(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{IF1Y:function(e,t,n){},QxlJ:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return W}));n("SuFq"),n("pNMO"),n("4Brf"),n("07d7"),n("0oug"),n("4mDm"),n("PKPk"),n("3bBZ"),n("mbEz");var a=n("wCAj"),r=(n("L/Qf"),n("2/Rp")),o=(n("qNb/"),n("PArb")),i=n("BkRI"),c=n.n(i),l=(n("sMBO"),n("oVuX"),n("rB9j"),n("Rm1S"),n("NBAS"),n("q1tI")),u=n.n(l),d=n("55Ip"),s=n("MeRu"),p=n("FC04"),f=n("Nlzp"),m=n("DgvE"),y=(n("tkto"),n("TeQF"),n("5DmW"),n("FZtP"),n("27RR"),n("zKZe"),n("7W5+"),n("8z0m")),v=(n("tULf"),n("Vl3Y")),b=(n("8QGh"),n("2fM7")),h=(n("k3Gp"),n("kLXV")),g=(n("AUBz"),n("ZTPi")),E=(n("5s+n"),n("p532"),n("2B1R"),n("1vPl"),n("5rEg"));n("x0AG"),n("pDQq"),n("ma9I"),n("+2oP"),n("pjDv");function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return o}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var P=function(e){var t=e.productList,n=e.changedfunc,a=e.searchedFunc,r=e.children,o=O(Object(l.useState)([-1]),2);o[0],o[1];return u.a.createElement("div",{className:"search-box"},u.a.createElement(E.a.Group,{compact:!0,style:{display:"inline-block"}},u.a.createElement(b.a,{showSearch:!0,optionFilterProp:"children",defaultValue:[-1],onChange:n,style:{width:200}},u.a.createElement(b.a.Option,{value:-1},"全部产品"),t.map((function(e,t){return u.a.createElement(b.a.Option,{key:t,value:e.productId},e.productName)}))),u.a.createElement(E.a.Search,{enterButton:!0,maxLength:30,placeholder:"请输入设备ID查询",onSearch:a,style:{width:250}})),r)};n("IF1Y");function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(){return(k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=N(e);if(t){var r=N(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return A(this,n)}}function A(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(i,e);var t,n,r,o=D(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).getGroupAddDevList=function(){t.setState({listLoading:!0});var e=j({},t.state.addListParams);-1==e.productId&&delete e.productId,Object(f.c)(f.a.getGroupSlctDev,e).then((function(e){var n=e.data||{},a=n.list,r=n.pager;t.setState({list:a,pager:r})})).finally((function(){t.setState({listLoading:!1})}))},t.setQuestParams=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=j({},t.state.addListParams);r[e]=n||void 0,"pageIndex"!==e&&(r.pageIndex=1),t.setState({addListParams:r},!a&&t.getGroupAddDevList||void 0)},t.onSelectRowKeys=function(e){t.setState({selectedRowKeys:e})},t.addDeviceOk=function(){var e=t.state,n=e.addWay,a=e.selectedRowKeys;if("1"==n){var r=a;r.length>0&&Object(f.c)(f.a.addGroupDevice,{id:t.props.id,deviceIds:r.join(",")}).then((function(e){t.setState({selectedRowKeys:[]}),t.props.openCloseAdd(!0)}))}else"2"==n&&(console.log(11,t.uploadForm.current),console.log(22,t.uploadForm.current.getFieldsValue()),t.uploadForm.current.submit())},t.changeAddWay=function(e){t.setState({addWay:e})},t.uploadForm=Object(l.createRef)(),t.state={addWay:"1",listLoading:!1,list:[],pager:{},selectedRowKeys:[],addListParams:{pageIndex:1,pageRows:8,id:e.id,productId:-1,deviceUniqueId:void 0}},t.columns=[{title:"设备id",dataIndex:"deviceUniqueId",key:"deviceUniqueId"},{title:"所属产品",dataIndex:"productName",key:"productName"},{title:"状态",dataIndex:"status",key:"status",render:function(e){return u.a.createElement("span",null,{0:"有效",1:"未激活",2:"在线",3:"离线",4:"禁用"}[e])}},{title:"最后上线时间",dataIndex:"lastOnlineTime",key:"lastOnlineTime",render:function(e){return u.a.createElement("span",null,e&&m.a.utcToDev(e)||"--")}}],t}return t=i,(n=[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props,n=t.addVisiable,r=t.openCloseAdd,o=t.productList,i=t.groupid,c=this.state,l=c.selectedRowKeys,d=c.list,s=c.pager,p=c.addWay,f=c.listLoading,m={selectedRowKeys:l,onChange:this.onSelectRowKeys};return u.a.createElement(h.a,{title:"添加设备到分组",visible:n,width:750,onOk:this.addDeviceOk,onCancel:function(){r(!1)},maskClosable:!1,className:"groupadd-device-modal"},u.a.createElement(g.a,{defaultActiveKey:"1",onChange:this.changeAddWay},u.a.createElement(g.a.TabPane,{tab:"查找选择",key:"1"},"1"==p&&u.a.createElement("div",null,u.a.createElement(P,{productList:o,changedfunc:function(t){e.setQuestParams("productId",t,!0)},searchedFunc:function(t){e.setQuestParams("deviceUniqueId",t)}}),u.a.createElement("div",{className:"list-content"},u.a.createElement(a.a,{rowKey:"deviceId",columns:this.columns,dataSource:d,rowSelection:m,loading:!!f,pagination:{defaultCurrent:s.pageIndex,total:s.totalRows,onChange:function(t){e.setQuestParams("pageIndex",t)},current:s.pageIndex}})))),u.a.createElement(g.a.TabPane,{tab:"本地导入",key:"2"},"2"==p&&u.a.createElement(F,{productList:o,groupid:i,ref:this.uploadForm,openCloseAdd:r}))))}}])&&C(t.prototype,n),r&&C(t,r),i}(l.PureComponent),K={labelCol:{span:6},wrapperCol:{span:12}},F=Object(l.forwardRef)((function(e,t){var n=e.productList,a=e.groupid,o=e.openCloseAdd;return u.a.createElement(v.a,k({ref:t},K,{onFinish:function(e){var t=e.data,n=e.productId,r="";if(t&&t.length){var i=t[0];i&&i.response&&i.response.data&&(r=i.response.data.url)}Object(f.c)(f.a.groupUpDevice,{groupid:a,productId:n,data:r}).then((function(e){o(!0)}))}}),u.a.createElement(v.a.Item,{label:"产品名称",name:"productId",rules:[{required:!0,message:"请选择产品"}]},u.a.createElement(b.a,{showSearch:!0,optionFilterProp:"children",placeholder:"请选择产品"},u.a.createElement(b.a.Option,{value:"",disabled:!0,selected:!0},"请选择产品"),n.map((function(e){var t=e.productName,n=e.productId;return u.a.createElement(b.a.Option,{key:n,value:n},t)})))),u.a.createElement(v.a.Item,{label:"上传文件",name:"data",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:e&&e.fileList},rules:[{required:!0,message:"请上传文件"}]},u.a.createElement(y.a,{accept:".xls,.xlsx",maxCount:1,action:f.a.upFileUrl,data:{appId:31438,domainType:4}},u.a.createElement(r.a,{type:"primary"},"上传文件"),u.a.createElement("span",{style:{marginLeft:"15px"}},"仅支持.xls,.xlsx格式文件"))),u.a.createElement("a",{style:{display:"inline-block",margin:"0 0 10px 172px"},href:"http://skintest.hetyj.com/31438/6b0b20891e06ac31d0eed37a5083cca9.xlsx"},"下载模板"))}));function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Q(e);if(t){var r=Q(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return G(this,n)}}function G(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?B(e):t}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(v,e);var t,n,i,y=V(v);function v(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),(t=y.call(this,e)).openDel=function(e,n){t.setState({delVisable:!0}),e&&t.setState({delid:e,deldeviceUniqueId:n})},t.getDetail=function(){Object(f.c)(f.a.getGroupDetail,{id:t.id}).then((function(e){var n=e.data,a=n.name,r=n.createTime,o=n.remark,i=n.deviceCount,c=n.activeCount,l=n.groupId;t.setState({name:a,remark:o,deviceCount:i,activeCount:c,groupId:l,createTime:m.a.utcToDev(r)})}))},t.getDownProduct=function(){Object(f.b)(f.a.getProductType).then((function(e){var n=[];for(var a in e.data)n.push({productId:a,productName:e.data[a]});t.setState({productList:n})}))},t.getGroupDevList=function(){var e=c()(t.state.listParams);-1==e.productId&&delete e.productId,Object(f.c)(f.a.getGroupDeviceList,e).then((function(e){var n=e.data||{},a=n.list,r=n.pager;t.setState({groupDevList:a,pager:r})}))},t.setParams=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=c()(t.state.listParams);r[e]=n||void 0,"pageIndex"!==e&&(r.pageIndex=1),t.setState({listParams:r},!a&&t.getGroupDevList||void 0)},t.openCloseAdd=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!t.state.addVisiable;t.setState({addVisiable:n}),n?(t.addListRefs.current.setQuestParams("pageIndex",1),t.addListRefs.current.setState({addWay:1})):e&&t.getGroupDevList()},t.onSelectRowKeys=function(e){t.setState({selectedRowKeys:e})},t.delOkCancel=function(e){var n=t.state,a=n.delid,r=n.selectedRowKeys;"ok"==e?Object(f.c)(f.a.delGroupDevice,{id:t.id,deviceIds:a||r.join(",")}).then((function(e){0==e.code&&(t.getGroupDevList(),t.setState({delid:"",delVisable:!1,selectedRowKeys:[]}))})):t.setState({delid:"",delVisable:!1})},t.id=e.match.params.groupid,t.groupidid=e.match.params.groupidid,t.defaultListParams={pageIndex:1,pageRows:10,id:t.id,productId:-1,deviceUniqueId:void 0},t.addListRefs=Object(l.createRef)(),t.state={listParams:c()(t.defaultListParams),name:"--",groupId:"--",createTime:"--",remark:"--",deviceCount:"--",activeCount:"--",groupDevList:[],pager:{},productList:[],addVisiable:!1,selectedRowKeys:[],delid:"",deldeviceUniqueId:"",delVisable:!1},t.columns=[{title:"设备id",dataIndex:"deviceUniqueId",key:"deviceUniqueId"},{title:"所属产品",dataIndex:"productName",key:"productName"},{title:"设备类型",dataIndex:"productClass",key:"productClass",render:function(e){return u.a.createElement("span",null,0==e?"普通设备":"网关设备")}},{title:"状态",dataIndex:"status",key:"status",render:function(e){return u.a.createElement("span",null,{0:"有效",1:"未激活",2:"在线",3:"离线",4:"禁用"}[e])}},{title:"最后上线时间",dataIndex:"lastOnlineTime",key:"lastOnlineTime",render:function(e){return u.a.createElement("span",null,e&&m.a.utcToDev(e)||"--")}},{title:"操作",key:"action",width:"200px",render:function(e,n){var a=n.deviceId,r=n.deviceUniqueId;return u.a.createElement("span",null,u.a.createElement(d.Link,{key:"detail",to:"/open/device/devManage/detail/".concat(a,"?step=1")},"查看"),u.a.createElement(o.a,{type:"vertical"}),u.a.createElement("a",{onClick:t.openDel.bind(B(t),a,r)},"从分组中删除"))}}],t}return t=v,(n=[{key:"componentDidMount",value:function(){this.getDetail(),this.getDownProduct(),this.getGroupDevList()}},{key:"render",value:function(){var e=this,t=this.state,n=t.name,o=t.createTime,i=t.remark,c=t.deviceCount,l=t.activeCount,d=t.groupId,f=t.productList,m=t.groupDevList,y=t.addVisiable,v=t.selectedRowKeys,b=t.pager,h=t.delVisable,g=t.delid,E=t.deldeviceUniqueId,O={selectedRowKeys:v,onChange:this.onSelectRowKeys};return u.a.createElement("section",{className:"page-groupdetail"},u.a.createElement(s.a,{backTitle:"分组详情",title:n},u.a.createElement("div",{className:"product_title_baseinfo_list"},u.a.createElement("div",null,u.a.createElement("div",null,"分组ID："),u.a.createElement("div",null,d)),u.a.createElement("div",null,u.a.createElement("div",null,"创建时间："),u.a.createElement("div",null,o)),u.a.createElement("div",null,u.a.createElement("div",null,"描述："),u.a.createElement("div",null,i||"无")))),u.a.createElement("div",{className:"comm-shadowbox comm-countbox"},u.a.createElement("div",{className:"item"},"设备总数",u.a.createElement("br",null),u.a.createElement("span",{className:"num"},c)),u.a.createElement("div",{className:"item"},"激活设备数",u.a.createElement("br",null),u.a.createElement("span",{className:"num"},l))),u.a.createElement("div",{className:"comm-shadowbox comm-boxpadding"},u.a.createElement(P,{productList:f,changedfunc:function(t){e.setParams("productId",t,!0)},searchedFunc:function(t){e.setParams("deviceUniqueId",t)}},u.a.createElement(r.a,{className:"but-add",type:"primary",onClick:this.openCloseAdd},"新增设备到分组")),u.a.createElement("div",null,u.a.createElement(r.a,{disabled:0==v.length,className:"but-del",type:"primary",onClick:this.openDel.bind(this,0)},"删除"),u.a.createElement(a.a,{rowKey:"deviceId",columns:this.columns,dataSource:m,rowSelection:O,pagination:{defaultCurrent:b.pageIndex,total:b.totalRows,hideOnSinglePage:!1,onChange:function(t){e.setParams("pageIndex",t)},current:b.pageIndex}}))),u.a.createElement(T,{addVisiable:y,ref:this.addListRefs,productList:f,id:this.id,groupid:this.groupidid,openCloseAdd:this.openCloseAdd}),u.a.createElement(p.a,{visible:h,modalOKHandle:this.delOkCancel.bind(this,"ok"),modalCancelHandle:this.delOkCancel.bind(this,"cancel"),title:"从分组中删除",descText:"即将删除".concat(g?"设备":"选中的"),targetName:g?"".concat(E):"".concat(v.length,"个设备")}))}}])&&q(t.prototype,n),i&&q(t,i),v}(l.PureComponent)}}]);