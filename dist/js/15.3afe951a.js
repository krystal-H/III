(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"17x9":function(e,t,n){e.exports=n("WUjv")(13)},"2mql":function(e,t,n){e.exports=n("WUjv")(21)},FbVF:function(e,t,n){"use strict";n.r(t);n("rB9j"),n("Rm1S");var a=n("q1tI"),r=n.n(a),o=n("55Ip"),i=(n("NBAS"),n("SuFq"),n("tkto"),n("pNMO"),n("TeQF"),n("5DmW"),n("FZtP"),n("27RR"),n("4Brf"),n("07d7"),n("0oug"),n("4mDm"),n("PKPk"),n("3bBZ"),n("mbEz"),n("wCAj")),c=(n("L/Qf"),n("2/Rp")),l=(n("Y2jk"),n("zeV3")),u=(n("0lcf"),n("mr32")),s=(n("k3Gp"),n("kLXV")),f=(n("8QGh"),n("2fM7")),m=(n("RKNx"),n("L41K")),p=(n("2B1R"),n("/MKj")),d=n("Nlzp"),b=(n("+2oP"),n("sMBO"),n("pjDv"),n("zKZe"),n("7W5+"),n("8z0m")),y=(n("K4yd"),n("9yH6")),v=(n("1vPl"),n("5rEg")),h=(n("tULf"),n("Vl3Y")),g=n("z7Xi"),O=n("P2RN"),w=n("DgvE"),E=n("rwTb"),I=[{nam:"待验证",color:"blue"},{nam:"验证中",color:"gold"},{nam:"已发布",color:"green"},{nam:"验证完成",color:"lime"}],j=[{nam:"待升级",color:"blue"},{nam:"升级中",color:"gold"},{nam:"升级成功",color:"green"},{nam:"升级失败",color:"magenta"},{nam:"取消",color:"geekblue"},{nam:"下载结束",color:"geekblue"},{nam:"重置升级",color:"geekblue"}],S={strextVer:/^[a-zA-Z0-9_\-\.]{1,30}$/,verNam:/^[a-zA-Z0-9\u4e00-\u9fa5][a-zA-Z0-9_\u4e00-\u9fa5]{0,39}$/,mainVer:/^[0-9]*$/,url:/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/},x=[{id:1,nam:"普通升级",desc:"用户可感知，升级触发时用户可以在app上查看到升级提醒，确认后才能升级"},{id:2,nam:"强制升级",desc:"用户可感知，在app上查看到升级提示，无需确认自动开始升级"},{id:3,nam:"静默升级",desc:"用户无感知，无需确认，设备主动请求升级"},{id:4,nam:"推送升级",desc:"用户无感知，无需确认，平台主动推送下发升级到设备（需配置升级策略）"}],V=[{id:0,nam:"全部设备"},{id:1,nam:"设备分组"},{id:2,nam:"指定设备"}],P=[{id:0,nam:"不重试"},{id:1,nam:"30分钟后"},{id:2,nam:"1小时后"}],D=[{id:1,nam:"1 次"},{id:2,nam:"2 次"},{id:3,nam:"3 次"}],T=["触发升级","定时升级"],C=["升级中","已完成"],k=[{id:2,nam:"MCU"},{id:3,nam:"SoC"}],F=n("2C8d"),N=["filePath1","filePath2"];function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var U=f.a.Option,q=h.a.Item,G={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:15}}},H=function(e,t,n){+t>2147483647?n("最大不能超过数值2147483647"):n()},Q=(Object(p.connect)((function(e){var t=e.get("otaUpgrade");return{mcusocproLi:t.mcusocproLi,firmwareFrPro:t.firmwareFrPro}}),(function(e){return{getVersionLi:function(t){return e(Object(F.e)(t))},firmwareLastVersion:function(t){return e(Object(F.a)(t))}}}))((function(e){e.refInstance;var t=e.changeState,n=e.firmwareLastVersion,o=e.mcusocproLi,i=e.firmwareFrPro,l=e.getVersionLi,u=_(Object(a.useState)(1),2),m=u[0],p=u[1],I=_(Object(a.useState)("0"),2),j=I[0],x=I[1],V=_(Object(a.useState)([]),2),P=V[0],D=V[1],T=_(h.a.useForm(),1)[0],C=i.schemeType,F=i.productFirmwareVersion,A=void 0===F?"--":F,B=i.deviceVersionId;Object(a.useEffect)((function(){console.log(22222,i),C&&(D([{firmwareTypeName:"aaa",firmwareTypeNo:1},{firmwareTypeName:"bbb",firmwareTypeNo:2},{firmwareTypeName:"ccc",firmwareTypeNo:3},{firmwareTypeName:"eee",firmwareTypeNo:4}]),Object(d.c)(d.a.getFirmwareList,{productId:productId,schemeType:C}).then((function(e){console.log(333,e)})))}),[i]),Object(a.useEffect)((function(){P.length}),[P.length]);return r.a.createElement(s.a,{title:"新增固件",visible:!0,onOk:T.submit,onCancel:function(){t("addFirmwareVisiable",!1)},width:650,maskClosable:!1},r.a.createElement(h.a,R({form:T},G,{className:"ota_add_firmware_dialog",onFinish:function(e){var n=e.filePath1,a=e.filePath2,r=M(e,N),o=void 0;3!=C&&0!=m||(o="1"==j&&n||Object(w.g)(a)),Object(d.c)(d.a.otaAddVersion,L(L({},r),{},{deviceVersionId:B,deviceVersionType:5,filePath:o})).then((function(e){Object(O.a)({type:"success",description:"新增成功！"}),l(),t("addFirmwareVisiable",!1)}))}}),r.a.createElement(q,{label:"产品名称",name:"productId",rules:[{required:!0,message:"请选择产品"}]},r.a.createElement(f.a,{showSearch:!0,optionFilterProp:"children",placeholder:"请选择产品",onChange:function(e){n(12150)}},o.map((function(e){var t=e.productName,n=e.productId;return r.a.createElement(U,{key:n,value:n},t)})))),r.a.createElement(q,{label:"开发方案"}," ",C&&k[C-2]&&k[C-2].nam||"--"),2==C&&r.a.createElement(r.a.Fragment,null,r.a.createElement(q,{label:"当前模组固件版本"}," "),r.a.createElement(q,{label:"最新模组固件版本"}," ")),r.a.createElement(q,{label:r.a.createElement(E.a,{label:"产品版本号",tip:"产品版本自动生成，自增长，产品的整体内部版本号"})},A),r.a.createElement(q,{label:"产品版本名称",name:"deviceVersionName",rules:[{required:!0,message:"请输入产品版本名称"}]},r.a.createElement(v.a,{maxLength:30,placeholder:"最多30个字符"})),2==C&&r.a.createElement(q,{label:"MCU升级",name:"mcuUpgrade",initialValue:1},r.a.createElement(y.a.Group,{onChange:function(e){p(e.target.value)}},r.a.createElement(y.a.Button,{value:1},"不升级"),r.a.createElement(y.a.Button,{value:0},"升级"))),r.a.createElement(r.a.Fragment,null,r.a.createElement(q,{label:3==C?"模块":"模块/插件"},r.a.createElement(f.a,{placeholder:"选择固件模块",onChange:function(){},mode:"multiple"},P.map((function(e,t){var n=e.firmwareTypeName,a=e.firmwareTypeNo;return r.a.createElement(U,{key:a,disabled:0==t,value:a},n)})))),r.a.createElement(q,{label:r.a.createElement(E.a,{label:"固件系列标识",tip:"区分不同固件包，只有相同的固件才能升级"}),name:"totalVersion",rules:[{required:!0,message:"请输入固件系列标识"},{pattern:S.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]},r.a.createElement(v.a,{maxLength:30,placeholder:"仅支持字母、数字、下划线、短横线、点号"})),r.a.createElement(q,{label:r.a.createElement(E.a,{label:"内部版本号",tip:"同一系列标识的固件通过对比内部版本号决定是否升级"}),name:"mainVersion",rules:[{required:!0,message:"请输入内部版本号"},{pattern:S.mainVer,message:"须为不小于0的整数"},{validator:H}]},r.a.createElement(v.a,{maxLength:10,placeholder:"内部版本须为不小于0的整数"})),r.a.createElement(q,{label:"固件程序",name:"notneed",required:!0,initialValue:"0"},r.a.createElement(y.a.Group,{onChange:function(e){x(e.target.value)}},r.a.createElement(y.a.Button,{value:"0"},"本地上传"),r.a.createElement(y.a.Button,{value:"1"},"填写URL"))),"1"==j?r.a.createElement(q,{className:"filepathinpt",name:"filePath1",rules:[{required:!0,message:"请输入URL"},{pattern:S.url,message:"请输入正确的URL"}]},r.a.createElement(v.a,{maxLength:100,placeholder:"请输入URL"})):r.a.createElement(q,{name:"filePath2",className:"filepathinpt",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:e&&e.fileList},rules:[{required:!0,message:"请上传文件"}]},r.a.createElement(b.a,{accept:".bin,.hex,.zip,.cyacd,.apk,.dpkg",maxCount:1,action:d.a.upFileUrl,data:{appId:31438,domainType:4}},r.a.createElement(c.a,{type:"primary"},r.a.createElement(g.a,null),"上传附件"),r.a.createElement("div",null,"支持.bin,.hex,.zip,.cyacd,.apk,.dpkg格式，不超过200MB。"))))))})),n("U8R4"),n("+eQT")),z=(n("oVuX"),n("ma9I"),n("fbCW"),n("wd/R")),K=n.n(z),W=n("WsrF");n("XlDN");function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Z,X=["upgradeDevice","beginDate","endDate"];function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ee(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=ie(e);if(t){var r=ie(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return oe(this,n)}}function oe(e,t){return!t||"object"!==J(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}f.a.Option;var ce=v.a.TextArea,le=(m.a.Step,[5,19]),ue={labelCol:{span:le[0]},wrapperCol:{span:le[1]}},se=W.a.create({name:"ota_reaease_ver"})(Object(p.connect)(null,(function(e){return{getGroupLi:function(){return e(Object(F.b)())},getVersionLi:function(t){return e(Object(F.e)(t))}}}))(Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(i,e);var t,n,a,o=re(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).changeState=function(e,n){var a=n.target?n.target.value:n;t.setState(te({},e,a))},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(O.a)({description:"文件上传大小超过500k限制"}),!1;var n=t.props,a=n.deviceVersionId,r=n.form.setFieldsValue;return Object(d.c)(d.a.otaImportMac,{multipartFile:e,deviceVersionId:a},{needFormData:!0}).then((function(e){var t=e.data,n=void 0===t?{}:t,a=n.successes,o=(n.fails,n.totalCount),i=n.successCount,c=n.failCount,l=a.join(",");r({upgradeDevice:l}),Object(O.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})})),!1},t.commit=function(){var e=t.props,n=e.form.validateFieldsAndScroll,a=e.deviceVersionId,r=e.close;n((function(e,n){if(!e){var o=n.upgradeDevice,i=n.beginDate,c=n.endDate,l=ee(n,X);o&&(l.upgradeDevice=o.join&&o.join(",")||o),(i||c)&&(l.beginDate=K()(i).format("YYYY-MM-DD HH:mm:ss"),l.endDate=K()(c).format("YYYY-MM-DD HH:mm:ss")),Object(d.b)(d.a.otaRelease,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({deviceVersionId:a},l),{loading:!0}).then((function(){t.props.getVersionLi(),r()}))}}))},t.state={upgradeType:1,upgradeRange:2,triggerTime:0},t}return t=i,(n=[{key:"componentDidMount",value:function(){this.props.getGroupLi()}},{key:"render",value:function(){var e,t,n=this,a=this.props.form.getFieldDecorator,o=this.state,i=o.upgradeType,l=o.upgradeRange,u=o.triggerTime,s=x.find((function(e){return e.id==i})).desc;return r.a.createElement("div",{className:"ota_release_dialog"},r.a.createElement(W.a,ue,r.a.createElement("div",null,r.a.createElement(W.a.Item,{label:"升级方式",required:!0,help:s,className:"helpitem"},a("upgradeType",{initialValue:1})(r.a.createElement(y.a.Group,{onChange:function(e){n.changeState("upgradeType",e)}},x.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(y.a.Button,{key:t,value:t},n)}))))),r.a.createElement(W.a.Item,{label:"升级提示信息"},a("upgradeRemark")(r.a.createElement(ce,{placeholder:"仅普通升级和强制升级时，用户可在app（或设备屏幕）查看到升级提示，最多50个字符",rows:3,maxLength:50}))),r.a.createElement(W.a.Item,{label:"升级范围",required:!0,help:"若选择全部设备，则有且仅能发布一个批次，不能新增其他发布批次",className:"helpitem"},a("upgradeRange")(r.a.createElement(y.a.Group,{onChange:function(e){n.changeState("upgradeRange",e)}},V.map((function(e){var t=e.id,n=e.nam;return 4==i&&0==t||1==t?null:r.a.createElement(y.a.Button,{key:t,value:t},n)}))))),2==l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a.Item,{label:"设备Mac"},a("upgradeDevice",{rules:[{required:!0,message:"请输入或导入要升级的设备Mac"}]})(r.a.createElement(ce,{placeholder:"请输入或导入要升级的设备Mac，多个用逗号隔开",rows:5}))),r.a.createElement("div",{className:"ota_uploadbox"},r.a.createElement(b.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},r.a.createElement(c.a,{type:"primary",icon:r.a.createElement(g.a,null)},"批量导入")),r.a.createElement(c.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板"))),4==i&&r.a.createElement("div",null,r.a.createElement(W.a.Item,{label:"升级时间策略",required:!0},a("triggerTime",{initialValue:0})(r.a.createElement(y.a.Group,{onChange:function(e){n.changeState("triggerTime",e)}},r.a.createElement(y.a.Button,{value:0},"触发升级"),r.a.createElement(y.a.Button,{value:1},"定时升级")))),1==u&&r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a.Item,{label:"升级开始时间"},a("beginDate",{rules:[{required:!0,message:"请选择开始时间"}]})(r.a.createElement(Q.a,(te(e={showTime:!0,placeholder:"请选择开始时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:K()("00:00:00","HH:mm:ss")}),te(e,"disabledDate",fe),te(e,"disabledTime",me),e)))),r.a.createElement(W.a.Item,{label:"升级结束时间"},a("endDate",{rules:[{required:!0,message:"请选择结束时间"}]})(r.a.createElement(Q.a,(te(t={showTime:!0,placeholder:"请选择结束时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:K()("00:00:00","HH:mm:ss")}),te(t,"disabledDate",fe),te(t,"disabledTime",me),t))))),r.a.createElement(W.a.Item,{label:"失败重试时间",required:!0},a("retryTime",{initialValue:0})(r.a.createElement(y.a.Group,null,P.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(y.a.Button,{key:t,value:t},n)}))))),r.a.createElement(W.a.Item,{label:"失败重试次数",required:!0},a("retryCount",{initialValue:1})(r.a.createElement(y.a.Group,null,D.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(y.a.Button,{key:t,value:t},n)})))))))),r.a.createElement("div",{className:"btnbox"},r.a.createElement(c.a,{type:"primary",onClick:this.commit},"确定")))}}])&&ne(t.prototype,n),a&&ne(t,a),i}(a.Component))||Z);function fe(e){return e&&e<K()().startOf("day")}function me(){return{disabledHours:function(){return pe("h")},disabledMinutes:function(){return pe("m")}}}function pe(e){var t=K()().format(e)-0;console.log(e,K()().format(e));for(var n=[],a=0;a<t;a++)n.push(a);return console.log(e,n),n}n("2DKY");var de=n("+KLJ");function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Oe(e);if(t){var r=Oe(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ge(this,n)}}function ge(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=v.a.TextArea,Ee={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},Ie=["系统验证：要求输入的设备全部都升级成功到新版本后，状态才更新成验证完成。","手动验证：用户线下自行对设备验证，验证通过后，选择验证完成状态。"],je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(i,e);var t,n,a,o=he(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).changeValidateType=function(){},t.handleSubmit=function(){var e=t.props,n=e.deviceVersionId,a=e.validationDetail,r=a.macSet,o=a.validateType,i=e.pagerIndex,c=e.pageIndex,l=e.close;if(r){var u=t.setValidationDetail.status;Object(d.c)(d.a.otaValidate,{deviceVersionId:n,macSet:r,validateType:o,status:u},{loading:!0}).then((function(e){i(c),l()}))}else t.setState({error:!0})},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(O.a)({description:"文件上传大小超过500k限制"}),!1;var n=t.props.deviceVersionId;return Object(d.c)(d.a.otaImportMac,{multipartFile:e,deviceVersionId:n},{needFormData:!0}).then((function(e){var n=e.data,a=void 0===n?{}:n,r=a.successes,o=a.totalCount,i=a.successCount,c=a.failCount,l=r.join(",");t.props.setValidationDetail("macSet",l),Object(O.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})})),!1},t.changeStatus=function(e){t.setState({status:e})},t.changeValue=function(e,n){var a=n.target.value;(0,t.props.setValidationDetail)(e,a)},t.state={status:0,error:!1},t}return t=i,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.validationDetail,a=n.macSet,o=n.validateType,i=t.title,l=t.close,u=this.state.error;return r.a.createElement(s.a,{title:i,visible:!0,onOk:this.handleSubmit,onCancel:l,width:650,maskClosable:!1},r.a.createElement("div",{className:"ota_validationdialog"},r.a.createElement(W.a,Ee,r.a.createElement(W.a.Item,{label:"验证模式",name:"validateType"},r.a.createElement(y.a.Group,{value:o,onChange:function(t){e.changeValue("validateType",t)}},r.a.createElement(y.a.Button,{value:0},"系统验证"),r.a.createElement(y.a.Button,{value:1},"手动验证"))),r.a.createElement(W.a.Item,{label:"设备Mac",required:!0,help:!a&&u?"请输入或导入要验证的设备Mac":"",validateStatus:!a&&u?"error":""},r.a.createElement(we,{value:a,placeholder:"请输入或导入要验证的设备Mac，多个用逗号隔开",rows:7,onChange:function(t){e.changeValue("macSet",t)}})),r.a.createElement("div",{className:"ota_uploadbox"},r.a.createElement(b.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},r.a.createElement(c.a,{type:"primary",icon:r.a.createElement(g.a,null)},"批量导入")),r.a.createElement(c.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板")),1==o&&r.a.createElement(W.a.Item,{label:"线下验证状态",name:"status"},r.a.createElement(y.a.Group,{defaultValue:0,onChange:function(t){e.changeStatus(t.target.value)}},r.a.createElement(y.a.Button,{value:0},"验证中"),r.a.createElement(y.a.Button,{value:1},"验证完成")))),r.a.createElement(de.a,{message:Ie[o],type:"info",showIcon:!0})))}}])&&ye(t.prototype,n),a&&ye(t,a),i}(a.Component);n("5s+n"),n("p532"),n("p7yf");function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Ve,Pe=[{title:"产品名称",dataIndex:"productName"},{title:"模块/插件",dataIndex:"deviceVersionName"},{title:"模块/插件编号",dataIndex:"firmwareVersionType"},{title:"当前软件版本号",dataIndex:"extVersion"}],De=function(e){var t=e.productFirmwareId,n=e.schemeType,o=e.openClose,c=Se(Object(a.useState)([]),2),l=c[0],u=c[1],f=Se(Object(a.useState)(!0),2),m=f[0],p=f[1];return Object(a.useEffect)((function(){t&&(p(!0),Object(d.c)(d.a.otaDevVersionList,{productFirmwareId:t,schemeType:n}).then((function(e){var t=e.data;u(void 0===t?[]:t)})).finally((function(){return p(!1)})))}),[t]),r.a.createElement(s.a,{title:"查看固件",visible:!!t,width:700,onOk:function(){o()},onCancel:function(){o()},footer:null,afterClose:function(){return u([])}},r.a.createElement(i.a,{className:"viewFirmList-modal",rowKey:"deviceVersionId",columns:Pe,dataSource:l,loading:m,pagination:!1,scroll:{y:500}}))},Te=n("MeRu"),Ce=n("QjPx"),ke=n.n(Ce);function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){Ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Ye(e);if(t){var r=Ye(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return _e(this,n)}}function _e(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ue=m.a.Step,qe=f.a.Option,Ge=Object(p.connect)((function(e){var t=e.get("otaUpgrade");return{versionList:t.versionList,mcusocproLi:t.mcusocproLi}}),(function(e){return{getVersionLi:function(t){return e(Object(F.e)(t))},getExtVerLi:function(t){return e(Object(F.c)(t))},getMcuSocProLi:function(t){return e(Object(F.d)())}}}))(Ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(b,e);var t,n,a,p=Me(b);function b(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),console.log(e),(t=p.call(this,e)).changeState=function(e,n){t.setState(Ae({},e,n))},t.switchDialog=function(e){var n=t.state[e];t.setState(Ae({},e,!n))},t.openRelease=function(e){t.setState({releaseFirmwareDialog:!0,productFirmwareId:e})},t.openValidation=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{macSet:"",validateType:0};t.setState({validationFirmwareDialog:!0,productFirmwareId:e,validationDetail:n,validationModTit:n.macSet?"修改验证":"验证"})},t.getValidateInfo=function(e){Object(d.b)(d.a.otaValiGetinfo,{deviceVersionId:e}).then((function(e){var n=e.data||[];t.setState({validateInfo:n}),n.length||Object(O.a)({description:"没有查到验证信息"})}))},t.closeValidateInfo=function(){t.setState({validateInfo:[]})},t.deleteConfirm=function(e){s.a.confirm({title:"删除固件",content:"即将删除 ID 为 ".concat(e," 的固件，此固件包下各批次的升级设备信息也将一并删除。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(d.b)(d.a.otaDeleteVer,{deviceVersionId:e}).then((function(e){var n=t.state.pager,a=n.totalRows,r=n.pageIndex;r=a%(10*(r-1))>1?r:r-1,t.pagerIndex(r)}))}})},t.pagerIndex=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=t.state,a=n.productId,r=n.schemeType,o={pageIndex:e};"-1"!=a&&(o.productId=a),"-1"!=r&&(o.schemeType=r),t.props.getVersionLi(o)},t.closeValiFirm=function(){t.switchDialog("validationFirmwareDialog")},t.setValidationDetail=function(e,n){var a=t.state.validationDetail;t.setState({validationDetail:Re(Re({},a),{},Ae({},e,n))})},t.changeParamsGet=function(e,n){t.setState(Ae({},e,n),(function(){t.pagerIndex(1)}))},t.openCloseViewFirmList=function(e,n){t.setState({viewFirmid:e,viewFirmtype:n})},t.state={versionList:[],pager:{pageIndex:1,totalRows:10},productId:Object(w.h)("productId")||"-1",schemeType:void 0,addFirmwareVisiable:!1,validationFirmwareDialog:!1,productFirmwareId:"",validationDetail:{macSet:"",validateType:0},validationModTit:"验证",validateInfo:[],releaseFirmwareDialog:!1,viewFirmid:void 0,viewFirmtype:void 0},t.columns=[{title:"产品名称",dataIndex:"productName"},{title:"开发方案",dataIndex:"schemeType",render:function(e){return e>0&&k[e-2].nam||"脏数据"}},{title:"产品版本号",dataIndex:"extVersion"},{title:"产品版本名称",dataIndex:"productFirmwareName"},{title:"运行状态",dataIndex:"status",render:function(e){var t=I[e],n=t.nam,a=t.color;return r.a.createElement(u.a,{color:a},n)}},{title:"创建时间",dataIndex:"createTime",render:function(e){return r.a.createElement("span",null,e&&w.a.utcToDev(e)||"--")}},{title:"操作",dataIndex:"action",render:function(e,n){var a=n.status,i=void 0===a?0:a,c=n.macSet,u=void 0===c?"":c,s=n.validateType,f=void 0===s?0:s,m=(n.productId,n.productFirmwareId),p=n.schemeType;n.firmwareVersionType;return r.a.createElement(l.b,null,r.a.createElement("a",{onClick:function(){t.openCloseViewFirmList(m,p)}},"查看固件"),0==i?r.a.createElement("a",{onClick:function(){t.openValidation(m)}},"验证"):1==i?r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{onClick:function(){t.openValidation(m,{macSet:u,validateType:f||0})}},"修改验证"),r.a.createElement("a",{onClick:function(){t.getValidateInfo(m)}},"查看验证")):2==i?r.a.createElement(o.Link,{to:"/open/product/otaUpdate/details/".concat(m)},"查看批次"):r.a.createElement("a",{onClick:function(){t.openRelease(m)}},"发布"))}}],t.valInfoColumns=[{title:"Mac地址",dataIndex:"macAddress"},{title:"验证时间",dataIndex:"upgradeTime",render:function(e){return r.a.createElement("span",null,e&&w.a.utcToDev(e)||"--")}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"验证状态",dataIndex:"upgradeStatus",render:function(e){var t=j[e],n=t.nam,a=t.color;return r.a.createElement(u.a,{color:a},n)}},{title:"备注",dataIndex:"remark",render:function(e,t){return 3==t.upgradeStatus&&e||""}}],t}return t=b,(n=[{key:"componentDidMount",value:function(){this.pagerIndex(),this.props.getMcuSocProLi()}},{key:"render",value:function(){var e=this,t=this.state,n=(t.addFirmwareVisiable,t.releaseFirmwareDialog),a=t.validationFirmwareDialog,o=t.productFirmwareId,l=t.validationDetail,u=t.validateInfo,p=t.validationModTit,d=t.viewFirmid,b=t.viewFirmtype,y=this.props,v=y.versionList,h=v.list,g=v.pager,O=y.mcusocproLi,E=g.pageIndex,I=g.totalRows;return r.a.createElement("div",{className:"ota-firmware-up"},r.a.createElement(Te.a,{title:"固件升级",selectOnchange:function(t){e.changeParamsGet("productId",t)},defaultValue:Object(w.h)("productId")||"-1",selectData:O}),r.a.createElement("div",{className:"comm-shadowbox comm-setp-ttip"},r.a.createElement("div",{className:"step-title"},r.a.createElement("img",{src:ke.a,alt:""}),r.a.createElement("span",null,"固件升级步骤")),r.a.createElement(m.a,{current:-1,initial:0},r.a.createElement(Ue,{title:"添加升级包",description:"添加升级包，区分不同的MCU、模组、系统。"}),r.a.createElement(Ue,{title:"配置升级策略",description:"配置升级对象，配置升级批次、升级范围、升级时间等升级具体策略。"}),r.a.createElement(Ue,{title:"查看升级详情",description:"查看升级包各升级批次的具体设备列表，以及各设备的升级状态。"}))),r.a.createElement("div",{className:"otacontent comm-shadowbox"},r.a.createElement("div",{className:"otasearchbox"},r.a.createElement("div",{className:"searchgroupbox"},r.a.createElement("span",null,"方案类型："),r.a.createElement(f.a,{className:"typeselect",defaultValue:-1,onChange:function(t){e.changeParamsGet("schemeType",t)}},r.a.createElement(qe,{value:-1},"全部类型"),k.map((function(e,t){var n=e.id,a=e.nam;return r.a.createElement(qe,{key:t,value:n},a)})))),r.a.createElement(c.a,{className:"button",onClick:function(){e.switchDialog("addFirmwareVisiable")},type:"primary"},"添加固件")),r.a.createElement(i.a,{rowKey:function(e){return e.productFirmwareId+"_"},columns:this.columns,dataSource:h,pagination:{defaultCurrent:E,total:I,hideOnSinglePage:!1,onChange:this.pagerIndex}}),!1,n&&r.a.createElement(s.a,{title:"发布固件",visible:!0,width:660,onCancel:function(){e.switchDialog("releaseFirmwareDialog")},footer:null,maskClosable:!1},r.a.createElement(se,{deviceVersionId:o,close:function(){e.switchDialog("releaseFirmwareDialog")}})),a&&r.a.createElement(je,{deviceVersionId:o,validationDetail:Re({},l),setValidationDetail:this.setValidationDetail,pagerIndex:this.pagerIndex,pageIndex:E,close:this.closeValiFirm,title:p}),r.a.createElement(De,{productFirmwareId:d,schemeType:b,openClose:this.openCloseViewFirmList}),r.a.createElement(s.a,{title:"验证信息",visible:!!u.length,onCancel:this.closeValidateInfo,width:800,footer:null},r.a.createElement(i.a,{rowKey:"macAddress",columns:this.valInfoColumns,dataSource:u,pagination:!1}))))}}])&&Le(t.prototype,n),a&&Le(t,a),b}(a.Component))||Ve,He=(n("OrB1"),n("gFTJ"));n("hByQ");function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){We(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function We(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Je(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ze(e,t){return(Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=et(e);if(t){var r=et(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return $e(this,n)}}function $e(e,t){return!t||"object"!==Qe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(l,e);var t,n,a,c=Xe(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=c.call(this,e)).getBatch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=t.deviceVersionId,a=t.state.batchId;Object(d.b)(d.a.otaGetBatch,{deviceVersionId:n,batchId:a,pageIndex:e,pageRows:10}).then((function(e){var n=e.data,a=n.list,r=void 0===a?[]:a,o=n.pager,i=void 0===o?{}:o;t.setState({list:r,pager:i})}))},t.getDetail=function(){var e=t.deviceVersionId;Object(d.c)(d.a.otaGetVersionDetail,{deviceVersionId:e}).then((function(e){var n=e.data;t.setState({details:Ke({},n)})}))},t.search=function(e){t.setState({batchId:e},(function(){t.getBatch()}))},t.deviceVersionId=e.match.params.id,t.state={batchId:void 0,list:[],pager:{},details:{}},t.columns=[{title:"批次ID",dataIndex:"batchId"},{title:"发布时间",dataIndex:"createTime",render:function(e){return r.a.createElement("span",null,e&&w.a.utcToDev(e)||"--")}},{title:"升级范围",dataIndex:"upgradeRange",render:function(e){return V[e].nam}},{title:"升级方式",dataIndex:"upgradeType",render:function(e){return x[e-1].nam}},{title:"升级策略",dataIndex:"triggerTime",render:function(e){return T[e]}},{title:"状态",dataIndex:"upgradeStatus",render:function(e){return["升级中","已完成"][e]}},{title:"操作",key:"id",render:function(e,n){var a=n.batchId;return r.a.createElement(o.Link,{to:"/open/product/otaUpdate/batch/".concat(t.deviceVersionId,"/").concat(a)},"查看")}}],t}return t=l,(n=[{key:"componentDidMount",value:function(){this.getBatch(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,n=t.pager,a=n.pageIndex,o=n.totalRows,c=n.totalPages,l=t.list,u=t.details,s=u.firmwareVersionTypeName,f=u.productName,m=u.deviceVersionTypeName,p=u.productFirmwareVersion,d=u.uploadTime,b=u.mainVersion,y=u.totalVersion;return r.a.createElement("section",{className:"ota-firmwaredetail flex-column"},r.a.createElement(Te.a,{title:s,titleBack:!0},r.a.createElement("header",{className:"page-content-header"},r.a.createElement(He.b,{title:"",className:"descriptions",column:4},r.a.createElement(He.b.Item,{label:"归属产品"},f),r.a.createElement(He.b.Item,{label:"固件类型"},m),r.a.createElement(He.b.Item,{label:"上传时间"},d&&w.a.utcToDev(d)),r.a.createElement(He.b.Item,{label:"内部版本号"},b),r.a.createElement(He.b.Item,{label:"产品版本号"},p),r.a.createElement(He.b.Item,{label:"固件模块"},s),r.a.createElement(He.b.Item,{label:"固件系列标识"},y)))),r.a.createElement("div",{className:"comm-shadowbox",style:{padding:"24px"}},r.a.createElement(v.a.Search,{placeholder:"输入发布批次ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),r.a.createElement(i.a,{rowKey:"batchId",columns:this.columns,dataSource:l,pagination:{defaultCurrent:a,total:o,hideOnSinglePage:!0,onChange:function(t){e.getBatch(t)},current:a,showSizeChanger:!1,showQuickJumper:c>5}})))}}])&&Je(t.prototype,n),a&&Je(t,a),l}(a.PureComponent);function nt(e){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function at(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?at(Object(n),!0).forEach((function(t){ot(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function it(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ct(e,t){return(ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=st(e);if(t){var r=st(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ut(this,n)}}function ut(e,t){return!t||"object"!==nt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ct(e,t)}(c,e);var t,n,a,o=lt(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=o.call(this,e)).cancel=function(e){var n=t.verid,a=t.id;Modal.confirm({title:"取消升级",content:"即将取消升级 deviceId 为 ".concat(e," 的设备。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(d.b)(d.a.otaCancelDevicePub,{deviceVersionId:n,batchId:a,deviceId:e}).then((function(){var e=t.state.pager,n=e.totalRows,a=e.pageIndex;a=n%(10*(a-1))>1?a:a-1,t.getList(a)}))}})},t.getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=t.verid,a=t.id,r=t.state.deviceId;Object(d.b)(d.a.otaGetBatchDevice,{deviceVersionId:n,batchId:a,deviceId:r,pageIndex:e,pageRows:10}).then((function(e){var n=e.data,a=n.list,r=void 0===a?[]:a,o=n.pager,i=void 0===o?{}:o;t.setState({list:r.map((function(e,t){return rt(rt({},e),{},{index:t})})),pager:i})}))},t.getDetail=function(){var e=t.verid,n=t.id;Object(d.b)(d.a.otaGetBatchInfo,{deviceVersionId:e,batchId:n}).then((function(e){var n=e.data;t.setState({details:rt({},n)})}))},t.search=function(e){t.setState({deviceId:e},(function(){t.getList()}))},t.id=e.match.params.id,t.verid=e.match.params.verid,t.state={deviceId:void 0,list:[],pager:{},details:{}},t.columns=[{title:"设备ID",dataIndex:"deviceId"},{title:"MAC地址",dataIndex:"mac"},{title:"产品",dataIndex:"productName"},{title:"设备分组名",dataIndex:"groupName"},{title:"最新升级时间",dataIndex:"updateTime",render:function(e){return r.a.createElement("span",null,e&&w.a.utcToDev(e)||"--")}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"升级状态",dataIndex:"upgradeStatus",render:function(e){return e&&j[e].nam}},{title:"操作",key:"act",render:function(e,n){var a=n.deviceId,o=n.upgradeStatus;return r.a.createElement("span",null,0==o&&r.a.createElement("a",{onClick:function(){t.cancel(a)}},"取消"))}}],t}return t=c,(n=[{key:"componentDidMount",value:function(){this.getList(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,n=t.pager,a=n.pageIndex,o=n.totalRows,c=n.totalPages,l=t.list,u=t.details,s=u.deviceVersionName,f=u.upgradeStatus,m=void 0===f?0:f,p=u.upgradeRange,d=void 0===p?0:p,b=u.createTime,y=u.triggerTime,h=u.beginTime,g=u.endTime,O=u.retryCount,E=u.retryTime,I=u.upgradeType;return r.a.createElement("section",{className:"ota-firmwaredetail flex-column"},r.a.createElement(Te.a,{title:"".concat(s||"固件包"," / ").concat(this.id),titleBack:!0},r.a.createElement("header",{className:"page-content-header"},r.a.createElement(He.b,{title:"",className:"descriptions",column:4},r.a.createElement(He.b.Item,{label:"升级状态"},C[m]),r.a.createElement(He.b.Item,{label:"升级范围"},V[d].nam),r.a.createElement(He.b.Item,{label:"发布时间"},b&&w.a.utcToDev(b)),r.a.createElement(He.b.Item,{label:"升级方式"},I&&x[I-1].nam||"--"),r.a.createElement(He.b.Item,{label:"升级触发策略"},T[y]),r.a.createElement(He.b.Item,{label:"升级开始时间"},h&&w.a.utcToDev(h)),r.a.createElement(He.b.Item,{label:"升级结束时间"},g&&w.a.utcToDev(g)),r.a.createElement(He.b.Item,{label:"升级失败重试"},E),r.a.createElement(He.b.Item,{label:"失败重试次数"},O,"次")))),r.a.createElement("div",{className:"comm-shadowbox",style:{padding:"24px"}},r.a.createElement(v.a.Search,{placeholder:"输入设备ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),r.a.createElement(i.a,{rowKey:"index",columns:this.columns,dataSource:l,pagination:{defaultCurrent:a,total:o,hideOnSinglePage:!1,onChange:function(t){e.getList(t)},current:a,showSizeChanger:!1,showQuickJumper:c>5}})))}}])&&it(t.prototype,n),a&&it(t,a),c}(a.PureComponent);t.default=function(e){var t=e.match.path;return r.a.createElement(o.Switch,null,r.a.createElement(o.Route,{path:"".concat(t,"/list"),component:Ge}),r.a.createElement(o.Route,{path:"".concat(t,"/details/:id"),component:tt}),r.a.createElement(o.Route,{path:"".concat(t,"/batch/:verid/:id"),component:ft}),r.a.createElement(o.Redirect,{to:"".concat(t,"/list")}))}},MgzW:function(e,t,n){e.exports=n("WUjv")(35)},QjPx:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACHElEQVQokW2SP0iVYRTGf+97v+/LNDO1wjSDhiAKMWioqIYQFDcjkAanGoSohiBaHWvJKQiClhyiqKChoYIiQh0KIQtbDOxWphJlwvV67/eep+G73kp84OW8HHie85w/jn/w8sN8r4V0GLFHkkdCABIyIUdBsqfENYM9nS3zANEq+c1X1S79+H4BYxZsVsqIZAI5YJ/MmhF9FIsAJwEcwOuPC61pKT0aQqjLGEaw7OdM5iI3VZpdeZfbFt9QsLNyrtB7aHcdQPTq/VxPqVi6K7gDnJLUWq0uMAnKwjdHt8NC+Zxvjvpk1rzq3KdpuC6U7zrQdtGCHsiEtO47E7bkOs1sSqbq3NzziS9BkndiUtJeSbEyC0hQNhida2BqcROFcpQ2bki1v2Epniw21d7vd8vu2du8QOPeRadZg8+LycaRT033UnMdiYfYQVyJSY6xckJXJBngil0HW2fWChy7paEIOhIHbfVw6TjcHIVfBYgdR2oDVzwCZGu5VHY8EDto2wxXe6GjBYa6YUd9xY1jwEv6u+81iD3tsYefBTj/MMtdfgyLhayVxNPuZYatb4DYk6/27Cu5yhySLOa9oGBSw3oCiWckySoR+6poVSRyjLgn49OPFNQHmpBYVPV8jVJw8YuFXYeXyjW5/zbgIfKMrQS6olzQYApI6pZUq8oFSiKHcWLrjE393j79rdjoYs/O2JOPHCMrgWvD/W75DzRNJjQqUF42AAAAAElFTkSuQmCC"},p7yf:function(e,t,n){}}]);