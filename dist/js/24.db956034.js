(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{gbE0:function(e,t,n){"use strict";n.r(t);n("ef1R"),n("Ra8s"),n("sfoS"),n("HsXu"),n("bs69"),n("Lm8M"),n("ryEf"),n("qgAm"),n("9b3Y"),n("Ck9u"),n("59iL");var a=n("f6Fh"),r=n("T9Mk"),l=n.n(r),i=n("DgvE"),c=n("Nlzp"),o=n("MeRu"),u=(n("IHDg"),n("P37N"),n("vV4J"),n("av3G"),n("RfWx"),n("MNU5"),n("YeX6")),s=(n("UdMA"),n("ViyK")),m=(n("SmMv"),n("DTgQ")),f=(n("QcZr"),n("b+L2")),d=n("FC04"),p=(n("UTJx"),n("dVdO")),g=(n("a6t6"),n("N1Yw")),b=(n("odtX"),n("4Hua")),y=n("v7xx"),v=n("P2RN");function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var h=function(e){var t=e.warningInof,n=e.closeDetailMod,a=e.delwithWarn,o=t.alarmTime,u=t.warningTitle,m=t.state,f=t.warningWay,d=t.ruleName,O=t.warningDetail,h=t.deviceIds,j=t.dealDetail,w=t.id,S=E(Object(r.useState)(""),2),I=S[0],x=S[1],P=E(Object(r.useState)(""),2),C=P[0],A=P[1],T=1==m&&l.a.createElement(y.a,{style:{padding:"0"},preText:"取消",nextText:"提交",preHandle:n,nextHandle:function(){I?a({id:w,dealDetail:I}):Object(v.a)({description:"请填写处理记录",type:"warn"})}})||l.a.createElement(y.a,{style:{padding:"0"},nextBtn:!1,preText:"关闭",preHandle:n});return l.a.createElement(p.a,{className:"page-warninginfo-modal",title:u,visible:!!u,width:700,onCancel:n,footer:T},l.a.createElement(g.a,{gutter:[12,16]},l.a.createElement(b.a,{span:5,className:"detail-label"},"告1警时间："),l.a.createElement(b.a,{span:18},i.a.utcToDev(o)||"--"),l.a.createElement(b.a,{span:5,className:"detail-label"},"告警消息类型："),l.a.createElement(b.a,{span:18},{0:"站内",1:"站内+邮件"}[f]),l.a.createElement(b.a,{span:5,className:"detail-label"},"关联的告警规则："),l.a.createElement(b.a,{span:18},d||"--"),l.a.createElement(b.a,{span:5,className:"detail-label"},"告警内容："),l.a.createElement(b.a,{span:18},l.a.createElement("div",null,O||"--")),l.a.createElement(b.a,{span:5,className:"detail-label"},"告警设备ID："),l.a.createElement(b.a,{span:16},l.a.createElement("div",null,C||h||"")),l.a.createElement(b.a,{span:2},l.a.createElement("a",{onClick:function(){Object(c.c)(c.a.getWarningInfo,{id:w},{loading:!0}).then((function(e){A(e.data.deviceIds)}))}},"刷新")),l.a.createElement(b.a,{span:5,className:"detail-label"},"处理记录："),l.a.createElement(b.a,{span:18},1==m&&l.a.createElement(s.a.TextArea,{rows:3,value:I||j||"",placeholder:"处理记录",onChange:function(e){x(e.target.value)}})||l.a.createElement("div",null,I||j||""))))},j=(n("2ek4"),n("oWtQ")),w=(n("hEGT"),n("6IzV"),n("QFmM"));function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var A=s.a.TextArea,T=w.a.Item,k={labelCol:{span:6},wrapperCol:{span:12}};function N(e,t){var n=e.setStepCur,a=e.formdata,i=P(w.a.useForm(),1)[0];Object(r.useEffect)((function(){a.name?i.setFieldsValue(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},a)):i.resetFields()}),[a.name]);return l.a.createElement("div",null,l.a.createElement(w.a,S({ref:t,form:i},k,{onFinish:function(e){n(1)}}),l.a.createElement(T,{label:"告警规则名称",name:"name",rules:[{required:!0,message:"请输入告警规则名称"},{max:30,message:"最大输入长度为30字符"}]},l.a.createElement(s.a,{placeholder:"告警规则名称"})),l.a.createElement(T,{label:"描述",name:"remark",rules:[{max:100,message:"最大输入长度为100字符"}]},l.a.createElement(A,{placeholder:"告警规则描述",showCount:!0,maxLength:100,rows:4}))),l.a.createElement(y.a,{preBtn:!1,nextHandle:i.submit}))}var D=Object(r.memo)(Object(r.forwardRef)(N)),F=(n("oENA"),n("uTCA")),W=(n("xzjF"),n("PeP6"));n("pckg"),n("J2lP"),n("hjnz"),n("62KB");function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var U=W.a.Option,z=w.a.Item,B={labelCol:{span:8},wrapperCol:{span:16}},J=[{id:0,nam:"属性触发"},{id:1,nam:"事件触发"},{id:3,nam:"上线触发"},{id:4,nam:"下线触发"},{id:2,nam:"上下线触发"}],K=[{id:"1",nam:"=="},{id:"2",nam:">"},{id:"3",nam:"<"},{id:"4",nam:">="},{id:"5",nam:"<="},{id:"6",nam:"!="},{id:"7",nam:"in"},{id:"8",nam:"between"}],$=[{id:"1",nam:"="},{id:"6",nam:"!="},{id:"7",nam:"in"}];function G(e,t){var n=e.setStepCur,a=e.formdata,i=H(w.a.useForm(),1)[0],o=H(Object(r.useState)([]),2),u=o[0],s=o[1],m=H(Object(r.useState)([]),2),f=m[0],d=m[1],p=H(Object(r.useState)([]),2),v=p[0],E=p[1],O=H(Object(r.useState)([]),2),h=O[0],j=O[1],S=H(Object(r.useState)(a.triggerMode),2),I=S[0],x=S[1],P=H(Object(r.useState)(a.productId),2),C=P[0],A=P[1],T=H(Object(r.useState)(a.connType||"0"),2),k=T[0],N=T[1],D=H(Object(r.useState)(!1),2),V=D[0],R=D[1];Object(r.useEffect)((function(){0==u.length&&K()}),[]),Object(r.useEffect)((function(){C&&$(C)}),[C]),Object(r.useEffect)((function(){if(!V)if(a.productId){if(u.length>0&&f>0){var e=a.productId,t=a.deviceIds,n=a.triggerMode,r=a.props,l={productId:e,deviceIds:t,triggerMode:n};if(n>1)i.setFieldsValue(q({},l));else{l.ruletype=k;for(var c=0;c<r.length;c++){var o=r[c],s=o.propName,m=o.propIdentifier,d=o.propFieldType,p=o.judge,g=o.propVal,b=c>0?"_add":"";l["propName".concat(b)]="".concat(m,",").concat(d,",").concat(s),l["judge".concat(b)]=p,l["propVal".concat(b)]=g}if(1==n){G(e);var y=a.eventName,E=a.eventIdentifier+","+y;l.identifier=E,_(E),h.length>0&&v.length>0&&i.setFieldsValue(q({},l))}else 0==n&&(_(),v.length>0&&i.setFieldsValue(q({},l)))}}}else i.resetFields()}),[a.productId,u,f,v,h,V]),Object(r.useImperativeHandle)(t,(function(){return{formDataToData:L()}}),[L]);var L=function(){var e=i.getFieldsValue(),t=e.triggerName,n=e.productId,a=e.deviceIds,r=e.triggerMode,l={triggerName:t,productId:n,deviceIds:a,triggerMode:r};if(r<2){var c=e.identifier,o=e.ruletype,u=e.propName,s=e.judge,m=e.propVal;if(c){var f=c.split(",");l.eventName=f[1],l.eventIdentifier=f[0]}var d=u.split(","),p=[{propName:d[2],propIdentifier:d[0],propFieldType:d[1],judge:s,propVal:m}];if("0"!==o){l.connType=o;var g=e.propName_add,b=e.judge_add,y=e.propVal_add,v=g.split(",");p.push({propName:v[2],propIdentifier:v[0],propFieldType:v[1],judge:b,propVal:y})}l.props=p}return l},K=function(){Object(c.b)(c.a.getProductType,{},{loading:!0}).then((function(e){var t=e.data,n=Object.keys(t).map((function(e){return{id:e,name:t[e]}}));s(n)}))},$=function(e){Object(c.c)(c.a.getDeviceListByProId,{productId:e,pageIndex:1,pageRows:9999},{loading:!0}).then((function(e){d(e.data.list)}))},G=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;Object(c.c)(c.a.getWarnEventLi,{productId:e},{loading:!0}).then((function(e){var t=e&&e.data||[];j(t)}))},_=function(e){var t={productId:C},n=c.a.getWarnProperty;e&&(n=c.a.getWarnEventProperty,t.eventIdentifier=e.split(",")[0]),Object(c.c)(n,t,{loading:!0}).then((function(e){var t=e&&e.data||[];E(t)}))};return l.a.createElement("div",null,l.a.createElement(w.a,{form:i,onFinish:function(e){n(2)}},l.a.createElement(g.a,{gutter:14},l.a.createElement(b.a,{span:10},l.a.createElement(z,M({},B,{label:"触发对象",name:"triggerName",initialValue:"deviceTrigger",required:!0}),l.a.createElement(W.a,null,l.a.createElement(U,{value:"deviceTrigger"},"设备触发")))),l.a.createElement(b.a,{span:7},l.a.createElement(z,{name:"productId",rules:[{required:!0,message:"请选择产品"}]},l.a.createElement(W.a,{showSearch:!0,optionFilterProp:"children",onChange:function(e){A(e),R(!0)},placeholder:"请选择产品"},u.map((function(e){var t=e.id,n=e.name;return l.a.createElement(U,{key:t,value:t},n)}))))),l.a.createElement(b.a,{span:7},l.a.createElement(z,{name:"deviceIds",rules:[{required:!0,message:"请选择设备"}]},l.a.createElement(W.a,{allowClear:!0,mode:"multiple",placeholder:"请选择设备"},f.map((function(e){var t=e.deviceId,n=e.deviceMac;return l.a.createElement(U,{key:t,value:t},n)})))))),l.a.createElement(g.a,{gutter:14},l.a.createElement(b.a,{span:10},l.a.createElement(z,M({label:"触发方式"},B,{name:"triggerMode",rules:[{required:!0,message:"请选择触发方式"}]}),l.a.createElement(W.a,{disabled:!C,placeholder:"请选择触发方式",onChange:function(e){1===e&&(G(),E([]),R(!0)),0===e&&(_(),R(!0)),x(e)}},J.map((function(e){var t=e.id,n=e.nam;return l.a.createElement(U,{key:t,value:t},n)}))))),1===I&&l.a.createElement(b.a,{span:7},l.a.createElement(z,{name:"identifier",rules:[{required:!0,message:"请选择事件"}]},l.a.createElement(W.a,{placeholder:"请选择事件",onChange:function(e){_(e),R(!0)}},h.map((function(e){var t=e.identifier,n=e.name;return l.a.createElement(U,{key:t,value:t+","+n},n)})))))),(0==I||1==I)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(g.a,{gutter:14},l.a.createElement(b.a,{span:16},l.a.createElement(z,{label:"触发条件类型",name:"ruletype",labelCol:{span:5},required:!0,initialValue:"0"},l.a.createElement(F.a.Group,{onChange:function(e){N(e.target.value)}},l.a.createElement(F.a,{value:"0"},"单条"),l.a.createElement(F.a,{value:"and"},"and 组合"),l.a.createElement(F.a,{value:"or"},"or 组合"))))),l.a.createElement(Q,{propEventList:v,add:""}),"0"!==k&&l.a.createElement(l.a.Fragment,null,l.a.createElement(g.a,{gutter:[14]},l.a.createElement(b.a,{span:4}),l.a.createElement(b.a,{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"14px"},span:6},k)),l.a.createElement(Q,{propEventList:v,add:"_add"})))),l.a.createElement(y.a,{preHandle:function(){return n(0)},nextHandle:i.submit}))}var _=Object(r.memo)(Object(r.forwardRef)(G)),Q=function(e){var t=e.propEventList,n=void 0===t?[]:t,a=e.add,i=H(Object(r.useState)(""),2),c=i[0],o=i[1],u=H(Object(r.useState)("请输入比较值"),2),m=u[0],f=u[1];return l.a.createElement(g.a,{gutter:14},l.a.createElement(b.a,{span:10},l.a.createElement(z,M({label:"触发规则",name:"propName".concat(a)},B,{rules:[{required:!0,message:"请选择属性"}]}),l.a.createElement(W.a,{showSearch:!0,optionFilterProp:"children",onChange:function(e){var t=e.split(",")[1];o(t)},placeholder:"请选择属性"},n.map((function(e){var t=e.srcCode,n=e.srcName,a=e.srcType;return l.a.createElement(U,{key:t,value:t+","+a+","+n},"".concat(n,"( ").concat(t," )"))}))))),l.a.createElement(b.a,{span:4},l.a.createElement(z,{name:"judge".concat(a),rules:[{required:!0,message:"请选择比较方式"}]},l.a.createElement(W.a,{onChange:function(e){var t="请输入比较直";"in"==e?t="多个值请以逗号隔开":"between"==e&&(t="逗号隔开起始值，例如“1,5” "),f(t)},placeholder:"比较方式"},(("char"==c||"string"==c)&&$||K).map((function(e){var t=e.id,n=e.nam;return l.a.createElement(U,{key:t,value:n},n)}))))),l.a.createElement(b.a,{span:10},l.a.createElement(z,{name:"propVal".concat(a),rules:[{required:!0,message:"请输入比较值"}]},l.a.createElement(s.a,{placeholder:m}))))};function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return te(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ne=s.a.TextArea,ae=w.a.Item,re={labelCol:{span:6},wrapperCol:{span:12}};function le(e,t){var n=e.setStepCur,a=e.commitAll,i=e.formdata,c=ee(w.a.useForm(),1)[0],o=ee(Object(r.useState)(i.warningWay),2),u=o[0],m=o[1];Object(r.useEffect)((function(){i.warningTitle?c.setFieldsValue(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},i)):c.resetFields()}),[i.warningTitle]);return l.a.createElement("div",null,l.a.createElement(w.a,X({ref:t,form:c},re,{onFinish:function(e){a()}}),l.a.createElement(ae,{label:"触发告警",name:"warningWay",rules:[{required:!0,message:"请选择告警方式"}],initialValue:"0"},l.a.createElement(F.a.Group,{onChange:function(e){m(e.target.value)}},l.a.createElement(F.a,{value:"0"},"站内消息"),l.a.createElement(F.a,{value:"1"},"站内消息+邮件"))),l.a.createElement(ae,{label:"消息标题",name:"warningTitle",rules:[{required:!0,message:"请输入消息标题"},{max:50,message:"最大输入长度为50"}]},l.a.createElement(s.a,{placeholder:"请输入消息标题"})),"1"==u&&l.a.createElement(ae,{label:"邮件地址",name:"emailAddress",rules:[{required:!0,message:"请输入邮件地址"},{max:100,message:"最大输入长度为100"}]},l.a.createElement(s.a,{placeholder:"请输入邮件地址"})),l.a.createElement(ae,{label:"告警内容",name:"warningDetails",initialValue:"您好，{pruductname}，{time}出现配置规则下的异常，请在站内消息查看详情！"},l.a.createElement(ne,{rows:"3",disabled:!0})),l.a.createElement(ae,{label:"发送频率",name:"waringFreq",required:!0,initialValue:"0"},l.a.createElement(F.a.Group,null,l.a.createElement(F.a,{value:"0"},"首次发送后，相同故障间隔6小时发送一次，最高单日发送4次      "),l.a.createElement(F.a,{value:"1"},"首次发送后，相同故障间隔24小时发送一次")))),l.a.createElement(y.a,{nextText:"提交",preHandle:function(){return n(1)},nextHandle:c.submit}))}var ie=Object(r.memo)(Object(r.forwardRef)(le)),ce=["warningWay","warningTitle","warningDetails","waringFreq","emailAddress"];function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){se(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function me(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return de(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return de(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var pe=j.a.Step,ge=a.a.TabPane,be=function(e){var t=e.visible,n=e.closeEditMod,i=e.editData,o=i.id,u=i.name,s=fe(Object(r.useState)({}),2),m=s[0],f=s[1],d=fe(Object(r.useState)({}),2),g=d[0],b=d[1],y=fe(Object(r.useState)({}),2),v=y[0],E=y[1],O=fe(Object(r.useState)(0),2),h=O[0],w=O[1];Object(r.useEffect)((function(){var e=i.remark,t=i.content;if(void 0!==o){var n=JSON.parse(t),a=n.warningWay,r=n.warningTitle,l=n.warningDetails,c=n.waringFreq,s=n.emailAddress,m=me(n,ce);f({name:u,remark:e}),b(m),E({warningWay:a,warningTitle:r,warningDetails:l,waringFreq:c,emailAddress:s})}}),[i]);var S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;w(e)},I=Object(r.useRef)(),x=Object(r.useRef)(),P=Object(r.useRef)();return l.a.createElement(p.a,{title:void 0!==o?"编辑规则":"新增规则",visible:t,width:1e3,footer:null,maskClosable:!1,onCancel:n,className:"page-devwarn-config-modal",afterClose:function(){w(0),f({}),b({}),E({})}},l.a.createElement(j.a,{current:h},l.a.createElement(pe,{title:"告警信息"}),l.a.createElement(pe,{title:"规则配置"}),l.a.createElement(pe,{title:"通知方式"})),l.a.createElement("div",{className:"formbox"},l.a.createElement(a.a,{activeKey:h+""},l.a.createElement(ge,{tab:"告警信息",key:"0"},l.a.createElement(D,{ref:I,setStepCur:S,formdata:m})),l.a.createElement(ge,{tab:"规则配置",key:"1"},l.a.createElement(_,{ref:x,setStepCur:S,formdata:g})),l.a.createElement(ge,{tab:"通知方式",key:"2"},l.a.createElement(ie,{ref:P,setStepCur:S,commitAll:function(){var e=I.current.getFieldsValue(),t=x.current.formDataToData,a=P.current.getFieldsValue(),r=ue(ue({},t),a),l=JSON.stringify(r),i=ue(ue({},e),{},{id:o,content:l});Object(c.c)(c.a.saveWarningConfig,i,{loading:!0}).then((function(e){n()}))},formdata:v})))))};function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){Ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return he(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var je={pageRows:10,pageIndex:1},we={id:void 0,status:void 0,name:"",remark:"",content:""},Se=function(e){var t=Oe(Object(r.useState)({pager:{},list:[]}),2),n=t[0],a=t[1],o=n.list,u=n.pager,s=Oe(Object(r.useState)({}),2),m=s[0],d=s[1];Object(r.useEffect)((function(){p(je)}),[]);var p=function(e){Object(c.c)(c.a.getWarningList,e,{loading:!0}).then((function(e){a(e.data)}))},g=[{title:"告警时间",dataIndex:"alarmTime",key:"alarmTime",render:function(e){return e?i.a.utcToDev(e):"--"}},{title:"告警标题",dataIndex:"warningTitle",key:"warningTitle"},{title:"告警状态",dataIndex:"state",key:"state",render:function(e){return l.a.createElement("span",null,{1:"待处理",2:"已处理",3:"已发送"}[e])}},{title:"告警消息类型",dataIndex:"warningWay",key:"warningWay",render:function(e){return l.a.createElement("span",null,{0:"站内",1:"站内+邮件"}[e])}},{title:"关联的告警规则",dataIndex:"ruleName",key:"ruleName"},{title:"操作",dataIndex:"id",key:"id",render:function(e,t){var n=t.state;return l.a.createElement("a",{onClick:function(){y(e)}},"1"==n?"处理":"查看")}}],b=function(e){p(ve(ve({},je),{},{pageIndex:e}))},y=function(e){Object(c.c)(c.a.getWarningInfo,{id:e},{loading:!0}).then((function(e){d(e.data)}))},v=function(){d({})};return l.a.createElement(l.a.Fragment,null,l.a.createElement(f.a,{rowKey:"id",columns:g,dataSource:o,pagination:{defaultCurrent:u.pageIndex,total:u.totalRows,hideOnSinglePage:!0,onChange:b,current:u.pageIndex,showSizeChanger:!1}}),l.a.createElement("p",null,"注：仅限站内消息类型有“待处理”和“已处理状态”，站内消息+邮件均为“已发送”状态"),l.a.createElement(h,{warningInof:m,closeDetailMod:v,getIndexPage:b,delwithWarn:function(e){Object(c.c)(c.a.dealWithWarning,e,{loading:!0}).then((function(e){b(u.pageIndex||1),v()}))}}))},Ie=function(e){var t=Oe(Object(r.useState)({pager:{},list:[]}),2),n=t[0],a=t[1],o=Oe(Object(r.useState)([]),2),p=o[0],g=o[1],b=Oe(Object(r.useState)(""),2),y=b[0],v=b[1],E=Oe(Object(r.useState)(!1),2),O=E[0],h=E[1],j=Oe(Object(r.useState)(we),2),w=j[0],S=j[1];Object(r.useEffect)((function(){I(je)}),[]);var I=function(e){Object(c.c)(c.a.getWarningConfigLi,e,{loading:!0}).then((function(e){a(e.data)}))},x=[{title:"规则名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"remark",key:"remark"},{title:"运行状态",dataIndex:"status",key:"status",render:function(e){return l.a.createElement("span",null,{0:"初始状态",1:"运行中",2:"已停止"}[e])}},{title:"最近编辑时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return e?i.a.utcToDev(e):"--"}},{title:"操作",dataIndex:"id",key:"id",render:function(e,t){var n=t.id,a=t.name,r=t.status,i=t.remark,c=t.content;return l.a.createElement("span",null,l.a.createElement("a",{onClick:function(){A({id:n,name:a,remark:i,status:r,content:c})}},"编辑"),l.a.createElement(m.a,{type:"vertical"}),1==r&&l.a.createElement("a",{onClick:function(){g([n,a,"stop"])}},"停止")||l.a.createElement("a",{onClick:function(){C(n)}},"启动"),l.a.createElement(m.a,{type:"vertical"}),l.a.createElement("a",{onClick:function(){g([n,a,"del"])}},"删除"))}}],P=function(e){var t=ve(ve({},je),{},{pageIndex:e});""!=y&&(t.name=y),I(t)},C=function(e){Object(c.c)(c.a.startWarningConfigLi,{id:e},{loading:!0}).then((function(e){P(n.pager.pageIndex||1)}))},A=function(e){h(!0),S(e)},T=n.list,k=n.pager;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"searchrulebox"},l.a.createElement("div",{className:"comm-searchBox"},l.a.createElement(s.a.Search,{placeholder:"请输入规则名词查找",enterButton:!0,maxLength:20,onSearch:function(e){v(e);var t=ve({},je);""!=e&&(t.name=e),I(t)}})),l.a.createElement(u.a,{className:"btn",onClick:function(){A(we)},type:"primary"},"新增")),l.a.createElement(f.a,{rowKey:"id",columns:x,dataSource:T,pagination:{defaultCurrent:k.pageIndex,total:k.totalRows,hideOnSinglePage:!0,onChange:P,current:k.pageIndex,showSizeChanger:!1}}),l.a.createElement(d.a,{visible:p.length>0,modalOKHandle:function(){var e="del"==p[2]&&c.a.delWarningConfig||c.a.stopWarningConfig;Object(c.c)(e,{id:p[0]},{loading:!0}).then((function(e){P(n.pager.pageIndex||1),g([])}))},modalCancelHandle:function(){g([])},title:"del"==p[2]?"删除":"停止",descText:"即将".concat("del"==p[2]?"删除":"停止","告警配置"),needWarnIcon:!0,targetName:p[1]}),l.a.createElement(be,{visible:O,closeEditMod:function(){h(!1)},editData:ve({},w)}))};n("yfFx");function xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Ce=a.a.TabPane;t.default=function(e){var t=xe(Object(r.useState)({}),2),n=t[0],u=t[1],s=n.pendingCount,m=n.processedCount,f=n.sentCount,d=n.leastWaringDate;Object(r.useEffect)((function(){p()}),[p]);var p=function(){Object(c.b)(c.a.getDeviceWarningTotal,{loading:!0}).then((function(e){var t=e.data;u(t)}))};return l.a.createElement("section",{className:"page-devwarnlist"},l.a.createElement(o.a,{title:"设备消息"}),l.a.createElement("div",{className:"comm-shadowbox comm-countbox"},l.a.createElement("div",{className:"item"},"待处理告警",l.a.createElement("br",null),l.a.createElement("span",{className:"num"},s)),l.a.createElement("div",{className:"item"},"已处理告警",l.a.createElement("br",null),l.a.createElement("span",{className:"num"},m)),l.a.createElement("div",{className:"item"},"已发送告警",l.a.createElement("br",null),l.a.createElement("span",{className:"num"},f)),l.a.createElement("div",{className:"item"},"最近告警时间",l.a.createElement("br",null),l.a.createElement("span",{className:"num time"},d&&i.a.utcToDev(d)||"--"))),l.a.createElement("div",{className:"comm-shadowbox common-tab"},l.a.createElement(a.a,{defaultActiveKey:"1"},l.a.createElement(Ce,{tab:"消息列表",key:"1"},l.a.createElement(Se,null)),l.a.createElement(Ce,{tab:"规则列表",key:"2"},l.a.createElement(Ie,null)))))}},yfFx:function(e,t,n){}}]);