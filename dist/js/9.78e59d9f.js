(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"+ch6":function(e,t,n){"use strict";n("vxpS"),n("ThRY"),n("6wma"),n("8OWE"),n("L4wC"),n("KzFV"),n("2Kt1"),n("tpKs"),n("Y5Ue");var a=n("xc0u"),r=(n("rJH4"),n("nKmx")),c=(n("HzvR"),n("2n5t")),o=(n("WgEJ"),n("DwF0"),n("n1yf"),n("h4PX"),n("SoGA"),n("mtIt"),n("kCMX"),n("SnyF"),n("gsuU"),n("q+fq")),l=n.n(o);function i(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var d=c.a.Option,m=["按产品","按分组"];t.a=function(e){var t=e.list,n=e.searchedData,s=e.multiple,f=void 0!==s&&s,p=e.onRef,v=e.inputkey,y=u(Object(o.useState)(0),2),b=y[0],g=y[1],h=u(Object(o.useState)([-1]),2),E=h[0],O=h[1],j=u(Object(o.useState)(""),2),w=j[0],S=j[1],I=u(Object(o.useState)(!1),2),C=I[0],k=I[1],P=u(Object(o.useState)(!1),2),N=P[0],T=P[1];Object(o.useEffect)((function(){p&&p(L)}));var x=function(e,t){var n=e.findIndex((function(e){return t==e})),a=i(e);return n>-1&&a.splice(n,1),a},L=function(){var e={type:b};return w&&(e[v]=w),E.length>0&&-1!==E[0]&&(e.productIds=E.join(",")),e};return l.a.createElement("div",{className:"comm-search-box"},l.a.createElement(r.a.Group,{compact:!0,className:"inputgroup"},l.a.createElement(c.a,{value:b,onChange:function(e){g(e),O([-1])}},m.map((function(e,t){return l.a.createElement(d,{key:t,value:t},e)}))),l.a.createElement(c.a,{showSearch:!0,optionFilterProp:"children",mode:f?"multiple":"",defaultValue:[-1],value:E,onChange:!f&&function(e){O([e])}||void 0,onSelect:f&&function(e){O(-1==e?[-1]:function(t){var n=x(t,-1);return[].concat(i(n),[e])})}||void 0,onDeselect:f&&function(e){O((function(t){return x(t,e)}))}||void 0,style:{width:250}},l.a.createElement(d,{value:-1},"全部".concat(0==b?"产品":"分组")),t[b].map((function(e,t){var n=e.productId,a=e.id,r=e.name,c=e.productName;return l.a.createElement(d,{key:t,value:[n,a][b]},[c,r][b])}))),v&&l.a.createElement(r.a,{value:w,maxLength:30,placeholder:"请输入设备ID查询",style:{width:200},onChange:function(e){S(e.target.value)}})),l.a.createElement(a.a,{type:"primary",className:"btn",onClick:function(){k(!0),n(L()).finally((function(e){console.log("---rrr--",e),k(!1)}))},loading:C,icon:"search"},"查询"),l.a.createElement(a.a,{type:"default",className:"btn",loading:N,onClick:function(){g(0),O([-1]),S(""),T(!0),n({}).finally((function(){T(!1)}))}},"重置"))}},"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},O0UD:function(e,t,n){},PE3M:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Ln}));n("wlSd"),n("RWNY");var a=n("q+fq"),r=n.n(a),c=n("DndG"),o=(n("vxpS"),n("ThRY"),n("h4PX"),n("6wma"),n("8OWE"),n("L4wC"),n("KzFV"),n("2Kt1"),n("tpKs"),n("rsdX"),n("oCJ0"),n("L8Gl"),n("eVIo"),n("EO5n"),n("U4At"),n("KiF4")),l=(n("6rnn"),n("d6B9")),i=(n("rJH4"),n("nKmx")),u=(n("SnyF"),n("gsuU"),n("MeRu")),s=n("8QW8"),f=n("cu44"),d=n("FC04"),m=n("Nlzp"),p=n("DgvE");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var E=/^[\w\u4E00-\u9FA5]{1,30}$/,O="中英文、数字、下划线，长度不超过30";var j=l.a.create({name:"form_in_modal-project-add"})((function(e){var t=e.form,n=(e.history,g(Object(a.useState)([]),2)),v=n[0],b=n[1],h=g(Object(a.useState)(!1),2),j=h[0],w=h[1],S=g(Object(a.useState)(!1),2),I=S[0],C=S[1],k=g(Object(a.useState)(null),2),P=k[0],N=k[1],T=t.getFieldDecorator,x=i.a.TextArea,L=Object(a.useCallback)((function(){Object(m.c)(m.a.getProjectList,{loading:!0}).then((function(e){e&&e.data&&b(e.data)}))}),[]);Object(a.useEffect)((function(){L()}),[L]);var D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=e.serveCount,n=e.deviceCount,a=e.proCount,r="";return(t>0||n>0||a>0)&&(r="项目下仍有服务未删除，或有产品/设备未解除关联关系，请进入项目内删除对应内容"),r};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"项目管理",needBtn:!0,btnText:"新建项目",btnClickHandle:function(e){P&&N(e),w(!0)},btnIcon:"plus"}),r.a.createElement(f.a,{style:{minHeight:"calc(100% - 102px)"}},v.length>0?r.a.createElement("div",{className:"project-wrapper"},v.map((function(e,t){var n=e.name,a=e.deviceCount,o=e.serveCount,l=e.createTime,i=e.projectId;return r.a.createElement("div",{className:"project-item",key:t+t},r.a.createElement(c.Link,{to:{pathname:"/open/developCenter/projectManage/detail/".concat(i),search:"?name=".concat(n)},className:"title"},n),r.a.createElement("span",{className:"time"},"创建于：".concat(p.a.utcToDev(+l))),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"item"},r.a.createElement("span",null,"关联设备"),r.a.createElement("h2",null,a)),r.a.createElement("div",{className:"item"},r.a.createElement("span",null,"服务"),r.a.createElement("h2",null,o))),r.a.createElement("div",{className:"btns"},r.a.createElement("span",{onClick:function(){N(y({},e)),w(!0)}},"编辑"),r.a.createElement("span",{onClick:function(){!function(e){var t=e.serveCount,n=e.deviceCount,a=e.projectId;if(t>0||n>0)return N(e),void C(!0);Object(m.c)(m.a.getProductInProject,{projectId:a},{loading:!0}).then((function(t){var n=t&&t.data&&t.data.list||[];e.proCount=n.length,N(e),C(!0)}))}(y({},e))}},"删除")))}))):r.a.createElement(s.a,{tipText:"没有项目，请添加"})),j&&r.a.createElement(o.a,{visible:j,width:600,title:"新增项目",centered:!0,closable:!1,onCancel:function(){N(null),w(!1)},onOk:function(){t.validateFields((function(e,t){if(!e){var n=m.a.addProject,a=y({},t);P&&(n=m.a.updateProject,a.projectId=P.projectId),Object(m.d)(n,a,{loading:!0}).then((function(e){w(!1),P&&N(null),L()}))}}))},destroyOnClose:!0,maskClosable:!1},r.a.createElement(l.a,{labelCol:{span:4},wrapperCol:{span:20},labelAlign:"left"},r.a.createElement(l.a.Item,{label:"项目名称"},T("name",{rules:[{required:!0,message:"请输入项目名称"},{pattern:E,message:O}],initialValue:P?P.name:""})(r.a.createElement(i.a,{placeholder:O}))),r.a.createElement(l.a.Item,{label:"项目描述"},T("desc",{rules:[{required:!0,message:"请输入项目描述"},{pattern:E,message:O}],initialValue:P?P.desc:""})(r.a.createElement(x,{placeholder:O,rows:3}))))),I&&r.a.createElement(d.a,{visible:I,title:"删除项目",needWarnIcon:!0,descText:"即将删除的项目",targetName:P.name,tipText:D(),modalCancelHandle:function(){C(!1),N(null)},modalOKHandle:function(){var e=P.projectId;if(D())return C(!1),void N(null);Object(m.c)(m.a.deleteProject,{id:e},{loading:!0}).then((function(e){C(!1),N(null),L()}))}}))})),w=(n("72Pr"),n("O4+N")),S=(n("Y5Ue"),n("xc0u")),I=(n("7fbo"),n("LCR/")),C=(n("HzvR"),n("2n5t")),k=(n("sbOf"),n("spxj")),P=(n("SoGA"),n("mtIt"),n("n1yf"),n("kCMX"),n("P2RN")),N=(n("3EvH"),n("+ch6"));function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}C.a.Option;function R(e){var t=e.visible,n=e.okLoading,c=e.onOkHandle,l=e.onCancelHandle,u=e._selectedRowKeys,s=e.columns,f=e.type,d=void 0===f?1:f,m=e.dataInRela,p=e.getRelaList,v=L(Object(a.useState)(u||[]),2),y=v[0],b=v[1],g=L(Object(a.useState)(""),2),h=g[0],E=g[1],O=L(Object(a.useState)(!1),2),j=O[0],I=O[1],C=L(Object(a.useState)(!1),2),k=C[0],D=C[1],R=m.list,A=m.pager,F=m.relatedProductList,M=m.deviceGroupList,_=function(){},Q=function(e){var t={};1===d?h&&(t.name=h):Object.assign(t,_()),"number"==typeof e?t._index=e:I(!0),p(t).finally((function(){I(!1)}))},V={selectedRowKeys:y,onChange:function(e){b(e)}};return r.a.createElement(o.a,{visible:t,width:1e3,title:"关联".concat(["产品","设备"][d-1]),okText:"确定",confirmLoading:n,onOk:function(){y.length?c(y):Object(P.a)({message:"请至少选中一个后再进行管理"})},cancelText:"取消",onCancel:l,centered:!0,closable:!1,destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{style:{marginBottom:"24px"}},1===d&&r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,{placeholder:"请输入产品查询名称",style:{width:"240px",marginRight:"12px"},value:h,onChange:function(e){return E(e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",style:{marginRight:"12px"},onClick:Q,loading:j,icon:"search"},"查询"),r.a.createElement(S.a,{type:"default",loading:k,onClick:function(){E(""),D(!0),p({}).finally((function(){D(!1)}))}},"重置")),2===d&&r.a.createElement(N.a,{multiple:!0,inputkey:"param",list:[F,M],searchedData:function(e){return p(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))},onRef:function(e){_=e}})),r.a.createElement(w.a,{rowKey:1===d?"productId":"deviceId",rowSelection:V,columns:s,dataSource:R,pagination:{total:A.totalRows,current:A.pageIndex,defaultCurrent:1,defaultPageSize:10,onChange:function(e){Q(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}}))}n("amE0");var A=n("54Vy");n("vQck");function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e,t,n,a,r,c,o){try{var l=e[c](o),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(a,r)}function V(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var c=e.apply(t,n);function o(e){Q(c,a,r,o,l,"next",e)}function l(e){Q(c,a,r,o,l,"throw",e)}o(void 0)}))}}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var K=["发布","发布","停止","启动","",""];function G(e){var t=e.projectId,n=q(Object(a.useState)(!1),2),l=n[0],u=n[1],s=q(Object(a.useState)({callExplainVisible:!1,paramList:[],url:[]}),2),f=s[0],v=s[1],y=q(Object(a.useState)(""),2),b=y[0],g=y[1],h=q(Object(a.useState)([]),2),E=h[0],O=h[1],j=q(Object(a.useState)({totalRows:0,pageIndex:1}),2),C=j[0],k=j[1],N=q(Object(a.useState)([]),2),T=N[0],x=N[1],L=q(Object(a.useState)({actionType:0,actionRecord:{},actionLoading:!1}),2),D=L[0],R=L[1],F=q(Object(a.useState)({dataAnlVisibel:!1,dataAnlRecord:null}),2),_=F[0],Q=F[1],U=q(Object(a.useState)(-1),2),G=U[0],B=U[1],J=q(Object(a.useState)({id:-1,neme:"",desc:""}),2),H=J[0],W=J[1],z=C.totalRows,Y=C.pageIndex,X=f.callExplainVisible,Z=f.paramList,$=f.url,ee=D.actionType,te=D.actionRecord,ne=D.actionLoading,ae=_.dataAnlVisibel,re=_.dataAnlRecord;Object(a.useEffect)((function(){ce(1)}),[ce,t]);var ce=function(e){var n={pageRows:10};t&&(n.projectId=t),e&&(n.pageIndex=e),b&&(n.name=b),Object(m.c)(m.a.getServeList,n,{loading:!0}).then((function(e){var t=e&&e.data||{},n=t.list,a=t.pager;O(n),k(a)}))},oe=function(){var e=V(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return e.next=3,Object(m.c)(m.a.getProjectList,{},{loading:!0});case 3:n=e.sent,x(n.data||[]);case 5:u(!0);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(m.d)(m.a.servePublish,M({serviceId:e,envType:t,operate:n},a),{timeout:3e5}).then((function(e){ce(Y)})).finally(fe)},ie=function(){var e=V(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R((function(e){return M(M({},e),{},{actionType:t,actionRecord:M({},n)})}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ue=function(){R((function(e){return M(M({},e),{},{actionLoading:!0})}));var e=te.id;3==ee?function(e){Object(m.d)(m.a.serveDelete,{id:e}).then((function(){ce(),Object(P.a)({type:"success",description:"删除成功！"})})).finally(fe)}(e):le(e,1==ee?1:0,2)},se=function(e){R((function(e){return M(M({},e),{},{actionLoading:!0})}));var t=te.id,n=te.proEnv,a=1,r=te.testEnv;2==ee&&(a=0,r=n),le(t,a,r,e)},fe=function(){R({actionType:0,actionRecord:{},actionLoading:!1})},de=function(e,t){var n=t||re||{},a=n.id,r=n.projectId,c=n.desc,o=n.name;Object(p.n)("/dataAnalysis/".concat(r,"/").concat(a),"desc=".concat(c,"&name=").concat(o,"&analysisiType=").concat(e)),Q((function(e){return M(M({},e),{},{dataAnlVisibel:!1})}))},me=function(e){var t=e.id,n=e.type,a=void 0===n?0:n,c=e.projectId;return 0==+a?r.a.createElement("a",{onClick:function(){return Object(p.n)("/logicDevelop/".concat(c,"/").concat(t))}},"编辑"):r.a.createElement("a",{onClick:function(){return function(e){var t=e.id;Object(m.c)(m.a.getDataAnlzType,{serveId:t}).then((function(t){var n=(t&&t.data||{}).funcType;n?de(n,e):Q((function(t){return M(M({},t),{},{dataAnlVisibel:!0,dataAnlRecord:e})}))}))}(e)}},"编辑")},pe=[{title:"服务名称",dataIndex:"name",key:"name",width:160,render:function(e,t){var n=t.id,a=t.desc;return r.a.createElement("a",{onClick:function(){return W({id:n,name:e,desc:a})}},e)}},{title:"服务类型",dataIndex:"type",key:"type",width:160,render:function(e,t){var n=t.type,a=void 0===n?0:n;return r.a.createElement("span",null,["业务逻辑服务","数据分析服务"][a])}},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:160,render:function(e,t){var n=t.createTime;return r.a.createElement("span",null,n?p.a.utcToDev(n):"--")}},{title:"操作",key:"action",width:500,render:function(e,t){var n=t.id,a=t.type,o=void 0===a?0:a,l=t.testEnv,i=t.proEnv,u=t.projectId,s=t.name,f=5==l?"重新发布新版本到测试环境":"".concat(K[l],"测试环境"),d=5==i?"重新部署新版本到生产环境":"".concat(K[i],"生产环境");return r.a.createElement("span",null,2===i&&r.a.createElement(r.a.Fragment,null,r.a.createElement(c.Link,{to:{pathname:"/open/developCenter/serveDetail/".concat(n),search:"?serveName=".concat(s,"&projectId=").concat(u,"&type=").concat(o)},target:"_black"},"查看"),r.a.createElement(I.a,{type:"vertical"})),me(t),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{disabled:0===l,onClick:function(){return ie(1,t)}},f),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{disabled:!1,onClick:function(){return function(e){Object(m.c)(m.a.serveCallExplain,{serviceId:e},{loading:!0}).then((function(e){var t=[],n="";if(e.data){if(e.data.input){var a=JSON.parse(e.data.input);a.input&&(t=a.input)}e.data.flowVersion&&(n=e.data.flowVersion.invokeUrl||"")}v({paramList:t,url:n,callExplainVisible:!0})}))}(n)}},"调用说明"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{disabled:0===i,onClick:function(){return ie(2,t)}},d),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return B(n)}},"复制"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return ie(3,t)}},"删除"))}}];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tab-content-wrapper"},r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",onClick:oe,icon:"plus"},"新建服务")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(i.a,{placeholder:"请输入服务名称查询",style:{width:"240px"},value:b,onChange:function(e){return g(e.target.value)},maxLength:20})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",icon:"search",onClick:function(){return ce(1)}},"查询")))),r.a.createElement("div",{className:"table-wrapper"},r.a.createElement(w.a,{columns:pe,rowKey:"id",dataSource:E,pagination:{total:z,current:Y,defaultCurrent:1,defaultPageSize:10,onChange:function(e){return ce(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}})),l&&r.a.createElement(A.a,{visible:l,onOk:function(e){Object(m.d)(m.a.serveAdd,M({},e),{loading:!0}).then((function(){g(""),u(!1),ce(1),Object(P.a)({type:"success",description:"新增成功！"})}))},projectId:t,projectList:T,onCancel:function(){return u(!1)}}),G&&r.a.createElement(A.c,{visible:-1!==G||-1!==H.id,editContent:H,onOk:function(e){-1!==G?Object(m.d)(m.a.serveCopy,M(M({},e),{},{id:G}),{loading:!0}).then((function(){g(""),B(-1),ce(1)})):-1!==H.id&&Object(m.d)(m.a.updateServe,M(M({},e),{},{id:H.id}),{loading:!0}).then((function(){W({id:-1,name:"",desc:""}),ce(Y)}))},onCancel:function(){-1!==G?B(-1):-1!==H.id&&W({id:-1,name:"",desc:""})}}),function(){var e=te.id,t=te.name,n=te.proEnv,a=te.testEnv,c=3==ee,o=1==ee,l=2==ee,i=2==a,u=2==n;return r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{visible:c||o&&i||l&&u,modalOKHandle:ue,modalCancelHandle:fe,targetName:t,confirmLoading:ne,title:c?"删除服务":"停止服务",needWarnIcon:!0,descText:"即将".concat(["在测试环境停止","在生产环境停止","删除服务"][ee-1])}),r.a.createElement(A.d,{visible:o&&!i||l&&!u,envdata:{id:e,actionType:ee,testEnv:a,proEnv:n,name:t},onOk:se,confirmLoading:ne,onCancel:fe}))}(),X&&r.a.createElement(A.b,{paramList:Z,url:$,visible:X,onCancel:function(){return v({callExplainVisible:!1,paramList:[]})}}),ae&&r.a.createElement(o.a,{visible:ae,className:"sql-modal-self-class",width:500,title:"选择数据分析类型",closable:!0,centered:!0,footer:null,onCancel:function(){return Q({dataAnlVisibel:!1,dataAnlRecord:null})},destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{className:"type-select"},r.a.createElement("span",{onClick:function(){return de(1)}},"节点实时流任务"),r.a.createElement("span",{onClick:function(){return de(3)}},"数据分析任务"),r.a.createElement("span",{onClick:function(){return de(4)}},"SQL实时流任务"))))}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){H(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Y=k.a.TabPane,X=C.a.Option,Z=[m.a.getProductInProject,m.a.getDeviceInProject];function $(e){var t=e.match,n=e.history,o=W(Object(a.useState)(1),2),l=o[0],s=o[1],v=W(Object(a.useState)([]),2),y=v[0],b=v[1],g=W(Object(a.useState)({totalRows:0,pageIndex:1}),2),h=g[0],E=g[1],O=W(Object(a.useState)([]),2),j=O[0],N=O[1],T=W(Object(a.useState)({totalRows:0,pageIndex:1}),2),x=T[0],L=T[1],D=W(Object(a.useState)([]),2),A=D[0],F=D[1],M=W(Object(a.useState)({name:"",mac:"",productId:""}),2),_=M[0],Q=M[1],V=W(Object(a.useState)({relaVisible:!1,name:"",mac:"",productId:"",list:[],pager:{},relatedDeviceList:[],relatedProductList:[],deviceGroupList:[],_selectedRowKeys:[]}),2),q=V[0],U=V[1],K=W(Object(a.useState)(!1),2),B=K[0],z=K[1],$=W(Object(a.useState)({actionVisibel:!1,actionType:"1",actionRecord:{},actionLoading:!1}),2),ee=$[0],te=$[1],ne=t.params&&t.params.id,ae=decodeURI(Object(p.j)("name")),re=q.relaVisible,ce=q._selectedRowKeys,oe=ee.actionVisibel,le=ee.actionType,ie=ee.actionRecord,ue=ee.actionLoading,se=Object(a.useCallback)((function(e,t,n){var a=_.name,r=_.mac,c=_.productId,o={projectId:ne};t&&(o.pageIndex=t),1==e&&(o.name=a),2==e&&(o=J(J({},o),{},{mac:r,productId:n||c})),Object(m.c)(Z[e-1],o,{loading:!0}).then((function(t){var n=t&&t.data||{},a=n.list,r=void 0===a?[]:a,c=n.pager,o=void 0===c?{}:c;1===e?b(r):N(r),1===e?E(o):L(o)}))}),[ne,_]),fe=Object(a.useCallback)((function(e){var t=1===l?"productId":"deviceId",n=1===l?m.a.unrelaProduct:m.a.unrelaDevice;te((function(e){return J(J({},e),{},{actionLoading:!0})})),Object(m.c)(n,H({projectId:ne},t,e)).then((function(){se(l)})).finally((function(){te({actionVisibel:!1,actionRecord:null,actionLoading:!1})}))}),[ne,se,l]),de=Object(a.useCallback)((function(){return Object(m.c)(m.a.getAllRelatedProduct,{projectId:ne,pageRows:9999}).then((function(e){return e&&e.data&&e.data.list||[]}))}),[ne]),me=Object(a.useCallback)((function(){return Object(m.c)(m.a.getGroupList,{pageRows:9999}).then((function(e){return e.data.list||[]}))})),pe=Object(a.useCallback)((function(e){s(2),Q((function(t){return J(J({},t),{},{productId:e})})),de().then((function(e){F(e)})),se(2,void 0,e)}),[de,se]),ve=Object(a.useMemo)((function(){switch(l){case 1:return[{title:"产品ID",dataIndex:"productId",key:"productId",width:200},{title:"产品名称",dataIndex:"productName",key:"productName",width:200},{title:"产品类型",dataIndex:"productClassId",key:"productClassId",width:180,render:function(e,t){var n=t.productClassId,a=void 0===n?0:n;return r.a.createElement("span",null,["普通设备","网关设备"][a])}},{title:"状态",dataIndex:"mode",key:"mode",width:180,render:function(e,t){var n=t.mode,a=void 0===n?0:n;return r.a.createElement("span",null,["开发中","已发布","审核中"][a])}},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180,render:function(e,t){var n=t.createTime;return r.a.createElement("span",null,n?p.a.utcToDev(n):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var n=t.productId,a=t.mode;return r.a.createElement("span",null,r.a.createElement(c.Link,{to:{pathname:"/open/base/product/".concat(1==a?"details":"edit","/").concat(n)}},"查看"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return pe(n)}},"设备管理"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return je("1",t)}},"解除关联"))}}];case 2:return[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"物理地址",dataIndex:"deviceMac",key:"deviceMac",width:200},{title:"产品",dataIndex:"productName",key:"productName",width:180},{title:"分类",dataIndex:"productClass",key:"productClass",width:180,render:function(e,t){var n=t.productClass,a=void 0===n?0:n;return r.a.createElement("span",null,["普通设备","网关设备"][a])}},{title:"状态",dataIndex:"status",key:"status",width:180,render:function(e,t){var n=t.status;return r.a.createElement("span",null,["开发中","已发布","审核中"][n||0])}},{title:"最后上线",dataIndex:"lastOnlineTime",key:"lastOnlineTime",width:180,render:function(e,t){var n=t.lastOnlineTime;return r.a.createElement("span",null,n?p.a.utcToDev(n):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var n=t.deviceId;return r.a.createElement("span",null,r.a.createElement(c.Link,{to:{pathname:"/open/base/device/onlineDevice/details/".concat(n)}},"查看"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return je("1",t)}},"解除绑定"))}}]}}),[l,pe]),ye=function(e,t){Q((function(n){var a=J({},n);return a[e]=t,a}))};Object(a.useEffect)((function(){ne?(se(1),se(2),de().then((function(e){F(e)}))):Object(P.a)({description:"请传入项目ID"})}),[ne]);var be=function(e){var t=_.name,a=_.mac,c=_.productId;return 1===e?r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",loading:B,icon:"plus",onClick:Ee},"关联产品")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"default",name:t,onClick:function(){return n.push({pathname:"/open/base/product/add",search:"projectId=".concat(ne)})},icon:"plus"},"创建产品")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(i.a,{placeholder:"请输入产品查询名称",onChange:function(e){return ye("name",e.target.value)},style:{width:"240px"},maxLength:20})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",onClick:function(){return se(1)},icon:"search"},"查询"))):2===e?r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",loading:B,onClick:Ee,icon:"plus"},"关联设备")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(i.a,{placeholder:"请输入设备物理地址/设备ID",mac:a,onChange:function(e){return ye("mac",e.target.value)},style:{width:"240px"},maxLength:50})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(C.a,{style:{width:"240px"},value:c,onChange:function(e){return ye("productId",e)}},r.a.createElement(X,{value:""},"全部产品"),A.map((function(e){var t=e.productId,n=e.productName;return r.a.createElement(X,{key:t,value:t},n)})))),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",icon:"search",onClick:function(){return se(2)}},"查询"))):void 0},ge=function(){var e=1===l?h:x,t=e.totalRows,n=e.pageIndex,a=1===l?y:j;return r.a.createElement(w.a,{columns:ve,rowKey:1===l?"productId":"deviceId",dataSource:a,pagination:{total:t,current:n,defaultCurrent:1,defaultPageSize:20,onChange:function(e){return se(l,e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}})},he=function(e){var t=e.name,n=e.param,a=e.productIds,r=e._index,c=e.type,o={projectId:ne,pageRows:10,pageIndex:r||1},i=m.a.getRelaProduct;return 1===l?t&&(o.name=t):2===l&&(i=m.a.getRelaDevice,o.type=c||0,n&&(o.param=n),a&&(o.productIds=a)),Object(m.c)(i,o).then((function(e){return e&&e.data&&U((function(t){return J(J({},t),e.data)})),e}))},Ee=function(){var e=[he({})];2===l&&e.push(de(),me()),z(!0),Promise.all(e).then((function(e){var t=W(e,3),n=(t[0],t[1]),a=void 0===n?[]:n,r=t[2],c=void 0===r?[]:r;U((function(e){return J(J({},e),{},{relaVisible:!0,relatedProductList:a,deviceGroupList:c})}))})).finally((function(){z(!1)}))},Oe=function(){U({relaVisible:!1,name:"",mac:"",productId:"",list:[],pager:{}})},je=function(e,t){te((function(n){return J(J({},n),{},{actionType:e,actionRecord:J({},t),actionVisibel:!0})}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{title:ae||"--"}),r.a.createElement(f.a,{style:{minHeight:"calc(100% - 102px)"}},r.a.createElement(k.a,{activeKey:""+l,onChange:function(e){return s(+e)}},r.a.createElement(Y,{tab:"产品列表",key:1},r.a.createElement("div",{className:"tab-content-wrapper"},be(1)),r.a.createElement("div",{className:"table-wrapper"},ge())),r.a.createElement(Y,{tab:"设备列表",key:2},r.a.createElement("div",{className:"tab-content-wrapper"},be(2)),r.a.createElement("div",{className:"table-wrapper"},ge())),r.a.createElement(Y,{tab:"服务列表",key:3},r.a.createElement(G,{projectId:ne})))),re&&r.a.createElement(R,{visible:re,getRelaList:he,onOkHandle:function(e){var t,n;(t=e.join(","),n=1===l?m.a.relaProduct:m.a.relaDevice,Object(m.d)(n,{projectId:ne,ids:t})).then((function(e){Oe(),se(l)}))},onCancelHandle:Oe,columns:ve.slice(0,-1),type:l,dataInRela:q,setDataInRela:U,_selectedRowKeys:ce}),oe&&r.a.createElement(d.a,{visible:oe,modalOKHandle:function(){var e=ie.deviceId,t=ie.productId;"1"===le&&(1===l&&fe(t),2===l&&fe(e))},modalCancelHandle:function(){return te({actionVisibel:!1,actionRecord:null,actionLoading:!1})},targetName:ie[1===l?"productName":"deviceUniqueId"],confirmLoading:ue,title:"解除关联",needWarnIcon:!0,descText:"即将解除关联"}))}n("O0UD");function ee(e){var t=e.match.path;return r.a.createElement(c.Switch,null,r.a.createElement(c.Route,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(j,e)}}),r.a.createElement(c.Route,{path:"".concat(t,"/detail/:id"),render:function(e){return r.a.createElement($,e)}}),r.a.createElement(c.Redirect,{to:"".concat(t,"/list")}))}var te=n("2kug"),ne=[{title:"步骤一"},{title:"步骤二"},{title:"步骤三"}];function ae(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"服务开发"}),r.a.createElement(f.a,null,r.a.createElement("div",{className:"use-service-flow-wrapper"},r.a.createElement(te.a,{type:3,flowLists:ne}),r.a.createElement("div",{className:"extra-descs"},r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"新建服务，填写服务名称和关联项目")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"编辑业务逻辑，进行部署调试")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"发布服务，生成正式地址，可以对服务进行启动/停止"))))),r.a.createElement(f.a,{style:{minHeight:"calc(100% - 300px)"}},r.a.createElement(G,null)))}n("97dn");var re,ce,oe=n("OV+i"),le=n("Cr9J"),ie=(n("0AG1"),n("Jya7"),n("ivud")),ue=n("AcTD"),se=n("vzJ4"),fe=n("zrZB"),de=n("gtRY");n("3tak");function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=ge(e);if(t){var r=ge(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return be(this,n)}}function be(e,t){return!t||"object"!==me(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var he=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(o,e);var t,n,a,c=ye(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=c.call(this,e),e.init(re,ce,!0),t}return t=o,(n=[{key:"render",value:function(){return r.a.createElement("div",{className:"draw-wrap"},r.a.createElement(ue.a,null),r.a.createElement(se.a,null),r.a.createElement(fe.a,null))}}])&&pe(t.prototype,n),a&&pe(t,a),o}(a.Component),Ee=Object(ie.connect)(void 0,(function(e){return{init:function(t,n,a){return e(Object(de.z)(t,n,a))}}}))(he),Oe=function(e){return re=e.projectId,ce=e.serviceId,r.a.createElement(Ee,null)};function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Se(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ce(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ke=k.a.TabPane,Pe=C.a.Option;function Ne(){var e=Object(c.useParams)().id,t=decodeURI(Object(p.j)("serveName")),n=decodeURI(Object(p.j)("projectId")),o=decodeURI(Object(p.j)("type")),l=Ie(Object(a.useState)({searchKey:"",since:null,searchLoading:!1}),2),s=l[0],d=l[1],v=Ie(Object(a.useState)({logList:[],logPager:{}}),2),y=v[0],b=v[1],g=s.searchKey,h=s.since,E=s.searchLoading,O=y.logList,j=(y.logPager,Object(a.useCallback)((function(t){var n={serviceId:e,tail:100,follow:!1};return t&&(n=t),Object(m.c)(m.a.getServiceLog,n).then((function(e){e&&e.data&&b(we(we({},y),{},{logList:e.data}))}))}),[e,y]));Object(a.useEffect)((function(){j()}),[e]);var I=function(e,t){d((function(n){return we(we({},n),Se({},e,t))}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:t||"测试"}),r.a.createElement(f.a,{style:{minHeight:"calc(100% - 102px)"}},r.a.createElement(k.a,{defaultActiveKey:"1"},r.a.createElement(ke,{tab:"运行数据",key:1},r.a.createElement("div",null,r.a.createElement(f.a,null,r.a.createElement("div",{className:"all-data-wrapper"},r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"服务总数"),r.a.createElement("p",null,"100")),r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"测试环境"),r.a.createElement("p",null,"49")),r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"正式环境"),r.a.createElement("p",null,"51")))))),r.a.createElement(ke,{tab:"服务日志",key:2},r.a.createElement("div",{className:"serve-log-wrapper"},r.a.createElement("div",{style:{marginBottom:"24px"}},r.a.createElement(C.a,{value:"",style:{width:"240px",marginRight:"12px"}},r.a.createElement(Pe,{value:""},"错误日志")),r.a.createElement(oe.a,{style:{width:"240px",marginRight:"12px"},showTime:!0,showToday:!0,value:h,onChange:function(e){return I("since",e)}}),r.a.createElement(i.a,{placeholder:"请输入关键字",style:{width:"240px",marginRight:"12px"},value:g,onChange:function(e){return I("searchKey",e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",style:{marginRight:"12px"},onClick:function(){if(h){var e=1e3*(h.unix()-28800);j(e)}else j()},loading:E,icon:"search"},"查询")),r.a.createElement("div",null,r.a.createElement(w.a,{rowKey:"timestamp",columns:[{title:"调用时间",dataIndex:"timestamp",key:"timestamp"},{title:"节点执行日志",dataIndex:"text",key:"text"}],dataSource:O,pagination:!1})))),r.a.createElement(ke,{tab:"服务编排",key:3},r.a.createElement("div",{className:"static-flow-wrapper"},r.a.createElement("div",{className:"relative-wrapper"},1==o?r.a.createElement(le.a,{service:{serviceId:e,projectId:n},isStatic:!0}):r.a.createElement(Oe,{projectId:n,serviceId:e})))))))}n("XNYu");var Te=n("LeYH"),xe=n("1Ngb"),Le=n.n(xe),De=(n("gSWv"),n("M7r8")),Re=l.a.create({name:"add-dataflow-rule"})((function(e){var t=e.form,n=t.validateFieldsAndScroll,a=t.getFieldValue,c=t.getFieldDecorator,u=t.resetFields,s=e.closeMod,f=e.visable,d=e.transferId,p=void 0===d?void 0:d,v=e.transferName,y=void 0===v?"":v,b=e.transferDesc,g=void 0===b?"":b,h=p?"编辑规则":"新增规则";return r.a.createElement(o.a,{title:h,visible:f,width:600,onOk:function(){n((function(e,t){var n=t.transferName,a=t.transferDesc;e||Object(m.d)(m.a.saveTransfer,{transferName:n,transferDesc:a,transferId:p},{needJson:!0}).then((function(e){s(!0),u()}))}))},onCancel:function(){s(),u()},maskClosable:!1,className:"self-modal"},r.a.createElement(l.a,{labelCol:{span:4},wrapperCol:{span:20}},r.a.createElement(l.a.Item,{label:"规则名称"},c("transferName",{rules:[{required:!0,message:"请输入规则名称"},{max:50,message:"最大输入长度为50"}],initialValue:y})(r.a.createElement(i.a,{placeholder:"请输入规则名称"}))),r.a.createElement(De.a,{label:"规则描述",formId:"transferDesc",astrictNub:"50",rows:"4",placeholder:"规则描述",getFieldDecorator:c,getFieldValue:a,initialVal:g})))}));function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Ve(e);if(t){var r=Ve(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Qe(this,n)}}function Qe(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qe=["创建规则","选择产品","编写SQL，处理数据","添加操作，转发数据","验证规则","启动规则"],Ue=[["删除","即将要删除规则"],["启动","即将要启动规则"],["停用","即将要停用规则"]],Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(l,e);var t,n,a,o=_e(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e)).getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.c)(m.a.getDataTransferList,e).then((function(e){t.setState({ruleList:e.data.list,pager:e.data.pager,loading:!1})}))},t.openAdd=function(){t.setState({addRuleVisible:!0})},t.closeAdd=function(e){t.setState({addRuleVisible:!1}),e&&t.pagerIndex(1)},t.searchRule=function(e){t.setState({loading:!0,searchName:e},(function(){t.pagerIndex(1)}))},t.pagerIndex=function(e){t.setState({pageIndex:e,loading:!0},(function(){t.getList({pageIndex:e,pageRows:10,transferName:t.state.searchName||void 0})}))},t.getGuidStep=function(){for(var e=[],t=0;t<qe.length;t++)e.push(r.a.createElement("div",{className:"step",key:"step_"+t},r.a.createElement("span",{className:"number"},t+1),r.a.createElement("span",{className:"desc"},qe[t]))),t+1<qe.length&&e.push(r.a.createElement("img",{className:"arrow",key:"img_"+t,src:Le.a}));return e},t.openConfirmMod=function(e,n,a){t.setState({id:e,name:n,confirmType:a})},t.modOk=function(){var e=t.state,n=e.id,a=e.confirmType,r=e.pageIndex,c=void 0===r?1:r,o=e.ruleList;if(1==a)Object(m.c)(m.a.delOneTransfer,{transferId:n},{loading:!0}).then((function(e){1==o.length&&c>1&&--c,t.pagerIndex(c),t.setState({confirmType:0})}));else{var l=2==a?1:0;Object(m.d)(m.a.saveTransfer,{transferId:n,status:l},{needJson:!0,noInstance:!0,loading:!0}).then((function(e){t.pagerIndex(c),t.setState({confirmType:0})}))}},t.modCancel=function(){t.setState({confirmType:0})},t.state={loading:!0,ruleList:[],pager:{},searchName:"",name:"",id:"",confirmType:0,addRuleVisible:!1,pageIndex:1},t.columns=[{title:"规则名称",dataIndex:"transferName"},{title:"规则ID",dataIndex:"transferId",width:90},{title:"描述",dataIndex:"transferDesc"},{title:"创建时间",dataIndex:"createTime",width:162,render:function(e){return r.a.createElement("span",null,p.a.utcToDev(e))}},{title:"状态",dataIndex:"status",width:90,render:function(e){return r.a.createElement("span",null,{0:"未启用",1:"启用"}[e]||"--")}},{title:"操作",key:"action",width:160,render:function(e,n){var a=n.transferId,o=n.transferName,l=n.status;return r.a.createElement("span",null,r.a.createElement(c.Link,{to:"/open/developCenter/dataFlow/ruledetail/".concat(a)},"查看"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){t.openConfirmMod(a,o,l+2)}},["启用","停用"][l]),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){t.openConfirmMod(a,o,1)}},"删除"))}}],t}return t=l,(n=[{key:"componentDidMount",value:function(){this.pagerIndex(1)}},{key:"render",value:function(){var e=this,t=this.state,n=t.loading,a=t.name,c=t.addRuleVisible,o=t.ruleList,l=t.pager,s=t.confirmType;return r.a.createElement("div",{className:"dataflow-page"},r.a.createElement(u.a,{noback:!0,title:"数据流转"}),r.a.createElement("header",{className:"page-content-header"},r.a.createElement("div",{className:"searchBox"},r.a.createElement(i.a.Search,{placeholder:"请输入规则名查找",enterButton:!0,maxLength:20,onSearch:function(t){return e.searchRule(t)}})),r.a.createElement("div",{className:"butFloatRight"},r.a.createElement(S.a,{className:"but-add",type:"primary",icon:"plus",onClick:this.openAdd},"创建规则"))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(Te.a,{message:"数据流转规则可以对设备上报的数据进行简单处理，并将处理后的数据流转到其他Topic或其他存储实例，目前只支持Json数据的处理",type:"info",showIcon:!0}),r.a.createElement("div",{className:"guid-step"},this.getGuidStep()))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(w.a,{rowKey:"transferId",columns:this.columns,dataSource:o,pagination:{defaultCurrent:l.pageIndex,total:l.totalRows,hideOnSinglePage:!1,onChange:this.pagerIndex,current:l.pageIndex},loading:n}))),r.a.createElement(Re,{visable:c,closeMod:function(t){e.closeAdd(t)}}),r.a.createElement(d.a,{visible:s>0,modalOKHandle:this.modOk,modalCancelHandle:this.modCancel,title:s>0&&Ue[s-1][0],descText:s>0&&Ue[s-1][1],targetName:a}))}}])&&Fe(t.prototype,n),a&&Fe(t,a),l}(a.Component),Ge=(n("VjeF"),n("dzgx")),Be=(n("GM9G"),n("t3JN")),Je=(n("Gcxg"),n("vyZY")),He=(n("WgEJ"),n("DwF0"),n("fPXa"));function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){Ye(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xe(e){return function(e){if(Array.isArray(e))return et(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$e(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||$e(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(e,t){if(e){if("string"==typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(e,t):void 0}}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var tt=C.a.Option,nt=l.a.create({name:"add-dataflow-editsql"})(Object(a.memo)((function(e){var t=e.form,n=t.validateFieldsAndScroll,c=t.getFieldValue,u=t.getFieldDecorator,s=t.resetFields,f=(t.validateFields,t.setFieldsValue),d=e.visable,p=e.tableData,v=e.productList,y=e.closeMod,b=e.transferId,g=e.transferSQL,h=g.transferSQL,E=void 0===h?"SELECT \n\nFROM \n\nWHERE":h,O=g.productId,j=g.deviceIdList,w=g.isAllDevice,S=void 0===w?0:w,I=g.transferSQLId,k=Ze(Object(a.useState)(E),2),P=k[0],N=k[1],T=Ze(Object(a.useState)([]),2),x=T[0],L=T[1],D=Ze(Object(a.useState)([]),2),R=D[0],A=D[1];Object(a.useEffect)((function(){var e=F();(L(e),I)&&f({transferSQL:E,productId:O,deviceIdList:0==S&&[-1]||j})}),[p]);var F=function(){var e=[];return Object.keys(p||{}).forEach((function(t){e.push(M(t,"数据表")),p[t].forEach((function(t){e.push(M(t,"表属性"))}))})),e.length>0&&e||null},M=function(e,t){return{name:"name",value:e,score:100,meta:t}},_=function(e,t){var n=e.findIndex((function(e){return t==e})),a=Xe(e);return n>-1&&a.splice(n,1),a};return r.a.createElement(o.a,{title:"编写SQL",visible:d,width:700,onOk:function(){n((function(e,t){if(console.log(999,t),!e){var n=t.deviceIdList,a=1;-1==n[0]&&(a=0,n=null);var r=I&&{transferSQLId:I}||{};Object(m.d)(m.a.saveTransfer,{transferId:b,transferSQL:ze(ze(ze({},t),{},{isAllDevice:a},r),{},{deviceIdList:n})},{needJson:!0,noInstance:!0}).then((function(e){y(!0),s()}))}}))},onCancel:function(){y(),s()},maskClosable:!1},r.a.createElement(l.a,null,r.a.createElement(l.a.Item,{labelCol:{span:3},wrapperCol:{span:21}},r.a.createElement(He.a,{mode:"mysql",height:200,code:P,completers:x,onChange:function(e){!function(e){N(e),f({transferSQL:e})}(e)}}),u("transferSQL",{initialValue:P,rules:[{required:!0,message:"请编写SQL"}]})(r.a.createElement(i.a,{type:"hidden"}))),r.a.createElement(l.a.Item,{label:"选择产品",labelCol:{span:3},wrapperCol:{span:12}},u("productId",{rules:[{required:!0,message:"请选择产品"}]})(r.a.createElement(C.a,{showSearch:!0,placeholder:"选择产品",optionFilterProp:"children",onChange:function(e){Object(m.c)(m.a.getDeviceList,{classType:1,pageRows:9999,infoType:1,productId:e},{loading:!0}).then((function(e){var t=e.data;A(t&&t.list||[]),f({deviceIdList:[]})}))}},v.map((function(e){var t=e.productId,n=e.productName;return r.a.createElement(tt,{key:t,value:t},n)}))))),r.a.createElement(l.a.Item,{label:"选择设备",labelCol:{span:3},wrapperCol:{span:12}},u("deviceIdList",{rules:[{required:!0,message:"请选择设备"}]})(r.a.createElement(C.a,{showSearch:!0,mode:"multiple",placeholder:"选择设备",optionFilterProp:"children",onSelect:function(e){if(-1==e)f({deviceIdList:[-1]});else{var t=c("deviceIdList"),n=_(t,-1);console.log(888,t,n),f({deviceIdList:Xe(n)})}}},R.length>0&&r.a.createElement(tt,{value:-1},"全部设备"),R.map((function(e){var t=e.deviceId,n=e.deviceMac;return r.a.createElement(tt,{key:t,value:t},n)})))))))}))),at=(n("lYSE"),n("/hI5")),rt=(n("0Gu2"),n("kT6h")),ct=(n("bqBU"),n("4OHk")),ot=n("OIuG");function lt(e){return function(e){if(Array.isArray(e))return st(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ut(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||ut(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(e,t){if(e){if("string"==typeof e)return st(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?st(e,t):void 0}}function st(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ft=C.a.Option,dt=l.a.create({name:"add-dataflow-checksql"})(Object(a.memo)((function(e){var t=e.transferId,n=e.form,c=n.validateFieldsAndScroll,o=n.getFieldValue,u=n.getFieldDecorator,s=n.resetFields,f=n.setFieldsValue,d=e.visable,p=e.productList,v=e.closeMod,y=it(Object(a.useState)("{\n\n}"),2),b=y[0],g=y[1],h=it(Object(a.useState)([]),2),E=h[0],O=h[1],j=it(Object(a.useState)(void 0),2),w=j[0],I=j[1];Object(a.useEffect)((function(){}),[]);var k=function(e,t){var n=e.findIndex((function(e){return t==e})),a=lt(e);return n>-1&&a.splice(n,1),a};return r.a.createElement(at.a,{title:"SQL调试",visible:d,width:480,onClose:function(){v(),s()}},r.a.createElement(l.a,null,r.a.createElement(l.a.Item,{label:"产品",labelCol:{span:24},wrapperCol:{span:12}},u("productId",{rules:[{required:!0,message:"请选择产品"}]})(r.a.createElement(C.a,{showSearch:!0,placeholder:"选择产品",optionFilterProp:"children",onChange:function(e){Object(m.c)(m.a.getDeviceList,{classType:1,pageRows:9999,infoType:1,productId:e},{loading:!0}).then((function(e){var t=e.data;O(t&&t.list||[]),f({deviceIdList:[]})}))}},p.map((function(e){var t=e.productId,n=e.productName;return r.a.createElement(ft,{key:t,value:t},n)}))))),r.a.createElement(l.a.Item,{label:"设备",labelCol:{span:24},wrapperCol:{span:12}},u("deviceIdList",{rules:[{required:!0,message:"请选择设备"}]})(r.a.createElement(C.a,{showSearch:!0,mode:"multiple",placeholder:"选择设备",optionFilterProp:"children",onSelect:function(e){if(-1==e)f({deviceIdList:[-1]});else{var t=o("deviceIdList"),n=k(t,-1);console.log(888,t,n),f({deviceIdList:lt(n)})}}},E.length>0&&r.a.createElement(ft,{value:-1},"全部设备"),E.map((function(e){var t=e.deviceId,n=e.deviceMac;return r.a.createElement(ft,{key:t,value:t},n)}))))),r.a.createElement(l.a.Item,{label:r.a.createElement(rt.a,{content:"设备使用自定义 Topic 时 Payload 数据格式即为上报的数据",overlayClassName:"draw-popover"},"Payload数据 ",r.a.createElement(ct.a,{type:"question-circle"})),labelCol:{span:24},wrapperCol:{span:24}},r.a.createElement(He.a,{mode:"json",height:200,code:b,onChange:function(e){!function(e){g(e),f({payload:e})}(e)}}),u("payload",{initialValue:b,rules:[{required:!0,message:"请编写Payload数据"}]})(r.a.createElement(i.a,{type:"hidden"})))),r.a.createElement(S.a,{className:"",type:"primary",onClick:function(){c((function(e,n){if(console.log(999,n),!e){var a=n.deviceIdList,r=n.productId,c=n.payload;try{c=JSON.parse(c)}catch(e){return console.log("eeeeee",e),void Object(P.a)({description:"Payload数据请输入正确的json格式"})}var o=-1==a[0]?0:1,l={transferSQL:{transferId:t,productId:r,isAllDevice:o,deviceIdList:a},payload:c};I(void 0),Object(m.d)(m.a.checkSqlTransfer,l,{needJson:!0,noInstance:!0}).then((function(e){I(e.data)}))}}))}},"调 试"),w&&r.a.createElement(ot.a,{keyName:"调试结果",data:w}))})));function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(n),!0).forEach((function(t){vt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var gt=C.a.Option,ht=l.a.create({name:"add-dataflow-addsend"})(Object(a.memo)((function(e){var t,n,c,u,s,f=e.operateList,d=e.transferId,p=e.form,v=p.validateFieldsAndScroll,y=(p.getFieldValue,p.getFieldDecorator),b=p.resetFields,g=(p.validateFields,p.setFieldsValue),h=e.operateType,E=e.transferTargetIndex,O=e.closeMod,j=e.transferTargetList,w=e.transferRecover,S=e.topicList,I=(t=1,n=Object(a.useRef)(),c=yt(Object(a.useState)(t),2),u=c[0],s=c[1],Object(a.useEffect)((function(){n.current&&n.current(u)}),[u]),[u,function(e,t){n.current=t,s(e)}]),k=yt(I,2),P=k[0],N=k[1];Object(a.useEffect)((function(){if(2==h||4==h){var e,t;if(2==h){var n=j[E];e=n.targetType,t=n.targetConfig}else t=w.recoverConfig,e=w.recoverType;var a=JSON.parse(t),r=a.transferId,c=a.topic,o=a.tag,l={optype:e,destination:c||r};1==e&&(l.tag=o),N(e),g(l)}}),[h]);return r.a.createElement(o.a,{title:h%2==0?"编辑":"添加",visible:h>0,width:600,onOk:function(){v((function(e,t){if(!e){var n=t.optype,a=t.destination,r=t.tag,c=0==n?{transferId:a}:{topic:a,tag:r},o=JSON.stringify(c),l={transferId:d};if(h>2)l.transferRecover=pt(pt({},w),{},{recoverType:n,recoverConfig:o});else if(1==h)l.transferTargetList=[{targetType:n,targetConfig:o}];else{var i=pt(pt({},j[E]),{},{targetType:n,targetConfig:o});l.transferTargetList=[i]}Object(m.d)(m.a.saveTransfer,l,{needJson:!0,noInstance:!0,loading:!0}).then((function(e){O(!0),b()}))}}))},onCancel:function(){O(),b()},maskClosable:!1},r.a.createElement(l.a,{labelCol:{span:6},wrapperCol:{span:16}},r.a.createElement(l.a.Item,{label:"选择操作"},y("optype",{rules:[{required:!0,message:"请选择操作"}],initialValue:1})(r.a.createElement(C.a,{placeholder:"选择操作",onChange:function(e){N(e),g({destination:void 0})}},f.map((function(e,t){return r.a.createElement(gt,{disabled:1!=t,key:t,value:t},e)}))))),0==P&&r.a.createElement(l.a.Item,{label:"数据目的地"},y("destination",{rules:[{required:!0,message:"请选择数据目的地"}]})(r.a.createElement(C.a,{placeholder:"请选择"},S[0].map((function(e){var t=e.transferId,n=e.transferName;return r.a.createElement(gt,{key:t,value:t},n)})))))||r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a.Item,{label:"数据目的地"},y("destination",{rules:[{required:!0,message:"请填写数据目的地"}]})(r.a.createElement(i.a,{placeholder:"自定义或者从平台选择"}))),r.a.createElement("div",{className:"hidselectbox"},r.a.createElement("a",null,"从平台选择"),r.a.createElement(C.a,{className:"hidselect",placeholder:"请选择",onChange:function(e){g({destination:e})}},S[1].map((function(e){return r.a.createElement(gt,{key:e,value:e},e)})))),r.a.createElement(l.a.Item,{label:"tag"},y("tag",{rules:[{required:!0,message:"请填写tag"}]})(r.a.createElement(i.a,{placeholder:"输入tag"}))))))})));function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||wt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jt(e){return function(e){if(Array.isArray(e))return St(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||wt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){if(e){if("string"==typeof e)return St(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?St(e,t):void 0}}function St(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Pt(e,t){return(Pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=xt(e);if(t){var r=xt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Tt(this,n)}}function Tt(e,t){return!t||"object"!==Et(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xt(e){return(xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Lt=["发布到另一个流转规则","发布到RocketMQ","发布到MQTT","发布到MySQL","发布到Redis"],Dt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pt(e,t)}(o,e);var t,n,a,c=Nt(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=c.call(this,e)).openEditServe=function(){t.setState({editvisable:!0})},t.closeEditServe=function(e){t.setState({editvisable:!1}),e&&t.getDetail()},t.getTableInfo=function(){Object(m.c)(m.a.getTransferDataTable).then((function(e){var n=e.data,a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(Object(n),!0).forEach((function(t){Ct(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},void 0===n?{}:n);t.setState({tableData:a})}))},t.getDetail=function(){Object(m.c)(m.a.getDataTransfer,{transferId:t.id},{loading:!0}).then((function(e){var n=e.data||{},a=n.transferDesc,r=n.transferName,c=n.transferSQL,o=n.transferTargetList,l=n.transferRecover;t.setState({transferName:r,transferDesc:a,transferSQL:c||{},transferTargetList:o||[],transferRecover:l||{}})}))},t.openEditSQL=function(){t.setState({editSQLvisiable:!0})},t.openCheckSQL=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t.setState({checkSQLvisiable:e})},t.closeEditSQL=function(e){t.setState({editSQLvisiable:!1}),e&&t.getDetail()},t.openOperate=function(e,n){var a={operateType:e};2==e&&(a.transferTargetIndex=n),t.setState(a);var r=t.state,c=r.transferMenuList,o=r.rocketMQTopicList;0==c.length&&t.getTransferMenuList(),0==o.length&&t.getRocketMQTopicList()},t.closeOperate=function(e){t.setState({operateType:0}),e&&t.getDetail()},t.getProList=function(){Object(m.c)(m.a.getProductList,{pageRows:9999,instanceId:2},{needVersion:1.2}).then((function(e){var n=e.data&&e.data.list||[];t.setState({productList:n})}))},t.getTransferMenuList=function(){Object(m.c)(m.a.getTransferMenuList).then((function(e){var n=e.data,a=jt(void 0===n?{}:n);t.setState({transferMenuList:a})}))},t.getRocketMQTopicList=function(){Object(m.c)(m.a.getRocketMQTopicList).then((function(e){var n=e.data,a=jt(void 0===n?{}:n);t.setState({rocketMQTopicList:a})}))},t.getColumns=function(e){var n=Ot(4==e&&["recoverType","recoverConfig","transferRecoverId"]||["targetType","targetConfig","transferTargetId"],3);return[{title:"操作类型",dataIndex:n[0],render:function(e){return Lt[e]}},{title:"数据目的地",dataIndex:n[1]},{title:"操作",dataIndex:n[2],width:120,render:function(n,a,c){return r.a.createElement("span",null,r.a.createElement("a",{onClick:function(){t.openOperate(e,c)}},"编辑"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(Je.a,{title:"确定要移除吗？",onConfirm:function(){t.deleteTarget(n,e)},okText:"是",cancelText:"否"},r.a.createElement("a",null,"移除")))}}]},t.deleteTarget=function(e,n){var a=4==n&&{transferRecoverId:e}||{transferTargetId:e};Object(m.c)(m.a.delOneTransfer,a,{loading:!0,noInstance:!0}).then((function(e){t.getDetail()}))},t.id=e.match.params.id,t.state={transferName:"--",transferDesc:"--",transferSQL:{},transferTargetList:[],transferRecover:{},operateType:0,transferTargetIndex:0,editvisable:!1,editSQLvisiable:!1,checkSQLvisiable:!1,tableData:null,productList:[],transferMenuList:[],rocketMQTopicList:[]},t}return t=o,(n=[{key:"componentDidMount",value:function(){this.getDetail(),this.getTableInfo(),this.getProList()}},{key:"render",value:function(){var e=this,t=this.state,n=t.transferDesc,a=t.transferName,c=t.editvisable,o=t.transferSQL,l=t.editSQLvisiable,i=t.checkSQLvisiable,s=t.tableData,d=t.productList,m=t.operateType,p=t.transferTargetIndex,v=t.transferTargetList,y=t.transferRecover,b=t.transferMenuList,g=t.rocketMQTopicList;return r.a.createElement("section",{className:"page-dataflowdetail"},r.a.createElement(u.a,{title:"规则详情"}),r.a.createElement("header",{className:"header"},r.a.createElement(Be.a,{className:"descriptions",column:2},r.a.createElement(Be.a.Item,{label:"规则名称"},a),r.a.createElement(Be.a.Item,{label:"规则 ID"},this.id),r.a.createElement(Be.a.Item,{label:"规则描述"},n)),r.a.createElement(S.a,{className:"deitbtn",type:"primary",onClick:this.openEditServe},"编辑")),r.a.createElement(f.a,{title:"处理数据"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(S.a,{className:"addbtn",type:"primary",onClick:this.openEditSQL},"编写 SQL"),r.a.createElement("div",{className:"sqltit"},"规则查询语句:"),o.transferSQL&&r.a.createElement("div",{className:"sqlstr"},o.transferSQL," ",r.a.createElement("a",{onClick:function(){return e.openCheckSQL(!0)}},"调试SQL"))||r.a.createElement(r.a.Fragment,null,r.a.createElement(Ge.a,{className:"emptyimg",description:!1,image:Ge.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"您还没有编写 SQL 语句处理数据，",r.a.createElement("a",{onClick:this.openEditSQL},"编写 SQL"))))),r.a.createElement(f.a,{title:"转发数据"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(S.a,{className:"addbtn",type:"primary",onClick:function(){e.openOperate(1)}},"添加操作"),v.length>0&&r.a.createElement(w.a,{rowKey:"transferTargetId",columns:this.getColumns(2),dataSource:v,pagination:!1})||r.a.createElement(r.a.Fragment,null,r.a.createElement(Ge.a,{className:"emptyimg",description:!1,image:Ge.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"暂无转发数据，",r.a.createElement("a",{onClick:function(){e.openOperate(1)}},"添加操作"))))),r.a.createElement(f.a,{title:"转发错误操作数据"},r.a.createElement("div",{className:"alone-section-content-default"},y.recoverConfig&&r.a.createElement(w.a,{rowKey:"transferRecoverId",columns:this.getColumns(4),dataSource:[y],pagination:!1})||r.a.createElement(r.a.Fragment,null,r.a.createElement(Ge.a,{className:"emptyimg",description:!1,image:Ge.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"暂无转发错误操作数据，",r.a.createElement("a",{onClick:function(){e.openOperate(3)}},"添加操作"))))),r.a.createElement(Re,{visable:c,transferId:this.id,transferName:a,transferDesc:n,closeMod:function(t){e.closeEditServe(t)}}),l&&r.a.createElement(nt,{visable:l,transferId:this.id,tableData:s,productList:d,transferSQL:o,closeMod:function(t){e.closeEditSQL(t)}}),i&&r.a.createElement(dt,{visable:i,transferId:this.id,productList:d,closeMod:function(){return e.openCheckSQL(!1)}}),m>0&&r.a.createElement(ht,{operateList:Lt,transferId:this.id,operateType:m,transferTargetIndex:p,topicList:[b,g],transferTargetList:v,transferRecover:y,closeMod:function(t){e.closeOperate(t)}}))}}])&&kt(t.prototype,n),a&&kt(t,a),o}(a.PureComponent);function Rt(e){var t=e.match.path;return r.a.createElement(c.Switch,null,r.a.createElement(c.Route,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(Ke,e)}}),r.a.createElement(c.Route,{path:"".concat(t,"/ruledetail/:id"),render:function(e){return r.a.createElement(Dt,e)}}),r.a.createElement(c.Redirect,{to:"".concat(t,"/list")}))}function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){Mt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Vt=[{title:"配置数据流转"},{title:"选择监控对象"},{title:"定义监控规则"},{title:"确定监控形式"}],qt={pageRows:10,pageIndex:1},Ut=function(e){var t=_t(Object(a.useState)({pager:{},list:[]}),2),n=t[0],c=t[1],o=_t(Object(a.useState)([]),2),l=o[0],s=o[1],v=_t(Object(a.useState)([]),2),y=v[0],b=v[1];Object(a.useEffect)((function(){g(qt)}),[]);var g=function(e){y&&(e.warningId=y),Object(m.c)(m.a.geMonitorList,e,{loading:!0}).then((function(e){c(e.data)}))},h=[{title:"规则名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description"},{title:"运行状态",dataIndex:"runType",key:"runType",render:function(e){return r.a.createElement("span",null,{0:"初始状态",1:"运行中",2:"已停止"}[e])}},{title:"最近编辑时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return e?p.a.utcToDev(e):"--"}},{title:"操作",dataIndex:"id",key:"id",render:function(e,t){var n=t.id,a=t.name,c=t.runType;return r.a.createElement("span",null,r.a.createElement("a",{href:"#/open/developCenter/deviceMonitor/edit/".concat(n)},"编辑"),r.a.createElement(I.a,{type:"vertical"}),1==c&&r.a.createElement("a",{onClick:function(){s([n,a,"stop"])},href:"javascript:"},"停止")||r.a.createElement("a",{onClick:function(){O(n)},href:"javascript:"},"启动"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){s([n,a,"del"])},href:"javascript:"},"删除"))}}],E=function(e){g(Ft(Ft({},qt),{},{pageIndex:e}))},O=function(e){Object(m.c)(m.a.startMonitor,{id:e},{loading:!0}).then((function(e){E(n.pager.pageIndex||1)}))},j=n.list,C=n.pager;return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"设备监控"}),r.a.createElement(f.a,null,r.a.createElement("div",{className:"use-service-flow-wrapper"},r.a.createElement(te.a,{type:3,flowLists:Vt}),r.a.createElement("div",{className:"extra-descs"},r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"配置数据流转，选择需要进行设备监控的rocketMQ数据对象。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"选择需要进行设备监控配置的对象，包括设备、产品、设备组。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"定义监控对象的具体监控规则，包括参数对比值、时长定义、条件比较等规则。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"在配置好规则前，可自定义具体整体规则的监控形式。"))))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(S.a,{href:"#/open/developCenter/deviceMonitor/add",icon:"plus",type:"primary"},"新增配置"),r.a.createElement(i.a,{placeholder:"请输入预警唯一ID查询",style:{width:"240px",margin:"0 24px 24px"},value:y,onChange:function(e){return b(e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",icon:"search",onClick:function(){return E(1)}},"查询"),r.a.createElement(w.a,{rowKey:"id",columns:h,dataSource:j,pagination:{defaultCurrent:C.pageIndex,total:C.totalRows,onChange:E,current:C.pageIndex,showTotal:function(e){return r.a.createElement("span",null,"共 ",e," 条")}}}))),r.a.createElement(d.a,{visible:l.length>0,modalOKHandle:function(){var e="del"==l[2]&&m.a.deleteMonitor||m.a.stopMonitor;Object(m.c)(e,{id:l[0]},{loading:!0}).then((function(e){E(n.pager.pageIndex||1),s([])}))},modalCancelHandle:function(){s([])},title:"del"==l[2]?"删除":"停止",descText:"即将".concat("del"==l[2]?"删除":"停止","监控规则"),needWarnIcon:!0,targetName:l[1]}))},Kt=(n("bHfV"),n("hVGm"));function Gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}C.a.Option;var Jt={labelCol:{span:4},wrapperCol:{span:14}},Ht=l.a.create({name:"monitor-baseinfo"})((function(e){var t=e.form,n=t.validateFieldsAndScroll,c=t.getFieldValue,o=t.getFieldDecorator,u=(t.resetFields,t.setFieldsValue),s=e.saveBaseInfo,f=e.baseFormData,d=e.transferList;Object(a.useEffect)((function(){var e=f.description,t=f.name,n=f.transferId,a=f.transferTopic,r=f.transferTag;u({description:e,name:t,transferId:n,transferTopic:a,transferTag:r})}),[f]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,Jt,r.a.createElement(l.a.Item,{label:"规则名称"},o("name",{rules:[{required:!0,message:"请输入监控规则名称"},{max:50,message:"最大输入长度为50"}]})(r.a.createElement(i.a,{placeholder:"请输入监控规则名称"}))),r.a.createElement(De.a,{label:"描述",formId:"description",astrictNub:"100",rows:"3",placeholder:"监控规则描述",getFieldDecorator:o,getFieldValue:c}),r.a.createElement("div",{className:"formitembox"},r.a.createElement(l.a.Item,{label:"数据流转"},o("transferObj",{rules:[{required:!0,message:"请选择数据流转对象"}]})(r.a.createElement(Kt.a,{style:{width:"450px"},options:void d.map((function(e){for(var t=e.transferId,n=e.transferName,a=e.recoverConfigList,r=void 0===a?[]:a,c={},o=0;o<r.length;o++){var l=JSON.parse(r[o]),i=l.topic,u=l.tag;c[i]?c[i].push(u):c[i]=[u]}var s=[];for(var f in c){console.log(c[f]);var d=c[f].map((function(e){return{value:e,label:e}}));s.push({value:f,label:f,children:d})}return{value:t,label:n,children:s}})),placeholder:"流转对象 / topic / tag"}))),r.a.createElement("div",{className:"tips"},"没有数据？请先配置",r.a.createElement("a",{href:"#/open/developCenter/dataFlow/list"}," 数据流转")))),r.a.createElement("div",{className:"stepbtnbox"},r.a.createElement(S.a,{className:"btn",type:"primary",onClick:function(){n((function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(n),!0).forEach((function(t){Bt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t);s(n)}))}},"下一步")))})),Wt=(n("kvrU"),n("BPQb")),zt=n("CvKH"),Yt=n.n(zt);n("WWzu"),n("xuDP");function Xt(e){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Zt=["ruleType"];function $t(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function en(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?en(Object(n),!0).forEach((function(t){nn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function an(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function cn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function on(e,t){return(on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=sn(e);if(t){var r=sn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return un(this,n)}}function un(e,t){return!t||"object"!==Xt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sn(e){return(sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var fn={labelCol:{span:4},wrapperCol:{span:16}},dn=C.a.Option,mn=(oe.a.RangePicker,[{id:"==",nam:"等于"},{id:">",nam:"大于"},{id:">=",nam:"大于等于"},{id:"<",nam:"小于"},{id:"<=",nam:"小于等于"}]),pn=[{id:"noDeviceData",nam:"设备无数据告警"},{id:"peak",nam:"设备数据触发阈值告警"},{id:"statistical",nam:"设备时间段内数据汇聚输出"},{id:"threshold",nam:"设备数据持续触发阈值告警"}],vn={ruleType:"noDeviceData",ruleId:"",stickTime:"",resendIntervalTime:""},yn={info:{productId:"",productName:""},rules:[Yt()(vn)]},bn={name:"",uniqueId:"",products:[Yt()(yn)]},gn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&on(e,t)}(o,e);var t,n,a,c=ln(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=c.call(this,e)).changeParam=function(e,n,a){var r=Yt()(t.state.campusConf),c=an(a,3),o=c[0],l=c[1],i=c[2];e.target&&(e=e.target.value),"fields"==n&&(e=e.split(",")),r[o].products[l].rules[i][n]=e,t.setState({campusConf:r})},t.getOneWarForm=function(e,n,a){var c=n.startTime,o=n.endTime,l=n.stickTime,u=n.judgeField,s=n.judgeValue,f=n.judgeType;switch(e){case"noDeviceData":var d=n.resendIntervalTime;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置时长"),r.a.createElement(i.a,{className:"timeinput",value:l,onChange:function(e){t.changeParam(e,"stickTime",a)}}),"毫秒无数据，则触发告警"),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"规则重发时间间隔"),r.a.createElement(i.a,{className:"timeinput",value:d,onChange:function(e){t.changeParam(e,"resendIntervalTime",a)}}),"毫秒"));case"peak":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(i.a,{onChange:function(e){t.changeParam(e,"startTime",a)},placeholder:"例：08:30:00",className:"hourtime",value:c}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(i.a,{onChange:function(e){t.changeParam(e,"endTime",a)},placeholder:"例：09:30:00",className:"hourtime",value:o})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较的字段和值"),r.a.createElement(i.a,{onChange:function(e){t.changeParam(e,"judgeField",a)},placeholder:"输入比较的字段",className:"kvinput",value:u}),r.a.createElement("span",{className:"rangeline"},":"),r.a.createElement(i.a,{onChange:function(e){t.changeParam(e,"judgeValue",a)},placeholder:"输入字段的值",className:"kvinput",value:s})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较方式"),r.a.createElement(C.a,{placeholder:"比较方式",defaultValue:"==",value:f,className:"compareselect",onChange:function(e){t.changeParam(e,"judgeType",a)}},mn.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(dn,{key:t,value:t},n)}))),r.a.createElement("span",{className:"desc"},"备注：与数据流转rocketMQ中数据做对比。")));case"statistical":var m=n.fields;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(i.a,{value:c,onChange:function(e){t.changeParam(e,"startTime",a)},placeholder:"例：08:30:00",className:"hourtime"}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(i.a,{value:o,onChange:function(e){t.changeParam(e,"endTime",a)},placeholder:"例：09:30:00",className:"hourtime"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"需获取的字段"),r.a.createElement(i.a,{value:m&&m.join(",")||"",onChange:function(e){t.changeParam(e,"fields",a)},placeholder:"可输入多个，英文逗号隔开",className:"manykey"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"desc solo"},"备注：蒋获取的字段k-v值做推送。")));case"threshold":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(i.a,{value:c,onChange:function(e){t.changeParam(e,"startTime",a)},placeholder:"例：08:30:00",className:"hourtime"}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(i.a,{value:o,onChange:function(e){t.changeParam(e,"endTime",a)},placeholder:"例：09:30:00",className:"hourtime"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较的字段和值"),r.a.createElement(i.a,{onChange:function(e){t.changeParam(e,"judgeField",a)},placeholder:"输入比较的字段",className:"kvinput",value:u}),r.a.createElement("span",{className:"rangeline"},":"),r.a.createElement(i.a,{onChange:function(e){t.changeParam(e,"judgeValue",a)},placeholder:"输入字段的值",className:"kvinput",value:s})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较方式"),r.a.createElement(C.a,{onChange:function(e){t.changeParam(e,"judgeType",a)},placeholder:"比较方式",defaultValue:"==",value:f,className:"compareselect"},mn.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(dn,{key:t,value:t},n)}))),r.a.createElement("span",{className:"desc"},"备注：与数据流转rocketMQ中数据做对比。")),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"持续时长"),r.a.createElement(i.a,{onChange:function(e){t.changeParam(e,"stickTime",a)},className:"timeinput",value:l}),"毫秒"));default:return null}},t.getRuleFormData=function(){var e=t.state,n=e.connector_type,a=e.connector_topic,r=e.connector_tag,c=e.connector_url,o=e.campusConf,l={connector_type:n};return"rocketmq"==n?(l.connector_topic=a,l.connector_tag=r):l.connector_url=c,{sinkConf:l,campusConf:Yt()(o)}},t.handleSubmit=function(e){var n=t.props,a=n.baseFormData,r=n.ruleId,c=tn(tn({},a),{},{ruleConf:JSON.stringify(t.getRuleFormData())}),o=m.a.addMonitor;r&&(c.id=r,o=m.a.updateMonitor),Object(m.c)(o,c).then((function(e){console.log(11111,e)}))},t.goPre=function(){t.props.setRuleFormData(t.getRuleFormData())},t.changeNoticeType=function(e){var n=e.target.value;t.setState({connector_type:n})},t.changeUrl=function(e){t.setState({connector_url:e})},t.addRule=function(e,n){var a=Yt()(t.state.campusConf);a[e].products[n].rules.push(Yt()(vn)),t.setState({campusConf:a})},t.addPro=function(e){var n=Yt()(t.state.campusConf);n[e].products.push(Yt()(yn)),t.setState({campusConf:n})},t.addGroup=function(){var e=Yt()(t.state.campusConf);e.push(Yt()(bn)),t.setState({campusConf:e})},t.changeWarType=function(e,n,a,r){var c=Yt()(t.state.campusConf);c[n].products[a].rules[r].ruleType=e,t.setState({campusConf:c})},t.changeGroup=function(e,n){var a=Yt()(t.state.campusConf),r=an(e.split("_|_"),2),c=r[0],o=r[1];a[n].uniqueId=c,a[n].name=o,t.setState({campusConf:a})},t.changePro=function(e,n,a){var r=Yt()(t.state.campusConf),c=an(e.split("_|_"),2),o=c[0],l=c[1];r[n].products[a].info.productId=o,r[n].products[a].info.productName=l,t.setState({campusConf:r})},t.state={connector_type:"rocketmq",connector_topic:"IOT_DEVICE_MONITOR_TOPIC_2021",connector_tag:void 0,connector_url:void 0,campusConf:[Yt()(bn)]},t}return t=o,(n=[{key:"componentDidMount",value:function(){var e=this.props.ruleFormData,t=e.sinkConf,n=e.campusConf;this.setState(tn(tn({},t),{},{campusConf:Yt()(n)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.campusConf,a=t.connector_type,c=t.connector_topic,o=t.connector_tag,u=t.connector_url,s=this.props,f=s.devicegrouplist,d=s.productList;return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,fn,r.a.createElement(l.a.Item,{label:"通知方式"},r.a.createElement(Wt.a.Group,{value:a,onChange:this.changeNoticeType},r.a.createElement(Wt.a,{value:"rocketmq"},"rocketMQ"),r.a.createElement(Wt.a,{value:"dingtalk"},"钉钉推送"))),"rocketmq"==a&&r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a.Item,{label:"topic"},r.a.createElement(C.a,{value:c},r.a.createElement(dn,{value:c},c))),o&&r.a.createElement(l.a.Item,{label:"tag"},r.a.createElement(C.a,{value:o},r.a.createElement(dn,{value:o},o))))||r.a.createElement(l.a.Item,{label:"钉钉推送地址"},r.a.createElement(i.a,{value:u,placeholder:"请输入钉钉推送地址",onChange:function(t){e.changeUrl(t)}})),r.a.createElement("div",{className:"devicegroupbox"},n.map((function(t,a){var c=t.uniqueId,o=t.name,i=t.products;return r.a.createElement("div",{key:c+"_"+a,className:"devicegroup"},r.a.createElement(l.a.Item,{className:"groupselect",label:"设备分组".concat(n[1]&&a+1||"")},r.a.createElement(C.a,{placeholder:"请选择设备分组",value:c+"_|_"+o,onChange:function(t){e.changeGroup(t,a)}},f.map((function(e){var t=e.id,n=e.name;return r.a.createElement(dn,{key:t,value:t+"_|_"+n},n)})))),r.a.createElement("div",{className:"pro-gropubox"},i.map((function(t,n){var c=t.info,o=t.rules,l=c.productId,i=c.productName;return r.a.createElement("div",{className:"pro-group",key:l+"_"+n},r.a.createElement(C.a,{className:"proselect",placeholder:"选择产品",showSearch:!0,optionFilterProp:"children",value:l+"_|_"+i,onChange:function(t){e.changePro(t,a,n)}},d.map((function(e,t){var n=e.productId,a=e.productName;return r.a.createElement(dn,{key:t,value:n+"_|_"+a},a)}))),r.a.createElement("div",{className:"rulebox"},o.map((function(t,c){var o=t.ruleType,l=$t(t,Zt);return r.a.createElement("div",{className:"rule",key:c},r.a.createElement(C.a,{placeholder:"选择告警方式",onChange:function(t){e.changeWarType(t,a,n,c)},value:o,className:"typeselect"},pn.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(dn,{key:t,value:t},n)}))),r.a.createElement("div",{className:"onewarn"},e.getOneWarForm(o,l,[a,n,c])))})),r.a.createElement("a",{className:"addbtn",onClick:function(){e.addRule(a,n)}},"增加规则")))})),r.a.createElement("a",{className:"addbtn",onClick:function(){e.addPro(a)}},"增加产品")))})),n.length<2&&r.a.createElement("a",{className:"addbtn",onClick:this.addGroup},"增加分组"))),r.a.createElement("div",{className:"stepbtnbox"},r.a.createElement(S.a,{className:"btn",onClick:this.goPre},"上一步"),r.a.createElement(S.a,{className:"btn",type:"primary",onClick:this.handleSubmit},"提 交")))}}])&&cn(t.prototype,n),a&&cn(t,a),o}(a.Component),hn=l.a.create({name:"ruleForm"})(gn);n("UgUF");function En(e){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function On(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?On(Object(n),!0).forEach((function(t){wn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):On(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function In(e,t){return(In=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Pn(e);if(t){var r=Pn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return kn(this,n)}}function kn(e,t){return!t||"object"!==En(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pn(e){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Nn={pageIndex:1,pageRows:9999},Tn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&In(e,t)}(o,e);var t,n,a,c=Cn(o);function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=c.call(this,e)).goToStep=function(e){t.setState({current:e},(function(){console.log(t.state)}))},t.saveBaseInfo=function(e){t.setState({baseFormData:e,current:1})},t.setRuleFormData=function(e){t.setState({ruleFormData:e,current:0})},t.baseInfoForm={},t.ruleForm={},t.publicTypeForm={},t.state={current:0,ruleId:t.props.match.params.id,baseFormData:{},ruleFormData:[],devicegrouplist:[],productList:[],transferList:[]};var n=t.props.match.params.id;return n&&Object(m.c)(m.a.getMonitor,{id:n},{loading:!0}).then((function(e){var a=e.data,r=a.description,c=a.name,o=a.transferId,l=a.transferTopic,i=a.transferTag,u=a.ruleConf,s={description:r,name:c,transferId:o,transferTopic:l,transferTag:i},f=JSON.parse(u);t.setState({ruleId:n,baseFormData:s,ruleFormData:f},(function(){console.log(9999,t.state)}))})),t}return t=o,(n=[{key:"componentDidMount",value:function(){var e=this;Object(m.c)(m.a.getGroupList,jn({},Nn)).then((function(t){e.setState({devicegrouplist:t.data.list})})),Object(m.c)(m.a.getDownProduct,jn({},Nn)).then((function(t){var n=t.data.list;n&&n.length&&n.length>0&&e.setState({productList:n})})),Object(m.c)(m.a.getTransfer4Monitor).then((function(t){var n=t.data||[];console.log(44,n),e.setState({transferList:n})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.current,a=t.ruleId,c=t.baseFormData,o=t.ruleFormData,l=t.devicegrouplist,i=t.productList,s=t.transferList;return r.a.createElement("div",{className:"device-monitordetailpage flex-column"},r.a.createElement(u.a,{backHandle:function(){return e.props.history.push({pathname:"/open/developCenter/deviceMonitor/list",page:"2"})},title:a?"编辑设备监控":"新增设备监控"}),r.a.createElement("div",{className:"step-header-wrapper"},r.a.createElement("div",{className:"step-header flex-row"},r.a.createElement("div",{className:"step-item flex-row flex1".concat(0===n?" current-step":"")},r.a.createElement("i",{className:"step-product"}),r.a.createElement("span",null,"1. 监控信息")),r.a.createElement("div",{className:"step-item flex1 flex-row".concat(1===n?" current-step":"")},r.a.createElement("i",{className:"step-data"}),r.a.createElement("span",null,"2. 规则配置")))),r.a.createElement("div",{className:"add-content-wrapper"},r.a.createElement("div",{className:"add-content"},r.a.createElement("div",{className:"steps-content"},[r.a.createElement(Ht,{saveBaseInfo:this.saveBaseInfo,baseFormData:c,transferList:s}),r.a.createElement(hn,{baseFormData:c,ruleFormData:o,ruleId:a,setRuleFormData:this.setRuleFormData,devicegrouplist:l,productList:i})][n]))))}}])&&Sn(t.prototype,n),a&&Sn(t,a),o}(a.Component);function xn(e){var t=e.match.path;return r.a.createElement(c.Switch,null,r.a.createElement(c.Route,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(Ut,e)}}),r.a.createElement(c.Route,{path:"".concat(t,"/edit/:id"),render:function(e){return r.a.createElement(Tn,e)}}),r.a.createElement(c.Route,{path:"".concat(t,"/add"),render:function(e){return r.a.createElement(Tn,e)}}),r.a.createElement(c.Redirect,{to:"".concat(t,"/list")}))}function Ln(e){var t=e.match.path;return r.a.createElement(c.Switch,null,r.a.createElement(c.Route,{path:"".concat(t,"/projectManage"),component:ee}),r.a.createElement(c.Route,{path:"".concat(t,"/serveDevelop"),component:ae}),r.a.createElement(c.Route,{path:"".concat(t,"/serveDetail/:id"),component:Ne}),r.a.createElement(c.Route,{path:"".concat(t,"/dataFlow"),component:Rt}),r.a.createElement(c.Route,{path:"".concat(t,"/deviceMonitor"),component:xn}),r.a.createElement(c.Redirect,{to:"".concat(t,"/projectManage")}))}},UgUF:function(e,t,n){},gSWv:function(e,t,n){},ivPg:function(e,t,n){e.exports=n.p+"static/images/no-source-tip.681eb7825cf81b5da33967ff8571f3c6.png"},vQck:function(e,t,n){}}]);