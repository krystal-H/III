(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"0eIn":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAACB0lEQVQ4T32ST2sTQRjGn9nZTTEKBeOtbv1T7zUHi8vmZMCw/QCBYsGT+DH88wEUeoseVTx4USyJFWpVYldaEJQEFROxCVqbi1Q0oWZnXpmZ3XRz0IXd2d2Z9/c+7/s+7HmzFzBChUi4RACZBwgYX6X6p/bQJViXS2fcmjrCXjS+d6QkdywoDdBAA44BitwtzZ2Y1oC1d9uUZDVJyagAYDGrcC4/9Up/AHi6ueVLIepqNzh7kmnAs7ffVISWTFI/RxDObb+Yn1pPA4QCEGHem0kAXzskyTWZk7pjFUlP0srUIYbuvHfKlLD6ZjsgiAqRdEe1GpIGDiWwvjOJ97uHMIhsHJ6IkJsYLu9QtvygzAZaxr8u7wYdsA5i1bbgZSzAYYATrxmOcJhB8b+Awm26agNXksCFWeBRA9Awc19jK5tfAoBVSKoS4mbGXrj1aRq/hw4cbrI/vAhcuLuvwrHQZisbWx1Vf9pAyfvSxxlwMCzmgYXT+4U+bgC1plbyhz15/Vm3jBMvnPeOjWZeDVv+nZZb74uMzq5k31sELt03CjKqHxxtVg3b2jWcc780d3w08+rLD/7Gj1y9uXtk1LzyLLDcMOUooK16UAvb2srGpuPzjyTDWu8ofkbZ8QmY4HBPoMiqYSsgQRWpfBAbJu0HQQytXzn09iYhyEaWiz5jfKkfWddvltngL3uXRG6qfr/OAAAAAElFTkSuQmCC"},"4ZAH":function(e,t,a){},RGxR:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return ie}));a("ef1R"),a("Ra8s"),a("sfoS"),a("HsXu"),a("bs69"),a("Lm8M"),a("ryEf"),a("qgAm"),a("9b3Y"),a("Ck9u"),a("QcZr");var n=a("b+L2"),r=(a("MNU5"),a("YeX6")),c=(a("SiC7"),a("AePH")),l=(a("6IzV"),a("QFmM")),i=(a("UdMA"),a("ViyK")),o=(a("2ek4"),a("oWtQ")),u=(a("xzjF"),a("PeP6")),s=(a("hEGT"),a("62KB"),a("T9Mk")),d=a.n(s),f=a("MeRu"),m=a("0eIn"),p=a.n(m),b=(a("IHDg"),a("vV4J"),a("RfWx"),a("DBxd"),a("sQtw")),y=(a("oENA"),a("uTCA")),h=(a("UTJx"),a("dVdO")),v=(a("59iL"),a("f6Fh")),E=a("CvKH"),g=a.n(E),O=(a("xc6N"),a("av3G"),a("pckg"),a("P37N"),a("4ZAH"),a("rwTb")),I=a("Nlzp");function S(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||N(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(Object(a),!0).forEach((function(t){A(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function A(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],l=!0,i=!1;try{for(a=a.call(e);!(l=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);l=!0);}catch(e){i=!0,r=e}finally{try{l||null==a.return||a.return()}finally{if(i)throw r}}return c}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"==typeof e)return k(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var T=o.a.Step,P=v.a.TabPane;function x(e){var t=e.isModalVisible,a=e.colseMoadl,n=e.cancelModel,c=C(Object(s.useState)("0"),2),l=c[0],i=c[1],u=C(Object(s.useState)({one:{},two:{},three:{}}),2),f=u[0],m=u[1],p=Object(s.useRef)(null),b=Object(s.useRef)(null),y=Object(s.useRef)(null),E=[d.a.createElement("div",{key:"a"},l-0>0&&d.a.createElement(r.a,{style:{margin:"0 8px"},onClick:function(){i((l-0-1).toString())}},"上一步"),l-0<2&&d.a.createElement(r.a,{type:"primary",onClick:function(){0==l?p.current.onFinish():1==l&&b.current.onFinish()}},"下一步"),l-0==2&&d.a.createElement(r.a,{type:"primary",onClick:function(){y.current.onFinish()}},"完成"))],O=function(e,t){0==l?m((function(e){var a=g()(e);return a.one=g()(t),a})):1==l&&m((function(e){var a=JSON.parse(JSON.stringify(e));return a.two=g()(t),a})),i(e)};return d.a.createElement(h.a,{title:"新增订阅",visible:t,onCancel:n,width:"900px",wrapClassName:"add-subscribe-modal",footer:E},d.a.createElement("div",{className:"add-subscribe"},d.a.createElement("div",{className:"add-subscribe-main"},d.a.createElement("div",{className:"edit-left-protocol-wrap"}," ",d.a.createElement(v.a,{activeKey:l,renderTabBar:function(e,t){return d.a.createElement(o.a,{current:l-0},d.a.createElement(T,{title:"选择订阅对象"}),d.a.createElement(T,{title:"配置订阅内容"}),d.a.createElement(T,{title:"确定订阅方式"}))}},d.a.createElement(P,{tab:"Tab 1",key:"0"},d.a.createElement(V,{ref:p,continueStep:O})),d.a.createElement(P,{tab:"Tab 2",key:"1"},d.a.createElement(R,{ref:b,continueStep:O,oneData:f.one})),d.a.createElement(P,{tab:"Tab 3",key:"2"},d.a.createElement(L,{ref:y,finishSub:function(e){var t=w(w({},f.one),{},{devicePushDataConfList:f.two},e);Object(I.c)(I.a.addsubscribe,t,{loading:!0}).then((function(e){a()}))}})))))))}function V(e,t){var a=e.continueStep,n=C(l.a.useForm(),1)[0],r=C(Object(s.useState)([]),2),c=r[0],o=r[1],f=C(Object(s.useState)([]),2),m=f[0],p=f[1];Object(s.useEffect)((function(){h()}),[]);var h=function(){Object(I.c)(I.a.allProductPubList).then((function(e){o(e.data)}))},v=function(){n.validateFields().then((function(e){var t=g()(e),n="";if(c.forEach((function(e){e.productId==t.productId&&(n=e.productName)})),"number"==typeof t.isAll){var r=[];m.forEach((function(e){(t.isAll||t.labelVoList&&t.labelVoList.indexOf(e.value)>-1)&&r.push(e)})),t.labelVoList=r}t.productName=n,a("1",t)}))};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:v}}),[c,m]),d.a.createElement("div",{className:"step-one"},d.a.createElement(l.a,{form:n,labelAlign:"right"},d.a.createElement(l.a.Item,{name:"subscription",label:"订阅名称",rules:[{required:!0,whitespace:!0}]},d.a.createElement(i.a,null)),d.a.createElement(l.a.Item,{name:"productId",label:"归属产品",rules:[{required:!0}]},d.a.createElement(u.a,{onChange:function(e){n.setFieldsValue({labelVoList:[]}),Object(I.c)(I.a.getLabelByAddress,{productId:e}).then((function(e){var t=[];e.data.forEach((function(e){t.push(w(w({},e),{},{label:e.labelValue,value:e.labelId,id:e.labelId}))})),p(t)}))},showSearch:!0,optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},c.map((function(e){return d.a.createElement(u.a.Option,{value:e.productId,key:e.productId},e.productName)})))),d.a.createElement(l.a.Item,{name:"isAll",label:"选择设备"},d.a.createElement(y.a.Group,null,d.a.createElement(y.a,{value:1},"全部设备"),d.a.createElement(y.a,{value:0},"根据标签筛选设备"))),d.a.createElement(l.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.isAll!==t.isAll}},(function(e){return 0==(0,e.getFieldValue)("isAll")?d.a.createElement(l.a.Item,{name:"labelVoList",label:"选择标签"},d.a.createElement(b.a.Group,{options:m})):null}))))}function R(e,t){var a=e.continueStep,r=e.oneData,c=[{title:"数据名称",dataIndex:"funcName",key:"funcName"},{title:"数据标识",dataIndex:"funcIdentifier",key:"funcIdentifier"}],l=C(Object(s.useState)({one:[],two:[],three:[]}),2),i=l[0],o=l[1],u=C(Object(s.useState)("a"),2),f=u[0],m=u[1],p=C(Object(s.useState)([]),2),b=p[0],y=p[1],h=C(Object(s.useState)([]),2),E=h[0],g=h[1],O=C(Object(s.useState)([]),2),j=O[0],A=O[1];Object(s.useEffect)((function(){N()}),[r.productId]);var N=function(){y([]),g([]),A([]),Object(I.c)(I.a.standardFnList,{productId:r.productId}).then((function(e){var t=e.data.standard.concat(e.data.custom),a={};a.one=t.filter((function(e){if("properties"===e.funcType)return e})),a.two=t.filter((function(e){if("events"===e.funcType)return e})),a.three=t.filter((function(e){if("services"===e.funcType)return e})),o(a)}))},k={onChange:function(e,t){var a=[];t.forEach((function(e){var n={dataType:5,dataTypeScope:t.length==i.one.length?2:1,protocolProperty:e.funcIdentifier};a.push(n)})),y(a)},getCheckboxProps:function(e){return{funcIdentifier:e.funcIdentifier}}},T={onChange:function(e,t){var a=[];t.forEach((function(e){var n={dataType:6,dataTypeScope:t.length==i.two.length?2:1,protocolProperty:e.funcIdentifier};a.push(n)})),g(a)},getCheckboxProps:function(e){return{name:e.funcIdentifier}}},x={onChange:function(e,t){var a=[];t.forEach((function(e){var n={dataType:7,dataTypeScope:t.length==i.three.length?2:1,protocolProperty:e.funcIdentifier};a.push(n)})),A(a)},getCheckboxProps:function(e){return{name:e.funcIdentifier}}},V=function(){var e=[].concat(S(b),S(E),S(j));a("2",e)};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:V}}),[b,E,j]),d.a.createElement("div",{className:"step-two"},d.a.createElement("div",{className:"product-title"},"已选择产品：",r.productName),d.a.createElement("div",{className:"select-tip"},"选择协议类型"),d.a.createElement(v.a,{defaultActiveKey:"a",activeKey:f,onChange:function(e){m(e)}},d.a.createElement(P,{tab:"属性",key:"a"},d.a.createElement(n.a,{rowSelection:w({},k),dataSource:i.one,columns:c,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}})),d.a.createElement(P,{tab:"事件",key:"b"},d.a.createElement(n.a,{dataSource:i.two,rowSelection:w({},T),columns:c,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}})),d.a.createElement(P,{tab:"服务",key:"c"},d.a.createElement(n.a,{dataSource:i.three,rowSelection:w({},x),columns:c,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}}))))}function L(e,t){var a=e.finishSub,n=C(l.a.useForm(),1)[0],r=function(){n.validateFields().then((function(e){a(e)}))};Object(s.useImperativeHandle)(t,(function(){return{onFinish:r}}));var c=C(Object(s.useState)("0"),2),o=c[0],u=c[1];return d.a.createElement("div",{className:"step-one"},d.a.createElement(l.a,{form:n,labelAlign:"right"},d.a.createElement(l.a.Item,{name:"pushWay",label:"订阅方式",rules:[{required:!0,message:"请选择订阅方式"}]},d.a.createElement(y.a.Group,{onChange:function(e){u(e.target.value)}},d.a.createElement(y.a,{value:"0"},"API数据PUSH形式"),d.a.createElement(y.a,{value:"1"},"MQTT主题订阅"))),"0"===o&&d.a.createElement(l.a.Item,{name:"url",label:d.a.createElement(O.a,{label:"数据订阅URL",tip:"第三方云服务接口的唯一标识，供C-life云推送服务给第三方云推送数据使用，现仅支持http方式"}),rules:[{required:!0,whitespace:!0,message:"请输入数据订阅URL"}]},d.a.createElement(i.a,null)),"0"===o&&d.a.createElement(l.a.Item,{name:"pushToken",label:d.a.createElement(O.a,{label:"Token",tip:"第三方云服务接口对接C-life云推送服务的凭证，用来验证厂商服务接口的合法性"}),rules:[{required:!0,whitespace:!0,message:"请输入Token"}]},d.a.createElement(i.a,null)),d.a.createElement(l.a.Item,{label:" ",colon:!1},d.a.createElement("a",{onClick:function(){window.open("http://skintest.hetyj.com/10086/a9b97e2ef3c7465bb79b63374cbd4dd8.docx")}},"订阅帮助文档"))))}function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function D(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){H(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function H(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],l=!0,i=!1;try{for(a=a.call(e);!(l=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);l=!0);}catch(e){i=!0,r=e}finally{try{l||null==a.return||a.return()}finally{if(i)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}V=Object(s.forwardRef)(V),R=Object(s.forwardRef)(R),L=Object(s.forwardRef)(L);var K=o.a.Step,W=v.a.TabPane;function Q(e){var t=e.editModelVis,a=e.colseMoadl,n=e.cancelModel,c=e.id,l=e.editData,i=M(Object(s.useState)("0"),2),u=i[0],f=i[1],m=M(Object(s.useState)({one:{},two:{},three:{}}),2),p=m[0],b=m[1],y=Object(s.useRef)(null),E=Object(s.useRef)(null),O=Object(s.useRef)(null),S=[d.a.createElement("div",{key:"a"},u-0>0&&d.a.createElement(r.a,{style:{margin:"0 8px"},onClick:function(){f((u-0-1).toString())}},"上一步"),u-0<2&&d.a.createElement(r.a,{type:"primary",onClick:function(){0==u?y.current.onFinish():1==u&&E.current.onFinish()}},"下一步"),u-0==2&&d.a.createElement(r.a,{type:"primary",onClick:function(){O.current.onFinish()}},"完成"))],j=function(e,t){0==u?b((function(e){var a=g()(e);return a.one=g()(t),a})):1==u&&b((function(e){var a=g()(e);return a.two=g()(t),a})),f(e)};return d.a.createElement(h.a,{title:"编辑订阅",visible:t,onCancel:n,width:"900px",wrapClassName:"add-subscribe-modal",footer:S},d.a.createElement("div",{className:"add-subscribe"},d.a.createElement("div",{className:"add-subscribe-main"},d.a.createElement("div",{className:"edit-left-protocol-wrap"}," ",d.a.createElement(v.a,{activeKey:u,renderTabBar:function(e,t){return d.a.createElement(o.a,{current:u-0},d.a.createElement(K,{title:"选择订阅对象"}),d.a.createElement(K,{title:"配置订阅内容"}),d.a.createElement(K,{title:"确定订阅方式"}))}},d.a.createElement(W,{tab:"Tab 1",key:"0"},d.a.createElement(J,{ref:y,continueStep:j,editData:l})),d.a.createElement(W,{tab:"Tab 2",key:"1"},d.a.createElement(q,{ref:E,continueStep:j,oneData:p.one,editData:l})),d.a.createElement(W,{tab:"Tab 3",key:"2"},d.a.createElement(z,{ref:O,finishSub:function(e){var t=D(D(D({},p.one),{},{devicePushDataConfList:p.two},e),{},{urlConfId:c});Object(I.c)(I.a.addsubscribe,t,{loading:!0}).then((function(e){a()}))},editData:l})))))))}function J(e,t){var a=e.continueStep,n=e.editData,r=M(l.a.useForm(),1)[0],c=M(Object(s.useState)([]),2),o=c[0],f=c[1],m=M(Object(s.useState)([]),2),p=m[0],h=m[1];Object(s.useEffect)((function(){v();var e=[];n.labelVoList&&n.labelVoList.forEach((function(t){e.push(t.labelId)})),r.setFieldsValue({subscription:n.subscription,productId:n.productId,isAll:n.isAll,labelVoList:e}),E(n.productId)}),[]);var v=function(){Object(I.c)(I.a.allProductPubList).then((function(e){h(e.data)}))},E=function(e){r.setFieldsValue({labelVoList:[]}),Object(I.c)(I.a.getLabelByAddress,{productId:e}).then((function(e){var t=[];e.data.forEach((function(e){t.push(D(D({},e),{},{label:e.labelValue,value:e.labelId,id:e.labelId}))})),f(t)}))},O=function(){r.validateFields().then((function(e){var t=g()(e),n="";if(p.forEach((function(e){e.productId==t.productId&&(n=e.productName)})),t.productName=n,"number"==typeof t.isAll){var r=[];o.forEach((function(e){(t.isAll||t.labelVoList&&t.labelVoList.indexOf(e.value)>-1)&&r.push(e)})),t.labelVoList=r}a("1",t)}))};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:O}}),[p,o]),d.a.createElement("div",{className:"step-one"},d.a.createElement(l.a,{form:r,labelAlign:"right"},d.a.createElement(l.a.Item,{name:"subscription",label:"订阅名称",rules:[{required:!0}]},d.a.createElement(i.a,null)),d.a.createElement(l.a.Item,{name:"productId",label:"归属产品",rules:[{required:!0}]},d.a.createElement(u.a,{onChange:function(e){E(e)},showSearch:!0,optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},p.map((function(e){return d.a.createElement(u.a.Option,{value:e.productId,key:e.productId},e.productName)})))),d.a.createElement(l.a.Item,{name:"isAll",label:"选择设备"},d.a.createElement(y.a.Group,null,d.a.createElement(y.a,{value:1},"全部设备"),d.a.createElement(y.a,{value:0},"根据标签筛选设备"))),d.a.createElement(l.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.isAll!==t.isAll}},(function(e){return 0==(0,e.getFieldValue)("isAll")?d.a.createElement(l.a.Item,{name:"labelVoList",label:"选择标签"},d.a.createElement(b.a.Group,{options:o})):null}))))}function q(e,t){var a=e.continueStep,r=e.oneData,c=e.editData,l=M(Object(s.useState)([]),2),i=l[0],o=l[1],u=M(Object(s.useState)([]),2),f=u[0],m=u[1],p=M(Object(s.useState)([]),2),b=p[0],y=p[1],h=[{title:"数据名称",dataIndex:"funcName",key:"funcName"},{title:"数据标识",dataIndex:"funcIdentifier",key:"funcIdentifier"}],E=M(Object(s.useState)({one:[],two:[],three:[]}),2),g=E[0],O=E[1],S=M(Object(s.useState)("a"),2),j=S[0],w=S[1];Object(s.useEffect)((function(){C(),A()}),[]);var A=function(){var e=[],t=[],a=[];c.devicePushDataConfList.forEach((function(n){n.funcIdentifier=n.protocolProperty,5==n.dataType&&(e.push(n.protocolProperty),"a"),6==n.dataType&&(t.push(n.protocolProperty),"b"),7==n.dataType&&(a.push(n.protocolProperty),"c")})),o(e),m(t),y(a)},C=function(){Object(I.c)(I.a.standardFnList,{productId:r.productId}).then((function(e){var t=e.data.standard.concat(e.data.custom),a={};a.one=t.filter((function(e){if("properties"===e.funcType)return e})),a.two=t.filter((function(e){if("events"===e.funcType)return e})),a.three=t.filter((function(e){if("services"===e.funcType)return e})),O(a)}))},N={onChange:function(e,t){o(e)},selectedRowKeys:i},k={onChange:function(e,t){m(e)},selectedRowKeys:f},T={onChange:function(e,t){y(e)},selectedRowKeys:b},P=function(){var e=[];g.one.forEach((function(t){if(i.indexOf(t.funcIdentifier)>-1){var a={dataType:5,dataTypeScope:i.length==g.one.length?2:1,protocolProperty:t.funcIdentifier};e.push(a)}})),g.two.forEach((function(t){if(f.indexOf(t.funcIdentifier)>-1){var a={dataType:6,dataTypeScope:f.length==g.one.length?2:1,protocolProperty:t.funcIdentifier};e.push(a)}})),g.three.forEach((function(t){if(b.indexOf(t.funcIdentifier)>-1){var a={dataType:7,dataTypeScope:b.length==g.one.length?2:1,protocolProperty:t.funcIdentifier};e.push(a)}})),a("2",e)};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:P}}),[i,f,b]),d.a.createElement("div",{className:"step-two"},d.a.createElement("div",{className:"product-title"},"已选择产品：",r.productName),d.a.createElement("div",{className:"select-tip"},"选择协议类型"),d.a.createElement(v.a,{defaultActiveKey:"a",activeKey:j,onChange:function(e){w(e)}},d.a.createElement(W,{tab:"属性",key:"a"},d.a.createElement(n.a,{rowSelection:D({},N),dataSource:g.one,columns:h,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}})),d.a.createElement(W,{tab:"事件",key:"b"},d.a.createElement(n.a,{dataSource:g.two,rowSelection:D({},k),columns:h,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}})),d.a.createElement(W,{tab:"服务",key:"c"},d.a.createElement(n.a,{dataSource:g.three,rowSelection:D({},T),columns:h,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}}))))}function z(e,t){var a=e.finishSub,n=e.editData;console.log(n,"liek");var r=M(Object(s.useState)("0"),2),c=r[0],o=r[1],u=M(l.a.useForm(),1)[0],f=function(){u.validateFields().then((function(e){a(e)}))};Object(s.useEffect)((function(){o(n.pushWay.toString()),0==n.pushWay?u.setFieldsValue({pushWay:n.pushWay.toString(),url:n.url,pushToken:n.pushToken}):u.setFieldsValue({pushWay:n.pushWay.toString()})}),[]),Object(s.useImperativeHandle)(t,(function(){return{onFinish:f}}));return d.a.createElement("div",{className:"step-one"},d.a.createElement(l.a,{form:u,labelAlign:"right"},d.a.createElement(l.a.Item,{name:"pushWay",label:"订阅方式",rules:[{required:!0}]},d.a.createElement(y.a.Group,{onChange:function(e){o(e.target.value)}},d.a.createElement(y.a,{value:"0"},"API数据PUSH形式"),d.a.createElement(y.a,{value:"1"},"MQTT主题订阅"))),"0"===c&&d.a.createElement(l.a.Item,{name:"url",label:d.a.createElement(O.a,{label:"数据订阅URL",tip:"第三方云服务接口的唯一标识，供C-life云推送服务给第三方云推送数据使用，现仅支持http方式"}),rules:[{required:!0,message:"请输入"}]},d.a.createElement(i.a,null)),"0"===c&&d.a.createElement(l.a.Item,{name:"pushToken",label:d.a.createElement(O.a,{label:"Token",tip:"第三方云服务接口对接C-life云推送服务的凭证，用来验证厂商服务接口的合法性"}),rules:[{required:!0,message:"请输入"}]},d.a.createElement(i.a,null)),d.a.createElement(l.a.Item,{label:" ",colon:!1},d.a.createElement("a",{onClick:function(){window.open("http://skintest.hetyj.com/10086/a9b97e2ef3c7465bb79b63374cbd4dd8.docx")}},"订阅帮助文档"))))}J=Object(s.forwardRef)(J),q=Object(s.forwardRef)(q),z=Object(s.forwardRef)(z);var Y=a("P2RN"),B=a("FC04");function G(e){var t=e.operate,a=e.visible,n=e.updateOkHandle,r=e.updateCancelHandle,c=e.actionObj,l=null;switch(t){case 1:l={title:"启动数据订阅",desc:"启动",needWarnIcon:!1};break;case 2:l={title:"停用数据订阅",desc:"停用",needWarnIcon:!0}}return d.a.createElement(B.a,{visible:a,modalOKHandle:function(){return n(t)},modalCancelHandle:r,targetName:c.subscription,title:l.title,descGray:!0,needWarnIcon:l.needWarnIcon,descText:l.desc,tipText:l.tip})}a("qSPm");function Z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],l=!0,i=!1;try{for(a=a.call(e);!(l=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);l=!0);}catch(e){i=!0,r=e}finally{try{l||null==a.return||a.return()}finally{if(i)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return X(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var _=[{title:"数据名称",dataIndex:"funcName",key:"funcName"},{title:"数据标识",dataIndex:"protocolProperty",key:"protocolProperty"}];function $(e){var t=e.rightVisible,a=e.onCloseRight,r=e.id,c=Z(Object(s.useState)({devicePushDataConfList:[]}),2),l=c[0],i=c[1];Object(s.useEffect)((function(){o()}),[]);var o=function(){var e=I.a.subscribeDetail+"?urlConfId="+r;Object(I.c)(e).then((function(e){i(e.data)}))};return d.a.createElement(h.a,{title:"订阅详情",footer:!1,visible:t,onOk:a,onCancel:a,width:"900px"},d.a.createElement("div",{className:"subscrbe-info"},d.a.createElement("div",{className:"subscrbe-c"},d.a.createElement("div",{className:"subscrbe-t"},"订阅对象"),d.a.createElement("div",{className:"subscrbe-item"},d.a.createElement("div",{className:"item-label"},"订阅名称："),d.a.createElement("div",{className:"item-value"},l.subscription)),d.a.createElement("div",{className:"subscrbe-item"},d.a.createElement("div",{className:"item-label"},"归属产品："),d.a.createElement("div",{className:"item-value"},l.productName)),d.a.createElement("div",{className:"subscrbe-item"},d.a.createElement("div",{className:"item-label"},"订阅设备："),d.a.createElement("div",{className:"item-value"},l.subscription)),d.a.createElement("div",{className:"subscrbe-t"},"配置数据"),d.a.createElement(n.a,{dataSource:l.devicePushDataConfList,rowKey:"protocolProperty",columns:_}),d.a.createElement("div",{className:"subscrbe-t",style:{marginTop:"22px"}},"订阅方式"),d.a.createElement("div",{className:"subscrbe-item"},d.a.createElement("div",{className:"item-label"},"订阅方式："),d.a.createElement("div",{className:"item-value"},l.pushWay?"MQTT主题订阅":"API数据PUSH形式")),d.a.createElement("div",{className:"subscrbe-item"},d.a.createElement("div",{className:"item-label"},"数据订阅URL："),d.a.createElement("div",{className:"item-value"},l.url)),d.a.createElement("div",{className:"subscrbe-item"},d.a.createElement("div",{className:"item-label"},"Token："),d.a.createElement("div",{className:"item-value"},l.pushToken)))))}a("rvOk");var ee=a("yq+b"),te=a.n(ee);function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],l=!0,i=!1;try{for(a=a.call(e);!(l=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);l=!0);}catch(e){i=!0,r=e}finally{try{l||null==a.return||a.return()}finally{if(i)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ne(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var re=u.a.Option,ce=o.a.Step,le=i.a.Search;function ie(){var e=ae(l.a.useForm(),1)[0],t=ae(Object(s.useState)(0),2),a=t[0],i=t[1],m=ae(Object(s.useState)([]),2),b=m[0],y=m[1],h=ae(Object(s.useState)([]),2),v=h[0],E=h[1],g=ae(Object(s.useState)({pageIndex:1,totalRows:0,pageRows:10}),2),O=g[0],S=g[1],j=ae(Object(s.useState)(!1),2),w=j[0],A=j[1],C=ae(Object(s.useState)(null),2),N=C[0],k=C[1],T=ae(Object(s.useState)({}),2),P=T[0],V=T[1],R=function(e,t){A(!0),V(t),k(e)},L=ae(Object(s.useState)(!1),2),F=L[0],D=L[1];Object(s.useEffect)((function(){Object(I.c)(I.a.allProductPubList,{}).then((function(e){e.data.unshift({productId:0,productName:"全部产品"}),E(e.data)}))}),[]),Object(s.useEffect)((function(){H()}),[O.pageRows,O.pageIndex,a]);var H=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n={};-1!=e.getFieldValue("push_way")&&(n.push_way=e.getFieldValue("push_way")),e.getFieldValue("subscription")&&(n.subscription=e.getFieldValue("subscription"));var r={devicePushUrlConf:n,pager:O};a&&(r.devicePushUrlConf.productId=a),Object(I.c)(I.a.subscribeList,r,{loading:t}).then((function(e){y(e.data.list),S((function(t){var a=JSON.parse(JSON.stringify(t));return Object.assign(a,{totalRows:e.data.pager.totalRows})}))}))},M=ae(Object(s.useState)(!1),2),U=M[0],K=M[1],W=ae(Object(s.useState)(!1),2),J=W[0],q=W[1],z=ae(Object(s.useState)({devicePushDataConfList:[]}),2),B=z[0],Z=z[1],X=[{title:"订阅ID",dataIndex:"urlConfId",key:"urlConfId"},{title:"订阅名称",dataIndex:"subscription",key:"subscription"},{title:"订阅方式",dataIndex:"pushWay",key:"pushWay",render:function(e){return d.a.createElement("span",null,e?"MQTT主题订阅":"API数据PUSH形")}},{title:"归属产品名称",dataIndex:"productName",key:"productName"},{title:"订阅更新时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return d.a.createElement("span",null,e&&te()(e).add(8,"h").format("YYYY-MM-DD HH:mm:ss")||"--")}},{title:"状态",dataIndex:"pushState",key:"pushState",render:function(e){return d.a.createElement("span",null,e?"正常":"停用")}},{title:"操作",render:function(e,t){return d.a.createElement(c.b,{size:"middle"},d.a.createElement("a",{onClick:function(){V(t),D(!0)}},"查看"),d.a.createElement("a",{onClick:function(){!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=I.a.subscribeDetail+"?urlConfId="+e.urlConfId;Object(I.c)(a,{},{loading:t}).then((function(t){Z(t.data),V(e),q(!0)}))}(t)}},"编辑"),t.pushState?d.a.createElement("a",{onClick:function(){R(2,t)}},"停用"):d.a.createElement("a",{onClick:function(){R(1,t)}},"启动"))}}];return d.a.createElement("div",{id:"subscribe-data"},d.a.createElement(f.a,{title:"数据订阅"},d.a.createElement("div",{className:"top-select"},d.a.createElement(u.a,{style:{width:150},value:a,onChange:function(e){S((function(e){var t=JSON.parse(JSON.stringify(e));return Object.assign(t,{pageIndex:1})})),i(e)},showSearch:!0,optionFilterProp:"children"},v.map((function(e){return d.a.createElement(re,{value:e.productId,key:e.productId},e.productName)}))))),d.a.createElement("div",{className:"comm-shadowbox setp-ttip"},d.a.createElement("div",{className:"step-title"},d.a.createElement("img",{src:p.a,alt:""}),d.a.createElement("span",null,"数据订阅步骤")),d.a.createElement(o.a,{current:-1,initial:0},d.a.createElement(ce,{title:"选择产品",description:"可根据产品订阅以及设备标签，选择需要的数据对象。"}),d.a.createElement(ce,{title:"配置订阅内容",description:"可根据产品或设备的物模型，订阅详细的功能点数据信息。"}),d.a.createElement(ce,{title:"确定订阅方式",description:"支持数据API推送服务或MQTT订阅，两种不同的方式。"}))),d.a.createElement("div",{className:"comm-shadowbox device-content"},d.a.createElement("div",{className:"content-top"},d.a.createElement("div",{className:"content-top-left"},d.a.createElement(l.a,{className:"device-filter-form",form:e,initialValues:{push_way:"-1"},layout:"inline"},d.a.createElement(l.a.Item,{name:"push_way",label:"订阅方式"},d.a.createElement(u.a,{style:{width:"200px"}},d.a.createElement(re,{value:"-1"},"全部方式"),d.a.createElement(re,{value:"0"},"API数据PUSH形式"),d.a.createElement(re,{value:"1"},"MQTT主题订阅"))),d.a.createElement(l.a.Item,{label:"订阅名称",name:"subscription"},d.a.createElement(le,{onSearch:function(){1==O.pageIndex?H():S((function(e){var t=JSON.parse(JSON.stringify(e));return Object.assign(t,{pageIndex:1})}))},style:{width:"465px"}})))),d.a.createElement(r.a,{type:"primary",onClick:function(){K(!0)}},"添加订阅")),d.a.createElement(n.a,{rowKey:"urlConfId",dataSource:b,columns:X,pagination:{defaultCurrent:1,current:O.pageIndex,onChange:function(e,t){t==O.pageRows?S((function(a){var n=JSON.parse(JSON.stringify(a));return Object.assign(n,{pageIndex:e,pageRows:t})})):S((function(e){var a=JSON.parse(JSON.stringify(e));return Object.assign(a,{pageIndex:1,pageRows:t})}))},pageSize:O.pageRows,total:O.totalRows,showQuickJumper:!0,pageSizeOptions:[10],showTotal:function(){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,O.totalRows)," 条")}}})),U&&d.a.createElement(x,{isModalVisible:U,cancelModel:function(){K(!1)},colseMoadl:function(){Object(Y.a)({type:"success",description:"新增成功！"}),H(),K(!1)}}),w&&d.a.createElement(G,{visible:w,operate:N,actionObj:P,updateOkHandle:function(){return function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(1===N){var t=I.a.subscribeStart+"?urlConfId="+P.urlConfId;Object(I.c)(t,{},{loading:e}).then((function(e){A(!1),Object(Y.a)({type:"success",description:"操作成功！"}),H()}))}else{var a=I.a.subscribeClose+"?urlConfId="+P.urlConfId;Object(I.c)(a,{},{loading:e}).then((function(e){A(!1),Object(Y.a)({type:"success",description:"操作成功！"}),H()}))}}()},updateCancelHandle:function(){A(!1)}}),F&&d.a.createElement($,{rightVisible:F,onCloseRight:function(){D(!1)},id:P.urlConfId}),J&&d.a.createElement(Q,{editModelVis:J,colseMoadl:function(){Object(Y.a)({type:"success",description:"编辑成功！"}),H(),q(!1)},editData:B,cancelModel:function(){q(!1)},id:P.urlConfId}))}},qSPm:function(e,t,a){},rvOk:function(e,t,a){}}]);