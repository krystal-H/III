(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"11ds":function(e,t){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4QBMRXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAOKADAAQAAAABAAAAQAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/9sAhAAICAgICQgJCgoJDQ4MDg0TERAQERMcFBYUFhQcKxsfGxsfGysmLiUjJS4mRDUvLzVETkI+Qk5fVVVfd3F3nJzRAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wgARCABAADgDASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAAAAECAwQFBgf/2gAIAQEAAAAAtgAOLTFrimh6B5rCO6V7HZOcvWSMdiZa97NFJzOGumqFWsoAH//EABkBAAIDAQAAAAAAAAAAAAAAAAIEAQMFBv/aAAgBAhAAAADsgKas91hFO7TAZs//xAAZAQADAQEBAAAAAAAAAAAAAAACAwUEBgf/2gAIAQMQAAAA8bcAvvxcFq1g5hjQR//EAC8QAAEDAwEFBwMFAAAAAAAAAAECAwQABRESICFRU5EGEBMVIjFBI3GSFDBUYrH/2gAIAQEAAT8A/ZbhSnWvFaZU4nODo9RH3FCJKJ0iO6Tw0mn4r8fR4yCgqGQk++Pts224PW+Sl5vePZafhQqXfobNvRJaIUpwYQj5zT77sh1brqipajknYstiauUdx1by0FLhTgU92fabdWgPqwDwoWFvnq6UOz7X8hXSrlBTCdbQlZVqTnvsF4iW+K609r1KdKtwz8Cn73CW8tY14J4UL1D4OdKF7hcHOlXWY1LdbU1nATg5rHd2UabXBe1IB+sf8FSWWf1Dv00e/AUGWeUjoKDDPKR0FX1CEPs6Ugej474V2mwW1Nx1hKVKKjuzS7xPWsqLgyf6ivN53MH4ivOJ/NH4ipMp6SpKnVZIGBuxsYrGx//EACMRAAIBAgYCAwAAAAAAAAAAAAECAwARBBASEyIxIZFRU2H/2gAIAQIBAT8ArWnnkPFAhhcEEZSzJCmpzYXqYYSdkkLH12KjnhYhEOWPKCDmpIuOjStBpXg3XzWHMW8NKkHJ0RxZ1BH7WzF9a+qWONSCEAOX/8QAJREAAgEDAwQCAwAAAAAAAAAAAQIDAAQREhMhBRAxUSNBMkJx/9oACAEDAQE/AM1szYU7b4PjimVkYqwII+jWatLSa8l2oVy2M1ZN1aximgWNTnxk/iaubK8jVpph98nPvt0ATtfgQuqtoPLDNPHfbr/PHnUf1rqSXQtGMkqFcjgLjtDPLA+uKRkb2po3t2Tnfkz/AGnubiRdLyuR6J7f/9k="},"65m2":function(e,t,n){},"6MFL":function(e,t,n){},Fw8H:function(e,t){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4QBMRXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAOKADAAQAAAABAAAAQAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/9sAhAAICAgICQgJCgoJDQ4MDg0TERAQERMcFBYUFhQcKxsfGxsfGysmLiUjJS4mRDUvLzVETkI+Qk5fVVVfd3F3nJzRAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wgARCABAADgDASIAAhEBAxEB/8QAGgABAAIDAQAAAAAAAAAAAAAAAAEGAwQFAv/aAAgBAQAAAADbA9ASZb9WeF6Nm8Vjiy3s/KJs+apCdxpiRB//xAAZAQEAAwEBAAAAAAAAAAAAAAAAAgMFBAb/2gAIAQIQAAAA9kEMzWpq6kUn/8QAGwEAAQQDAAAAAAAAAAAAAAAAAAECBAYDBQf/2gAIAQMQAAAA44AzJZ6pIlaxHDD/xAAlEAACAgEDAgcBAAAAAAAAAAABAgMEEQAFEiAhEBMjMUFRYUD/2gAIAQEAAT8A/hhiaaaOJSAXYKM/uq2z0o4BE8KuflmHcnW+7dFSmiMK4jdT2znuOmvBZflLDGzeVhiR8arb7t0oHKXy2+mGt53QXpVSMYhjJ4/bfvjjVChLem4J2Ud2b60btmpDNRR04hyOa6xrGseGwUq8ySzSIHYNxAIyBrfKsdVI7Ff0nZijcO2QR1VLtim5aFsZ9wRkHVy9ZuOGmfOPYAYA68dP/8QAIREBAAECBgMBAAAAAAAAAAAAAQIDEQAEEBIUQSAiMlH/2gAIAQIBAT8A8ZtorcMZbk8j23W7vpWqlKDNMUpGYN78dH4msokhJAmIxjECIBr/AP/EACMRAAIBAwMEAwAAAAAAAAAAAAECAwAEEBESMQUTFCFBQlH/2gAIAQMBAT8A1rXGuIl3Oo2lhr7A/K6k3TPAHaMe/wBBNvOLS2e6nWJSAT8mrpDYN2VJEv2cHlTmOR43DoxVhwRUkjyOXdizHknP/9k="},JTrB:function(e,t,n){},NAHi:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return wr}));n("pNMO"),n("4Brf"),n("07d7"),n("0oug"),n("4mDm"),n("PKPk"),n("3bBZ"),n("+2oP"),n("sMBO"),n("pjDv");var r,a,o,i=n("q1tI"),c=n.n(i),l=(n("L/Qf"),n("2/Rp")),u=(n("yq1k"),n("6wSz")),s=n("ga3A"),A=n("q9hl"),d=n("8yf6"),f=new d.Subject,p=new d.Subject,m=(new d.Subject,new d.Subject),y=(n("kyDF"),c.a.memo((function(e){var t=e.dataAnalysisName,n=void 0===t?"未命名":t,r=e.analysisiType,a=e.testEnv,o=function(){f.next("save")};return c.a.createElement("header",{className:"data-analysis-header"},c.a.createElement("span",{className:"d-a-name"},n),c.a.createElement("div",{className:"tools-wrapper"},3===r?c.a.createElement(c.a.Fragment,null,c.a.createElement(l.a,{type:"primary",size:"small",onClick:function(){m.next("text")},icon:c.a.createElement(u.a,null)},"调试"),c.a.createElement(l.a,{type:"primary",size:"small",onClick:o,disabled:![0,1,3].includes(a),icon:c.a.createElement(s.a,null)},"保存"),c.a.createElement(l.a,{type:"primary",size:"small",onClick:function(){p.next("publish")},disabled:![1,3].includes(a),icon:c.a.createElement(A.a,null)},"发布")):c.a.createElement(c.a.Fragment,null,c.a.createElement(l.a,{type:"primary",size:"small",onClick:o,icon:c.a.createElement(s.a,null)},"保存"))))}))),b=(n("tkto"),n("5DmW"),n("FZtP"),n("27RR"),n("Z0cm")),v=n.n(b),g=n("JBE3"),E=n.n(g),h=(n("TeQF"),n("JTJg"),n("2B1R"),n("rB9j"),n("EnZy"),n("oVuX"),n("GRva"),n("gK9i")),O=(n("zKZe"),n("ma9I"),n("WpQE")),w=n.n(O),I=n("11ds"),j=n.n(I),C=n("Fw8H"),S=n.n(C),N=n("vPre"),D=n.n(N),B=n("Q1S+"),k=n.n(B),Q=n("qEOn"),T=n.n(Q);function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=2101,R=2201,M=2202,F=2301,L=2302,U=2401,V=(P(r={},x,"输入"),P(r,R,"数据过滤"),P(r,M,"聚合计算"),P(r,F,"异常检测"),P(r,L,"业务表关联"),P(r,U,"输出"),r),K=(P(a={},x,w.a),P(a,R,j.a),P(a,M,S.a),P(a,F,D.a),P(a,L,k.a),P(a,U,T.a),a),q=[x],J=[U],G=[{title:"输入",nodelists:[{nodeType:x,nodeName:V[x]}]},{title:"基础处理",nodelists:[{nodeType:R,nodeName:V[R]},{nodeType:M,nodeName:V[M]}]},{title:"高级处理",nodelists:[{nodeType:L,nodeName:V[L]}]},{title:"输出",nodelists:[{nodeType:U,nodeName:V[U]}]}],H=[{srcName:"设备名称",srcCode:"deviceId",srcType:"varchar",srcTableCode:""},{srcName:"时间",srcCode:"eventTime",srcType:"timestamp",srcTableCode:""}],z=(P(o={},x,{nodeName:"输入",productId:"",deviceList:[],deviceIds:[],propsOrEventList:[],propEvent:"0",props:[].concat(H),eventTimeField:"eventTime",propsCodes:[],anyContent:"",eventList:[],eventIdentifier:""}),P(o,R,{nodeName:"数据过滤",condition:"and",props:[],anyContent:""}),P(o,M,{nodeName:"聚合计算",props:[],granularity:0,dims:[],dimsCode:[],measure:[],measureCode:[],funcs:[],windowType:0,windowDurings:{windowDuring:"",windowUnit:"s"},slideDurings:{slideDuring:"",slideUnit:"s"},anyContent:""}),P(o,F,{nodeName:"异常检测",checkProp:"",anyContent:""}),P(o,L,{nodeName:"业务表关联",datasourceId:"",tableCode:"",tableList:[],filedList:[],props:[],joinType:0,relate:{streamFieldCode:"",dimFieldCode:""},streamTableCode:"",selectedRowKeys:[],anyContent:""}),P(o,U,{nodeName:"输出",datasourceId:"",tableCode:"",tableList:[],props:[],filedList:[],selectedRowKeys:[],anyContent:"",dataSource:[]}),o),Z=(n("TfFZ"),n("3S7+")),Y=n("P2RN"),W=["inWhere"];function X(e){return function(e){if(Array.isArray(e))return ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||$(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,t){if(e){if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function te(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function ne(e){var t=e.inWhere,n=void 0===t?"select":t,r=te(e,W);switch(n){case"painter":return c.a.createElement(ae,r);case"staticPainter":return c.a.createElement(oe,r);case"select":default:return c.a.createElement(re,r)}}function re(e){var t=e.nodeType,n=e.nodeName;return c.a.createElement("div",{className:"real-node in-select",draggable:!0,onDragStart:function(e){e.stopPropagation(),e.currentTarget.style.opacity=.5;var r=e.currentTarget,a=e.clientX,o=e.clientY,i={l:r.offsetLeft,t:r.offsetTop,x:a,y:o,w:r.offsetWidth,h:r.offsetHeight,nodeType:t,nodeName:n};e.dataTransfer.setData("text/plain",JSON.stringify(i))},onDragEnd:function(e){e.currentTarget.style.opacity=1}},c.a.createElement("img",{src:K[t],alt:"icon"}),c.a.createElement("span",{className:"node-name"},n))}function ae(e){var t=e.nodeType,n=e.id,r=e.location,a=e.pid,o=e.input,l=e.hasChildNode,u=e.focusNodeId,s=e.limitNodePostion,A=e.workStatu,d=e.recordStartPoint,f=e.addNewPath,p=e.changePathsByNodeId,m=e.changeNodeDataByIds,y=e.setFocusNode,b=e.clearMenu,v=_(Object(i.useState)(null),2),g=v[0],E=v[1],h=_(Object(i.useState)(null),2),O=h[0],w=h[1],I=Object(i.useRef)(null),j=function(){E((function(e){return null})),w(null)},C={left:"".concat(r[0],"px"),top:"".concat(r[1],"px")},S=n===u;return c.a.createElement(Z.a,{placement:"left",title:c.a.createElement("div",{style:{padding:"8px"}},c.a.createElement("div",null,"节点ID：".concat(n)),c.a.createElement("div",null,"节点类型：".concat(V[t])))},c.a.createElement("div",{id:n,className:"real-node in-painter ".concat(a?"linked":""," ").concat(S?"focus":""),style:C,ref:I,onClick:function(e){e.stopPropagation(),y(n),b()},onMouseDown:function(e){e.preventDefault();var t=e.clientX,n=e.clientY;E("mouseDown"),w([t,n].concat(X(r)))},onMouseUp:function(e){if("mouseDownStartPoint"===A&&"mouseenter"===g){if(a)return void Object(Y.a)({description:"节点不可以有多个输入"});if(q.includes(t))return void Object(Y.a)({description:"输入节点不能被链接"});e.stopPropagation();var r=e.currentTarget.getBoundingClientRect(),o=r.left,i=r.top,c=r.width;f({endPoint:[o+c/2,i],endNodeId:n})}else j()},onMouseLeave:j,onMouseEnter:function(){"mouseDownStartPoint"===A&&E((function(e){return"mouseenter"}))},onMouseMove:function(e){if(["mouseDown","moving"].includes(g)){"mouseDown"===g&&E("moving");var t=e.clientX,r=e.clientY,o=e.currentTarget.getBoundingClientRect(),i=o.width,c=o.height,u=o.top,A=o.left,d=_(O,4),f=d[0],y=d[1],b=t-f+d[2],v=r-y+d[3];(l||a)&&p(n,{width:i,height:c,top:u,left:A}),m([n],[{location:[s(b,i,"left"),s(v,c,"top")]}])}},onContextMenu:function(e){e.preventDefault()}},c.a.createElement("img",{src:K[t],alt:"icon"}),c.a.createElement("span",{className:"node-name"},o.nodeName),!J.includes(t)&&c.a.createElement("div",{className:"link-blocks-wrapper bottom",onMouseDown:function(e){e.stopPropagation();var t=e.target.getBoundingClientRect(),r=t.left,a=t.top,o=t.width,i=t.height;d({startPoint:[r+o/2,a+i/2],startNodeId:n})}},c.a.createElement("div",{className:"link-block"})),!q.includes(t)&&c.a.createElement("div",{className:"link-blocks-wrapper top"},c.a.createElement("div",{className:"link-block"}))))}function oe(e){var t=e.nodeType,n=e.id,r=e.location,a=e.pid,o=e.input,i={left:"".concat(r[0],"px"),top:"".concat(r[1],"px")};return c.a.createElement(Z.a,{placement:"left",title:c.a.createElement("div",{style:{padding:"8px"}},c.a.createElement("div",null,"节点ID：".concat(n)),c.a.createElement("div",null,"节点类型：".concat(V[t])))},c.a.createElement("div",{id:n,className:"real-node in-painter ".concat(a?"linked":""),style:i},c.a.createElement("img",{src:K[t],alt:"icon"}),c.a.createElement("span",{className:"node-name"},o.nodeName),!J.includes(t)&&c.a.createElement("div",{className:"link-blocks-wrapper bottom"},c.a.createElement("div",{className:"link-block"})),!q.includes(t)&&c.a.createElement("div",{className:"link-blocks-wrapper top"},c.a.createElement("div",{className:"link-block"}))))}function ie(){return(ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var ce=h.a.Panel,le=c.a.memo((function(){return c.a.createElement("section",{className:"nodes-select-wrapper"},c.a.createElement(h.a,{defaultActiveKey:["1","2","3","4"]},G.map((function(e,t){var n=e.title,r=e.nodelists;return c.a.createElement(ce,{header:n,key:t+1},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return c.a.createElement("div",{className:"node-panel"},e.map((function(e,t){return c.a.createElement(ne,ie({key:e.nodeType+t},e))})))}(r))}))))}));var ue=n("BkRI"),se=n.n(ue);function Ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return de(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return de(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fe(e){var t=e.pathsConfigs,n=void 0===t?[]:t,r=Object(i.useRef)(null);return c.a.createElement("section",{className:"svg-wrapper"},c.a.createElement("svg",{ref:r},n.map((function(e,t){if(!e)return null;var n=e.startPoint,r=e.endPoint,a=e.startNodeId,o=e.endNodeId,i=function(e,t){var n,r,a=Ae(e,2),o=a[0],i=a[1],c=Ae(t,2),l=c[0],u=c[1],s=(o+l)/2,A=(i+u)/2;u>=i?(r=i+.9*(A-i),n=o):(r=i+1.6*(i-u),n=o);return"M ".concat(o," ").concat(i," Q ").concat(n," ").concat(r," ").concat(s," ").concat(A," T ").concat(l," ").concat(u)}(n,r),l="".concat(a,"-").concat(o);return c.a.createElement("g",{key:l,id:l},c.a.createElement("path",{className:"path-link",d:i,stroke:"rgba(255,0,0,.0)",strokeWidth:"20",fill:"none"}),c.a.createElement("path",{className:"path-link",d:i,stroke:"rgba(153,153,153,.5)",strokeWidth:"1",fill:"none"}))}))))}function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function me(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ee(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){ve(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||Ee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(e,t){if(e){if("string"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oe(e){var t=e.setNodes,n=e.nodes,r=e.nodeIdCount,a=e.setNodeIdCount,o=e.focusNodeId,l=e.setFocusNodeId,u=e.changeNodeDataByIds,s=e.hasInputNode,A=e.pathsConfigs,d=e.setPathsConfigs,f=ge(Object(i.useState)("default"),2),p=f[0],m=f[1],y=ge(Object(i.useState)({}),2),b=y[0],v=y[1],g=ge(Object(i.useState)({showMenu:!1,menuLeft:0,menuTop:0}),2),E=g[0],h=g[1],O=Object(i.useRef)(null),w=E.showMenu,I=E.menuLeft,j=E.menuTop,C=E.selectNodeIdToDelete,S=E.selectLinkLineToDelete,N=function(){return O&&O.current.getBoundingClientRect()||{}},D=function(e,t,n){var r=N(),a=r.width,o=r.height,i="left"===n?a:o;return e+t>i-2&&(e=i-t-2),e>2?e:2},B=function(e){l(e)},k=function(){h({showMenu:!1,menuLeft:0,menuTop:0,selectNodeIdToDelete:null,selectLinkLineToDelete:null})},Q=function(e){"mouseDownStartPoint"===p&&(m("default"),v({}))},T=function(e){var t=N(),n=t.left,r=t.top,a=e.startPoint,o=be({},e);o.startPoint=[a[0]-n,a[1]-r],v(be(be({},b),o)),m("mouseDownStartPoint")},P=function(e){var t=e||{},n=t.endPoint,r=t.endNodeId,a=b.startNodeId;if(r&&r!==a){var o=N(),i=o.left,c=o.top,l=be({},e);l.endPoint=[n[0]-i,n[1]-c],d([].concat(me(A),[be(be({},b),l)])),u([r,a],[{pid:a},{hasChildNode:!0}])}else Object(Y.a)({message:"节点连接错误"});m("default"),v({})},R=function(e,t){var n=t.left,r=t.top,a=t.width,o=t.height,i=N(),c=me(A).map((function(t){var c=t.startNodeId,l=t.endNodeId;return e===c?be(be({},t),{},{startPoint:[n+a/2-i.left,r+o-i.top]}):e===l?be(be({},t),{},{endPoint:[n+a/2-i.left,r-i.top]}):t}));d(c)},M=me(A);return Object.keys(b).length>2&&(M=[].concat(me(M),[b])),c.a.createElement("section",{className:"painter-wrapper",ref:O,onDrop:function(e){e.stopPropagation(),e.preventDefault();var o=e.currentTarget,i=e.clientX,c=e.clientY,u=o.offsetLeft,A=o.offsetTop,d=JSON.parse(e.dataTransfer.getData("text/plain")||""),f=d.x,p=d.y,m=d.l,y=d.t,b=d.nodeType,v=d.nodeName,g=d.w,E=d.h,h=r+1;if(b===x&&s())Object(Y.a)({message:"已存在输入节点"});else{var O={nodeType:b,location:[D(m+i-f-u,g,"left"),D(y+c-p-A,E,"top")],id:h,nodeName:v,pid:null,hasChildNode:!1,input:be(be({},se()(z[b])),{},{nodeId:h})};t([].concat(me(n),[O])),a(h),l(h)}},onDragOver:function(e){e.preventDefault()},onMouseMove:function(e){if(e.preventDefault(),"mouseDownStartPoint"===p){var t=e.clientX,n=e.clientY,r=N(),a=r.left,o=r.top;v(be(be({},b),{},{endPoint:[t-a,n-o],endNodeId:null}))}},onMouseLeave:Q,onMouseUp:Q,onContextMenu:function(e){e.preventDefault();var t=e.clientX,n=e.clientY,r=e.target;if(r.classList.contains("real-node")||r.parentNode.classList.contains("real-node")){var a=N(),o=a.left,i=a.top;h({showMenu:!0,menuLeft:t-o,menuTop:n-i,selectNodeIdToDelete:+r.id||+r.parentNode.id})}else if(r.classList.contains("path-link")){var c=r.parentNode.id,l=N(),u=l.left,s=l.top;h({showMenu:!0,menuLeft:t-u,menuTop:n-s,selectLinkLineToDelete:c})}else k()},onClick:function(e){B(null),w&&k(),o&&B(null)}},n.map((function(e){var t=e.id;return c.a.createElement(ne,pe({key:t,focusNodeId:o,inWhere:"painter",workStatu:p,recordStartPoint:T,addNewPath:P,changePathsByNodeId:R,limitNodePostion:D,changeNodeDataByIds:u,setFocusNode:B,clearMenu:k},e))})),c.a.createElement(fe,{pathsConfigs:M}),w&&c.a.createElement("section",{style:{left:I,top:j},className:"painter-menu-wrapper"},c.a.createElement("span",{className:"menu-item",onClick:function(e){if(e.stopPropagation(),C){var r=n.filter((function(e){return e.id!==C})),a=A.filter((function(e){return![e.startNodeId,e.endNodeId].includes(C)}));r=r.map((function(e){return e.pid===C?be(be({},e),{},{pid:null}):e})),t(r),d(a)}if(S){var o=ge(S.split("-").map((function(e){return+e})),2),i=o[0],c=o[1],l=me(n).map((function(e){var t=e.id;return e.pid===i&&c===t?be(be({},e),{},{pid:null}):e})),u=me(A).filter((function(e){var t=e.startNodeId,n=e.endNodeId;return!(t===i&&n===c)}));t(l),d(u)}h({showMenu:!1,selectNodeIdToDelete:null})}},"删除")))}function we(){return(we=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ie(e){var t=e.nodes,n=e.pathsConfigs,r=Object(i.useRef)(null),a=function(e,t,n){var a=r?r.current.getBoundingClientRect():{},o=a.width,i=a.height,c="left"===n?o:i;return e+t>c-2&&(e=c-t-2),e>2?e:2};return c.a.createElement("section",{className:"painter-wrapper"},t.map((function(e){var t=e.id;return c.a.createElement(ne,we({key:t,inWhere:"staticPainter",limitNodePostion:a},e))})),c.a.createElement(fe,{pathsConfigs:n}))}n("B6y2");var je=n("WsrF"),Ce=(n("XlDN"),n("mbEz"),n("wCAj")),Se=(n("K4yd"),n("9yH6")),Ne=(n("8QGh"),n("2fM7")),De=(n("5s+n"),n("NBAS"),n("SuFq"),n("QCje"),n("fyUT")),Be=(n("1vPl"),n("5rEg"));function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){Pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ue(e);if(t){var a=Ue(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Le(this,n)}}function Le(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ve=Ne.a.Option,Ke=[{title:"属性名称",dataIndex:"srcName",key:"srcName"},{title:"数据类型",dataIndex:"srcType",key:"srcType",width:"100px"}],qe=function(e,t){return c.a.createElement(je.a.Item,{label:"节点名称"},e("nodeName",{rules:[{required:!0,message:"请输入节点名称！"}],initialValue:t})(c.a.createElement(Be.a,{placeholder:"请输入节点名称！"})))},Je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(o,e);var t,n,r,a=Fe(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a.call.apply(a,[this].concat(n))).handletChange=function(t,n){e.triggerChange(Pe({},t,n))},e.triggerChange=function(t){var n=e.props,r=n.onChange,a=n.value;r&&r(Te(Te({},a),t))},e}return t=o,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.value,r=t.inputString,a=t.selectString,o=t.optionsConfig,i=void 0===o?[]:o;return c.a.createElement("span",null,c.a.createElement(De.a,{value:n[r],onChange:function(t){return e.handletChange(r,t)},style:{width:"65%",marginRight:"3%"}}),c.a.createElement(Ne.a,{value:n[a],style:{width:"32%"},onChange:function(t){return e.handletChange(a,t)}},i.map((function(e){var t=e.label,n=e.value;return c.a.createElement(Ve,{key:n,value:n},t)}))))}}])&&Re(t.prototype,n),r&&Re(t,r),o}(c.a.Component);function Ge(e){return function(e){if(Array.isArray(e))return Ze(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ze(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||ze(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(e,t){if(e){if("string"==typeof e)return Ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(e,t):void 0}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ye=Ne.a.Option;function We(e){return function(e){if(Array.isArray(e))return Xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xe(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _e=Ne.a.Option,$e=["=","!=",">=","<=",">","<"],et=(n("MKzF"),n("kaz8"));function tt(e){return function(e){if(Array.isArray(e))return nt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(n),!0).forEach((function(t){ot(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var it=[{label:"最大值",value:"max"},{label:"最小值",value:"min"},{label:"平均值",value:"sum"},{label:"求和",value:"avg"}];function ct(e){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(n),!0).forEach((function(t){st(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function At(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=yt(e);if(t){var a=yt(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return mt(this,n)}}function mt(e,t){return!t||"object"!==ct(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yt(e){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var bt=Ne.a.Option,vt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(o,e);var t,n,r,a=pt(o);function o(){var e;At(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a.call.apply(a,[this].concat(n))).handleNumberChange=function(t){var n=parseInt(t.target.value||0,10);isNaN(n)||e.triggerChange({number:n})},e.handleCurrencyChange=function(t){e.triggerChange({currency:t})},e.triggerChange=function(t){var n=e.props,r=n.onChange,a=n.value;r&&r(ut(ut({},a),t))},e}return t=o,(n=[{key:"render",value:function(){var e=this.props,t=e.checked,n=e.value;return c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,c.a.createElement(et.a,{checked:t,style:{margin:"0 2%"}}),c.a.createElement("span",null,"连续"),c.a.createElement(De.a,{value:n.number,style:{width:"20%",margin:"0 2%"}}),c.a.createElement("span",null,"个点小于阈值"),c.a.createElement(De.a,{value:n.number,style:{width:"20%",margin:"0 2%"}})),c.a.createElement("p",null,c.a.createElement(et.a,{checked:t,style:{margin:"0 2%"}}),c.a.createElement("span",null,"连续"),c.a.createElement(De.a,{value:n.number,style:{width:"20%",margin:"0 2%"}}),c.a.createElement("span",null,"个点超出阈值"),c.a.createElement(De.a,{value:n.number,style:{width:"20%",margin:"0 2%"}})))}}])&&dt(t.prototype,n),r&&dt(t,r),o}(c.a.Component);function gt(e){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(n),!0).forEach((function(t){Ot(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function It(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Nt(e);if(t){var a=Nt(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return St(this,n)}}function St(e,t){return!t||"object"!==gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dt(e){return function(e){if(Array.isArray(e))return Bt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var kt=Ne.a.Option,Qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(o,e);var t,n,r,a=Ct(o);function o(){var e;wt(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a.call.apply(a,[this].concat(n))).handletChange=function(t,n){if("streamFieldCode"===t){var r=e.props,a=r.streamOptions;(0,r.changeNodeDataByIds)([r.id],[{input:{streamTableCode:a.map((function(e){return e.srcCode===n}))[0].srcTableCode||""}}])}e.triggerChange(Ot({},t,n))},e.triggerChange=function(t){var n=e.props,r=n.onChange,a=n.value;r&&r(ht(ht({},a),t))},e}return t=o,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.value,r=t.streamOptions,a=t.dimOptions;return c.a.createElement("span",null,c.a.createElement("span",null,"流"),c.a.createElement(Ne.a,{value:n.streamFieldCode,onChange:function(t){return e.handletChange("streamFieldCode",t)},style:{width:"30%",margin:"0 2%"}},r.map((function(e){var t=e.srcName,n=e.srcCode;return c.a.createElement(kt,{key:n,value:n},t)}))),c.a.createElement("span",null," = 维表"),c.a.createElement(Ne.a,{value:n.dimFieldCode,onChange:function(t){return e.handletChange("dimFieldCode",t)},style:{width:"30%",margin:"0 2%"}},a.map((function(e){var t=e.srcName,n=e.srcCode;return c.a.createElement(kt,{key:n,value:n},t)}))))}}])&&It(t.prototype,n),r&&It(t,r),o}(c.a.Component);function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){xt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rt(e){return function(e){if(Array.isArray(e))return Mt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ft=Ne.a.Option;function Lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ut(e){var t=Object.assign({},e);switch(t.nodeType){case x:return c.a.createElement(Kt,t);case R:return c.a.createElement(qt,t);case M:return c.a.createElement(Jt,t);case F:return c.a.createElement(Gt,t);case L:return c.a.createElement(Ht,t);case U:return c.a.createElement(zt,t);default:return c.a.createElement("span",null,"未识别节点")}}var Vt=function(e,t){return je.a.create({name:e,onFieldsChange:function(e,t,n){var r=e.changeNodeDataByIds,a=e.id,o=(e.input,Object.values(t)[0]),i=o.name,c=o.value;o.errors,o.dirty;r([a],[{input:Lt({},i,c)}])}})(t)},Kt=Vt("form_for_dataInput",(function(e){var t=e.form,n=e.id,r=e.input,a=void 0===r?{}:r,o=e.productList,l=e.getDeviceList,u=e.getPropOrEventList,s=e.getDownEventList,A=e.changeNodeDataByIds,d=t.getFieldDecorator,f=t.setFieldsValue,p=a.nodeName,m=a.productId,y=a.deviceIds,b=void 0===y?[]:y,v=a.propEvent,g=a.propsCodes,E=void 0===g?[]:g,h=a.props,O=void 0===h?[]:h,w=(a.eventTimeField,a.deviceList),I=a.propsOrEventList,j=a.eventList,C=a.eventIdentifier;Object(i.useMemo)((function(){return I.filter((function(e){return E.includes(e.srcCode)}))}),[I,E]);return c.a.createElement(je.a,null,qe(d,p),c.a.createElement(je.a.Item,{label:"选择产品"},d("productId",{rules:[{required:!0,message:"请选择产品！"}],initialValue:m})(c.a.createElement(Ne.a,{onChange:function(e){Promise.all([l(e),u(e,v)]).then((function(e){var t=He(e,2),r=t[0],a=t[1];A([n],[{input:{deviceList:r,deviceIds:[],propsOrEventList:a,propsCodes:[],props:Ge(H)}}]),f({deviceIds:[],propsCodes:[]})}))}},o.map((function(e){var t=e.productId,n=e.productName;return c.a.createElement(Ye,{key:t,value:t},n)}))))),c.a.createElement(je.a.Item,{label:"选择设备"},d("deviceIds",{rules:[{required:!0,message:"请选择设备！"}],initialValue:b})(c.a.createElement(Ne.a,{mode:"multiple"},w.map((function(e){var t=e.deviceId;return c.a.createElement(Ye,{key:t,value:t},t)}))))),c.a.createElement(je.a.Item,{label:"输入参数"},d("propEvent",{rules:[{required:!0,message:"请选择输入参数！"}],initialValue:v})(c.a.createElement(Se.a.Group,{onChange:function(e){var t;0==(t=e.target.value)?u(m,t).then((function(e){A([n],[{input:{propsOrEventList:e,propsCodes:[],props:Ge(H)}}]),f({propsCodes:[]})})):s(m).then((function(e){A([n],[{input:{eventList:e,propsCodes:[],eventIdentifier:"",props:Ge(H)}}]),f({propsCodes:[],eventIdentifier:""})}))}},c.a.createElement(Se.a,{value:"0"},"属性"),c.a.createElement(Se.a,{value:"1"},"事件")))),1==v&&c.a.createElement(je.a.Item,null,d("eventIdentifier",{rules:[{required:!0,message:"请选择事件！"}],initialValue:C})(c.a.createElement(Ne.a,{onChange:function(e){u(m,1,e).then((function(e){A([n],[{input:{propsOrEventList:e,propsCodes:[],props:Ge(H)}}]),f({propsCodes:[]})}))},placeholder:"请选择事件！"},j.map((function(e){var t=e.identifier,n=e.name;return c.a.createElement(Ye,{key:t,value:t},n)}))))),c.a.createElement(je.a.Item,null,d("propsCodes",{rules:[{required:!0,message:"请选择".concat("0"===v?"属性":"事件","字段！")}],initialValue:E})(c.a.createElement(Ne.a,{mode:"multiple",onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=I.filter((function(t){return e.includes(t.srcCode)}));A([n],[{input:{props:[].concat(Ge(t),Ge(H))}}])}},I.map((function(e){var t=e.srcName,n=e.srcCode;e.srcType;return c.a.createElement(Ye,{key:n,value:n},"".concat(t,"( ").concat(n," )"))}))))),c.a.createElement(je.a.Item,null,c.a.createElement(Ce.a,{rowKey:"srcCode",columns:Ke,dataSource:O,pagination:!1})))})),qt=Vt("form_for_dataFilter",(function(e){var t=e.form,n=e.id,r=e.input,a=e.pProps,o=void 0===a?[]:a,i=e.changeNodeDataByIds,u=t.getFieldDecorator,s=r.nodeName,A=r.props,d=void 0===A?[]:A,f=r.condition,p=function(e,t,r){if("value"!==e||/^\d*$/.test(t)){var a=We(d);if(a[r][e]=t,"code"===e){var c=o.filter((function(e){return e.srcCode===t})),l="",u="";c.length>0&&(l=c[0].srcName||"",u=c[0].srcTableCode||""),a[r].name=l,a[r].tableCode=u}i([n],[{input:{props:a}}])}},m=[{title:"属性名称",dataIndex:"name",key:"name",width:"90px",render:function(e,t,n){return c.a.createElement(Ne.a,{value:t.code,onChange:function(e){return p("code",e,n)}},o.map((function(e){var t=e.srcName,n=e.srcCode;return c.a.createElement(_e,{key:n,value:n},t)})))}},{title:"判断",dataIndex:"judge",key:"judge",width:"90px",render:function(e,t,n){return c.a.createElement(Ne.a,{value:t.judge,onChange:function(e){return p("judge",e,n)}},$e.map((function(e){return c.a.createElement(_e,{key:e,value:e},e)})))}},{title:"数值",dataIndex:"value",key:"value",width:"50px",render:function(e,t,n){return c.a.createElement(Be.a,{value:t.value,onChange:function(e){return p("value",e.target.value,n)}})}},{title:"操作",dataIndex:"action",key:"action",width:"40px",render:function(e,t,r){return c.a.createElement("a",{onClick:function(){return e=r,t=We(d).filter((function(t,n){return n!==e})),void i([n],[{input:{props:t}}]);var e,t}},"删除")}}];return c.a.createElement(je.a,null,qe(u,s),c.a.createElement(je.a.Item,{label:"关系与条件"},u("condition",{rules:[{required:!0,message:"请选择关系！"}],initialValue:f})(c.a.createElement(Se.a.Group,null,c.a.createElement(Se.a,{value:"and"},"同时满足以下条件(and)"),c.a.createElement(Se.a,{value:"or"},"满足以下某一个条件(or)")))),c.a.createElement(je.a.Item,null,c.a.createElement("div",{className:"add-new-condition"},c.a.createElement(l.a,{type:"default",onClick:function(){i([n],[{input:{props:[].concat(We(d),[{}])}}])},size:"small"},"新增条件")),c.a.createElement(Ce.a,{rowKey:"code",columns:m,dataSource:d,pagination:!1})))})),Jt=Vt("form_for_datacacl",(function(e){var t=e.form,n=e.input,r=e.id,a=e.pProps,o=void 0===a?[]:a,l=e.changeNodeDataByIds,u=t.getFieldDecorator,s=n.nodeName,A=n.props,d=n.granularity,f=n.dimsCode,p=n.measureCode,m=n.funcs,y=n.windowType,b=n.windowDurings,v=n.slideDurings,g=Object(i.useMemo)((function(){var e=[],t=[];return o.forEach((function(n){e.push(at({},n)),t.push(at({},n))})),[e.map((function(e){var t=e.srcCode;return{label:e.srcName,value:t}})),t.map((function(e){var t=e.srcCode;return{label:e.srcName,value:t}}))]}),[o]),E=function(e){return function(t,n,r){if(n[e]>0)return r();r("请输入大于0的数字")}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,r=o.filter((function(t){return e.includes(t.srcCode)}));return t=o.filter((function(e){return t.includes(e.srcCode)})),n=it.filter((function(e){return n.includes(e.value)})),t.forEach((function(e){var t=e.srcCode,a=e.srcName,o=e.srcType,i=e.srcTableCode,c=void 0===i?"":i;n.forEach((function(e){var n=e.label,i=e.value;r.push({srcName:"".concat(a,"_").concat(n),srcCode:"".concat(i,"_").concat(t),srcType:o,srcTableCode:c})}))})),r},O=function(e,t){var n=[],a=null,i=null;"dimsCode"===t&&(n=h(e),a=o.filter((function(t){return e.includes(t.srcCode)})).map((function(e){var t=e.srcCode,n=e.srcName,r=e.srcTableCode;return{srcCode:t,srcName:n,srcTableCode:void 0===r?"":r}}))),"measureCode"===t&&(n=h(void 0,e),i=o.filter((function(t){return e.includes(t.srcCode)})).map((function(e){var t=e.srcCode,n=e.srcName,r=e.srcTableCode;return{srcCode:t,srcName:n,srcTableCode:void 0===r?"":r}}))),"funcs"===t&&(n=h(void 0,void 0,e));var c={props:tt(n)};a&&(c.dims=a),i&&(c.measure=i),l([r],[{input:c}])};return c.a.createElement(je.a,null,qe(u,s),c.a.createElement(je.a.Item,{label:"统计粒度"},u("granularity",{rules:[{required:!0,message:"请选择统计粒度"}],initialValue:d})(c.a.createElement(Se.a.Group,null,c.a.createElement(Se.a,{value:0},"单个设备"),c.a.createElement(Se.a,{value:1},"所有设备")))),c.a.createElement(je.a.Item,{label:"统计维度(非数值类型)"},u("dimsCode",{rules:[{required:!0,message:"请选择统计粒度"}],initialValue:f})(c.a.createElement(et.a.Group,{onChange:function(e){return O(e,"dimsCode")},options:g[1]}))),c.a.createElement(je.a.Item,{label:"计算度量(数值类型)"},u("measureCode",{rules:[{required:!0,message:"请选择计算度量"}],initialValue:p})(c.a.createElement(et.a.Group,{onChange:function(e){return O(e,"measureCode")},options:g[0]}))),c.a.createElement(je.a.Item,{label:"统计函数"},u("funcs",{rules:[{required:!0,message:"请选择统计函数"}],initialValue:m})(c.a.createElement(et.a.Group,{onChange:function(e){return O(e,"funcs")},options:it}))),c.a.createElement(je.a.Item,{label:"时间窗口类型"},u("windowType",{rules:[{required:!0,message:"请选择统计粒度"}],initialValue:y})(c.a.createElement(Se.a.Group,null,c.a.createElement(Se.a,{value:0},"滑动窗口"),c.a.createElement(Se.a,{value:1},"滚动窗口")))),c.a.createElement(je.a.Item,{label:"窗口时长"},u("windowDurings",{initialValue:b,rules:[{validator:E("windowDuring")}]})(c.a.createElement(Je,{inputString:"windowDuring",selectString:"windowUnit",optionsConfig:[{label:"秒",value:"s"},{label:"分",value:"m"},{label:"时",value:"h"}]}))),0===y&&c.a.createElement(je.a.Item,{label:"滑动时长"},u("slideDurings",{initialValue:v,rules:[{validator:E("slideDuring")}]})(c.a.createElement(Je,{inputString:"slideDuring",selectString:"slideUnit",optionsConfig:[{label:"秒",value:"s"},{label:"分",value:"m"},{label:"时",value:"h"}]}))),c.a.createElement(je.a.Item,{label:"输出数据"},c.a.createElement(Ce.a,{columns:Ke,rowKey:"srcCode",dataSource:A,pagination:!1})))})),Gt=Vt("form_for_errorcheck",(function(e){var t=e.form,n=(e.id,e.productList,e.changeNodeDataByIds,e.input),r=t.getFieldDecorator,a=n.nodeName,o=(n.productId,n.deviceIds,n.propEvent,n.propsCodes,n.props),i=void 0===o?[]:o;n.eventTimeField;return c.a.createElement(je.a,null,qe(r,a),c.a.createElement(je.a.Item,{label:"节点名称"},r("nodeName",{rules:[{required:!0,message:"请输入节点名称！"}]})(c.a.createElement(Be.a,{placeholder:"请输入节点名称！"}))),c.a.createElement(je.a.Item,{label:"检测属性"},r("eventTimeField",{rules:[{required:!0,message:"请选择检测属性！"}],initialValue:""})(c.a.createElement(Ne.a,null,c.a.createElement(bt,{value:""},"请选择")))),c.a.createElement(je.a.Item,{label:"检测规则"},r("condition",{initialValue:{number:60,currency:"s"},rules:[{validator:function(e,t,n){if(t.number>0)return n();n("Price must greater than zero!")}}]})(c.a.createElement(vt,null))),c.a.createElement(je.a.Item,null,c.a.createElement(Ce.a,{columns:Ke,dataSource:i,pagination:!1})))})),Ht=Vt("form_for_datarelated",(function(e){var t=e.form,n=e.id,r=e.input,a=void 0===r?{}:r,o=e.pProps,i=void 0===o?[]:o,l=e.changeNodeDataByIds,u=e.dataSourceList,s=e.getTableByDatasource,A=e.getFieldsByDatasourceTable,d=t.getFieldDecorator,f=a.nodeName,p=a.datasourceId,m=a.tableCode,y=a.relate,b=a.joinType,v=a.selectedRowKeys,g=a.tableList,E=a.filedList,h=[].concat(Dt(i),Dt(E)),O={onChange:function(e,t){l([n],[{input:{selectedRowKeys:e,props:h.filter((function(t){return e.includes(t.srcCode)}))}}])},selectedRowKeys:v};return c.a.createElement(je.a,null,qe(d,f),c.a.createElement(je.a.Item,{label:"选择数据源"},d("datasourceId",{rules:[{required:!0,message:"请选择数据源！"}],initialValue:p})(c.a.createElement(Ne.a,{onChange:function(e){s(e).then((function(e){l([n],[{input:{tableList:e,tableCode:"",filedList:[],relate:{dimFieldCode:""}}}])}))}},u.map((function(e){var t=e.name,n=e.id;return c.a.createElement(kt,{key:n,value:n},t)}))))),c.a.createElement(je.a.Item,{label:"指定维表"},d("tableCode",{rules:[{required:!0,message:"请选择维表！"}],initialValue:m})(c.a.createElement(Ne.a,{onChange:function(e){A(e,p).then((function(e){l([n],[{input:{filedList:e,relate:{dimFieldCode:""}}}])}))}},g.map((function(e){var t=e.code;return c.a.createElement(kt,{key:t,value:t},t)}))))),c.a.createElement(je.a.Item,{label:"设置连接"},d("joinType",{rules:[{required:!0,message:"请设置连接方式！"}],initialValue:b})(c.a.createElement(Se.a.Group,null,c.a.createElement(Se.a,{value:0},"内连接"),c.a.createElement(Se.a,{value:1},"外连接")))),c.a.createElement(je.a.Item,{label:"连接条件(类型必须匹配, 且维表字段为主键)"},d("relate",{initialValue:y,rules:[{validator:function(e,t,n){if(t.streamFieldCode&&t.dimFieldCode)return n();n("请选择关联字段")}}]})(c.a.createElement(Qt,{streamOptions:i,changeNodeDataByIds:l,id:n,dimOptions:E}))),c.a.createElement(je.a.Item,{label:"输出字段"},c.a.createElement(Ce.a,{rowKey:"srcCode",rowSelection:O,columns:Ke,dataSource:h,pagination:!1})))})),zt=Vt("form_for_dataoutput",(function(e){var t=e.form,n=e.id,r=e.input,a=void 0===r?{}:r,o=e.pProps,l=void 0===o?[]:o,u=e.changeNodeDataByIds,s=e.dataSourceList,A=e.getTableByDatasource,d=e.getFieldsByDatasourceTable;console.log("--------pProps---",l);var f=t.getFieldDecorator,p=(a.nodeName,a.datasourceId),m=a.tableCode,y=a.selectedRowKeys,b=a.dataSource,v=a.tableList,g=a.filedList,E=[{title:"输出节点",dataIndex:"srcName",key:"srcName",width:"100px"},{title:"数据库字段",dataIndex:"destName",key:"destName",width:"100px",render:function(e,t,r){t.srcType;var a=t.destCode,o=t.srcCode,i=Rt(g),l=!y.includes(o);return c.a.createElement(Ne.a,{value:a||"",onChange:function(e){return function(e,t,r){var a=r.filter((function(t){return t.srcCode===e}))[0],o=a.srcCode,i=a.srcName,c=a.srcType,l=a.srcTableCode,s=Rt(b);s[t]=Pt(Pt({},s[t]),{destName:i,destCode:o,destType:c,destTableCode:l}),u([n],[{input:{dataSource:s}}])}(e,r,i)},style:{width:"90px"},disabled:l},i.map((function(e){var t=e.srcCode,n=e.srcName;return c.a.createElement(Ft,{key:t,value:t},n)})))}},{title:"字段类型",dataIndex:"srcType",key:"srcType",width:"100px"}];Object(i.useEffect)((function(){console.log("---useEffect---",l);var e=b.map((function(e){return e.srcCode})),t=l.map((function(e){return e.srcCode})),r=Rt(b);l.forEach((function(t){e.includes(t.srcCode)||r.push(Pt(Pt({},t),{destName:"",destCode:"",destType:"",destTableCode:""}))})),r=r.filter((function(e){return t.includes(e.srcCode)})),console.log("---useEffect-_data--",r),u([n],[{input:{dataSource:r}}])}),[]);var h={onChange:function(e,t){u([n],[{input:{selectedRowKeys:e}}])},selectedRowKeys:y};return c.a.createElement(je.a,null,c.a.createElement(je.a.Item,{label:"数据库"},f("datasourceId",{rules:[{required:!0,message:"请选择数据库！"}],initialValue:p})(c.a.createElement(Ne.a,{onChange:function(e){A(e).then((function(e){u([n],[{input:{tableList:e,filedList:[]}}])}))}},s.map((function(e){var t=e.name,n=e.id;return c.a.createElement(Ft,{key:n,value:n},t)}))))),c.a.createElement(je.a.Item,{label:"数据表"},f("tableCode",{rules:[{required:!0,message:"请选择数据表！"}],initialValue:m})(c.a.createElement(Ne.a,{onChange:function(e){d(e,p).then((function(e){u([n],[{input:{filedList:e}}])}))}},v.map((function(e){var t=e.code;return c.a.createElement(Ft,{key:t,value:t},t)}))))),c.a.createElement(je.a.Item,{label:"输出映射(数据类型要和数据库匹配)"},c.a.createElement(Ce.a,{rowKey:"srcCode",rowSelection:h,columns:E,dataSource:b,pagination:!1})))})),Zt=["service","selectedNode"];function Yt(){return(Yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Wt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Xt=c.a.memo((function(e){var t=e.service,n=void 0===t?{}:t,r=e.selectedNode,a=Wt(e,Zt),o=r.id,i=r.nodeType,l=n.desc;return c.a.createElement("section",{className:"config-edit-wrapper"},c.a.createElement("div",{className:"title"},i?V[i]:"服务详情"),o?c.a.createElement("div",{className:"form-wrapper"},c.a.createElement(Ut,Yt({},r,a))):c.a.createElement("ul",{className:"service-wrapper"},c.a.createElement("li",null,c.a.createElement("span",{className:"label"},"服务类型:")," ",c.a.createElement("span",{className:"content"},"数据分析服务")),c.a.createElement("li",null,c.a.createElement("span",{className:"label"},"服务描述:")," ",c.a.createElement("span",{className:"content"},l||"--"))))})),_t=n("Nlzp");function $t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(n),!0).forEach((function(t){tn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nn=function(e){return Object(_t.c)(_t.a.getAllRelatedProduct,en({},e))},rn=function(e){return Object(_t.c)(_t.a.getDownDevice,en({},e))},an=function(e){return Object(_t.c)(_t.a.getDownEventList,en({},e))},on=function(e){return Object(_t.c)(_t.a.getDownPropEvent,en({},e))},cn=function(e){return Object(_t.c)(_t.a.getDownDatasource,en({},e))},ln=function(e){return Object(_t.c)(_t.a.getDownTableByDatasource,en({},e))},un=function(e){return Object(_t.c)(_t.a.getDownFieldsByDatasourceTable,en({},e))},sn=function(e){return Object(_t.c)(_t.a.getFlowData,en({},e),{noInstance:!0})},An=function(e){return Object(_t.d)(_t.a.saveFlowData,en({},e),{needJson:!0,noInstance:!0})};n("JTrB");function dn(e){return function(e){if(Array.isArray(e))return vn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||bn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fn(Object(n),!0).forEach((function(t){mn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||bn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bn(e,t){if(e){if("string"==typeof e)return vn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vn(e,t):void 0}}function vn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gn(e){var t=e.service,n=e.isStatic,r=yn(Object(i.useState)([]),2),a=r[0],o=r[1],l=yn(Object(i.useState)(0),2),u=l[0],s=l[1],A=yn(Object(i.useState)(null),2),d=A[0],m=A[1],y=yn(Object(i.useState)([]),2),b=y[0],g=y[1],h=yn(Object(i.useState)([]),2),O=h[0],w=h[1],I=yn(Object(i.useState)([]),2),j=I[0],C=I[1],S=function(e){return e&&a.filter((function(t){return t.id===e}))[0]||null},N=Object(i.useMemo)((function(){if(d){var e=a.filter((function(e){return e.id===d}))[0]||{};if(e.pid){var t=function(e){for(var t=S(e);t&&t.nodeType===R;)t=t.pid?S(t.pid):null;return t}(e.pid);e.pProps=t&&t.input&&t.input.props||[]}return e}return{}}),[d,a]),D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=pn({},e);if(t===M){var r=n,a=r.windowDurings,o=void 0===a?{}:a,i=r.slideDurings,c=void 0===i?{}:i,l=o.windowDuring,u=o.windowUnit,s=c.slideDuring,A=c.slideUnit;n=pn(pn({},n),{},{windowDuring:l,windowUnit:u,slideDuring:s,slideUnit:A})}if(t===L){var d=n,f=d.relate,p=void 0===f?{}:f,m=p.streamFieldCode,y=p.dimFieldCode;n=pn(pn({},n),{},{streamFieldCode:m,dimFieldCode:y})}if(t===U){var b=n,v=b.dataSource,g=void 0===v?[]:v,E=b.selectedRowKeys,h=void 0===E?[]:E,O=g.filter((function(e){return h.includes(e.srcCode)}));n=pn(pn({},n),{},{props:O})}return JSON.stringify(n)};Object(i.useEffect)((function(){var e=t.projectId,n=t.serviceId;e&&nn({projectId:e,pageRows:9999}).then((function(e){e&&e.data&&e.data.list&&w(dn(e.data.list))})),n&&sn({serviceId:n}).then((function(e){if(e.data){var t=e.data,n=t.flowNodeList,r=t.lines,a=void 0===r?"":r,i=(n||[]).map((function(e){return e.pNodeId})),c=0,l=[];n&&(l=n.map((function(e){var t=e.input,n=e.location,r=e.nodeId,a=e.nodeName,o=e.nodeType,l=e.output,u=e.pNodeId;return r>c&&(c=r),{input:JSON.parse(t),nodeType:o,location:n.split(",").map((function(e){return+e})),id:r,nodeName:a,output:l,pid:u||null,hasChildNode:i.includes(r)}}))),a&&g(JSON.parse(a)),o(l),s(c+1)}})),cn({type:2}).then((function(e){e&&e.data&&C(dn(e.data))}))}),[t]);var B=Object(i.useCallback)((function(){var e={projectId:t.projectId,serviceId:t.serviceId,lines:JSON.stringify(b)};e.nodes=a.map((function(e){var t=e.nodeName,n=e.nodeType,r=e.pid,a=e.id,o=e.input;return{id:a,pid:r,nodeName:t,nodeType:n,location:e.location.join(","),input:D(o,n),output:""}})),console.log("触发保存 -- ",e),An(e).then((function(){Object(Y.a)({type:"success",description:"保存成功！"})}))}),[a,b,t]);Object(i.useEffect)((function(){var e=f.asObservable().subscribe((function(e){B()})),t=p.asObservable().subscribe((function(e){}));return function(){e.unsubscribe(),t.unsubscribe()}}),[B]);var k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.length===t.length?o((function(n){return dn(n).map((function(n){var r=e.indexOf(n.id);return r>-1?E()({},n,t[r],(function(e,t){if(v()(t))return t})):n}))})):console.log("修改节点数据时，传入的数据异常",e,t)};return c.a.createElement("div",{className:"playground-wrapper flex-row"},n?c.a.createElement(Ie,{nodes:a,pathsConfigs:b}):c.a.createElement(c.a.Fragment,null,c.a.createElement(le,null),c.a.createElement(Oe,{nodes:a,nodeIdCount:u,setNodeIdCount:s,focusNodeId:d,setFocusNodeId:m,changeNodeDataByIds:k,hasInputNode:function(){return a.map((function(e){return e.nodeType})).includes(x)},pathsConfigs:b,setPathsConfigs:g,setNodes:o}),c.a.createElement(Xt,{changeNodeDataByIds:k,selectedNode:N,productList:O,getDeviceList:function(e){return rn({productId:e,pageRows:9999}).then((function(e){return e.data&&e.data.list||[]}))},getPropOrEventList:function(e,t,n){return on({productId:e,property:t,eventIdentifier:n}).then((function(e){return e&&e.data&&dn(e.data).map((function(e){return pn(pn({},e),{},{srcTableCode:""})}))||[]}))},getDownEventList:function(e){return an({productId:e}).then((function(e){return e&&e.data||[]}))},dataSourceList:j,getTableByDatasource:function(e){return ln({datasourceId:e}).then((function(e){return e&&e.data||[]}))},getFieldsByDatasourceTable:function(e,t){return un({datasourceId:t,tableCode:e}).then((function(t){return t&&t.data?dn(t.data).map((function(t){return pn(pn({},t),{},{srcTableCode:e})})):[]}))},service:t})))}n("AUBz");var En=n("ZTPi"),hn=(n("Rm1S"),n("p532"),n("dlhN"),n("MJZm"));n("wJTb");function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return In(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return In(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function In(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Be.a.Search,hn.a.TreeNode;var jn=Ne.a.Option;function Cn(e){var t=e.setSelectedData,n=e.setPropsProductId,r=e.productId,a=wn(Object(i.useState)([]),2),o=a[0],l=a[1],u=wn(Object(i.useState)(0),2),s=(u[0],u[1],wn(Object(i.useState)([]),2)),A=s[0],d=s[1],f=wn(Object(i.useState)({properties:[],events:[]}),2),p=f[0],m=f[1],y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.properties,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.events,n=e.map((function(e){var t=e.name,n=e.dataType.type;return{key:"设备属性表.".concat(t),title:"".concat(t," (").concat(n,")")}})),r=t.map((function(e){var t=e.identifier,n=e.name,r=e.outputData,a={title:n,key:"_events_|"+t,disabled:!0};return r&&r.length>0&&(a.children=r.map((function(e){var t=e.name,n=e.dataType.type;return{key:"设备事件表.".concat(t),title:"".concat(t," (").concat(n,")")}}))),a}));return[{title:"设备属性表",key:"设备属性表",children:n},{title:"设备事件表",key:"设备事件表",children:r}]};Object(i.useEffect)((function(){Object(_t.c)(_t.a.getProductList,{pageRows:9999,instanceId:2},{needVersion:1.2}).then((function(e){var t=e.data&&e.data.list||[];l(t)}))}),[]),Object(i.useEffect)((function(){}),[]),Object(i.useEffect)((function(){r&&function(e){Object(_t.c)(_t.a.getTsl,{productId:e}).then((function(e){var t=e.data,n=JSON.parse(t),r=n.properties,a=void 0===r?[]:r,o=n.events,i=void 0===o?[]:o;m({properties:a,events:i}),d(y(a,i))}))}(r)}),[r]);return c.a.createElement("div",{className:"sql"},c.a.createElement("div",{className:"tree-content"},c.a.createElement(Ne.a,{className:"proselect",placeholder:"请先选择产品",value:r,onChange:function(e){n(e),d([])},showSearch:!0,optionFilterProp:"children"},o.map((function(e){var t=e.productId,n=e.productName;return c.a.createElement(jn,{key:t,value:t},n)}))),c.a.createElement(hn.a,{autoExpandParent:!0,defaultExpandAll:!0,treeData:A,onSelect:function(e){console.log(e),t(e)}})))}function Sn(e){var t,n=e.setSelectedData,r=e.proLogicData,a=(t="",function e(n){var r=[];for(var a in n){var o=n[a],i={title:a,key:t&&"".concat(t,".").concat(a)||a};o&&"object"===On(o)?(t=t&&"".concat(t,".").concat(a)||a,i.children=e(o)):i.title="".concat(a," (").concat(o,")"),r.push(i)}return t="",r}(r));Object(i.useEffect)((function(){}),[]);return c.a.createElement("div",{className:"sql"},c.a.createElement("div",{className:"tree-content"},c.a.createElement(hn.a,{autoExpandParent:!0,defaultExpandAll:!0,treeData:a,onSelect:function(e){console.log(e),n(e)}})))}n("k3Gp");var Nn=n("kLXV"),Dn=n("zsHu"),Bn=n("DgvE");function kn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||Tn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qn(e){return function(e){if(Array.isArray(e))return Pn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Tn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tn(e,t){if(e){if("string"==typeof e)return Pn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pn(e,t):void 0}}function Pn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(n),!0).forEach((function(t){Mn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Fn=h.a.Panel;je.a.create({name:"sql-config"})((function(e){var t=e.visible,n=e.cancelHandle,r=e.form,a=e.requestList,o=void 0===a?[]:a,i=e.responseList,l=void 0===i?[]:i,u=e.invokeUrl,s=e.setConfigModalData,A=e.saveData,d=e.apiName,f=e.onPage,p=r.getFieldDecorator,m=(r.setFieldsValue,function(e,t,n,r){s((function(a){var o=Rn({},a);return o[r][t][n]=e,o}))}),y=[{title:"属性名称",dataIndex:"key",key:"key",width:"200px"},{title:"数据类型",dataIndex:"type",key:"type",render:function(e,t,n){var r=t.type;return c.a.createElement("select",{value:r,onChange:function(e){return m(e.target.value,n,"type","requestList")}},c.a.createElement("option",{value:""},"请选择"),c.a.createElement("option",{value:"VARCHAR"},"VARCHAR"),c.a.createElement("option",{value:"INTEGER"},"INTEGER"),c.a.createElement("option",{value:"TIMESTAMP"},"TIMESTAMP"),c.a.createElement("option",{value:"DOUBLE"},"DOUBLE"),c.a.createElement("option",{value:"DATE"},"DATE"))}},{title:"是否必填",dataIndex:"ro",key:"ro",render:function(e,t,n){var r=t.ro;return c.a.createElement(et.a,{checked:r,onChange:function(e){return m(e.target.checked,n,"ro","requestList")}})}}],b=[{title:"属性名称",dataIndex:"key",key:"key",width:"200px"},{title:"数据类型",dataIndex:"type",key:"type",render:function(e,t,n){var r=t.type;return c.a.createElement("select",{value:r,onChange:function(e){return m(e.target.value,n,"type","responseList")}},c.a.createElement("option",{value:""},"请选择"),c.a.createElement("option",{value:"VARCHAR"},"VARCHAR"),c.a.createElement("option",{value:"INTEGER"},"INTEGER"),c.a.createElement("option",{value:"TIMESTAMP"},"TIMESTAMP"),c.a.createElement("option",{value:"DOUBLE"},"DOUBLE"),c.a.createElement("option",{value:"DATE"},"DATE"))}}];return c.a.createElement(Nn.a,{className:"sql-modal-self-class",visible:t,width:600,title:"生成API",closable:!0,centered:!0,okText:"提交",onOk:function(){r.validateFields((function(e,t){if(!e){var n=!1;if([].concat(Qn(o),Qn(l)).forEach((function(e){""===e.type&&(n=!0)})),n)return void Object(Y.a)({message:"请为所有参数选择数据类型！"});A(Rn({},t))}}))},onCancel:n,destroyOnClose:!0,maskClosable:!1},c.a.createElement("div",{className:"sql-config-wrapper"},c.a.createElement(h.a,{defaultActiveKey:["1","2","3","4"]},c.a.createElement(Fn,{header:"基本信息",key:"1"},c.a.createElement(je.a.Item,{label:"API名称"},p("apiName",{rules:[{required:!0,message:"请输入API名称！"}],initialValue:d})(c.a.createElement(Be.a,{placeholder:"请输入API名称！"}))),c.a.createElement(je.a.Item,{label:"ApiSrn"},p("apiSrn",{initialValue:u,rules:[{required:!0,message:"请输入ApiSrn！"}]})(c.a.createElement(Be.a,null)))),c.a.createElement(Fn,{header:"请求参数",key:"2"},c.a.createElement(Ce.a,{rowKey:"key",columns:y,dataSource:o,pagination:!1})),c.a.createElement(Fn,{header:"返回参数",key:"3"},c.a.createElement(Ce.a,{rowKey:"key",columns:b,dataSource:l,pagination:!1})),c.a.createElement(Fn,{header:"高级设置",key:"4"},c.a.createElement(je.a.Item,null,p("onPage",{valuePropName:"checked",initialValue:f})(c.a.createElement(et.a,null,"开启返回结果分页")))))))}));function Ln(e){var t=e.visible,n=e.cancelHandle,r=e.params,a=e.sqlTest;console.log("---params--",r);var o=kn(Object(i.useState)(new Array(r.length)),2),u=o[0],s=o[1];return c.a.createElement(Nn.a,{className:"modal-sql-paramsconfig",visible:t,title:"参数配置",closable:!0,centered:!0,footer:null,onCancel:n,destroyOnClose:!0,maskClosable:!1},c.a.createElement("div",{className:"test-config-wrapper"},r.map((function(e,t){return c.a.createElement("div",{key:t,className:"param"},c.a.createElement("span",{className:"key"},e," :"),c.a.createElement(Be.a,{className:"input",placeholder:"输入参数值",onChange:function(e){!function(e,t){var n=e.target.value,r=se()(u);r[t]=n,s(r)}(e,t)}}))})),c.a.createElement(l.a,{className:"testbtn",type:"primary",onClick:function(){a(u)}},"开始调试")))}function Un(e){var t=e.visible,n=e.cancelHandle,r=e.downHistoryLi,a=e.getDownTslHistory,o=e.downHistoryLoading,i=e.addTslHistory,u=[{title:"导出时间",dataIndex:"createTime",width:150,render:function(e){return c.a.createElement("span",null,Bn.a.pekingToStr(e))}},{title:"路径地址",dataIndex:"filePath"},{title:"状态",dataIndex:"status",width:90,render:function(e){return c.a.createElement("span",null,{0:"处理中",1:"成功",2:"失败"}[e]||"--")}}];return c.a.createElement(Nn.a,{className:"modal-downHistoryLi",visible:t,title:"导出列表",closable:!0,centered:!0,footer:null,onCancel:n,destroyOnClose:!0,maskClosable:!1,width:800},c.a.createElement("div",{className:"topbtnbox"},c.a.createElement(l.a,{className:"addbtn",type:"link",onClick:i},"新增导出"),c.a.createElement(Dn.a,{title:"刷新列表",spin:o,className:"refresh",onClick:a})),c.a.createElement(Ce.a,{rowKey:"createTime",columns:u,dataSource:r,scroll:{y:600},pagination:!1}))}function Vn(e){return function(e){if(Array.isArray(e))return Kn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Kn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Kn(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qn(e){var t=e.fieldList,n=t.map((function(e,t){var n=se()(e);return n.id=t+1,n})),r=Object.keys(t[0]).map((function(e){return{title:e,dataIndex:e}}));return c.a.createElement("div",{className:"table-filed-content"},c.a.createElement(Ce.a,{rowKey:"id",columns:[{title:"序号",dataIndex:"id"}].concat(Vn(r)),dataSource:n,scroll:{y:400},pagination:!1}))}var Jn=n("54Vy");n("boRK");function Gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gn(Object(n),!0).forEach((function(t){zn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Wn=En.a.TabPane,Xn=Be.a.TextArea,_n=function(e){return e.match(/(?<={).*?(?=})/g)||[]};function $n(e){var t=e.service,n=e.getServeStatu,r=Zn(Object(i.useState)(void 0),2),a=r[0],o=r[1],u=t.serviceId,s=t.projectId,A=t.name,d=Zn(Object(i.useState)(),2),y=d[0],b=d[1],v=Zn(Object(i.useState)([]),2),g=v[0],E=v[1],h=Zn(Object(i.useState)("select "),2),O=h[0],w=h[1],I=Zn(Object(i.useState)(!1),2),j=I[0],C=I[1],S=Zn(Object(i.useState)([]),2),N=S[0],D=S[1],B=Zn(Object(i.useState)("TSL"),2),k=B[0],Q=B[1],T=Zn(Object(i.useState)({}),2),P=T[0],x=T[1],R=Zn(Object(i.useState)(!1),2),M=R[0],F=R[1],L=Zn(Object(i.useState)(),2),U=L[0],V=L[1],K=Zn(Object(i.useState)([]),2),q=K[0],J=K[1],G=Zn(Object(i.useState)(!1),2),H=G[0],z=G[1],Z=Zn(Object(i.useState)(!1),2),W=Z[0],X=Z[1],_=function(e){var t=e[0];t&&w(O+" "+t)},$=function(){for(var e={},t=_n(O),n=0;n<t.length;n++){var r=t[n],a="{{1@".concat(r,"}}");e[r]=a}return e},ee=function(){z(!0),Object(_t.c)(_t.a.downTslHistory,{flowId:U}).then((function(e){var t=e.data;J(void 0===t?[]:t)})).finally((function(){z(!1)}))},te=function(){var e={};if(N.length>0)for(var t=_n(O),n=0;n<t.length;n++){var r=t[n],a=paramsVal[n];e[r]=a}return e},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];D(e);var t=te(e),n=_t.a.sqlTestProductData,r={sql:O,paramsMap:encodeURI(JSON.stringify(t))};"TSL"==k&&(n=_t.a.sqlTestTslData,r.projectId=s,r.productId=a),Object(_t.c)(n,r).then((function(e){e.code;var t=e.data,n=void 0===t?[]:t;C(!1),n.length>100&&(n=n.slice(0,100)),E(n)}))};return Object(i.useEffect)((function(){var e=f.asObservable().subscribe((function(e){var t=y||(new Date).getTime();Object(_t.d)(_t.a.saveFlowData,{projectId:s,serviceId:u,lines:"",action:t,nodes:[{nodeType:101,id:1,nodeName:"数据查询起始",location:"",input:JSON.stringify({action:t,authCheck:1,input:_n(O).map((function(e,t){return{param_name:e,param_typ:0,param_required:0,param_default:N[t],param_desc:""}}))}),output:""},{nodeType:3101,id:2,pid:1,nodeName:"数据查询",location:"",input:JSON.stringify({productId:a,projectId:s,logicSql:O,logicName:k,superInstanceId:localStorage.getItem("superInstanceId"),params:JSON.stringify($())}),output:""},{nodeType:701,id:3,pid:2,nodeName:"数据查询结束",location:"",input:JSON.stringify({source:1,sourceType:0,value:2}),output:""}]},{needJson:!0,noInstance:!0}).then((function(e){Object(Y.a)({type:"success",message:"保存成功"}),n()}))})),t=p.asObservable().subscribe((function(e){X(!0)})),r=m.asObservable().subscribe((function(e){_n(O).length>0?C(!0):ne()}));return function(){e.unsubscribe(),t.unsubscribe(),r.unsubscribe()}}),[n,u,a,O,k,y]),Object(i.useEffect)((function(){u&&Object(_t.c)(_t.a.getFlowData,{serviceId:u},{noInstance:!0}).then((function(e){if(e.data){var t=e.data,n=t.flowNodeList,r=void 0===n?[]:n,a=t.flowId,i=t.action;if(V(a),b(i),r&&r.length>1){var c=r[1].input;if(c){var l=JSON.parse(c),u=l.productId,s=l.logicSql,A=l.logicName;w(s),Q(A),o(u)}}}}))}),[u]),Object(i.useEffect)((function(){Object(_t.c)(_t.a.getProLogicTreeData,{},{noInstance:!0}).then((function(e){x(e.data||{})}))}),[]),c.a.createElement("div",{className:"sql-analysis-wrapper"},c.a.createElement("div",{className:"left-wrapper"},c.a.createElement("div",{className:"table-tree-wrapper"},c.a.createElement(En.a,{activeKey:k,className:"tabpane",onChange:function(e){Q(e)}},c.a.createElement(Wn,{tab:"物模型",key:"TSL"},c.a.createElement(Cn,{setSelectedData:_,setPropsProductId:o,productId:a})),c.a.createElement(Wn,{tab:"逻辑模型",key:"product"},c.a.createElement(Sn,{setSelectedData:_,proLogicData:P}))))),c.a.createElement("div",{className:"sql-code-edit-wrapper"},c.a.createElement("div",{className:"topbtn"},c.a.createElement(l.a,{type:"primary",size:"small",onClick:function(){F(!0),ee()},disabled:"product"==k}," 导出")),c.a.createElement("div",{className:"configitem"},c.a.createElement("span",{className:"itemname"},"SQL语句"),c.a.createElement(Xn,{rows:8,value:O,onChange:function(e){var t;t=e.target.value,w(t)}})),c.a.createElement("div",{className:"configitem"},c.a.createElement("span",{className:"itemname"},"发布路径"),c.a.createElement(Be.a,{value:y,placeholder:"选填",onChange:function(e){!function(e){var t=e.target.value;b(t)}(e)}})),c.a.createElement("div",{className:"configitem"},c.a.createElement("span",{className:"itemname"},"调试结果"),g.length>0&&c.a.createElement(qn,{fieldList:g}))),j&&c.a.createElement(Ln,{visible:!0,params:_n(O),cancelHandle:function(){C(!1)},sqlTest:ne}),c.a.createElement(Un,{visible:M,cancelHandle:function(){F(!1)},downHistoryLi:q,getDownTslHistory:ee,downHistoryLoading:H,addTslHistory:function(){Object(_t.c)(_t.a.addTslHistory,{sql:O,projectId:s,productId:a,paramsMap:encodeURI(JSON.stringify(te())),createTime:(new Date).getTime(),flowId:U}).then((function(e){ee()}))}}),c.a.createElement(Jn.a,{visible:W,envdata:{id:u,actionType:1,name:A},onOk:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(_t.d)(_t.a.servePublish,Hn({serviceId:u,envType:1,operate:1},e),{timeout:3e5}).then((function(e){Object(Y.a)({type:"success",message:"发布成功"}),n()}))},onCancel:function(){return X(!1)}}))}var er=n("lc5D"),tr=n.n(er);n("65m2"),n("EVKt"),n("umNf");function nr(e){var t=e.sqlText,n=e.setSqlText;return c.a.createElement(tr.a,{mode:"sql",theme:"github",height:"100%",width:"100%",value:t,onChange:function(e){n(e)},showGutter:!0,showPrintMargin:!1,enableBasicAutocompletion:!0,name:"sql-edit",editorProps:{$blockScrolling:!0}})}n("gtRY");function rr(e){return function(e){if(Array.isArray(e))return ur(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||lr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ar(Object(n),!0).forEach((function(t){ir(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ir(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||lr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lr(e,t){if(e){if("string"==typeof e)return ur(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ur(e,t):void 0}}function ur(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var sr=Ne.a.Option,Ar=[{code:"eventTime",name:"事件时间",type:"varchar",intBit:"",doubleBit:""},{code:"windowEventTime",name:"窗口事件时间",type:"timestamp",intBit:"",doubleBit:""},{code:"deviceId",name:"设备id",type:"varchar",intBit:"",doubleBit:""},{code:"proceTime",name:"当前系统时间",type:"timestamp",intBit:"",doubleBit:""}],dr=je.a.create({name:"sql-link-input-config"})((function(e){var t=e.visible,n=e.cancelHandle,r=e.form,a=e.productList,o=void 0===a?[]:a,l=e.setInputData,u=e.inputData,s=cr(Object(i.useState)(u.deviceList||[]),2),A=s[0],d=s[1],f=cr(Object(i.useState)([]),2),p=f[0],m=f[1],y=cr(Object(i.useState)(0),2),b=y[0],v=y[1],g=cr(Object(i.useState)(u.propsOrEventList||[]),2),E=g[0],h=g[1],O=cr(Object(i.useState)(u.fields||[].concat(Ar)),2),w=O[0],I=O[1],j=r.getFieldDecorator,C=r.setFieldsValue,S=r.getFieldValue,N=u.code,D=void 0===N?"":N,B=u.productId,k=void 0===B?"":B,Q=u.deviceIds,T=void 0===Q?[]:Q,P=u.propEvent,x=void 0===P?"0":P,R=u.fieldsCodes,M=void 0===R?[]:R,F=u.eventOffset,L=void 0===F?"":F,U=function(e,t,n){return on({property:t,productId:e,eventIdentifier:n}).then((function(e){return e&&e.data||[]}))},V=function(e){var t=S("productId");v(e),t?0==e?U(t,e).then((function(e){h(e),C({fieldsCodes:[]})})):function(e){return an({productId:e}).then((function(e){return e&&e.data||[]}))}(t).then((function(e){m(e),C({fieldsCodes:[]})})):Object(Y.a)({description:"请先选择一个产品"})},K=function(e,t,n){I((function(r){var a=rr(r);return a[n][e]=t,a}))},q=[{title:"字段名称",dataIndex:"name",key:"name",width:"100px"},{title:"字段编码",dataIndex:"code",key:"code",width:"100px"},{title:"字段类型",dataIndex:"type",key:"type",width:"100px"},{title:"整数位",dataIndex:"intBit",key:"intBit",width:"100px",render:function(e,t,n){var r=t.intBit;return c.a.createElement("input",{style:{width:"100px"},type:"number",value:r,onChange:function(e){return K("intBit",e.target.value,n)}})}},{title:"小数位",dataIndex:"doubleBit",key:"doubleBit",width:"100px",render:function(e,t,n){var r=t.doubleBit;return c.a.createElement("input",{style:{width:"100px"},type:"number",value:r,onChange:function(e){return K("doubleBit",e.target.value,n)}})}}];return c.a.createElement(Nn.a,{className:"sql-modal-self-class",visible:t,width:600,title:"输入表",closable:!0,centered:!0,okText:"保存",onOk:function(){r.validateFields((function(e,t){e||(l([or(or({},t),{},{fields:w,deviceList:A,propsOrEventList:E})]),n())}))},onCancel:n,destroyOnClose:!0,maskClosable:!1},c.a.createElement("div",{className:"sql-link-input-config-wrapper"},c.a.createElement(je.a,null,c.a.createElement(je.a.Item,{label:"表名称（只允许字母,数字,下划线，必须以字母开头）"},j("code",{rules:[{required:!0,message:"请输入表名称！"},{pattern:/^[a-zA-Z]+[a-zA-Z0-9_]{0,50}$/,message:"格式错误"}],initialValue:D})(c.a.createElement(Be.a,{placeholder:"请输入表名称！"}))),c.a.createElement(je.a.Item,{label:"选择产品"},j("productId",{rules:[{required:!0,message:"请选择产品！"}],initialValue:k})(c.a.createElement(Ne.a,{onChange:function(e){rn({productId:e,pageRows:9999}).then((function(e){C({deviceIds:[]}),d(e.data&&e.data.list||[])})),0==S("propEvent")&&U(e,"0").then((function(e){h(e),C({fieldsCodes:[]})}))}},o.map((function(e){var t=e.productId,n=e.productName;return c.a.createElement(sr,{key:t,value:t},n)}))))),c.a.createElement(je.a.Item,{label:"选择设备"},j("deviceIds",{rules:[{required:!0,message:"请选择设备！"}],initialValue:T})(c.a.createElement(Ne.a,{mode:"multiple"},A.map((function(e){var t=e.deviceId;return c.a.createElement(sr,{key:t,value:t},t)}))))),c.a.createElement(je.a.Item,{label:"输入参数"},j("propEvent",{rules:[{required:!0,message:"请选择输入参数！"}],initialValue:x})(c.a.createElement(Se.a.Group,{onChange:function(e){return V(e.target.value)}},c.a.createElement(Se.a,{value:"0"},"属性"),c.a.createElement(Se.a,{value:"1"},"事件")))),"1"==b&&c.a.createElement(je.a.Item,null,j("eventIdentifier",{rules:[{required:!0,message:"请选择事件！"}]})(c.a.createElement(Ne.a,{onChange:function(e){var t=S("productId");U(t,1,e).then((function(e){h(e),C({fieldsCodes:[]})}))},placeholder:"请选择事件！"},p.map((function(e){var t=e.identifier,n=e.name;return c.a.createElement(sr,{key:t,value:t},n)}))))),c.a.createElement(je.a.Item,null,j("fieldsCodes",{rules:[{required:!0,message:"请选择".concat("0"===b?"属性":"事件","字段！")}],initialValue:M})(c.a.createElement(Ne.a,{mode:"multiple",onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=w.filter((function(t){return e.includes(t.code)})),n=t.map((function(e){return e.code})),r=[];e.forEach((function(e){n.includes(e)||r.push(e)})),E.forEach((function(e){var n=e.srcCode,a=e.srcName,o=e.srcType;r.includes(n)&&t.push({code:n,name:a,type:o,intBit:"",doubleBit:""})})),I([].concat(Ar,rr(t)))}},E.map((function(e){var t=e.srcName,n=e.srcCode;return c.a.createElement(sr,{key:n,value:n},"".concat(t,"( ").concat(n," )"))}))))),c.a.createElement(je.a.Item,{label:"窗口起始时间偏移（毫秒）"},j("eventOffset",{rules:[{required:!0,message:"请输入窗口起始时间偏移！"}],initialValue:L})(c.a.createElement(Be.a,{placeholder:"请输入窗口起始时间偏移！",type:"number"}))),c.a.createElement(je.a.Item,null,c.a.createElement(Ce.a,{rowKey:"code",columns:q,dataSource:w,pagination:!1})))))})),fr=je.a.create({name:"sql-link-output-config"})((function(e){var t=e.visible,n=e.cancelHandle,r=e.form,a=e.changeOutput,o=e.inputData,u=cr(Object(i.useState)(o.dataSourceList||[]),2),s=u[0],A=u[1],d=cr(Object(i.useState)(o.tableList||[]),2),f=d[0],p=d[1],m=cr(Object(i.useState)(o.fieldsList||[]),2),y=m[0],b=m[1],v=cr(Object(i.useState)(o.selectedRowKeys||[]),2),g=v[0],E=v[1],h=r.getFieldDecorator,O=r.setFieldsValue,w=r.getFieldValue,I=o.code,j=o.dsType,C=o.dsId,S=o.tableCode,N=function(e,t,n){b((function(r){var a=rr(r);return a[n][e]=t,a}))},D=[{title:"字段编码",dataIndex:"code",key:"index",width:"100px",render:function(e,t,n){var r=t.code;return"5"==w("dsType")?c.a.createElement("input",{style:{width:"100px"},type:"text",value:r,onChange:function(e){return N("code",e.target.value,n)}}):c.a.createElement("span",null,r)}},{title:"字段类型",dataIndex:"type",key:"type",width:"100px",render:function(e,t,n){var r=t.type;return c.a.createElement("select",{value:r,onChange:function(e){return N("type",e.target.value,n)}},c.a.createElement("option",{value:"varchar"},"varchar"),c.a.createElement("option",{value:"double"},"double"),c.a.createElement("option",{value:"integer"},"integer"),c.a.createElement("option",{value:"time"},"time"),c.a.createElement("option",{value:"date"},"date"),c.a.createElement("option",{value:"timestamp(3)"},"timestamp(3)"),c.a.createElement("option",{value:"varbinary"},"varbinary"),c.a.createElement("option",{value:"decimal"},"decimal"),c.a.createElement("option",{value:"float"},"float"),c.a.createElement("option",{value:"bigint"},"bigint"),c.a.createElement("option",{value:"boolean"},"boolean"),c.a.createElement("option",{value:"tinyint"},"tinyint"),c.a.createElement("option",{value:"smallint"},"smallint"))}},{title:"整数位",dataIndex:"intBit",key:"intBit",width:"100px",render:function(e,t,n){var r=t.intBit;return c.a.createElement("input",{style:{width:"100px"},type:"number",value:r,onChange:function(e){return N("intBit",e.target.value,n)}})}},{title:"小数位",dataIndex:"doubleBit",key:"doubleBit",width:"100px",render:function(e,t,n){var r=t.doubleBit;return c.a.createElement("input",{style:{width:"100px"},type:"number",value:r,onChange:function(e){return N("doubleBit",e.target.value,n)}})}},{title:"操作",dataIndex:"code",key:"code",width:"100px",render:function(e,t,n){return c.a.createElement("a",{style:{marginLeft:"8px"},onClick:function(e){return function(e){b((function(t){return[].concat(rr(t.slice(0,e)),rr(t.slice(e+1)))}))}(n)}},"删除")}}],B={onChange:function(e,t){E(e)},selectedRowKeys:g};return c.a.createElement(Nn.a,{className:"sql-modal-self-class",visible:t,width:600,title:"输出表",closable:!0,centered:!0,okText:"保存",onOk:function(){r.validateFields((function(e,t){if(!e){var r=[],o=!1;"5"!=w("dsType")?r=y.filter((function(e){return g.includes(e.code)})):(r=rr(y)).forEach((function(e){e.code||(o=!0)})),o&&Object(Y.a)({description:"有参数未填完！"}),a(or(or({},t),{},{fields:r,fieldsList:y,tableList:f,dataSourceList:s,selectedRowKeys:g})),n()}}))},onCancel:n,destroyOnClose:!0,maskClosable:!1},c.a.createElement("div",{className:"sql-link-input-config-wrapper"},c.a.createElement(je.a,null,c.a.createElement(je.a.Item,{label:"表名称（只允许字母,数字,下划线，必须以字母开头）"},h("code",{rules:[{required:!0,message:"请输入表名称！"},{pattern:/^[a-zA-Z]+[a-zA-Z0-9_]{0,50}$/,message:"格式错误"}],initialValue:I})(c.a.createElement(Be.a,{placeholder:"请输入表名称！"}))),c.a.createElement(je.a.Item,{label:"数据源类型"},h("dsType",{rules:[{required:!0,message:"请选择数据源类型！"}],initialValue:j})(c.a.createElement(Ne.a,{onChange:function(e){cn({type:e}).then((function(e){e&&e.data&&(A(rr(e.data)),O({dsId:"",tableCode:""}),p([]),b([]),E([]))}))}},[{key:2,name:"mysql"},{key:5,name:"rocketMq"}].map((function(e){var t=e.name,n=e.key;return c.a.createElement(sr,{key:n,value:n},t)}))))),c.a.createElement(je.a.Item,{label:"数据库"},h("dsId",{rules:[{required:!0,message:"请选择数据库！"}],initialValue:C})(c.a.createElement(Ne.a,{onChange:function(e){"5"!=w("dsType")&&ln({datasourceId:e}).then((function(e){e&&e.data&&(p(e.data),O({tableCode:""}),b([]),E([]))}))}},s.map((function(e){var t=e.name,n=e.id;return c.a.createElement(sr,{key:n,value:n},t)}))))),"5"!=w("dsType")?c.a.createElement(je.a.Item,{label:"数据表"},h("tableCode",{rules:[{required:!0,message:"请选择数据表！"}],initialValue:S})(c.a.createElement(Ne.a,{onChange:function(e){un({datasourceId:w("dsId"),tableCode:e}).then((function(e){e&&e.data&&(b(e.data.map((function(e){return{code:e.srcCode,type:"varchar",name:e.srcName,intBit:"",doubleBit:""}}))),E([]))}))}},f.map((function(e){var t=e.code;return c.a.createElement(sr,{key:t,value:t},t)}))))):c.a.createElement(je.a.Item,null,c.a.createElement(l.a,{type:"primary",size:"small",onClick:function(){b((function(e){return[].concat(rr(e),[{code:"",type:"varchar",name:"",intBit:"",doubleBit:"",index:1e4*Math.random()}])}))}},"新增一行")),c.a.createElement(je.a.Item,{label:"输出"},c.a.createElement(Ce.a,{rowKey:"5"!=w("dsType")?"code":"index",rowSelection:"5"!=w("dsType")?B:void 0,columns:"5"!=w("dsType")?D.slice(0,-1):D,dataSource:y,scroll:{y:240},pagination:!1})))))}));n("m/U6");function pr(e){return function(e){if(Array.isArray(e))return br(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||yr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||yr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yr(e,t){if(e){if("string"==typeof e)return br(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?br(e,t):void 0}}function br(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var vr=h.a.Panel;function gr(e){var t=e.service,n=mr(Object(i.useState)(""),2),r=n[0],a=n[1],o=mr(Object(i.useState)([]),2),l=o[0],u=o[1],s=mr(Object(i.useState)([]),2),A=s[0],d=s[1],p=mr(Object(i.useState)([]),2),m=p[0],y=p[1],b=mr(Object(i.useState)(!1),2),v=b[0],g=b[1],E=mr(Object(i.useState)(!1),2),O=E[0],w=E[1],I=mr(Object(i.useState)(-1),2),j=I[0],C=I[1];Object(i.useEffect)((function(){var e=t.projectId,n=t.serviceId;e&&nn({projectId:e,pageRows:9999}).then((function(e){e&&e.data&&e.data.list&&d(pr(e.data.list))})),n&&sn({serviceId:n}).then((function(e){if(e.data){var t=e.data.flowNodeList,n=void 0===t?[]:t;if(n&&n.length>0){var r=(n[0]||{}).input;if(r){var o=JSON.parse(r)||{},i=o.inputTable,c=o.outputTable,l=o.sql;u(i||[]),y(c||[]),a(l||"")}}}}))}),[t]),Object(i.useEffect)((function(){var e=f.asObservable().subscribe((function(e){var n=t.projectId,a=t.serviceId;An({projectId:n,serviceId:a,lines:"",nodes:[{id:1,pid:null,nodeName:"flinkSql",nodeType:2501,location:"",input:JSON.stringify({nodeType:2501,inputTable:l,outputTable:m,sql:r}),output:""}]}).then((function(){Object(Y.a)({type:"success",message:"保存成功"})}))}));return function(){e.unsubscribe()}}),[t,r,l,m]);var S=Object(i.useMemo)((function(){return-1===j?{code:"",dsType:"",dsId:"",tableCode:"",fieldsList:[],tableList:[],dataSourceList:[],fields:[],selectedRowKeys:[]}:m[j]}),[j,m]),N=function(e,t){"input"===e?g(!0):(C(t),w(!0))},D=function(e,t){"input"===e?u([]):y((function(e){return[].concat(pr(e.slice(0,t)),pr(e.slice(t+1)))}))};return c.a.createElement("section",{className:"sql-link-wrapper"},c.a.createElement("div",{className:"left-wrapper"},c.a.createElement("div",{className:"input-wrapper"},c.a.createElement("div",{className:"input-title"},"输入表管理",c.a.createElement("span",{className:l.length>0?"disabled":"",onClick:l.length>0?null:function(){return g(!0)}},"添加输入")),c.a.createElement("div",{className:"table-content"},c.a.createElement(h.a,{defaultActiveKey:[]},l.map((function(e,t){var n=e.code,r=e.fields;return n?c.a.createElement(vr,{header:c.a.createElement("div",null,c.a.createElement("span",null,n),c.a.createElement("div",{style:{float:"right",marginRight:"12px"},onClick:function(e){return e.stopPropagation()}},c.a.createElement("span",{onClick:function(){return N("input")}},"编辑")," | ",c.a.createElement("span",{onClick:function(){return D("input")}},"删除"))),key:n+t},c.a.createElement("div",null,r.map((function(e,n){var r=e.code,a=e.type;return c.a.createElement("div",{className:"field-p",key:t+r},c.a.createElement("span",null,r),c.a.createElement("span",null,a))})))):null}))))),c.a.createElement("div",{className:"output-wrapper"},c.a.createElement("div",{className:"input-title"},"输出表与维表管理",c.a.createElement("span",{onClick:function(){return w(!0)}},"添加输出或维表")),c.a.createElement("div",{className:"table-content"},c.a.createElement(h.a,{defaultActiveKey:["1"]},m.map((function(e,t){var n=e.code,r=e.fields;return n?c.a.createElement(vr,{header:c.a.createElement("div",null,c.a.createElement("span",null,n),c.a.createElement("div",{style:{float:"right",marginRight:"12px"},onClick:function(e){return e.stopPropagation()}},c.a.createElement("span",{onClick:function(){return N("output",t)}},"编辑")," | ",c.a.createElement("span",{onClick:function(){return D("output",t)}},"删除"))),key:n+t},c.a.createElement("div",null,r.map((function(e,n){var r=e.code,a=e.type;return c.a.createElement("div",{className:"field-p",key:t+r},c.a.createElement("span",null,r),c.a.createElement("span",null,a))})))):null})))))),c.a.createElement("div",{className:"right-wrapper"},c.a.createElement(nr,{sqlText:r,setSqlText:a})),v&&c.a.createElement(dr,{inputData:l[0]||{},visible:v,productList:A,setInputData:u,cancelHandle:function(){return g(!1)}}),O&&c.a.createElement(fr,{inputData:S,visible:O,changeOutput:function(e){var t=pr(m);j>-1?t[j]=e:t.push(e),y(t)},cancelHandle:function(){w(!1),C(-1)}}))}var Er=n("55Ip");n("6MFL");function hr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Or(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Or(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Or(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wr(){var e=Object(Er.useParams)(),t=e.projectId,n=e.serviceId,r=decodeURI(Object(Bn.i)("name")),a=decodeURI(Object(Bn.i)("desc")),o=+decodeURI(Object(Bn.i)("analysisiType")||1),l=hr(Object(i.useState)(0),2),u=l[0],s=l[1],A=Object(i.useCallback)((function(){Object(_t.c)(_t.a.getServeStatu,{serveId:n}).then((function(e){e&&e.data&&s(e.data.testEnv)}))}),[n]);return c.a.createElement("section",{className:"data-analysis-wrapper flex-column"},c.a.createElement(y,{dataAnalysisName:r,analysisiType:o,testEnv:+u}),c.a.createElement("section",{className:"flex1"},3===o?c.a.createElement($n,{service:{name:r,desc:a,serviceId:n,projectId:t},getServeStatu:A}):4===o?c.a.createElement(gr,{service:{name:r,desc:a,serviceId:n,projectId:t}}):c.a.createElement(gn,{service:{name:r,desc:a,serviceId:n,projectId:t}})))}},"Q1S+":function(e,t){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4QBMRXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAOKADAAQAAAABAAAAQAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/9sAhAAICAgICQgJCgoJDQ4MDg0TERAQERMcFBYUFhQcKxsfGxsfGysmLiUjJS4mRDUvLzVETkI+Qk5fVVVfd3F3nJzRAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wgARCABAADgDASIAAhEBAxEB/8QAGwABAAIDAQEAAAAAAAAAAAAAAAYHAgMFAQT/2gAIAQEAAAAA+MDay7HG8bU4smsYY2JbY9axVs7Mkh0xjPIzteJRaXyOrcgMgP/EABsBAAEEAwAAAAAAAAAAAAAAAAABAwQGAgUH/9oACAECEAAAAOmtOjNNsk7VJBsGAH//xAAYAQEBAQEBAAAAAAAAAAAAAAAAAQIDBP/aAAgBAxAAAADzi9ec2uKP/8QAKxAAAgEEAQMDAQkAAAAAAAAAAQIAAwQREgUGE0EQFDFRISMzQGGBkqHB/9oACAEBAAE/ANZrNZrNZrNZrNYtNnYKqksTgAfJh6b5oUu77F9f2z/H5hQqSCCCDggzWazExOibSi9xdXDqC9IKqfpt6da2lKlfUK6KA1ZW3A+qzExMTE6Re6pX7ugHY1xVz/U97ad0UzVG+u2vnE6sF09+Kj/g6YpTExMTj+B5DkE7lJAKecbscSo6cLbdopgr48sYb66N37rufe5zn/JRdOatuzpkkfaPKmcjwd/xwD1kBpk43WYmJ0/e2tbjLdEdQ9NArr5BE6svKFzeUkosG7SEMR8ZPp0jeW1vcXNKswVqqroT9V8TqW9tafGV6LOpqVQAi+fyH//EACIRAAEEAgEEAwAAAAAAAAAAAAEAAgMRBBIFEBMiMVGBof/aAAgBAgEBPwDZSZEMRAkka2/Vmlstla5drznSG9hQ+lxpIwoA51mla5LKmx4WuibZLqv4WBEHQCWRnnIPK1358XP7EbLjc4fqvpfS1//EABoRAAIDAQEAAAAAAAAAAAAAAAERAAIgMRD/2gAIAQMBAT8AiOK8lunyocMTD1//2Q=="},WpQE:function(e,t){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4QBMRXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAOKADAAQAAAABAAAAQAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/9sAhAAICAgICQgJCgoJDQ4MDg0TERAQERMcFBYUFhQcKxsfGxsfGysmLiUjJS4mRDUvLzVETkI+Qk5fVVVfd3F3nJzRAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wgARCABAADgDASIAAhEBAxEB/8QAGwABAAIDAQEAAAAAAAAAAAAAAAIFAwQHAQb/2gAIAQEAAAAAgBkbf2nx2iyF7RxZPehWdfzyErHqRzOonPrNlo8kxSZbiowvQP/EABkBAAIDAQAAAAAAAAAAAAAAAAIDBAUGB//aAAgBAhAAAADpEOSa6OxloxVxoRSwv//EABkBAAIDAQAAAAAAAAAAAAAAAAEDAgQFBv/aAAgBAxAAAADh7KIjWpVpdfk4Yasf/8QALRAAAgEDAgMGBgMAAAAAAAAAAQIAAwQRBRMSIlEhMTJBYXEGEBQWMIFScrL/2gAIAQEAAT8AxMTExMTExMTEshZ74S7Vtpuwup5k9YPgy1ZRVGonaxnPCO6X62SVzTs+Jqadm4x7XPX2mJiYmIELEAAkxautjTmshTq7BOfCc4/j7RkZSQwII8jMTExFQswVRkk4Amm6TSs6QyoNUjmabUv9Lo3lIhlAcDlfpKlJqbujjDKxBHqJiYmkKranaBu7cE25tzbmuqq6rdBeq/5ExMSm7UqiVEOGVgwPqJpl/b6hbrVpkcQHOnmpnAJqF5b2Fu1as39V82PQSvWe4r1az+J2LH9/LExKNatbuKlGoyN1U4n3HrHDw/U/vgWXFxcXL7leqzt1YzEx+D//xAAgEQACAgICAgMAAAAAAAAAAAABAgMRAAQSMQUQIUJR/9oACAECAQE/ALzY34NdgsvIX0asHEk5orURY6PeXhas2PIxuwAiVlU2C2am4mwD8Uw7GXkoLxuo7KkY7MjFWBBBzw6uZHk+vGsv08EEht4kY/pGKAoAUAD1/8QAIREAAgICAQQDAAAAAAAAAAAAAQIDEQAEEAUSITFBUWH/2gAIAQMBAT8AyHVlnUmOjXvzVYy9rEWDX1zDouq2ZCpYVQzZ1mgIvyp9HiNgsiMfgg4gV0DKQQRnVnQIkdjuu+UnmjFJIyj8OMxY2SSeP//Z"},boRK:function(e,t,n){},kyDF:function(e,t,n){},"m/U6":function(e,t,n){},qEOn:function(e,t){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4QBMRXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAOKADAAQAAAABAAAAQAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/9sAhAAICAgICQgJCgoJDQ4MDg0TERAQERMcFBYUFhQcKxsfGxsfGysmLiUjJS4mRDUvLzVETkI+Qk5fVVVfd3F3nJzRAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wgARCABAADgDASIAAhEBAxEB/8QAGwABAAEFAQAAAAAAAAAAAAAAAAUCAwQGBwH/2gAIAQEAAAAAoAuMqXisNcudQyLPMLFcj1c5bE1OlbPrnMvK2VuOoYaokI89A//EABoBAAEFAQAAAAAAAAAAAAAAAAIAAwQFBgf/2gAIAQIQAAAA6Qw6UfG22gDMXE8QNf/EABoBAAEFAQAAAAAAAAAAAAAAAAEAAgMFBgT/2gAIAQMQAAAAw8sYdq6ulGhquMPYv//EACwQAAEEAQMBBQkBAAAAAAAAAAEAAgMRBAUTMSEGEFFhgRIUFiIjMDJxkTP/2gAIAQEAAT8ApUqVKlSpUqWLg5OW4thjvxPAC+G8uv8AWO/VZWn5OIamjoHhw6gqlSpQQOmmiib+T3Bo9VjYUWNCyKNtNaP6tpT4kc8T4pG21worKxnY2TNA7ljqVKlpDms1PELuNwD+9FtrbW2tdc1+rZZbwHAerQAVSpDotF7QY2TEyHKeI5wKs8PXyVdhaxr+LhxPjge2TIPAHUN8ynFznFzjZJslV34fum8G5QdtO6FzeW+aHZOExh41J20RfCzhhtmMeJ7To29Nxx6vPj+u+lSpN1PMbguwhJ9In1rw/SpUq+x//8QAIhEAAgICAQMFAAAAAAAAAAAAAQIDEQAEEgUQMSEiM0KB/9oACAECAQE/ALyTagjNPIAcSRXHJWBGXkrlYpGHkKThmJJJNk50iZjM6fXjeX23dLWim+Vow3qPbyH5mhqx68Vrdt5Lecvs6I9c1Bo2O/8A/8QAIhEAAgICAQMFAAAAAAAAAAAAAQIDEQAEEAUSMSEiM0Fi/9oACAEDAQE/AMSCVxaoSMZWU0wIPEYDSID4JGLEAAAPQDOqRKI0f77q4vNPc2JIvjVyP1Rzc2ZJ5PdVL4A5V3S+1iLFHn//2Q=="},vPre:function(e,t){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4QBMRXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAOKADAAQAAAABAAAAQAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/9sAhAAICAgICQgJCgoJDQ4MDg0TERAQERMcFBYUFhQcKxsfGxsfGysmLiUjJS4mRDUvLzVETkI+Qk5fVVVfd3F3nJzRAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wgARCABAADgDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAYCAwUEAf/aAAgBAQAAAADjAAtA98LdrU43VLXLG1jx3pFR7OnpNbD45sm9OzAVpS9DyMgAP//EABoBAAICAwAAAAAAAAAAAAAAAAAFAQQCBgf/2gAIAQIQAAAA6aAuVVdqqLRzhBP/xAAYAQEBAQEBAAAAAAAAAAAAAAAAAgEDBP/aAAgBAxAAAADziq3nWp0f/8QAKxAAAQMDAwIFBAMAAAAAAAAAAQACAwQREgUTIQZSEBUxcpEwM1OiQVHR/9oACAEBAAE/AMVisVisVisVisVZWWJte3CxWKstL02GrjkdIXXa63C8hpO6T5WkaPDW1NUJHOwhcBiP5uT/AIhptMIdgQM2+23C13R4aDblhJxe4jA82VlZdONvDUe8LbXTU9PFXajFLK1r5JBgDxexK2V1dPTubBAyVrpWPJc0c2VlZQUVRUAmJmVjzyAvKK/8P7BeT6h+H9gmu6kbTGmEj9v3tyt/V1U0FVTBrpo8cjxyCreGh/am9wQQQXUH2YPefEOcPQkLOTvd8rck7z8rck73fKLnO9XE/R//xAAjEQABBQABAgcAAAAAAAAAAAABAAIDBBESUZEFEBMUISJS/9oACAECAQE/AOS5LkuSuyuZA5zTh0L3dg17BD3EgDO68NszG0xoc4gn7LVYldHEXDEb835Z2VWyfWDRHG0OPyQMW+WN6BYOgWr/xAAbEQACAgMBAAAAAAAAAAAAAAAAAREgAhAhMf/aAAgBAwEBPwCi9IUoyXNIgat//9k="},wJTb:function(e,t,n){}}]);