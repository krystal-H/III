(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+Acz":function(e,t,a){},"/DsP":function(e,t,a){},"7wwM":function(e,t,a){},"8bdq":function(e,t,a){},C8h6:function(e,t,a){},GCsS:function(e,t,a){},"JzY+":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAv0lEQVQ4T+XUSwrCMBAG4H/0QFLpXdy4FzxBpfvSA/QKRY8iuFAP1IxMIVBqJjPZarYZvsyL0K5hRua8eyK5tuIiQVbgH4CxRK2t+4YPARgZ2KZivnqYAy1MHnCDKYyAaZ2pC9Qw2uAYAq7L0k0whz07uq3XLgtaWGrhVbBqueYJ92WPpGdSpmSmbYEKMjNVLQYOOM/Tc2DmlCOKgJOWWVEP5cUZvaB+9fRIlVkM5n6ioqFYULw3M/RC7in/PvgBL+qur9K0TXkAAAAASUVORK5CYII="},N20j:function(e,t,a){},ORHb:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));a("pNMO"),a("4Brf"),a("07d7"),a("0oug"),a("4mDm"),a("PKPk"),a("3bBZ"),a("+2oP"),a("sMBO"),a("pjDv"),a("rB9j"),a("Re5i");var n=a("/wGt"),r=(a("1vPl"),a("5rEg")),c=(a("L/Qf"),a("2/Rp")),i=(a("tULf"),a("Vl3Y")),l=a("q1tI"),o=a.n(l),u=a("rVDo"),s=a("Nlzp"),m=a("S18n"),d=a("DgvE");a("T8Ho");function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function y(e){var t=e.titleVisible,a=e.onCloseTitle,f=e.onOkClose,y=e.productItem,b=p(i.a.useForm(),1)[0],g=Object(l.useRef)(),v=p(Object(l.useState)([]),2),h=(v[0],v[1]);Object(l.useEffect)((function(){Object(s.c)(s.a.getProductBrand).then((function(e){h(e.data)}))}),[]);return o.a.createElement(n.a,{title:"产品信息",placement:"right",closable:!1,onClose:a,visible:t,destroyOnClose:!0,width:393,footer:o.a.createElement("div",{style:{textAlign:"right"}},o.a.createElement(c.a,{onClick:a,style:{marginRight:8}},"取消"),o.a.createElement(c.a,{onClick:function(){b.validateFields().then((function(e){var t={productId:y.productId,productName:e.productName,brandId:e.brandId,productIcon:e.productIcon[0].url,productCode:e.productCode};Object(s.c)(s.a.editProductInfo,t).then((function(t){var a={productName:e.productName,brandId:e.brandId,productIcon:e.productIcon[0].url,productCode:e.productCode,modifyTime:t.data.modifyTime};f(a)}))}))},type:"primary"},"确定"))},o.a.createElement("div",{className:"edit-left-protocol-wrap"},o.a.createElement(i.a,{labelCol:{span:8},wrapperCol:{span:16},form:b,initialValues:{productIcon:[{url:y.productIcon}],productName:y.productName,brandId:y.brandId,productCode:y.productCode}},o.a.createElement(i.a.Item,{label:"产品名称",name:"productName",rules:[{required:!0}]},o.a.createElement(r.a,{maxLength:30})),o.a.createElement(i.a.Item,{label:"产品ID"},o.a.createElement("span",null,y.productId)),o.a.createElement(i.a.Item,{label:"品类"},o.a.createElement("span",null,y.deviceType)),o.a.createElement(i.a.Item,{label:"品牌",name:"brandId",rules:[{required:!0}]},o.a.createElement("span",null,y.brandName)),o.a.createElement(i.a.Item,{label:"产品型号",name:"productCode"},o.a.createElement(r.a,null)),o.a.createElement(i.a.Item,{label:"通信协议"},o.a.createElement("span",null,y.bindTypeStr)),o.a.createElement(i.a.Item,{label:"智能化方案"},o.a.createElement("span",null,y.schemeName)),o.a.createElement(i.a.Item,{label:"产品编码"},o.a.createElement("span",null,y.code)),o.a.createElement(i.a.Item,{label:"产品密钥"},o.a.createElement("span",null,o.a.createElement(m.a,{label:y.deviceKey,tip:"",copy:!1}))),o.a.createElement(i.a.Item,{label:"产品图片",name:"productIcon",rules:[{required:!0}]},o.a.createElement(u.b,{ref:g,maxSize:10,format:".gif,.jpeg,.jpg,.png"})),o.a.createElement(i.a.Item,{label:"创建时间"},o.a.createElement("span",null,d.a.utcToDev(y.createTime))),o.a.createElement(i.a.Item,{label:"更新时间"},o.a.createElement("span",null,y.modifyTime?d.a.utcToDev(y.modifyTime):"--")))))}},OXFO:function(e,t,a){},PvDj:function(e,t,a){},ShEY:function(e,t,a){},T8Ho:function(e,t,a){},Z6NE:function(e,t,a){},Z8n2:function(e,t,a){"use strict";a.r(t);a("pNMO"),a("4Brf"),a("07d7"),a("0oug"),a("4mDm"),a("PKPk"),a("3bBZ"),a("+2oP"),a("sMBO"),a("pjDv"),a("L/Qf");var n=a("2/Rp"),r=(a("RKNx"),a("L41K")),c=(a("rB9j"),a("Rm1S"),a("2B1R"),a("q1tI")),i=a.n(c),l=a("55Ip"),o=a("8QW8"),u=(a("FZtP"),a("5s+n"),a("ma9I"),a("tkto"),a("TeQF"),a("5DmW"),a("27RR"),a("+Acz"),a("k3Gp"),a("kLXV")),s=(a("8QGh"),a("2fM7")),m=(a("AUBz"),a("ZTPi")),d=(a("tULf"),a("Vl3Y")),p=(a("1vPl"),a("5rEg")),f=a("Nlzp"),y=a("P2RN"),b=(a("PvDj"),a("mbEz"),a("wCAj")),g=(a("MKzF"),a("kaz8")),v=a("BkRI"),h=a.n(v),E=(a("yq1k"),a("x0AG"),a("7EV8"));function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return I(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function w(e){var t=e.dataSource,a=e.refreshCount,n=O(Object(c.useState)([]),2),r=n[0],l=n[1],o=O(Object(c.useState)(h()(t)),2),u=o[0],s=o[1],m=O(Object(c.useState)(!1),2),d=m[0],p=m[1],f=O(Object(c.useState)(!1),2),y=f[0],v=f[1],I=O(Object(c.useState)(0),2),w=I[0],j=I[1];Object(c.useEffect)((function(){s(h()(t));var e=[];t.forEach((function(t){e.includes(t.funcIdentifier)||(e.push(t.funcIdentifier),j(e.length))})),l([]),p(!1),v(!1)}),[JSON.stringify(t)]);Object(c.useEffect)((function(){a(r)}),[r.length]);var S=[{width:"80px",title:function(){return i.a.createElement(g.a,{onChange:function(e){!function(e){var a=e.target.checked,n=JSON.parse(sessionStorage.getItem("productItem")).productId;if(s((function(e){var t=h()(e);return t.forEach((function(e){e.checked=a})),t})),v(a),p(!1),a){var r=[],c=[];t.forEach((function(e){if(!r.includes(e.funcIdentifier)){var t={id:e.id,funcType:e.funcType,identifier:e.funcIdentifier,productId:n};c.push(t),r.push(e.funcIdentifier)}})),l(c)}else l([])}(e)},checked:y,indeterminate:d})},render:function(e,a,n){var r=Object(E.a)(t,"funcIdentifier",n,a.funcIdentifier,"funcIdentifier");return r.children=i.a.createElement(g.a,{onChange:function(e){!function(e,t){var a=e.target.checked,n=JSON.parse(sessionStorage.getItem("productItem")).productId;l((function(e){var r={id:t.id,funcType:t.funcType,identifier:t.funcIdentifier,productId:n},c=JSON.parse(JSON.stringify(e));return a?c.push(r):c=c.filter((function(e){if(e.identifier!==t.funcIdentifier)return e})),p(!!c.length&&c.length<w),v(c.length===w),c})),s((function(e){var n=h()(e),r=n.findIndex((function(e){if(e.funcIdentifier===t.funcIdentifier)return e}));return n[r].checked=a,n}))}(e,a)},checked:a.checked}),r}},{title:"功能类型",dataIndex:"funcTypeCN",width:"140px",render:function(e,a,n){return Object(E.a)(t,"funcIdentifier",n,e,"funcTypeCN")}},{title:"功能点名称",dataIndex:"funcName",width:"140px",render:function(e,a,n){return Object(E.a)(t,"funcIdentifier",n,e,"funcName")}},{title:"标识符",dataIndex:"funcIdentifier",width:"140px",render:function(e,a,n){return Object(E.a)(t,"funcIdentifier",n,e,"funcIdentifier")}},{title:"参数名称",dataIndex:"name",width:"140px"},{title:"参数标识",dataIndex:"identifier",width:"140px"},{title:"数据传输类型",dataIndex:"accessMode",width:"140px",render:function(e,t){return"rw"===e?"可下发可上报":"w"===e?"可下发":"r"===e?"可上报":""}},{title:"数据类型",width:"100px",dataIndex:"dataType",render:function(e,t){return i.a.createElement("span",null,t.dataTypCN)}},{title:"数据属性",dataIndex:"propertyMap",render:function(e,t){return i.a.createElement("span",null,function(e){var t=null;switch(e.dataTypeEN){case"int":case"float":t="数值范围：".concat(e.propertyMap.min,"-").concat(e.propertyMap.max,",间距：").concat(e.propertyMap.interval,",倍数：").concat(e.propertyMap.multiple,",单位：").concat(e.propertyMap.unit);break;case"bool":t="0：".concat(e.propertyMap[0],",1：").concat(e.propertyMap[1]);break;case"enum":var a="";for(var n in e.propertyMap)a+=n+"："+e.propertyMap[n]+", ";t="枚举值：".concat(a);break;default:return""}return t}(t))}}];return i.a.createElement("div",null,i.a.createElement(b.a,{rowKey:"key",columns:S,dataSource:u,pagination:!1,scroll:{y:440}}))}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(Object(a),!0).forEach((function(t){C(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function C(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var k=p.a.Search;function P(e){var t=[];return e.forEach((function(e){e.funcParamList&&e.funcParamList.length&&e.funcParamList.forEach((function(a){var n=JSON.parse(JSON.stringify(e));t.push(T(T({},n),a))}))})),t.forEach((function(e,t){e.key=t})),t}function x(e){var t=e.isModalVisible,a=e.closeAdd,n=e.CancelAdd,r=JSON.parse(sessionStorage.getItem("productItem")),l=j(d.a.useForm(),1)[0],o=m.a.TabPane,p=s.a.Option,b=j(Object(c.useState)("1"),2),g=b[0],v=b[1],h=j(Object(c.useState)([]),2),E=h[0],O=h[1],I=j(Object(c.useState)([]),2),S=I[0],N=I[1],T=j(Object(c.useState)([]),2),C=T[0],x=T[1];Object(c.useEffect)((function(){var e;e={deviceTypeId:r.deviceTypeId,productId:r.productId,eq:!0},Object(f.c)(f.a.PhysicalModelList,e).then((function(e){O(P(e.data))})),function(){var e={productId:r.productId,eq:!0,deviceTypeId:14};Object(f.c)(f.a.PhysicalModelList,e).then((function(e){N(P(e.data))}))}(),Object(f.c)(f.a.getThirdCategory).then((function(e){x(e.data)}))}),[]);var F=j(Object(c.useState)([]),2),A=F[0],D=F[1],M=j(Object(c.useState)([]),2),V=M[0],L=M[1];return i.a.createElement("div",null,i.a.createElement(u.a,{title:"新增标准功能",visible:t,onOk:function(){A.length||V.length?"1"===g?Object(f.c)(f.a.addPhticalStard,A).then((function(e){a()})):Object(f.c)(f.a.addPhticalStard,V).then((function(e){a()})):Object(y.a)({description:"至少勾选一条数据",type:"warn"})},onCancel:n,width:"1300px",wrapClassName:"add-protocols-wrap"},i.a.createElement(m.a,{activeKey:g,onChange:function(e){v(e)}},i.a.createElement(o,{tab:"本品类",key:"1"},i.a.createElement("div",{className:"add-protocols-count"},"已选择".concat(A.length,"项")),i.a.createElement(w,{dataSource:E,refreshCount:function(e){D(e)}})),i.a.createElement(o,{tab:"其他品类",key:"2"},i.a.createElement("div",{className:"other-product-top"},i.a.createElement(d.a,{className:"device-filter-form",form:l,layout:"inline",initialValues:{proId:14}},i.a.createElement(d.a.Item,{name:"proId"},i.a.createElement(s.a,{style:{width:"200px"},placeholder:"选择产品",showSearch:!0,optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},C.map((function(e){return i.a.createElement(p,{value:e.deviceTypeId,key:e.deviceTypeId},e.deviceTypeName)})))),i.a.createElement(d.a.Item,{label:"",name:"name"},i.a.createElement(k,{onSearch:function(){var e={deviceTypeId:l.getFieldValue("proId"),eq:!0,productId:r.productId,funcName:l.getFieldValue("name")};Object(f.c)(f.a.PhysicalModelList,e).then((function(e){N(P(e.data))}))},style:{width:"465px"},placeholder:"输入功能点名称"})))),i.a.createElement("div",null,i.a.createElement(w,{dataSource:S,refreshCount:function(e){L(e)}}))))))}a("zKZe"),a("Y2jk");var F=a("zeV3"),A=(a("Re5i"),a("/wGt")),D=(a("K4yd"),a("9yH6")),M=(a("ls82"),a("JfAA"),a("qePV"),a("UxlC"),a("pDQq"),a("wlus")),V=a("xvlK"),L=(a("OXFO"),a("mU7p")),R=["key","name","fieldKey"];function q(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function K(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?q(Object(a),!0).forEach((function(t){z(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):q(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function z(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function U(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function H(e,t,a,n,r,c,i){try{var l=e[c](i),o=l.value}catch(e){return void a(e)}l.done?t(o):Promise.resolve(o).then(n,r)}function B(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var c=e.apply(t,a);function i(e){H(c,n,r,i,l,"next",e)}function l(e){H(c,n,r,i,l,"throw",e)}i(void 0)}))}}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return W(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return W(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var _=[{label:"属性",value:"properties"},{label:"事件",value:"events"},{label:"服务",value:"services"}],Z=[{value:"bool",label:"布尔型"},{value:"enum",label:"枚举型"},{value:"text",label:"字符型"},{value:"int",label:"整数型"},{value:"float",label:"浮点型"}],$=[{label:"故障",value:"fault"},{label:"告警",value:"alarm"},{label:"信息",value:"info"}],Y=0,Q=Object(c.createContext)(0);function X(e){var t=e.rightVisible,a=e.onCloseRight,r=e.onRefreshList,l=e.standardData,o=m.a.TabPane;Object(c.useEffect)((function(){}),[]);var u=Object(c.useMemo)((function(){return l.standard.concat(l.custom).filter((function(e){if("properties"===e.funcType)return e}))}),[]),s=G(Object(c.useState)("properties"),2),d=s[0],p=s[1],b=function(e){p(e.target.value)},g=Object(c.useRef)(),v=Object(c.useRef)(),h=Object(c.useRef)(),E=function(e){e.funcType=d,e.type="add";var t=JSON.parse(sessionStorage.getItem("productItem"));e.productId=t.productId,e.content.standard=!1,console.log(e,99999);var a={productId:t.productId,identifier:e.content.identifier};Object(f.c)(f.a.checkIdentifier,a,{loading:!0}).then((function(t){t.data?Object(y.a)({description:"标识符已存在",type:"warn"}):(e.content=JSON.stringify(e.content),function(e){Object(f.c)(f.a.PhysicalModelAction,e,{loading:!0}).then((function(e){Object(y.a)({description:"新增成功",type:"success"}),r()}))}(e))}))};return i.a.createElement(A.a,{title:"新增自定义功能",placement:"right",closable:!1,onClose:a,visible:t,destroyOnClose:!0,width:393,footer:i.a.createElement("div",{style:{textAlign:"right"}},i.a.createElement(n.a,{onClick:a,style:{marginRight:8}},"取消"),i.a.createElement(n.a,{onClick:function(){"properties"===d?g.current.onFinish():"events"===d?v.current.onFinish():"services"===d&&h.current.onFinish()},type:"primary"},"确定"))},i.a.createElement(Q.Provider,{value:u},i.a.createElement("div",{className:"edit-left-protocol-wrap"}," ",i.a.createElement(m.a,{activeKey:d,defaultActiveKey:"properties",renderTabBar:function(e,t){var a=[];return e.panes.forEach((function(e){a.push({key:e.key,title:e.props.tab})})),i.a.createElement("div",{className:"addcus-tab"}," ",i.a.createElement(D.a.Group,{buttonStyle:"solid",optionType:"button",value:d,onChange:b,options:_}))}},i.a.createElement(o,{tab:"Tab 1",key:"properties"},i.a.createElement(ee,{ref:g,currentTab:d,sentReq:E})),i.a.createElement(o,{tab:"Tab 2",key:"events"},i.a.createElement(te,{ref:v,sentReq:E,key:"events"})),i.a.createElement(o,{tab:"Tab 3",key:"services"},i.a.createElement(ae,{ref:h,sentReq:E}))))))}function ee(e,t){e.currentTab;var a=e.sentReq,r=G(d.a.useForm(),1)[0],l=function(){var e=B(regeneratorRuntime.mark((function e(){var t,n,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.validateFields();case 3:t=e.sent,t=JSON.parse(JSON.stringify(t)),(n={}).content={},"bool"===t.type?n.content=t:"enum"===t.type?(c=t.emusList.filter((function(e){if(e.key&&e.value)return e})),i=c.reduce((function(e,t){return e[t.key.toString()]=t.value,e}),{}),t.specs=i,n.content=t):"text"===t.type?n.content=t:"float"!==t.type&&"int"!==t.type||(n.content=t),"int"===t.type&&Number(n.content.specs.max)>Math.pow(2,31)-1&&(n.content.specs.unsigned=!0),n.content.dataType={type:n.content.type,specs:n.content.specs},delete n.content.type,delete n.content.specs,a(n),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.log("Validate Failed:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}();Object(c.useImperativeHandle)(t,(function(){return{onFinish:l}}));return i.a.createElement(d.a,{name:"numberT",labelCol:{span:8},wrapperCol:{span:16},form:r},i.a.createElement(d.a.Item,{label:"功能点名称",name:"name",rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{label:"标识符",name:"identifier",getValueFromEvent:function(e){return e.target.value.replace(/[\u4e00-\u9fa5]|(^\s+)|(\s+$)/gi,"")},rules:[{required:!0}]},i.a.createElement(p.a,{"οnkeyup":"value=value.replace(/[\\u4e00-\\u9fa5]|(^\\s+)|(\\s+$)/ig,'')"})),i.a.createElement(d.a.Item,{label:"数据类型",name:"type"},i.a.createElement(s.a,{onChange:function(e){console.log(e)}},Z.map((function(e){return i.a.createElement(s.a.Option,{key:e.value,value:e.value},e.label)})))),i.a.createElement(d.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.type!==t.type}},(function(e){var t=e.getFieldValue;return"bool"===t("type")?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"布尔值",rules:[{required:!0}]},i.a.createElement(d.a.Item,{name:["specs","0"],label:"0"},i.a.createElement(p.a,{placeholder:"参数描述"})),i.a.createElement(d.a.Item,{name:["specs","1"],label:"1"},i.a.createElement(p.a,{placeholder:"参数描述"})))):"enum"===t("type")?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"枚举型:",name:"enumus_text",className:"enums-lise-nobottom"},i.a.createElement("span",{style:{marginRight:"50px"}},"参数值"),"-",i.a.createElement("span",{style:{marginLeft:"30px"}},"参数描述")),i.a.createElement("div",{className:"right-list-wrap"},i.a.createElement(d.a.List,{name:"emusList"},(function(e,t){var a=t.add,r=t.remove;return i.a.createElement(i.a.Fragment,null,e.map((function(e){var t=e.key,a=e.name,n=e.fieldKey,c=U(e,R);return i.a.createElement(F.b,{key:t,style:{display:"flex",marginBottom:8},align:"baseline"},i.a.createElement(d.a.Item,J({},c,{name:[a,"key"],fieldKey:[n,"key"],className:"enums-lise-nobottom",noStyle:!0}),i.a.createElement(p.a,null)),i.a.createElement("span",null,"-"),i.a.createElement(d.a.Item,J({},c,{name:[a,"value"],fieldKey:[n,"value"],className:"enums-lise-nobottom",noStyle:!0}),i.a.createElement(p.a,null)),i.a.createElement(M.a,{onClick:function(){return r(a)}}))})),i.a.createElement(d.a.Item,null,i.a.createElement(n.a,{type:"dashed",onClick:function(){!function(e,t){t>39?Object(y.a)({description:"不能超过40条数据",type:"warn"}):e()}(a,e.length)},block:!0,icon:i.a.createElement(V.a,null)},"新加")))})))):"float"===t("type")||"int"===t("type")?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"数值范围"},i.a.createElement("div",{className:"number-input-wrap"},i.a.createElement(d.a.Item,{name:["specs","min"],noStyle:!0,rules:[{required:!0,message:"请输入最小值"}]},i.a.createElement(p.a,{style:{width:"40%"}})),i.a.createElement("span",{style:{margin:"0 10px"}},"至"),i.a.createElement(d.a.Item,{name:["specs","max"],noStyle:!0,rules:[{required:!0,message:"请输入最小值"}]},i.a.createElement(p.a,{style:{width:"40%"}})))),i.a.createElement(d.a.Item,{label:"数值间隔",name:["specs","interval"],rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{name:["specs","multiple"],label:"倍数",rules:[{required:!0}]},i.a.createElement(s.a,null,L.c.map((function(e){return i.a.createElement(s.a.Option,{value:e.value,key:e.value},e.label)})))),i.a.createElement(d.a.Item,{name:["specs","unit"],label:"单位",rules:[{required:!0}]},i.a.createElement(s.a,{showSearch:!0,optionFilterProp:"children"},L.h.map((function(e){return i.a.createElement(s.a.Option,{value:e.Symbol,key:e.Symbol},e.Symbol)}))))):null})),i.a.createElement(d.a.Item,{label:"数据传输类型",name:"accessMode",rules:[{required:!0,message:"请选择数据传输类型"}]},i.a.createElement(D.a.Group,null,i.a.createElement(D.a,{value:"rw"},"可下发可上报"),i.a.createElement(D.a,{value:"w"},"可下发"),i.a.createElement(D.a,{value:"r"},"可上报"))))}function te(e,t){e.currentTab;var a=e.sentReq,r=G(d.a.useForm(),1)[0],l=G(Object(c.useState)([]),2),o=l[0],u=l[1];function s(e,t){var a=h()(e);u((function(e){var n=h()(e);return n.splice(t.index,1,a),n}))}Object(c.useImperativeHandle)(t,(function(){return{onFinish:f}}),[o]);var m=function(e,t){u((function(t){var a=h()(t);return a=a.filter((function(t){if(t.unikey!=e)return t}))}))},f=function(){var e=B(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.validateFields().then((function(e){var t=h()(e),n={},r=[],c=[];0!==o.length?(h()(o).forEach((function(e){r.push(e.fn()),c.push(e.data)})),Promise.all(r).then((function(e){e.forEach((function(e,t){c[t].dataType.default=e.default})),t.outputData=re(c),n.content=t,a(n)})).catch((function(e){Object(y.a)({description:"添加参数有误",type:"warn"})}))):Object(y.a)({description:"至少添加一个参数",type:"warn"})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a,{name:"basic",labelCol:{span:8},wrapperCol:{span:16},form:r},i.a.createElement(d.a.Item,{label:"功能点名称",name:"name",rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{label:"标识符",name:"identifier",getValueFromEvent:function(e){return e.target.value.replace(/[\u4e00-\u9fa5]|(^\s+)|(\s+$)/gi,"")},rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{label:"事件类型",name:"type"},i.a.createElement(D.a.Group,{options:$})),i.a.createElement(d.a.Item,{label:"输出参数"},i.a.createElement(n.a,{type:"dashed",onClick:function(){Y++,u((function(e){var t=h()(e);return t.push({unikey:Y}),t}))},style:{width:"60%"},icon:i.a.createElement(V.a,null)},"添加参数"))),o.map((function(e,t){return i.a.createElement(ne,{sentAddData:s,delItemObj:m,refIndex:t,type:!0,unikey:e.unikey,key:e.unikey,data:e})})))}function ae(e,t){var a=e.sentReq,r=G(d.a.useForm(),1)[0],l=G(Object(c.useState)([]),2),o=l[0],u=l[1],s=G(Object(c.useState)([]),2),m=s[0],f=s[1],b=function(e){Y++,e?u((function(e){var t=h()(e);return t.push({unikey:Y}),t})):f((function(e){var t=h()(e);return t.push({unikey:Y}),t}))},g=function(e,t){t?u((function(t){var a=h()(t);return a=a.filter((function(t){if(t.unikey!=e)return t}))})):f((function(t){var a=h()(t);return a=a.filter((function(t){if(t.unikey!=e)return t}))}))},v=function(e,t){var a=h()(e);a.unikey=t.unikey,t.type?u((function(e){var n=h()(e);return n.splice(t.index,1,a),n})):f((function(e){var n=h()(e);return n.splice(t.index,1,a),n}))},E=function(){var e=B(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.validateFields().then((function(e){var t=h()(e),n={},r=[],c=[],i=o.concat(m);0!==i.length?(h()(i).forEach((function(e){r.push(e.fn()),c.push(e.data)})),Promise.all(r).then((function(e){e.forEach((function(e,t){c[t].dataType.default=e.default})),t.inputData=re(c.splice(0,o.length)),t.outputData=re(c),n.content=t,a(n)})).catch((function(e){Object(y.a)({description:"添加参数有误",type:"warn"})}))):Object(y.a)({description:"至少添加一个参数",type:"warn"})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useImperativeHandle)(t,(function(){return{onFinish:E}}),[m,o]),i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a,{labelCol:{span:8},wrapperCol:{span:16},form:r},i.a.createElement(d.a.Item,{label:"功能点名称",name:"name",rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{label:"标识符",name:"identifier",getValueFromEvent:function(e){return e.target.value.replace(/[\u4e00-\u9fa5]|(^\s+)|(\s+$)/gi,"")},rules:[{required:!0}]},i.a.createElement(p.a,null))),i.a.createElement(d.a,{labelCol:{span:8},wrapperCol:{span:16}},i.a.createElement(d.a.Item,{label:"输入参数"},i.a.createElement(n.a,{type:"dashed",onClick:function(){b(!0)},style:{width:"60%"},icon:i.a.createElement(V.a,null)},"添加参数"))),o.map((function(e,t){return i.a.createElement(ne,{sentAddData:v,delItemObj:g,refIndex:t,type:!0,unikey:e.unikey,key:e.unikey,data:e})})),i.a.createElement(d.a,{labelCol:{span:8},wrapperCol:{span:16}},i.a.createElement(d.a.Item,{label:"输出参数"},i.a.createElement(n.a,{type:"dashed",onClick:function(){b(!1)},style:{width:"60%"},icon:i.a.createElement(V.a,null)},"添加参数"))),m.map((function(e,t){return i.a.createElement(ne,{sentAddData:v,delItemObj:g,refIndex:t,type:!1,unikey:e.unikey,key:e.unikey,data:e})})))}function ne(e,t){var a=e.sentAddData,n=e.type,r=(e.data,e.refIndex),l=e.delItemObj,o=e.unikey,u=Object(c.useContext)(Q),m=G(d.a.useForm(),1)[0],f=G(Object(c.useState)({}),2),y=f[0],b=f[1],g=G(Object(c.useState)(0),2),v=g[0],h=g[1];Object(c.useEffect)((function(){E()}),[v]);var E=function(){var e={index:r,type:n,unikey:o};a({fn:m.validateFields,unikey:o,data:y},e)};return i.a.createElement("div",{className:"add-tempele-wrap add-params-wrap"},i.a.createElement(M.a,{onClick:function(){l(o,n)},className:"del-icon-params"}),i.a.createElement(d.a,{form:m,labelCol:{span:8},wrapperCol:{span:16}},i.a.createElement(d.a.Item,{label:"参数名称",name:"name",rules:[{required:!0}]},i.a.createElement(s.a,{onChange:function(e){h(e),m.setFieldsValue({default:""}),u.forEach((function(t){if(t.dataPointId==e){var a={dataType:K(K({},t.funcParamList[0]),{},{specs:t.funcParamList[0].propertyMap}),name:t.funcName,identifier:t.funcIdentifier,dataPointId:t.dataPointId};b(a)}}))}},u.map((function(e){return i.a.createElement(s.a.Option,{key:e.dataPointId,value:e.dataPointId},e.funcName)})))),y.identifier&&i.a.createElement("div",null,i.a.createElement(d.a.Item,{label:"标识符"},i.a.createElement("span",null,y.identifier)),i.a.createElement(d.a.Item,{label:"数据类型"},i.a.createElement("span",null,y.dataType.dataTypCN)),"数值"===y.dataType.dataTypCN?i.a.createElement(d.a.Item,{noStyle:!0},i.a.createElement(d.a.Item,{label:"数值范围"},i.a.createElement("div",{className:"number-input-wrap"},i.a.createElement(d.a.Item,{noStyle:!0},i.a.createElement("span",null,y.dataType.specs.min,"   至   ",y.dataType.specs.max)))),i.a.createElement(d.a.Item,{label:"默认值",name:"default",rules:[{validator:function(e,t){return t?t>=y.dataType.specs.min&&t<=y.dataType.specs.max?Promise.resolve():Promise.reject("默认值需在".concat(y.dataType.specs.min,"和").concat(y.dataType.specs.max,"之间")):Promise.resolve()}}]},i.a.createElement(p.a,{type:"number",placeholder:"可为空"})),i.a.createElement(d.a.Item,{label:"数值间隔"},i.a.createElement("span",null,y.dataType.specs.interval)),i.a.createElement(d.a.Item,{label:"倍数"},i.a.createElement("span",null,y.dataType.specs.multiple)),i.a.createElement(d.a.Item,{label:"单位"},i.a.createElement("span",null,y.dataType.specs.unit))):"布尔"===y.dataType.dataTypCN?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"布尔值"},i.a.createElement("span",null,"0："+y.dataType.specs[0]+" - 1："+y.dataType.specs[1])),i.a.createElement(d.a.Item,{label:"默认值",name:"default"},i.a.createElement(s.a,{allowClear:!0,placeholder:"可为空"},Object.keys(y.dataType.specs).map((function(e){return i.a.createElement(s.a.Option,{key:e,value:e},y.dataType.specs[e])}))))):"枚举"===y.dataType.dataTypCN?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"枚举型:",className:"enums-lise-nobottom"},i.a.createElement("span",{style:{marginRight:"5px"}},"参数值"),"-",i.a.createElement("span",{style:{marginLeft:"5px"}},"参数描述")),i.a.createElement("div",{className:"right-list-wrap",style:{marginBottom:"10px"}},Object.keys(y.dataType.specs).map((function(e){return i.a.createElement("div",{key:e,style:{display:"flex"}},i.a.createElement("div",{style:{width:"40px"}},e),i.a.createElement("span",{style:{marginRight:"10px"}},"-"),i.a.createElement("div",null,y.dataType.specs[e]))}))),i.a.createElement(d.a.Item,{label:"默认值",name:"default"},i.a.createElement(s.a,{allowClear:!0,placeholder:"可为空"},Object.keys(y.dataType.specs).map((function(e){return i.a.createElement(s.a.Option,{key:e,value:e},y.dataType.specs[e])}))))):"字符串"===y.dataType.dataTypCN?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"默认值",name:"default"},i.a.createElement(p.a,{placeholder:"可为空"}))):"",i.a.createElement(d.a.Item,{label:"数据传输类型"},(console.log(y,"==="),"rw"==y.dataType.accessMode?i.a.createElement("span",null,"可下发可上报"):"w"==y.dataType.accessMode?i.a.createElement("span",null,"可下发"):"r"==y.dataType.accessMode?i.a.createElement("span",null,"可上报"):"")))))}function re(e){var t=[],a=[];return e.forEach((function(e){if(e.identifier&&-1===a.indexOf(e.identifier)){a.push(e.identifier);var n={};n.name=e.name,n.identifier=e.identifier,n.dataPointId=e.dataPointId,n.accessMode=e.dataType.accessMode,n.dataType={type:e.dataType.dataTypeEN,specs:e.dataType.specs,default:e.dataType.default},t.push(n)}})),t}ee=Object(c.forwardRef)(ee),te=Object(c.forwardRef)(te),ae=Object(c.forwardRef)(ae);var ce=a("JzY+"),ie=a.n(ce),le=a("rwTb"),oe=a("FC04"),ue=["key","name","fieldKey"];function se(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function me(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?se(Object(a),!0).forEach((function(t){de(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):se(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function de(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function fe(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function ye(e,t,a,n,r,c,i){try{var l=e[c](i),o=l.value}catch(e){return void a(e)}l.done?t(o):Promise.resolve(o).then(n,r)}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ge(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ge(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var ve=[{value:"bool",label:"布尔型"},{value:"enum",label:"枚举型"},{value:"text",label:"字符型"},{value:"float",label:"浮点型"},{value:"int",label:"整数型"}],he=0,Ee=Object(c.createContext)(0),Oe=[{label:"故障",value:"fault"},{label:"告警",value:"alarm"},{label:"信息",value:"info"}];function Ie(e){var t=e.rightVisible,a=e.onCloseRight,r=e.onRefreshList,l=e.modelType,o=e.actionData,u=e.standardData,s=Object(c.useMemo)((function(){return("1"===l?u.standard:u.standard.concat(u.custom)).filter((function(e){if("properties"===e.funcType)return e}))}),[]),d=h()(o),p=m.a.TabPane;Object(c.useEffect)((function(){}),[]);var y=o.funcType,b=Object(c.useRef)(),g=Object(c.useRef)(),v=Object(c.useRef)(),E=function(e){e.funcType=y,e.type="update";var t=JSON.parse(sessionStorage.getItem("productItem"));e.productId=t.productId,e.content.standard=1==l,e.content=JSON.stringify(e.content),Object(f.c)(f.a.PhysicalModelAction,e,{loading:!0}).then((function(e){r()}))};return i.a.createElement(A.a,{title:"1"===l?"编辑标准功能":"编辑自定义功能",placement:"right",closable:!1,onClose:a,visible:t,destroyOnClose:!0,width:393,footer:i.a.createElement("div",{style:{textAlign:"right"}},i.a.createElement(n.a,{onClick:a,style:{marginRight:8}},"取消"),i.a.createElement(n.a,{onClick:function(){"properties"===y?b.current.onFinish():"events"===y?g.current.onFinish():"services"===y&&v.current.onFinish()},type:"primary"},"确定"))},i.a.createElement(Ee.Provider,{value:s},i.a.createElement("div",{className:"edit-left-protocol-wrap"}," ",i.a.createElement(m.a,{activeKey:y,defaultActiveKey:o.funcType,renderTabBar:function(e,t){return i.a.createElement("div",null)}},i.a.createElement(p,{tab:"Tab 1",key:"properties"},i.a.createElement(we,{ref:b,currentTab:y,sentReq:E,actionData:d,modelType:l})),i.a.createElement(p,{tab:"Tab 2",key:"events"},i.a.createElement(je,{ref:g,sentReq:E,key:"events",actionData:d,modelType:l})),i.a.createElement(p,{tab:"Tab 3",key:"services"},i.a.createElement(Se,{ref:v,sentReq:E,actionData:d,modelType:l}))))))}function we(e,t){e.currentTab;var a=e.sentReq,r=e.actionData,l=e.modelType,o=be(d.a.useForm(),1)[0],u=function(){var e,t=(e=regeneratorRuntime.mark((function e(){var t,n,r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.validateFields();case 3:t=e.sent,t=h()(t),(n={}).content={},"bool"===t.type?n.content=t:"enum"===t.type?(r=t.emusList.filter((function(e){if(e.key&&e.value)return e})),c=r.reduce((function(e,t){return e[t.key.toString()]=t.value,e}),{}),t.specs=c,n.content=t):"text"===t.type?n.content=t:"int"!==t.type&&"float"!==t.type||(n.content=t),"int"===t.type&&Number(n.content.specs.max)>Math.pow(2,31)-1&&(n.content.specs.unsigned=!0),n.content.dataType={type:n.content.type,specs:n.content.specs},delete n.content.type,delete n.content.specs,a(n),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.log("Validate Failed:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})),function(){var t=this,a=arguments;return new Promise((function(n,r){var c=e.apply(t,a);function i(e){ye(c,n,r,i,l,"next",e)}function l(e){ye(c,n,r,i,l,"throw",e)}i(void 0)}))});return function(){return t.apply(this,arguments)}}(),m=Object(c.useMemo)((function(){var e={};return e.name=r.funcName,e.identifier=r.funcIdentifier,e.type=r.dataTypeEN,r.funcParamList.forEach((function(t){if(e.accessMode=t.accessMode,"enum"===t.dataTypeEN){var a=[];for(var n in t.propertyMap)a.push({key:n,value:t.propertyMap[n]});e.emusList=a}else if("int"===t.dataTypeEN||"float"===t.dataTypeEN){var r={};["interval","min","max","multiple","unit"].forEach((function(e){r[e]=t.propertyMap[e]})),e.specs=r}else if("bool"===t.dataTypeEN){var c={1:t.propertyMap[1],0:t.propertyMap[0]};e.specs=c}})),e}),[]);Object(c.useImperativeHandle)(t,(function(){return{onFinish:u}}));return i.a.createElement(d.a,{labelCol:{span:8},wrapperCol:{span:16},form:o,initialValues:m},i.a.createElement(d.a.Item,{label:"功能点名称",name:"name",rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{label:"标识符",name:"identifier",getValueFromEvent:function(e){return e.target.value.replace(/[\u4e00-\u9fa5]|(^\s+)|(\s+$)/gi,"")},rules:[{required:!0}]},1==l?i.a.createElement("span",null,r.funcIdentifier):i.a.createElement(p.a,{disabled:!0})),i.a.createElement(d.a.Item,{label:"数据类型",name:"type"},i.a.createElement(s.a,{onChange:function(e){},disabled:"1"===l},ve.map((function(e){return i.a.createElement(s.a.Option,{key:e.value,value:e.value},e.label)})))),i.a.createElement(d.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.type!==t.type}},(function(e){var t=e.getFieldValue;return"bool"===t("type")?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"布尔值",rules:[{required:!0}]},i.a.createElement(d.a.Item,{name:["specs","0"],label:"0"},i.a.createElement(p.a,{placeholder:"参数描述"})),i.a.createElement(d.a.Item,{name:["specs","1"],label:"1"},i.a.createElement(p.a,{placeholder:"参数描述"})))):"enum"===t("type")?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"枚举型:",name:"enumus_text",className:"enums-lise-nobottom"},i.a.createElement("span",{style:{marginRight:"50px"}},"参数值"),"-",i.a.createElement("span",{style:{marginLeft:"30px"}},"参数描述")),i.a.createElement("div",{className:"right-list-wrap"},i.a.createElement(d.a.List,{name:"emusList"},(function(e,t){var a=t.add,r=t.remove;return i.a.createElement(i.a.Fragment,null,e.map((function(e){var t=e.key,a=e.name,n=e.fieldKey,c=fe(e,ue);return i.a.createElement(F.b,{key:t,style:{display:"flex",marginBottom:8},align:"baseline"},i.a.createElement(d.a.Item,pe({},c,{name:[a,"key"],fieldKey:[n,"key"],className:"enums-lise-nobottom",noStyle:!0}),i.a.createElement(p.a,null)),i.a.createElement("span",null,"-"),i.a.createElement(d.a.Item,pe({},c,{name:[a,"value"],fieldKey:[n,"value"],className:"enums-lise-nobottom",noStyle:!0}),i.a.createElement(p.a,null)),i.a.createElement(M.a,{onClick:function(){return r(a)}}))})),i.a.createElement(d.a.Item,null,i.a.createElement(n.a,{type:"dashed",onClick:function(){!function(e,t){t>39?Object(y.a)({description:"不能超过40条数据",type:"warn"}):e()}(a,e.length)},block:!0,icon:i.a.createElement(V.a,null)},"新加")))})))):"int"===t("type")||"float"===t("type")?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"数值范围"},i.a.createElement("div",{className:"number-input-wrap"},i.a.createElement(d.a.Item,{name:["specs","min"],noStyle:!0,rules:[{required:!0,message:"请输入最小值"}]},i.a.createElement(p.a,{style:{width:"40%"}})),i.a.createElement("span",{style:{margin:"0 10px"}},"至"),i.a.createElement(d.a.Item,{name:["specs","max"],noStyle:!0,rules:[{required:!0,message:"请输入最小值"}]},i.a.createElement(p.a,{style:{width:"40%"}})))),i.a.createElement(d.a.Item,{label:"数值间隔",name:["specs","interval"],rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{name:["specs","multiple"],label:"倍数"},i.a.createElement(s.a,null,L.c.map((function(e){return i.a.createElement(s.a.Option,{value:e.value,key:e.value},e.label)})))),i.a.createElement(d.a.Item,{name:["specs","unit"],label:"单位"},i.a.createElement(s.a,{showSearch:!0,optionFilterProp:"children"},L.h.map((function(e){return i.a.createElement(s.a.Option,{value:e.Symbol,key:e.Symbol},e.Symbol)}))))):null})),i.a.createElement(d.a.Item,{label:"数据传输类型",name:"accessMode"},i.a.createElement(D.a.Group,null,i.a.createElement(D.a,{value:"rw"},"可下发可上报"),i.a.createElement(D.a,{value:"w"},"可下发"),i.a.createElement(D.a,{value:"r"},"可上报"))))}function je(e,t){var a=e.actionData,r=e.sentReq,l=e.modelType,o=be(d.a.useForm(),1)[0],u=Object(c.useMemo)((function(){var e={output:[]};return a.funcParamList.forEach((function(t){console.log(t,"累了呀"),he++;var a={name:t.name,identifier:t.identifier,type:t.dataTypeEN,dataPointId:t.dataPointId,unikey:he,default:t.defaultValue};e.output.push(a)})),e}),[]),s=be(Object(c.useState)(u.output),2),m=s[0],f=s[1];function b(e,t){var a=h()(e);f((function(e){var n=h()(e);return n.splice(t.index,1,a),n}))}Object(c.useImperativeHandle)(t,(function(){return{onFinish:v}}),[m]);var g=function(e,t){f((function(t){var a=h()(t);return a.splice(e,1),a}))},v=function(){o.validateFields().then((function(e){var t=h()(e),a={},n=[],c=[];0!=m.length?m.every((function(e){if(e.fn)return!0}))?(h()(m).forEach((function(e){n.push(e.fn()),c.push(e.data)})),Promise.all(n).then((function(e){e.forEach((function(e,t){c[t].dataType.default=e.default})),t.outputData=Te(c),a.content=t,r(a)})).catch((function(e){Object(y.a)({description:"添加参数有误",type:"warn"})}))):Object(y.a)({description:"新增参数未选择参数名",type:"warn"}):Object(y.a)({description:"至少添加一个参数",type:"warn"})}))};return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a,{name:"basic",labelCol:{span:8},wrapperCol:{span:16},form:o,initialValues:{name:a.funcName,identifier:a.funcIdentifier,type:a.eventType}},i.a.createElement(d.a.Item,{label:"功能点名称",name:"name",rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{label:"标识符",name:"identifier",getValueFromEvent:function(e){return e.target.value.replace(/[\u4e00-\u9fa5]|(^\s+)|(\s+$)/gi,"")},rules:[{required:!0}]},1==l?i.a.createElement("span",null,a.funcIdentifier):i.a.createElement(p.a,{disabled:!0})),i.a.createElement(d.a.Item,{label:"事件类型",name:"type"},i.a.createElement(D.a.Group,{options:Oe})),i.a.createElement(d.a.Item,{label:"输出参数"},i.a.createElement(n.a,{type:"dashed",onClick:function(){he++,f((function(e){var t=h()(e);return t.push({unikey:he}),t}))},style:{width:"60%"},icon:i.a.createElement(V.a,null)},"添加参数"))),m.map((function(e,t){return i.a.createElement(Ne,{sentAddData:b,refIndex:t,type:!0,data:e,delItemObj:g,unikey:e.unikey,key:e.unikey})})))}function Se(e,t){var a=e.sentReq,r=e.actionData,l=e.modelType,o=be(d.a.useForm(),1)[0],u=Object(c.useMemo)((function(){var e={input:[],output:[]};return r.funcParamList.forEach((function(t){he++;var a={name:t.name,identifier:t.identifier,type:t.dataTypeEN,dataPointId:t.dataPointId,unikey:he,default:t.defaultValue};"输出"===t.type?e.output.push(a):e.input.push(a)})),e}),[]),s=be(Object(c.useState)(u.input),2),m=s[0],f=s[1],b=be(Object(c.useState)(u.output),2),g=b[0],v=b[1],E=function(e){he++,e?f((function(e){var t=h()(e);return t.push({unikey:he}),t})):v((function(e){var t=h()(e);return t.push({unikey:he}),t}))},O=function(e,t){var a=h()(e);a.unikey=t.unikey,t.type?f((function(e){var n=h()(e);return n.splice(t.index,1,a),n})):v((function(e){var n=h()(e);return n.splice(t.index,1,a),n}))},I=function(){o.validateFields().then((function(e){var t=h()(e),n={},r=[],c=[],i=m.concat(g);0!==i.length?i.every((function(e){if(e.fn)return!0}))?(h()(i).forEach((function(e){r.push(e.fn()),c.push(e.data)})),Promise.all(r).then((function(e){e.forEach((function(e,t){c[t].dataType.default=e.default})),t.inputData=Te(c.splice(0,m.length)),t.outputData=Te(c),n.content=t,a(n)})).catch((function(e){Object(y.a)({description:"添加参数有误",type:"warn"})}))):Object(y.a)({description:"新增参数未选择参数名",type:"warn"}):Object(y.a)({description:"至少添加一个参数",type:"warn"})}))},w=function(e,t){t?f((function(t){var a=h()(t);return a.splice(e,1),a})):v((function(t){var a=h()(t);return a.splice(e,1),a}))};return Object(c.useImperativeHandle)(t,(function(){return{onFinish:I}}),[m,g]),i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a,{labelCol:{span:8},wrapperCol:{span:16},form:o,initialValues:{name:r.funcName,identifier:r.funcIdentifier}},i.a.createElement(d.a.Item,{label:"功能点名称",name:"name",rules:[{required:!0}]},i.a.createElement(p.a,null)),i.a.createElement(d.a.Item,{label:"标识符",name:"identifier",getValueFromEvent:function(e){return e.target.value.replace(/[\u4e00-\u9fa5]|(^\s+)|(\s+$)/gi,"")},rules:[{required:!0}]},1==l?i.a.createElement("span",null,r.funcIdentifier):i.a.createElement(p.a,{disabled:!0}))),i.a.createElement(d.a,{labelCol:{span:8},wrapperCol:{span:16}},i.a.createElement(d.a.Item,{label:"输入参数"},i.a.createElement(n.a,{type:"dashed",onClick:function(){E(!0)},style:{width:"60%"},icon:i.a.createElement(V.a,null)},"添加参数"))),m.map((function(e,t){return i.a.createElement(Ne,{sentAddData:O,refIndex:t,type:!0,data:e,delItemObj:w,unikey:e.unikey,key:e.unikey})})),i.a.createElement(d.a,{labelCol:{span:8},wrapperCol:{span:16}},i.a.createElement(d.a.Item,{label:"输出参数"},i.a.createElement(n.a,{type:"dashed",onClick:function(){E(!1)},style:{width:"60%"},icon:i.a.createElement(V.a,null)},"添加参数"))),g.map((function(e,t){return i.a.createElement(Ne,{sentAddData:O,refIndex:t,type:!1,data:e,delItemObj:w,unikey:e.unikey,key:e.unikey})})))}function Ne(e,t){var a=e.sentAddData,n=e.type,r=e.data,l=e.refIndex,o=e.delItemObj,u=e.unikey,m=Object(c.useContext)(Ee),f=be(d.a.useForm(),1)[0],y=be(Object(c.useState)({}),2),b=y[0],g=y[1],v=be(Object(c.useState)(r.dataPointId),2),h=(v[0],v[1]);Object(c.useEffect)((function(){if(r.dataPointId){f.setFieldsValue({name:r.dataPointId});var e={isSet:!0,value:r.default};E(r.dataPointId,e)}}),[]);var E=function(e,t){t&&t.isSet?f.setFieldsValue({default:t.value}):f.setFieldsValue({default:""}),m.forEach((function(t){if(t.dataPointId===e){var r={dataType:me(me({},t.funcParamList[0]),{},{specs:t.funcParamList[0].propertyMap}),name:t.funcName,identifier:t.funcIdentifier,dataPointId:t.dataPointId},c={index:l,type:n,unikey:u};g(r),a({fn:f.validateFields,unikey:u,data:r},c)}})),h(e)};return i.a.createElement("div",{className:"add-tempele-wrap add-params-wrap"},i.a.createElement(M.a,{onClick:function(){o(l,n)},className:"del-icon-params"}),i.a.createElement(d.a,{form:f,labelCol:{span:8},wrapperCol:{span:16}},i.a.createElement(d.a.Item,{label:"参数名称",name:"name",rules:[{required:!0}]},i.a.createElement(s.a,{onChange:E},m.map((function(e){return i.a.createElement(s.a.Option,{key:e.dataPointId,value:e.dataPointId},e.funcName)})))),b.identifier&&i.a.createElement("div",null,i.a.createElement(d.a.Item,{label:"标识符"},i.a.createElement("span",null,b.identifier)),i.a.createElement(d.a.Item,{label:"数据类型",name:"type"},i.a.createElement("span",null,b.dataType.dataTypCN)),"数值"===b.dataType.dataTypCN?i.a.createElement(d.a.Item,{noStyle:!0},i.a.createElement(d.a.Item,{label:"数值范围"},i.a.createElement("div",{className:"number-input-wrap"},i.a.createElement(d.a.Item,{noStyle:!0},i.a.createElement("span",null,b.dataType.specs.min,"   至   ",b.dataType.specs.max)))),i.a.createElement(d.a.Item,{label:"默认值",name:"default",rules:[{validator:function(e,t){return t?t>=b.dataType.specs.min&&t<=b.dataType.specs.max?Promise.resolve():Promise.reject("默认值需在".concat(b.dataType.specs.min,"和").concat(b.dataType.specs.max,"之间")):Promise.resolve()}}]},i.a.createElement(p.a,{type:"number",placeholder:"可为空"})),i.a.createElement(d.a.Item,{label:"数值间隔",name:["specs","interval"]},i.a.createElement("span",null,b.dataType.specs.interval)),i.a.createElement(d.a.Item,{label:"倍数"},i.a.createElement("span",null,b.dataType.specs.multiple)),i.a.createElement(d.a.Item,{label:"单位"},i.a.createElement("span",null,b.dataType.specs.unit))):"布尔"===b.dataType.dataTypCN?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"布尔值"},i.a.createElement("span",null,"0："+b.dataType.specs[0]+" - 1："+b.dataType.specs[1])),i.a.createElement(d.a.Item,{label:"默认值",name:"default"},i.a.createElement(s.a,{allowClear:!0,placeholder:"可为空"},Object.keys(b.dataType.specs).map((function(e){return i.a.createElement(s.a.Option,{key:e,value:e},b.dataType.specs[e])}))))):"枚举"===b.dataType.dataTypCN?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"枚举型:",className:"enums-lise-nobottom"},i.a.createElement("span",{style:{marginRight:"5px"}},"参数值"),"-",i.a.createElement("span",{style:{marginLeft:"5px"}},"参数描述")),i.a.createElement("div",{className:"right-list-wrap",style:{marginBottom:"10px"}},Object.keys(b.dataType.specs).map((function(e){return i.a.createElement("div",{key:e,style:{display:"flex"}},i.a.createElement("div",{style:{width:"30px"}},e),i.a.createElement("span",{style:{marginRight:"10px"}},"-"),i.a.createElement("div",null,b.dataType.specs[e]))}))),i.a.createElement(d.a.Item,{label:"默认值",name:"default"},i.a.createElement(s.a,{allowClear:!0,placeholder:"可为空"},Object.keys(b.dataType.specs).map((function(e){return i.a.createElement(s.a.Option,{key:e,value:e},b.dataType.specs[e])}))))):"字符串"===b.dataType.dataTypCN?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a.Item,{label:"默认值",name:"default"},i.a.createElement(p.a,{placeholder:"可为空"}))):"",i.a.createElement(d.a.Item,{label:"数据传输类型"},"rw"===b.dataType.accessMode?i.a.createElement("span",null,"可下发可上报"):"w"===b.dataType.accessMode?i.a.createElement("span",null,"可下发"):"r"===b.dataType.accessMode?i.a.createElement("span",null,"可上报"):""))))}function Te(e){var t=[],a=[];return e.forEach((function(e){if(e.identifier&&-1===a.indexOf(e.identifier)){a.push(e.identifier);var n={};n.name=e.name,n.identifier=e.identifier,n.dataPointId=e.dataPointId,n.accessMode=e.dataType.accessMode,n.dataType={type:e.dataType.dataTypeEN,specs:e.dataType.specs,default:e.dataType.default},t.push(n)}})),t}function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ke(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ke(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Pe(e){var t=e.dataSource,a=e.reFreshData,r=e.type,l=e.standardData,o=e.bindTypeStr,u=Ce(Object(c.useState)({pageIndex:1,totalRows:0,pageRows:10}),2),s=u[0],m=u[1],d=Object(c.useMemo)((function(){var e=[];return t.forEach((function(t){e.indexOf(t.funcIdentifier)<0&&e.push(t.funcIdentifier)})),e}),[t]),p=Ce(Object(c.useState)(!1),2),g=p[0],v=p[1],h=Ce(Object(c.useState)({}),2),O=h[0],I=h[1],w=Ce(Object(c.useState)(!1),2),j=w[0],S=w[1],N=function(){var e=(s.pageIndex-1)*s.pageRows;return t.slice(e,e+10)},T=[{title:"功能类型",dataIndex:"funcTypeCN",width:"100px",render:function(e,t,a){return Object(E.a)(N(),"funcIdentifier",a,e,"funcTypeCN")}},{title:"功能点名称",dataIndex:"funcName",width:"130px",render:function(e,t,a){return Object(E.a)(N(),"funcIdentifier",a,e,"funcName")}},{title:"标识符",dataIndex:"funcIdentifier",width:"160px",render:function(e,t,a){return Object(E.a)(N(),"funcIdentifier",a,e,"funcIdentifier")}},{title:"DP ID",dataIndex:"dataPointId",width:"100px"},{title:"参数名称",dataIndex:"name",width:"140px",render:function(e,t){return e}},{title:"参数标识",dataIndex:"identifier",width:"160px"},{title:"数据传输类型",dataIndex:"accessMode",width:"240px",render:function(e,t){return"rw"==e?"可下发可上报":"w"==e?"可下发":"r"==e?"可上报":""}},{title:"数据类型",dataIndex:"dataType",width:"140px",render:function(e,t){return i.a.createElement("span",null,t.dataTypCN)}},{title:"数据属性",dataIndex:"propertyMap",width:"340px",render:function(e,t){return i.a.createElement("span",null,function(e){var t=null;switch(e.dataTypeEN){case"float":case"int":t="数值范围：".concat(e.propertyMap.min,"-").concat(e.propertyMap.max,",间距：").concat(e.propertyMap.interval,",倍数：").concat(e.propertyMap.multiple,",单位：").concat(e.propertyMap.unit);break;case"bool":t="0：".concat(e.propertyMap[0],",1：").concat(e.propertyMap[1]);break;case"enum":var a="";for(var n in e.propertyMap)a+=n+"："+e.propertyMap[n]+", ";t="枚举值：".concat(a);break;default:return""}return t}(t))}},{title:"zigbee描述",dataIndex:"desc",key:"desc",width:"120px"},{title:"操作",render:function(e,t,a){var r=Object(E.a)(N(),"funcIdentifier",a,t.funcIdentifier,"funcIdentifier");return r.children=i.a.createElement(F.b,{size:"middle"},i.a.createElement(n.a,{type:"link",onClick:function(){I(t),S(!0)}},"编辑"),i.a.createElement(n.a,{type:"link",onClick:function(){I(t),v(!0)}},"删除")),r}}];return i.a.createElement("div",null,i.a.createElement(b.a,{rowKey:"key",columns:-1!==o.indexOf("Zigbee")?T:T.filter((function(e){return"desc"!=e.dataIndex})),dataSource:t,locale:{emptyText:"1"===r?"暂无标准功能":"暂无自定义功能"},pagination:{defaultCurrent:1,current:s.pageIndex,onChange:function(e,t){t===s.pageRows?m((function(a){var n=JSON.parse(JSON.stringify(a));return Object.assign(n,{pageIndex:e,pageRows:t})})):m((function(e){var a=JSON.parse(JSON.stringify(e));return Object.assign(a,{pageIndex:1,pageRows:t})}))},pageSize:s.pageRows,total:s.totalRows,showQuickJumper:!1,pageSizeOptions:[10],showTotal:function(){return i.a.createElement("span",null,"共 ",i.a.createElement("a",null,d.length)," 条")}}}),j&&i.a.createElement(Ie,{rightVisible:j,onCloseRight:function(){S(!1)},onRefreshList:function(){S(!1),Object(y.a)({type:"success",description:"编辑成功！"}),a()},standardData:l,actionData:O,modelType:r}),g&&i.a.createElement(oe.a,{visible:g,modalOKHandle:function(){var e=JSON.stringify({identifier:O.funcIdentifier}),t={productId:JSON.parse(sessionStorage.getItem("productItem")).productId,type:"delete",content:e,funcType:O.funcType};Object(f.c)(f.a.PhysicalModelAction,t,{loading:!0}).then((function(e){Object(y.a)({type:"success",description:"删除成功！"}),v(!1),a()}))},modalCancelHandle:function(){v(!1)},targetName:O.funcName,title:"删除",descGray:!0,needWarnIcon:!0,descText:"确定删除此功能"}))}function xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fe(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Ae(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function De(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(a),!0).forEach((function(t){Me(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ae(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Me(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ve(e){var t=[];return e.forEach((function(e){e.funcParamList&&e.funcParamList.length&&e.funcParamList.forEach((function(a){var n=JSON.parse(JSON.stringify(e));t.push(De(De({},n),a))}))})),t.forEach((function(e,t){e.key=t})),t}function Le(e,t){var a=e.nextStep,r=e.productId,l=xe(Object(c.useState)([]),2),o=l[0],u=l[1],s=xe(Object(c.useState)([]),2),m=s[0],d=s[1],p=xe(Object(c.useState)({standard:[],custom:[]}),2),b=p[0],g=p[1],v=xe(Object(c.useState)(sessionStorage.getItem("productItem")?JSON.parse(sessionStorage.getItem("productItem")):{}),2),h=v[0],E=(v[1],xe(Object(c.useState)(!1),2)),O=E[0],I=E[1],w=function(){var e={deviceTypeId:h.deviceTypeId,productId:h.productId,eq:!0},t=[Object(f.c)(f.a.standardFnList,{productId:r}),Object(f.c)(f.a.PhysicalModelList,e,{loading:!0})];Promise.all(t).then((function(e){var t=Ve(e[0].data.standard),a=Ve(e[0].data.custom),n=Ve(e[1].data);d(t),u(a),g({standard:t.concat(n),custom:a}),!n.length||t.length||a.length||I(!0)}))};Object(c.useEffect)((function(){w()}),[]);var j=xe(Object(c.useState)(!1),2),S=j[0],N=j[1],T=function(){a()},C=Object(c.useRef)();Object(c.useImperativeHandle)(t,(function(){return{onFinish:T}}));return i.a.createElement("div",{className:"Protocol-wrap",ref:C},i.a.createElement("div",{className:"Protocol-label"},i.a.createElement("div",null,"MCU方案"===h.schemeName?"独立MCU方案，需选择下载MCU开发资料包等，进行相应开发":"SoC方案"===h.schemeName?"SoC方案，不提供通用固件程序，需自行开发模组固件":"免开发方案"===h.schemeName?"免开发方案，只需选择推荐模组以及配置固件信息，快速实现硬件智能化":h.schemeName),i.a.createElement("div",{className:"Protocol-download",onClick:function(){var e=f.a.downPhysicalModel+"?productId="+r;window.open(e)}},i.a.createElement("a",null,"导出物模型（json）"),i.a.createElement("img",{src:ie.a,alt:""}))),i.a.createElement("div",{className:"Protocol-download"},i.a.createElement("div",null,"标准功能",i.a.createElement(le.a,{tip:"支持用户编辑修改功能点名称以及数值范围，但是不能修改功能点的数据标识、数据类型，数据传输类型。"})),i.a.createElement(n.a,{type:"primary",onClick:function(){I(!0)}},"新建标准功能")),i.a.createElement("div",{className:"Protocol-table"},i.a.createElement(Pe,{dataSource:m,standardData:b,reFreshData:w,type:"1",bindTypeStr:h.bindTypeStr})),i.a.createElement("div",{className:"Protocol-download"},i.a.createElement("div",null,"自定义功能",i.a.createElement(le.a,{tip:"支持在标准功能的基础上，自定义适合客户自己硬件特色的定制功能点。"})),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement(n.a,{type:"primary",onClick:function(){N(!0)}},"新建自定义功能"))),i.a.createElement("div",null,i.a.createElement(Pe,{dataSource:o,reFreshData:w,type:"2",standardData:b,bindTypeStr:h.bindTypeStr})),S&&i.a.createElement(X,{standardData:b,rightVisible:S,onCloseRight:function(){N(!1)},onRefreshList:function(){N(!1),Object(y.a)({type:"success",description:"新增成功！"}),w()}}),O&&i.a.createElement(x,{closeAdd:function(){I(!1),Object(y.a)({type:"success",description:"新增成功！"}),w()},CancelAdd:function(){I(!1)},isModalVisible:O}))}we=Object(c.forwardRef)(we),je=Object(c.forwardRef)(je),Se=Object(c.forwardRef)(Se);var Re=Object(c.forwardRef)(Le),qe=a("MeRu"),Ke=(a("vAZS"),a("ECub")),ze=(a("oVuX"),a("NBAS"),a("SuFq"),a("X72a"));a("ShEY");function Je(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ue(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(a),!0).forEach((function(t){He(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Je(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function He(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ge(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ge(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var We=p.a.Search;var _e=function(e){var t=e.title,a=e.desc,n=void 0===a?"":a,r=e.opeType,l=e.replaceModalVisible,o=e.handleOk,s=e.handleCancel,m=e.schemeId,d=e.moduleId,p=e.productId,g=e.firmwareId,v=Be(Object(c.useState)(""),2),h=v[0],E=v[1],O=Be(Object(c.useState)([]),2),I=O[0],w=O[1],j=Be(Object(c.useState)(["module"===r?d:g]),2),S=j[0],N=j[1],T=(Be(Object(c.useState)(JSON.parse(sessionStorage.getItem("productItem"))||{}),1)[0],[{title:"模组",dataIndex:"moduleName"},{title:"芯片",dataIndex:"originalModuleTypeName"},{title:"尺寸",key:"",render:function(e,t){return i.a.createElement("div",null,i.a.createElement("span",null,t.sizeThickness,"x",t.sizeWidth,"x",t.sizeHeight))}},{title:"适用说明",dataIndex:"applyScope"},{title:"调试价格",dataIndex:"price"},{title:"操作",dataIndex:"",render:function(e,t){return i.a.createElement("a",{onClick:function(){return C(t.readmePdf)}},"说明书")}}]),C=function(e){e?window.open(e):alert("暂无数据！")},k={onChange:function(e,t){N(e)}},P=function(){"module"===r&&Object(f.c)(f.a.replaceModuleList,{schemeId:m,moduleName:h,productId:p},{loading:!0}).then((function(e){w(e.data)})),"firmware"===r&&Object(f.c)(f.a.getDevFirmwareList,{moduleId:d,burnFileName:h}).then((function(e){w(e.data)}))};return Object(c.useEffect)((function(){P()}),[h]),i.a.createElement(u.a,{title:t,visible:l,onOk:function(){return"module"===r&&o(S),void("firmware"===r&&Object(f.c)(f.a.saveChooseFirmware,{productId:p,firmwareId:Number(S.join(""))}).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),o(S)})))},onCancel:function(){return s(r)},maskClosable:!1,width:1e3,wrapClassName:"replace-module-modal"},n&&i.a.createElement("div",{className:"replace-firmware-desc"},n),i.a.createElement(We,{className:"search-input",placeholder:"module"===r?"输入模组名称":"请输入固件名称",allowClear:!0,onSearch:function(e){return E(e)},style:{width:674}}),i.a.createElement(b.a,{rowSelection:Ue({type:"radio",selectedRowKeys:S},k),rowKey:"module"===r?"moduleId":"id",columns:"module"===r?T:[{title:"固件名称",dataIndex:"burnFileName"},{title:"版本",dataIndex:"burnFileVersion"}],dataSource:I,pagination:!1}))};a("TWNs"),a("wkzE");function Ze(){return(Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function $e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ye(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(a),!0).forEach((function(t){Qe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$e(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Qe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return et(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return et(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var tt=function(e){var t=e.freeApplyVisible,a=e.handleFreeApply,n=e.handleCancel,r=e.type,l=e.moduleName,o=e.firmwareName,s=JSON.parse(sessionStorage.getItem("productItem"))||{},m=Xe(d.a.useForm(),1)[0],b=Xe(Object(c.useState)({}),2),g=b[0],v=b[1];return Object(c.useEffect)((function(){Object(f.c)(f.a.showFirmware,{productId:s.productId}).then((function(e){v(e.data)}))}),[]),i.a.createElement(u.a,{title:"免费申请",visible:t,onOk:function(){m.submit()},onCancel:n,maskClosable:!1,destroyOnClose:!0,width:857,wrapClassName:"replace-module-modal free-apply-modal"},i.a.createElement("div",{className:"free-apply-modal-top"},i.a.createElement("div",{className:"confirm-tip"},"请确认以下信息："),i.a.createElement("div",{className:"f-module-box"},i.a.createElement("div",{className:"f-module-title"},"模组名称：",l||"-"),i.a.createElement("div",{className:"pad22"},i.a.createElement("div",{className:"firmware-msg"},"固件信息"),i.a.createElement("div",null,i.a.createElement(d.a,{labelAlign:"left"},i.a.createElement(d.a.Item,{label:"固件名称/固件Key",className:"txt-color"},g.burnFileName||"-"),i.a.createElement(d.a.Item,{label:"固件版本",className:"txt-color"},g.burnFileVersion||"-"),1==JSON.parse(sessionStorage.getItem("productItem")).schemeType&&g.firmwareModuleList&&g.firmwareModuleList.map((function(e){return e.firmwareFuncList&&e.firmwareFuncList.map((function(e,t){return i.a.createElement(i.a.Fragment,null,"int"===e.dataType.type&&i.a.createElement(d.a.Item,{key:e.funcName,label:e.funcName,className:"txt-color"},e.dataType.specs.defaultValue),"enum"===e.dataType.type&&i.a.createElement(d.a.Item,{key:e.funcName,label:e.funcName,className:"txt-color"},e.dataType.specs.defaultValue[0].k))}))}))))))),i.a.createElement("div",{className:"free-apply-modal-form"},i.a.createElement(d.a,Ze({},{labelCol:{md:{span:3}},wrapperCol:{md:{span:8}}},{form:m,name:"freeApply-form",onFinish:function(e){var t={type:r,moduleName:l,firmwareName:o,productName:s.productName,schemeType:s.schemeType,productId:s.productId};Object(f.c)(f.a.freeApplyModule,Ye(Ye({},t),e),{loading:!0}).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),a()}))}}),i.a.createElement(d.a.Item,{name:"account",label:"产品联系人",rules:[{required:!0,message:"请输入联系人名称"}]},i.a.createElement(p.a,{maxLength:50,placeholder:"请输入联系人名称"})),i.a.createElement(d.a.Item,{name:"tel",label:"联系方式",rules:[{required:!0,pattern:/^(((\d{3,4}-)?\d{7,8})|(1\d{10}))$/,message:"请输入联系方式"}]},i.a.createElement(p.a,{placeholder:"请输入联系方式"})),i.a.createElement(d.a.Item,{name:"address",label:"邮寄地址",rules:[{required:!0,message:"请输入联系邮寄地址"}]},i.a.createElement(p.a,{maxLength:50,placeholder:"请输入联系邮寄地址"})),i.a.createElement(d.a.Item,{name:"num",label:"申请数量",rules:[{required:!0,pattern:new RegExp(/^[0-9]+$/,"g"),message:"请输入申请数量，仅支持数字"}]},i.a.createElement(p.a,{placeholder:"请输入申请数量"})),1==s.schemeType&&i.a.createElement("div",{className:"tip-msg"},"免开发方案，请务必详细填写，以方便邮寄调试模组等物料。"))))},at=(a("QCje"),a("fyUT"));a("B6y2"),a("EnZy"),a("/DsP");function nt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function rt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ct(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return it(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return it(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var lt=s.a.Option;function ot(e){var t=e.modifyFirmwareVisible,a=e.handleCancelFirmware,n=e.firmwareId,r=e.productId,l=e.handleOk,o=e.moduleName,m=ct(d.a.useForm(),1)[0],b=ct(Object(c.useState)({}),2),g=b[0],v=b[1],E=ct(Object(c.useState)([]),2),O=E[0],I=E[1],w=ct(Object(c.useState)(JSON.parse(sessionStorage.getItem("productItem"))||{}),1)[0];Object(c.useEffect)((function(){Object(f.c)(f.a.modifyFirmware,{productId:r}).then((function(e){e.data.firmwareModuleList.forEach((function(e){e.firmwareFuncList.forEach((function(e){"int"===e.dataType.type&&m.setFieldsValue(rt({},"".concat(e.funcModule,"#").concat(e.identifier),e.dataType.specs.value||e.dataType.specs.defaultValue)),"enum"===e.dataType.type&&(m.setFieldsValue(rt({},"".concat(e.funcModule,"#").concat(e.identifier),e.dataType.specs.value||e.dataType.specs.defaultValue[0].k)),I((function(t){var a=h()(t);return a.push(e.dataType.specs.value||e.dataType.specs.defaultValue[0].k),a})))}))})),v(e.data)}))}),[]);return i.a.createElement(u.a,{title:"修改固件",visible:t,onOk:function(){m.submit()},onCancel:a,maskClosable:!1,destroyOnClose:!0,width:857,okText:"重新生成固件",wrapClassName:"replace-module-modal"},i.a.createElement("div",{className:"modify-firmware-modal"},i.a.createElement("div",{className:"modify-firmware-modal-left"},i.a.createElement(d.a,{form:m,onFinish:function(e){var t=Object.keys(e),a=Object.values(e),c=t.map((function(e,t){return{funcModule:e.split("#")[0],identifier:e.split("#")[1],value:a[t]}})),i={productId:r,id:n,firmwareConfigReqList:c,moduleName:o,schemeId:w.schemeId,productName:w.productName};console.log("提交的数据",i),Object(f.c)(f.a.saveFirmwareSetting,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(a),!0).forEach((function(t){rt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},i)).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),l()}))},labelCol:{span:8},wrapperCol:{span:15},name:"modify-firmware-form",initialValues:{}},g.firmwareModuleList&&g.firmwareModuleList.map((function(e){return i.a.createElement(i.a.Fragment,{key:e.funcModule},i.a.createElement("div",{className:"modify-firmware-title"},e.funcModule),e.firmwareFuncList&&e.firmwareFuncList.map((function(e,t){return i.a.createElement(i.a.Fragment,{key:e.identifier},"int"===e.dataType.type&&i.a.createElement(d.a.Item,{label:e.funcName,name:"".concat(e.funcModule,"#").concat(e.identifier),key:e.identifier,rules:[{required:!0,message:"请输入".concat(e.funcName)}]},i.a.createElement(at.a,{className:"input-number",min:e.dataType.specs.min,max:e.dataType.specs.max})),"enum"===e.dataType.type&&i.a.createElement("div",{className:"parent-item"},i.a.createElement(d.a.Item,{label:e.funcName,name:"".concat(e.funcModule,"#").concat(e.identifier),key:e.identifier,wrapperCol:{span:10},rules:[{required:!0,message:"选择".concat(e.funcName)}]},i.a.createElement(s.a,{onChange:function(e){!function(e,t){var a=h()(O);a[t]=e,I(a)}(e,t)},allowClear:!0},e.dataType.specs.def&&e.dataType.specs.def.map((function(e){return i.a.createElement(lt,{key:e.k,value:e.k},e.v)})))),i.a.createElement(p.a,{className:"son-item",key:e,value:O[t],disabled:!0,style:{width:100}})))})))})))),i.a.createElement("div",{className:"modify-firmware-modal-right"},i.a.createElement("img",{src:g.pinDiagram,alt:""}))))}var ut=a("MPE6"),st=a.n(ut);a("N20j");function mt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function dt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(a),!0).forEach((function(t){pt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function pt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var bt=s.a.Option;var gt=function(e){var t=e.visible,a=e.handleOk,n=e.handleCancel,r=e.networkWayList,l=e.protocolList,o=e.productId,m=e.schemeInfo,p=void 0===m?{}:m,b=ft(d.a.useForm(),1)[0],v=ft(Object(c.useState)([]),2),E=v[0],O=v[1],I=ft(Object(c.useState)([]),2),w=I[0],j=I[1],S=function(e){var t=[];h()(r).forEach((function(a){e.forEach((function(e){e==a.txfs&&t.push(a.pwfs)}))})),O(function(e){for(var t={},a=[],n=0;n<e.length;n++)t[e[n].netTypeId]||(t[e[n].netTypeId]=1,a.push(e[n]));return a}(function e(t){return t.reduce((function(t,a){return t.concat(Array.isArray(a)?e(a):a)}),[])}(t)))};return Object(c.useEffect)((function(){var e=p.communicationModeList&&p.communicationModeList.map((function(e){return"".concat(e.bindType,"#").concat(e.bindTypeVersion)}));b.setFieldsValue({communicationModeList:e}),p.communicationModeList&&S(p.communicationModeList.map((function(e){return e.bindType}))),1!=p.schemeType&&(1==p.productClassId&&Object(f.b)(f.a.subGateWayList).then((function(e){console.log("adadsa",e),j(e.data)})),b.setFieldsValue({schemeType:p.schemeType}))}),[p]),i.a.createElement(u.a,{title:"更改开发方案",visible:t,onOk:function(){b.submit()},onCancel:n,maskClosable:!1,destroyOnClose:!0,width:857,wrapClassName:"replace-module-modal config-communication-modal"},i.a.createElement(d.a,{form:b,onFinish:function(e){var t=dt({productId:o},e);t.communicationModeList=e.communicationModeList.map((function(e){return{bindType:Number(e.split("#")[0]),bindTypeVersion:Number(e.split("#")[1])}})),t.schemeType=e.schemeType||1,console.log(t,"保存提交的数据"),Object(f.c)(f.a.saveCommunication,t,{loading:!0}).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),a(e.data,dt({},t))}))},labelCol:{span:4},wrapperCol:{span:16},style:{minHeight:250}},i.a.createElement(d.a.Item,{name:"communicationModeList",label:"云端通信方式",rules:[{required:!0,message:"请选择云端通信方式"}]},i.a.createElement(g.a.Group,{onChange:function(e){return function(e){b.setFieldsValue({netTypeId:""});var t=[];e.forEach((function(e){t.push(e.split("#")[0])})),S(t)}(e)},className:"radio-group"},l&&l.map((function(e){return i.a.createElement(g.a,{value:"".concat(e.bindTypeId,"#").concat(e.bindTypeVersion),key:"".concat(e.bindTypeId,"#").concat(e.bindTypeVersion),style:{marginBottom:8}},e.bindTypeName)})))),i.a.createElement(d.a.Item,{label:"配网方式",name:"netTypeId",initialValue:p.netTypeId||"",wrapperCol:{span:15},rules:[{required:!0,message:"请选择配网方式"}]},i.a.createElement(s.a,null,E&&E.map((function(e){return i.a.createElement(bt,{key:e.netTypeId,value:e.netTypeId},e.baseTypeName)})))),1!=p.schemeType&&i.a.createElement(i.a.Fragment,null,0==p.productClassId&&i.a.createElement(d.a.Item,{label:"是否是子设备",name:"isRelatedGateway",initialValue:p.isRelatedGateway,rules:[{required:!0,message:"请选择是否是子设备"}]},i.a.createElement(D.a.Group,{onChange:function(e){console.log("radio checked",e.target.value)}},i.a.createElement(D.a,{value:1},"是"),i.a.createElement(D.a,{value:0},"否"))),1==p.productClassId&&i.a.createElement(d.a.Item,{name:"gatewayCommTypeList",label:"子设备通信方式",initialValue:p.gatewayCommTypeList||[],rules:[{required:!0,message:"请选择子设备通信方式"}]},i.a.createElement(g.a.Group,{className:"radio-group"},w.map((function(e,t){return i.a.createElement(g.a,{value:e.baseTypeId,key:e.baseTypeId,style:{marginBottom:8}},e.baseTypeName)})))),i.a.createElement(d.a.Item,{label:"开发方案",name:"schemeType",initialValue:p.schemeType||"",rules:[{required:!0,message:"请选择开发方案"}]},i.a.createElement(D.a.Group,{className:"scheme-choose"},i.a.createElement(F.b,{direction:"vertical"},i.a.createElement(D.a,{value:3},"SoC方案（使用C-Life模组SDK）"),i.a.createElement(D.a,{value:2},"独立MCU方案（已有MCU，使用C-Llife模组+MCU SDK）")))))))},vt=a("dL2e"),ht=a("/MKj");a("C8h6");function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function It(e,t){return(It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=St(e);if(t){var r=St(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return jt(this,a)}}function jt(e,t){if(t&&("object"===Et(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Nt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(l,e);var t,n,r,c=wt(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=c.call(this,e)).getMoudleInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(f.c)(f.a.getMoudleInfo,{productId:t.props.productId,moduleId:e},{loading:!0}).then((function(e){if(t.setState({allInfo:e.data}),t.downloadData(e.data.moduleId),e.data.firmwareDefList){t.setState({dataSource:e.data.firmwareDefList}),t.setState({currentModuleId:e.data.moduleId});var a=JSON.parse(sessionStorage.getItem("productItem"))||{};a.moduleId=e.data.moduleId,t.setState({productItemData:a}),sessionStorage.setItem("productItem",JSON.stringify(a))}}))},t.onFinish=function(){if(-1==t.state.productItemData.moduleId)return Object(y.a)({type:"warn",description:"请更改配置通信协议"});t.props.nextStep()},t.modifyFirmware=function(e,a){console.log(e,"-----"),t.setState({firmwareId:e},(function(){t.setState({modifyFirmwareVisible:!0})}))},t.goReplaceFirmware=function(e){t.setState({firmwareId:e},(function(){t.setState({replaceFirmwareVisible:!0})}))},t.handleModalOk=function(e,a){console.log("确定选中的id",e),"module"===a?(t.getMoudleInfo(e.join("")),t.setState({replaceModalVisible:!1})):"firmware"===a&&(-1!=t.state.productItemData.moduleId&&t.getMoudleInfo(t.state.productItemData.moduleId),t.setState({replaceFirmwareVisible:!1}))},t.handleModalCancel=function(e){"module"===e?t.setState({replaceModalVisible:!1}):"firmware"===e&&t.setState({replaceFirmwareVisible:!1})},t.downInstructions=function(e){e?window.open(e):alert("暂无数据！")},t.getSchemeType=function(){return t.state.productItemData.schemeType?L.e[t.state.productItemData.schemeType]:""},t.downloadData=function(e){if(!e)return t.setState({downloadInfo:{}});Object(f.c)(f.a.downloadHardWareData,{productId:t.props.productId,moduleId:e}).then((function(e){console.log(e),0===e.code&&t.setState({downloadInfo:e.data})}))},t.getCommunicationProtocol=function(){Object(f.c)(f.a.getCommunicationProtocol,{}).then((function(e){t.setState({protocolList:e.data})}))},t.getChangeScheme=function(){Object(f.c)(f.a.changeScheme,{productId:t.props.productId}).then((function(e){console.log(e),t.setState({schemeInfo:e.data})}))},t.getBindTypeNetworkType=function(){Object(f.b)(f.a.getBindTypeNetworkTypeMap,{}).then((function(e){t.setState({networkWayList:e.data})}))},t.handleCommunicationOk=function(e,a){console.log(a);var n=JSON.parse(sessionStorage.getItem("productItem"))||{};n.moduleId=e.moduleId,n.netTypeId=a.netTypeId,n.schemeType=a.schemeType,sessionStorage.setItem("productItem",JSON.stringify(n)),t.getMoudleInfo(e.moduleId),t.getChangeScheme(),t.setState({configCommunicationVisible:!1}),t.props.getHeadInfoAction(t.props.productId),t.getSchemeType()},t.state={replaceModalVisible:!1,freeApplyVisible:!1,modifyFirmwareVisible:!1,replaceFirmwareVisible:!1,dataSource:[],allInfo:{},currentModuleId:"",firmwareId:"",productItemData:JSON.parse(sessionStorage.getItem("productItem"))||{},officeVis:!1,configCommunicationVisible:JSON.parse(sessionStorage.getItem("productItem"))&&-1==JSON.parse(sessionStorage.getItem("productItem")).moduleId,protocolList:[],networkWayList:[],downloadInfo:{},schemeInfo:{}},t.columns=[{title:"固件名称/固件Key",dataIndex:"burnFileName"},{title:"关联硬件",dataIndex:"moduleName"},{title:"芯片平台",dataIndex:"originalModuleTypeName"},{title:"固件类型",dataIndex:"type"},{title:"当前版本",dataIndex:"burnFileVersion"},{title:"操作",render:function(e,a,n){return 1===t.state.productItemData.schemeType?i.a.createElement("div",{className:"table-operation",onClick:function(e){return t.modifyFirmware(a.id,e)}},"修改固件"):2===t.state.productItemData.schemeType?i.a.createElement("div",{className:"table-operation",onClick:function(e){return t.goReplaceFirmware(a.id,e)}},"更换固件"):void 0}}],t}return t=l,(n=[{key:"componentDidMount",value:function(){this.getCommunicationProtocol(),this.getBindTypeNetworkType(),this.getChangeScheme(),-1!=this.state.productItemData.moduleId&&this.getMoudleInfo(this.state.productItemData.moduleId)}},{key:"render",value:function(){var e=this,t=this.state,n=t.replaceModalVisible,r=t.freeApplyVisible,c=t.modifyFirmwareVisible,l=t.replaceFirmwareVisible,o=t.dataSource,s=t.allInfo,m=t.currentModuleId,d=t.firmwareId,p=t.productItemData,f=t.officeVis,y=t.configCommunicationVisible,g=t.protocolList,v=t.networkWayList,h=t.downloadInfo,E=t.schemeInfo;return i.a.createElement("div",{className:"hardware-page"},i.a.createElement("div",{className:"hardware-wrap"},i.a.createElement("div",{className:"desc"},this.getSchemeType(),i.a.createElement("a",{onClick:function(){return e.setState({configCommunicationVisible:!0})}},"更改方案")),i.a.createElement("div",{className:"module-box"},i.a.createElement("div",{className:"module-header"},i.a.createElement("div",{className:"module-tip"},"已选模组"),i.a.createElement("div",{className:"replace-btn",onClick:function(){return e.setState({replaceModalVisible:!0})}},"更换模组")),-1==p.moduleId&&i.a.createElement("div",{className:"flex-c border",style:{margin:"18px 0"}},i.a.createElement(Ke.a,null)),-1!=p.moduleId&&i.a.createElement("div",{className:"module-cont"},i.a.createElement("div",{className:"flex-s"},i.a.createElement("div",{className:"module-cont-left"},i.a.createElement("img",{src:s.modulePicture||a("jt+J"),alt:""})),i.a.createElement("div",{className:"module-cont-right"},i.a.createElement("div",{className:"module-title"},s.moduleName||"-"),i.a.createElement("div",{className:"flex"},i.a.createElement("div",{className:"desc-item"},i.a.createElement("span",{className:"desc-item-title"},"芯片："),s.originalModuleTypeName||"-"),i.a.createElement("div",{className:"desc-item"},i.a.createElement("span",{className:"desc-item-title"},"尺寸："),s.sizeThickness,"x",s.sizeWidth,"x",s.sizeHeight),i.a.createElement("div",{className:"desc-item"},i.a.createElement("span",{className:"desc-item-title"},"适用："),s.applyScope||"-")),i.a.createElement("div",{className:"desc-item"},i.a.createElement("span",{className:"desc-item-title"},"特性："),"1.配网方式: ",s.netTypeName||"-","； 2.支持协议: ",s.bindTypeName||"-","； 3.通信通讯速率: ",s.communicateSpeed||"-","bps； 4.是否支持文件传输: ",0===s.supportFileTransfer?"否":"是"),i.a.createElement("div",{className:"more",onClick:function(){return e.downInstructions(s.readmePdf)}},"说明书",i.a.createElement(ze.a,null)))),i.a.createElement("div",{className:"module-right-box"},s.price&&i.a.createElement("div",{className:"price"},"¥",s.price,"/个"),i.a.createElement("div",{className:"apply-btn",onClick:function(){e.setState({freeApplyVisible:!0})}},"免费申请")))),i.a.createElement("div",{className:"module-box"},i.a.createElement("div",{className:"module-tip mar-t-b"},"已生成固件"),3!=p.schemeType&&s.firmwareDefList&&i.a.createElement(b.a,{rowKey:"id",columns:this.columns,dataSource:o,pagination:!1,size:"small"}),3==p.schemeType&&i.a.createElement("div",{className:"no-match-firmware"},i.a.createElement("div",{className:"no-match-firmware-img"},i.a.createElement("img",{src:a("e35r"),alt:""})),i.a.createElement("div",{className:"no-match-firmware-tip"},"您选择的模组暂无通用固件程序，请自行开发模组固件。"))),i.a.createElement("div",{className:"module-box"},i.a.createElement("div",{className:"module-tip mar30"},"开发调试"),i.a.createElement("div",{className:"debug"},i.a.createElement("div",{className:"flex-c"},i.a.createElement("img",{className:"debug-icon",src:a("idcQ"),alt:""}),1===p.schemeType&&i.a.createElement("div",null,"设计PCB"),2===p.schemeType&&i.a.createElement("div",null,"MCU SDK开发"),3===p.schemeType&&i.a.createElement("div",null,"SDK开发"),0==Object.keys(h).length&&i.a.createElement("div",{className:"mar8"},"暂无可用资料"),1==h.schemeType&&h.referenceCircuitDiagram&&i.a.createElement("div",{className:"blue mar8 lineNor",onClick:function(){return window.location=h.referenceCircuitDiagram}},"参考电路原理图"),2==h.schemeType&&h.burnFile&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"blue mar8 lineNor",onClick:function(){return window.location=h.burnFile}},"模组固件")),3==h.schemeType&&i.a.createElement("div",{className:"blue mar8 lineNor"},h.sourceSDK&&i.a.createElement("div",{onClick:function(){return window.location=h.sourceSDK}},"原厂SDK"),h.clifeSDK&&i.a.createElement("div",{onClick:function(){return window.location=h.clifeSDK}},"clifeSDK"))),i.a.createElement("div",{className:"line"},i.a.createElement("img",{src:a("Lz/R"),alt:""})),i.a.createElement("div",{className:"flex-c"},i.a.createElement("img",{className:"debug-icon",src:a("iNUt"),alt:""}),i.a.createElement("div",null,"功能测试"),i.a.createElement("div",{className:"mar8 lineNor"},"（请先完成第四步中配网以及通信安全机制的配置）")),i.a.createElement("div",{className:"line"},i.a.createElement("img",{src:a("Lz/R"),alt:""})),i.a.createElement("div",{className:"flex-c"},i.a.createElement("img",{className:"debug-icon",src:a("e11v"),alt:""}),i.a.createElement("div",null,"联网验证"),i.a.createElement("div",{className:"blue lineNor",onClick:function(){return e.setState({officeVis:!0})}},"下载“数联智能”App"))))),y&&i.a.createElement(gt,{visible:y,schemeInfo:E,protocolList:g,networkWayList:v,productId:p.productId,handleOk:function(t,a){return e.handleCommunicationOk(t,a)},handleCancel:function(){return e.setState({configCommunicationVisible:!1})}}),n&&i.a.createElement(_e,{title:"更换模组",opeType:"module",replaceModalVisible:n,handleOk:function(t){return e.handleModalOk(t,"module")},handleCancel:this.handleModalCancel,schemeId:p.schemeId,productId:p.productId,moduleId:m}),r&&i.a.createElement(tt,{type:"1",firmwareName:s.burnFileName||"",moduleName:s.moduleName||"",freeApplyVisible:r,handleCancel:function(){return e.setState({freeApplyVisible:!1})},handleFreeApply:function(){e.setState({freeApplyVisible:!1}),e.getMoudleInfo(m)}}),c&&i.a.createElement(ot,{modifyFirmwareVisible:c,firmwareId:d,productId:this.props.productId,moduleName:s.moduleName,handleOk:function(){e.setState({modifyFirmwareVisible:!1}),e.getMoudleInfo(m)},handleCancelFirmware:function(){e.setState({modifyFirmwareVisible:!1})}}),l&&i.a.createElement(_e,{title:"更换固件",opeType:"firmware",desc:"clife为您提供经检测认证的通用固件，会直接在您采购的模组内烧录完成，并自动分配设备编码。通讯模组通用固件包含连接clife和数据透传功能。产品功能固件需要您自行研发。",replaceModalVisible:l,firmwareId:d,productId:this.props.productId,handleOk:function(t){return e.handleModalOk(t,"firmware")},handleCancel:this.handleModalCancel,moduleId:m}),f&&i.a.createElement(u.a,{title:"安装“数联智能”App",width:"470px",visible:f,footer:null,onCancel:function(){return e.setState({officeVis:!1})}},i.a.createElement("div",{className:"down-office-modal"},i.a.createElement("img",{src:st.a,alt:"pic"}),i.a.createElement("div",null,"手机扫描二维码下载"))))}}])&&Ot(t.prototype,n),r&&Ot(t,r),l}(c.Component),Tt=Object(ht.connect)(null,(function(e){return{getHeadInfoAction:function(t){return e(Object(vt.f)(t))}}}),null,{forwardRef:!0})(Nt),Ct=a("g4q9"),kt=a("4L/e"),Pt=a("rVDo");a("Z6NE");function xt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ft(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function At(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Dt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}s.a.Option;var Mt=a("HILT"),Vt=a("96C7");var Lt=function(e){var t=e.networkModalVisible,a=e.productId,r=e.isGateWayDevice,l=(e.isedited,e.cancelHandle),o=e.okHandle,s=At(d.a.useForm(),1)[0],m=Object(c.useRef)(),b=Object(c.useRef)(),g=At(Object(c.useState)(""),2),v=g[0],h=g[1],E=At(Object(c.useState)(""),2),O=E[0],I=E[1],w=At(Object(c.useState)({}),2),j=w[0],S=w[1],N=At(Object(c.useState)(),2),T=N[0],C=N[1],k=At(Object(c.useState)(""),2),P=k[0],x=k[1];Object(c.useEffect)((function(){Object(f.c)(f.a.getNetDataByProductId,{productId:a}).then((function(e){e.data.radiocastName||1!==e.data.bindTypeId||1!==e.data.baseTypeId||(e.data.radiocastName="CLIFE"),S(e.data),C(e.data.baseTypeId);var t=e.data.bindTypeList.filter((function(t){return t.baseTypeId===e.data.baseTypeId}));t&&t.length>0&&x(t[0].baseTypeName),m.current.setFieldsValue({baseTypeId:e.data.baseTypeId,guidePage:e.data.guidePage?e.data.guidePage.guidePage:"",bindFailPage:e.data.guidePage?e.data.guidePage.bindFailPage:"",imageUrlList:e.data.helpPage?e.data.helpPage.imageUrls:[],radiocastName:e.data.radiocastName||""}),e.data.guidePage&&(h(e.data.guidePage.guidePage),I(e.data.guidePage.bindFailPage)),e.data.helpPage&&b.current.setFileList(e.data.helpPage.imageUrls.filter((function(e){return e})).map((function(e){return{url:e,status:"done"}})))}))}),[]);var F=function(e){"guidePage"===e&&h(""),"bindFailPage"===e&&I("")},A=function(e,t){var a=t.target.files[0];if("image/png"!==a.type&&"image/jpeg"!==a.type&&"image/gif"!==a.type)return Object(y.a)({description:"请上传gif、jpeg、jpg、png格式图片!",type:"warn"}),t.target.value="",void F(e);if(a.size>512e3)return Object(y.a)({description:"文件大小不能超过500KB",type:"warn"}),t.target.value="",void F(e);var n={appId:31438,domainType:4,file:a};Object(f.c)(f.a.upFileUrl,n,{needFormData:!0,loading:!0},{timeout:3e4}).then((function(t){0===t.code&&("guidePage"===e&&h(t.data.url),"bindFailPage"===e&&I(t.data.url),m.current.setFieldsValue(Ft({},e,t.data.url)))}))};return i.a.createElement(u.a,{title:"配网信息",visible:t,width:875,onOk:function(){s.submit()},onCancel:l,maskClosable:!1,wrapClassName:"replace-module-modal"},i.a.createElement("div",{className:"network-info-modal"},i.a.createElement(d.a,{ref:m,form:s,labelAlign:"left",onFinish:function(e){var t=e.imageUrlList&&e.imageUrlList.filter((function(e){return e})).map((function(e){return e.url||e}));e.productId=a,e.imageUrlList=t||[],e.isGateWayDevice=r||"",e.guidePage=e.guidePage||"",e.bindFailPage=e.bindFailPage||"",console.log("提交的数据****",e),Object(f.c)(f.a.saveNetworkConfig,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(a),!0).forEach((function(t){Ft(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),{loading:!0}).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),o()}))},wrapperCol:{span:19},initialValues:{}},i.a.createElement("div",{className:"network-info-modal-title"},"配网方式"),i.a.createElement(d.a.Item,{label:"已选通信协议"},i.a.createElement("span",null,j.bindTypeName)),i.a.createElement(d.a.Item,{label:"配网方式",name:"baseTypeId"},i.a.createElement("span",null,P)),1===j.bindTypeId&&1===T&&i.a.createElement(d.a.Item,{label:"AP-SSID",name:"radiocastName",rules:[{required:!0,message:"请输入AP-SSID！"}]},i.a.createElement(p.a,{maxLength:50,style:{width:380}})),(1===j.bindTypeId&&3===T||2===j.bindTypeId)&&i.a.createElement(d.a.Item,{label:"广播名",name:"radiocastName",rules:[{required:!0,message:"请输入广播名！"}]},i.a.createElement(p.a,{maxLength:50,style:{width:380}})),(1===j.bindTypeId||2===j.bindTypeId)&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"network-info-modal-title"},"配网图片引导",i.a.createElement("span",{className:"tip"},"（需产品支持WiFi或蓝牙配置能力）")),i.a.createElement("div",{className:"flex"},i.a.createElement(d.a.Item,{label:"默认联网指引",name:"guidePage",wrapperCol:{span:10},className:"upload-img"},i.a.createElement("div",{className:"native-upload"},i.a.createElement("div",{className:"img-wrap"},i.a.createElement("img",{src:v||Mt,alt:""})),i.a.createElement("label",{htmlFor:"upLoadImg"},i.a.createElement(n.a,{type:"primary",className:"upload-btn"},"上传图片",i.a.createElement("input",{type:"file",accept:"image/*",id:"upLoadImg",name:"guideImg",className:"hidden",onInput:function(e){return A("guidePage",e)}}))),i.a.createElement("div",{className:"tip-text"},"支持gif、jpeg、jpg、png格式，大小不超过500k，推荐尺寸110*154px，150*267px"))),i.a.createElement(d.a.Item,{label:"默认联网失败提示",name:"bindFailPage",wrapperCol:{span:10},className:"upload-img"},i.a.createElement("div",{className:"native-upload"},i.a.createElement("div",{className:"img-wrap"},i.a.createElement("img",{src:O||Vt,alt:""})),i.a.createElement("label",{htmlFor:"upLoadImg"},i.a.createElement(n.a,{type:"primary",className:"upload-btn"},"上传图片",i.a.createElement("input",{type:"file",accept:"image/*",id:"upLoadImg",name:"guideImg",className:"hidden",onInput:function(e){return A("bindFailPage",e)}}))),i.a.createElement("div",{className:"tip-text"},"支持gif、jpeg、jpg、png格式，大小不超过500k，推荐尺寸110*154px，150*267px")))),i.a.createElement(d.a.Item,{label:"图片轮播帮助信息",name:"imageUrlList",className:"upload-img",wrapperCol:{span:20}},i.a.createElement(Pt.b,{ref:b,maxCount:5,preferSize:"150*267",format:".gif,.jpeg,.jpg,.png",maxSize:.5}))))))},Rt=(a("TfFZ"),a("3S7+")),qt=a("zueq");a("ggmS");function Kt(){return(Kt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Jt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Jt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Ut=function(e){var t=e.securityVisible,a=e.productId,n=e.cancelHandle,r=e.isGateWayDevice,l=e.isConfigedFunc,o=e.productExtend,s=zt(d.a.useForm(),1)[0],m=zt(Object(c.useState)("0"),2),p=m[0],b=m[1];return i.a.createElement(u.a,{title:"通信安全机制",visible:t,width:740,onOk:function(){s.submit()},onCancel:n,maskClosable:!1,wrapClassName:"replace-module-modal"},i.a.createElement("div",{className:"communication-security-modal"},i.a.createElement("div",{className:"tip-desc"},i.a.createElement(qt.a,null),i.a.createElement("span",{className:"tip-text"},"数据在产品发布后可在设备注册模块查看")),i.a.createElement(d.a,Kt({form:s},{labelCol:{span:5},wrapperCol:{span:14}},{onFinish:function(e){Object(f.c)(f.a.saveProductSecurityConfig,{productId:a,authorityType:Number(p),isGateWayDevice:r||""}).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),l()}))},initialValues:{authorityType:o+""}}),i.a.createElement(d.a.Item,{name:"authorityType",label:"验证方式",rules:[{required:!0,message:"请选择验证方式！"}]},i.a.createElement(D.a.Group,{onChange:function(e){return b(e.target.value)}},i.a.createElement(D.a,{value:"0"},i.a.createElement(Rt.a,{title:"设备通信时，仅校验烧录的产品密钥，设备安全性较低。",placement:"bottom"}," 一型一密 ")),i.a.createElement(D.a,{value:"1"},i.a.createElement(Rt.a,{title:"设备通信时，需校验烧录的产品密钥，同时需校验在Clife平台设备注册的设备ID，较为安全。",placement:"bottom"},"一型一密pro")),i.a.createElement(D.a,{value:"2"},i.a.createElement(Rt.a,{title:"设备通信时，需校验烧录的设备密钥，同时需校验烧录的设备ID，安全性最高。",placement:"bottom"},"一机一密")))))))};a("/MfK"),a("jXZW");s.a.Option;a("Lyp1"),a("sTEO");s.a.Option;a("qNb/"),a("PArb");var Ht=a("DgvE");a("fAKH");a("8bdq");function Bt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Gt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(a),!0).forEach((function(t){Wt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Bt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Wt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var $t=function(e){var t=e.visible,a=e.productId,n=e.cancelHandle,r=e.handleOk,c=e.zigbeeSign,l=void 0===c?"":c,o=_t(d.a.useForm(),1)[0];return i.a.createElement(u.a,{title:"zigbee3.0产品标示配置",visible:t,width:740,onOk:function(){o.submit()},onCancel:n,maskClosable:!1,wrapClassName:"replace-module-modal"},i.a.createElement("div",null,i.a.createElement(d.a,{form:o,onFinish:function(e){console.log(Gt({},e)),Object(f.c)(f.a.saveZigbeeProduct,Gt({productId:a},e)).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),r()}))},labelCol:{span:5},wrapperCol:{span:14},initialValues:{zigbeeSign:l}},i.a.createElement(d.a.Item,{name:"zigbeeSign",label:"产品标示",rules:[{required:!0,message:"请输入自定义字符串"}],style:{marginTop:22}},i.a.createElement(p.a,{placeholder:"请输入自定义字符串"})))))},Yt=a("Sfad");var Qt=function(e){var t=e.visible,a=e.productId,n=e.cancelHandle,r=e.handleOk,l=e.initialProtoclList,o=Object(c.useRef)(null);return i.a.createElement(u.a,{title:"zigbee协议描述信息",visible:t,width:1100,onOk:function(){o.current.subOrder()},onCancel:n,maskClosable:!1,wrapClassName:"zigbee-pro-modal"},i.a.createElement(Yt.a,{dataSource:l,ref:o,finishSub:function(e){var t={productId:a,zigbeeConfigList:e};Object(f.c)(f.a.saveConfigZigbee,t,{loading:!0}).then((function(e){Object(y.a)({description:"操作成功！",type:"success"}),r()}))}}))},Xt=a("ZWaL");function ea(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ta(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ta(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ta(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function aa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function na(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?aa(Object(a),!0).forEach((function(t){ra(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):aa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ra(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ca(e,t){var n=e.productId,r=e.nextStep,o=Object(l.useHistory)(),u=ea(Object(c.useState)([{title:"配网信息",desc:"选择设备联网方式，设置配网引导图，相关指引等",isConfiged:!1,type:"network",url:a("2mZb")},{title:"通信安全机制",desc:"配置设备通信的安全机制，兼顾客户的便利以及安全需求",isConfiged:!1,type:"security",url:a("sfQM")},{title:"zigbee四元组配置",desc:"配置zigbee四元组相关信息",isConfiged:!1,type:"zigbee",url:a("DOrO")},{title:"zigbee协议描述信息",desc:"需要根据物模型协议功能点进行ZigBee相关的描述",isConfiged:!1,type:"zigbeePro",url:a("5Azq")}]),2),s=u[0],m=u[1],d=ea(Object(c.useState)([{title:"固件升级",desc:"MCU固件或SDK固件配置远程升级，无需烧录。需控制板支持",isConfiged:!1,type:"firmwareUpdate",routePath:"/open/product/otaUpdate/list",url:a("YKHW")},{title:"云端定时",desc:"云端设定开关时间及周循环，无需硬件嵌入式开发",isConfiged:!1,type:"cloud",routePath:"/open/product/cloudTimer",url:a("hGad")},{title:"消息推送",desc:"可定义配置设备预警消息推送，方便随时随地的设备监控",isConfiged:!1,type:"deviceWarning",routePath:"/open/product/pushNotification",url:a("mBzF")},{title:"APP快捷卡片功能配置",desc:"配置在数联智能APP上快捷展示或控制设备的功能卡片",isConfiged:!1,type:"quickSetting",routePath:"/open/product/proManage/voiceSetting",url:a("rPhs")},{title:"语音能力",desc:"基于产品功能点，可选择配置主流平台语音控制方案",isConfiged:!1,type:"voiceSetting",routePath:"/open/product/proManage/voiceSetting",url:a("j/ee")}]),2),p=d[0],b=d[1],g=ea(Object(c.useState)(""),2),v=(g[0],g[1]),E=ea(Object(c.useState)(""),2),O=E[0],I=E[1],w=ea(Object(c.useState)(!1),2),j=w[0],S=w[1],N=ea(Object(c.useState)(!1),2),T=N[0],C=N[1],k=ea(Object(c.useState)(!1),2),P=k[0],x=k[1],F=ea(Object(c.useState)(!1),2),A=(F[0],F[1]),D=ea(Object(c.useState)(!1),2),M=(D[0],D[1]),V=ea(Object(c.useState)(""),2),R=V[0],q=V[1],K=ea(Object(c.useState)([]),2),z=(K[0],K[1],ea(Object(c.useState)("add"),2)),J=(z[0],z[1]),U=ea(Object(c.useState)({}),2),H=(U[0],U[1],ea(Object(c.useState)(0),2)),B=H[0],G=(H[1],ea(Object(c.useState)(JSON.parse(sessionStorage.getItem("productItem"))||{}),2)),W=G[0],_=(G[1],ea(Object(c.useState)([]),2)),Z=(_[0],_[1],ea(Object(c.useState)(!1),2)),$=Z[0],Y=Z[1],Q=ea(Object(c.useState)(!1),2),X=Q[0],ee=Q[1],te=ea(Object(c.useState)(""),2),ae=te[0],ne=te[1],re=ea(Object(c.useState)([]),2),ce=re[0],ie=re[1],le=ea(Object(c.useState)([]),2),oe=le[0],ue=le[1],se=Object(ht.useSelector)((function(e){return e.getIn(["product"]).toJS()}));Object(c.useEffect)((function(){pe(oe)}),[se.productHeadInfo]);var me=function(){4!=W.schemeType&&5!=W.schemeType?s.every((function(e){return!0===e.isConfiged}))?r():Object(y.a)({description:"请完善必选配置信息！",type:"warn"}):r()};Object(c.useImperativeHandle)(t,(function(){return{onFinish:me}}),[s]);var de=function(){x(!1);var e=h()(s);Object(f.c)(f.a.getSecurityConfigStatus,{productId:n},{loading:!0}).then((function(t){t.data.gatewayConfigflag&&(e.filter((function(e){return"network"===e.type}))[0].isConfiged=!0,v(t.data.productConfig)),t.data.securityConfigflag&&(e.filter((function(e){return"security"===e.type}))[0].isConfiged=!0,I(t.data.productExtend.authorityType))})),ue(e),pe(e)},pe=function(e){Object.keys(se.productHeadInfo).length&&-1!==se.productHeadInfo.bindTypeStr.indexOf("Zigbee")?(Object(f.c)(f.a.isConfigZigbee,{productId:n}).then((function(t){t.data.isZigbeeSignConfig&&(e.filter((function(e){return"zigbee"===e.type}))[0].isConfiged=!0,Object(f.c)(f.a.getZigbeeProduct,{productId:n}).then((function(e){ne(e.data.zigbeeSign)}))),t.data.isZigbeeDescConfig&&(e.filter((function(e){return"zigbeePro"===e.type}))[0].isConfiged=!0),m(e)})),ye()):m(e.filter((function(e){return"zigbee"!==e.type&&"zigbeePro"!==e.type})))},fe=function(){Object(f.c)(f.a.getProductExtendInfo,{productId:n},{loading:!0}).then((function(e){q(e.data.productClassId)}))},ye=function(){Object(f.c)(f.a.standardFnList,{productId:n},{loading:!0}).then((function(e){var t=e.data.standard.concat(e.data.custom);t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=[];return e.forEach((function(e){e.funcParamList&&e.funcParamList.length&&e.funcParamList.forEach((function(t){var n=JSON.parse(JSON.stringify(e));a.push(na(na({},n),t))}))})),a.forEach((function(e,a){(e.key=a,e.sendData="",e.isCheck=!1,Object.keys(t).length>0)&&JSON.parse(t.remoteProtocol.protocolJson).forEach((function(t){t.funcIdentifier===e.funcIdentifier&&(e.isCheck=!0,("properties"===e.funcType||e.identifier===t.identifier)&&(e.sendData=t.sendData))}))})),a}(t=t.filter((function(e){if("属性"===e.funcTypeCN)return e}))),ie(t)}))};Object(c.useEffect)((function(){de(),fe(),function(){if(!W.voiceable){var e=h()(p);e.pop(),b(e)}W.schemeType&&(1!=W.schemeType&&4!=W.schemeType||b((function(e){console.log("preList----",e);var t=h()(e);return t.splice(0,1),t})))}()}),[]);var be=function(e){switch(e){case"network":C(!0);break;case"security":x(!0);break;case"addFirmware":B>=5?Object(y.a)({description:"产品固件模块最多配置5个！",type:"warn"}):A(!0);break;case"gateway":break;case"zigbee":Y(!0);break;case"zigbeePro":ee(!0)}},ge=function(){M(!0)};return i.a.createElement("div",{className:"service-config-page"},i.a.createElement("div",{className:"desc"},W.schemeType?L.e[W.schemeType]:""),4!==W.schemeType&&5!==W.schemeType&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"service-config-title"},"必选配置"),i.a.createElement("div",{className:"service-config-cont"},s&&s.map((function(e,t){return i.a.createElement("div",{className:"config-card",key:t},i.a.createElement("div",{className:"config-card-left"},i.a.createElement("img",{src:e.url,alt:"图片"})),i.a.createElement("div",{className:"config-card-right"},i.a.createElement("div",{className:"config-card-right-title"},e.title),i.a.createElement("div",{className:"config-card-right-desc"},e.desc),i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){be(e.type)}},e.isConfiged?"修改":"配置")),e.isConfiged&&i.a.createElement("div",{className:"configured-logo"},"已配置"))})))),i.a.createElement("div",{className:"service-config-title"},"可选配置"),i.a.createElement("div",{className:"service-config-cont"},(4==W.schemeType||5==W.schemeType)&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"service-config-cont"},s&&s.map((function(e,t){return i.a.createElement("div",{className:"config-card",key:t},i.a.createElement("div",{className:"config-card-left"},i.a.createElement("img",{src:e.url,alt:"图片"})),i.a.createElement("div",{className:"config-card-right"},i.a.createElement("div",{className:"config-card-right-title"},e.title),i.a.createElement("div",{className:"config-card-right-desc"},e.desc),i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){be(e.type)}},e.isConfiged?"修改":"配置")),e.isConfiged&&i.a.createElement("div",{className:"configured-logo"},"已配置"))})))),p.map((function(e,t){return i.a.createElement("div",{className:"config-card",key:t},i.a.createElement("div",{className:"config-card-left"},i.a.createElement("img",{src:e.url,alt:"图片"})),i.a.createElement("div",{className:"config-card-right"},i.a.createElement("div",{className:"config-card-right-title"},e.title),i.a.createElement("div",{className:"config-card-right-desc"},e.desc),i.a.createElement("div",{className:"flex-start"},e.isConfiged?"":["firmwareUpdate","cloud","deviceWarning","scene"].includes(e.type)?i.a.createElement(l.Link,{to:{pathname:e.routePath,search:"?productId=".concat(n)},target:"_blank"},i.a.createElement("div",{className:"config-card-right-btn"},"配置")):"voiceSetting"===e.type?i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){o.push("/open/product/proManage/voiceSetting/".concat(n,"/?detail=1"))}},"配置"):"quickSetting"===e.type?i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){S(!0)}},"配置"):"addFirmware"===e.type?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){be(e.type),J("add")}},"配置"),i.a.createElement("div",{className:"config-card-right-btn mar6",onClick:function(){ge()}},"详情")):i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){be(e.type)}},"配置"),e.isConfiged?"addFirmware"===e.type?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){be(e.type),J("add")}},"配置"),i.a.createElement("div",{className:"config-card-right-btn mar6",onClick:function(){ge()}},"详情")):i.a.createElement("div",{className:"config-card-right-btn",onClick:function(){be(e.type)}},"修改"):"")),e.isConfiged&&i.a.createElement("div",{className:"configured-logo"},"已配置"))}))),T&&i.a.createElement(Lt,{networkModalVisible:T,productId:n,isGateWayDevice:R,isedited:s[0].isConfiged,okHandle:function(){C(!1),de(),fe()},cancelHandle:function(){C(!1)}}),P&&i.a.createElement(Ut,{securityVisible:P,productId:n,isGateWayDevice:R,productExtend:O,isConfigedFunc:de,cancelHandle:function(){x(!1)}}),$&&i.a.createElement($t,{visible:$,productId:n,zigbeeSign:ae,handleOk:function(){de(),Y(!1)},cancelHandle:function(){return Y(!1)}}),X&&i.a.createElement(Qt,{visible:X,productId:n,initialProtoclList:ce,handleOk:function(){de(),ee(!1)},cancelHandle:function(){return ee(!1)}}),j&&i.a.createElement(Xt.a,{cancelHandle:function(){S(!1)},visible:j,productId:n}))}var ia=Object(c.forwardRef)(ca);a("GCsS");function la(e){return(la="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oa(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ua(e,t){return(ua=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function sa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=da(e);if(t){var r=da(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return ma(this,a)}}function ma(e,t){if(t&&("object"===la(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function da(e){return(da=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ua(e,t)}(c,e);var t,a,n,r=sa(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).formRef=i.a.createRef(),t.getCommunicationProtocol=function(){Object(f.c)(f.a.getCommunicationProtocol,{}).then((function(e){t.setState({protocolList:e.data})}))},t.feibiaoModeDetail=function(){Object(f.c)(f.a.feiBiaoMode,{productId:t.props.productId}).then((function(e){var a=e.data&&e.data.map((function(e){return 0==e.bindType?"":"".concat(e.bindType,"#").concat(e.bindTypeVersion)}));t.formRef.current.setFieldsValue({communicationModeList:a}),t.setState({checkedValues:a})}))},t.saveFeiBiao=function(){var e={productId:t.props.productId,communicationModeList:t.state.checkedValues};e.communicationModeList=e.communicationModeList.map((function(e){return{bindType:Number(e.split("#")[0]),bindTypeVersion:Number(e.split("#")[1])}})),Object(f.c)(f.a.saveFeibiao,e).then((function(e){t.feibiaoModeDetail(),t.props.nextStep()}))},t.onFinish=function(e){if(console.log(e,t.state.checkedValues.filter((function(e){return e}))),0===t.state.checkedValues.filter((function(e){return e})).length)return Object(y.a)({type:"warn",description:"请更改配置通信方式"});t.saveFeiBiao()},t.onFinishFailed=function(e){console.log("Failed:",e)},t.changeProtocol=function(e){console.log(e),t.setState({checkedValues:e})},t.getSchemeType=function(){return t.state.productItemData.schemeType?L.e[t.state.productItemData.schemeType]:""},t.state={productItemData:JSON.parse(sessionStorage.getItem("productItem"))||{},checkedValues:[],protocolList:[]},t}return t=c,(a=[{key:"componentDidMount",value:function(){this.getCommunicationProtocol(),this.feibiaoModeDetail()}},{key:"render",value:function(){var e=this,t=this.state.protocolList;return i.a.createElement("div",null,i.a.createElement("div",{className:"desc"},this.getSchemeType()),i.a.createElement(d.a,{ref:this.formRef,className:"communicate-form",name:"control-ref",onFinish:this.onFinish,onFinishFailed:this.onFinishFailed},i.a.createElement(d.a.Item,{name:"communicationModeList",label:"云端通信方式",rules:[{required:!0,message:"请选择云端通信方式"}]},i.a.createElement(g.a.Group,{onChange:function(t){return e.changeProtocol(t)},className:"checkbox-group"},t&&t.map((function(e){return i.a.createElement(g.a,{value:"".concat(e.bindTypeId,"#").concat(e.bindTypeVersion),key:"".concat(e.bindTypeId,"#").concat(e.bindTypeVersion)},e.bindTypeName)}))))))}}])&&oa(t.prototype,a),n&&oa(t,n),c}(c.Component);a("7wwM");function fa(e){return(fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ya(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ba(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ga(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function va(e,t){return(va=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ha(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Oa(e);if(t){var r=Oa(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return Ea(this,a)}}function Ea(e,t){if(t&&("object"===fa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Oa(e){return(Oa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ia=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&va(e,t)}(c,e);var t,a,n,r=ha(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).formRef=i.a.createRef(),t.getSystemData=function(){Object(f.b)(f.a.getSystemType).then((function(e){t.setState({protocolList:e.data})}))},t.systemShowDetail=function(){Object(f.c)(f.a.systemShow,{productId:t.props.productId}).then((function(e){0===e.code&&(t.formRef.current.setFieldsValue({systemType:e.data.systemType}),t.setState({checkedValues:e.data.systemType}))}))},t.saveSystemData=function(){var e=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ya(Object(a),!0).forEach((function(t){ba(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ya(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({productId:t.props.productId},t.formRef.current.getFieldsValue("systemType"));Object(f.c)(f.a.saveSystem,e).then((function(e){t.systemShowDetail(),t.props.nextStep()}))},t.onFinish=function(e){if(console.log(e),!t.state.checkedValues)return Object(y.a)({type:"warn",description:"请选择操作系统"});t.saveSystemData()},t.onFinishFailed=function(e){console.log("Failed:",e)},t.changeProtocol=function(e){console.log(e.target.value),t.setState({checkedValues:e.target.value})},t.getSchemeType=function(){return t.state.productItemData.schemeType?L.e[t.state.productItemData.schemeType]:""},t.state={productItemData:JSON.parse(sessionStorage.getItem("productItem"))||{},checkedValues:"",protocolList:[]},t}return t=c,(a=[{key:"componentDidMount",value:function(){this.getSystemData(),this.systemShowDetail()}},{key:"render",value:function(){var e=this,t=this.state.protocolList;return i.a.createElement("div",null,i.a.createElement("div",{className:"desc"},this.getSchemeType()),i.a.createElement(d.a,{ref:this.formRef,className:"communicate-form",name:"control-ref",onFinish:this.onFinish,onFinishFailed:this.onFinishFailed},i.a.createElement(d.a.Item,{name:"systemType",label:"操作系统",rules:[{required:!0,message:"请选择操作系统"}]},i.a.createElement(D.a.Group,{onChange:function(t){return e.changeProtocol(t)},className:"checkbox-group"},t&&t.map((function(e){return i.a.createElement(D.a,{value:e.baseTypeId,key:e.baseTypeId},e.baseTypeName)}))))))}}])&&ga(t.prototype,a),n&&ga(t,n),c}(c.Component),wa=a("ORHb"),ja=a("739K"),Sa=a("DeUx");a("aTcW");function Na(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,c=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(c.push(n.value),!t||c.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ta(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ta(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ta(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Ca=r.a.Step;t.default=Object(ht.connect)((function(e){return{productHeadInfo:e.getIn(["product","productHeadInfo"])}}),(function(e){return{getHeadInfoAction:function(t){return e(Object(vt.f)(t))}}}))((function(e){var t=e.match,a=(e.location,e.productHeadInfo),u=e.getHeadInfoAction,s=+sessionStorage.getItem("stepnum")||0,m=Na(Object(c.useState)(sessionStorage.getItem("productItem")?JSON.parse(sessionStorage.getItem("productItem")):{}),2),d=m[0],p=m[1],b=Na(Object(c.useState)(!1),2),g=b[0],v=b[1],h=Na(Object(c.useState)(!1),2),E=h[0],O=h[1],I=Na(Object(c.useState)(s),2),w=I[0],j=I[1],S=Na(Object(c.useState)(s),2),N=S[0],T=S[1],C=[{title:"定义功能",content:"protocols",mod:Re},{title:"确定面板",content:"firmpanel",mod:Ct.a},{title:"通信方式",content:"comunicate",mod:pa},{title:"配置服务",content:"configService",mod:ia},{title:"调试验证",content:"validation",mod:kt.a}],k=[{title:"定义功能",content:"protocols",mod:Re},{title:"确定面板",content:"firmpanel",mod:Ct.a},{title:"操作系统",content:"operateSystem",mod:Ia},{title:"配置服务",content:"configService",mod:ia},{title:"调试验证",content:"validation",mod:kt.a}],P=[{title:"定义功能",content:"protocols",mod:Re},{title:"确定面板",content:"firmpanel",mod:Ct.a},{title:"开发硬件",content:"hardware",mod:Tt},{title:"配置服务",content:"configService",mod:ia},{title:"调试验证",content:"validation",mod:kt.a}],x=d.schemeType,F=Object(c.useMemo)((function(){return 4===x&&C||5===x&&k||P}),[]),A=Object(l.useHistory)(),D=(t.path,function(e){return+e.params.id}(t));Object(c.useEffect)((function(){u(D)}),[]),Object(c.useEffect)((function(){p(a)}),[a]);var M=Object(c.useRef)(),V=Object(c.useCallback)((function(){var e=w+1;e>N&&(T(e),Object(f.c)(f.a.upProMaxStep,{productId:D,step:e+1})),j(e),sessionStorage.setItem("stepnum",e)}));if(!D)return i.a.createElement(o.a,{tipText:"没有传入产品ID哦"});var L,R=i.a.createElement("div",{className:"product_title_baseinfo_list"},i.a.createElement("div",null,i.a.createElement("div",null,"品类："),i.a.createElement("div",null,d.deviceType)),i.a.createElement("div",null,i.a.createElement("div",null,"产品ID："),i.a.createElement("div",null,d.productId)),i.a.createElement("div",null,i.a.createElement("div",null,"通讯协议："),i.a.createElement("div",null,d.bindTypeStr)),i.a.createElement("div",null,i.a.createElement("div",null,"产品编码："),i.a.createElement("div",null,d.code)),i.a.createElement("div",null,i.a.createElement("div",null,"产品密钥："),i.a.createElement("div",null,(L=d.deviceKey,L=g?L:Object(Ht.k)(L,10)),i.a.createElement("span",{onClick:function(){v(!g)}},g?i.a.createElement(ja.a,null):i.a.createElement(Sa.a,null))))),q=F[w].mod;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"eidt-wrapper"},i.a.createElement(qe.a,{title:d.productName,titleTag:d.schemeName,btnTxt:"编辑",backHandle:function(){A.push("/open/product/proManage/list")},backTitle:"开发流程",btnClickHandle:function(){O(!0)}},R),i.a.createElement("div",{className:"product-main-wrap comm-shadowbox"},i.a.createElement("div",{className:"product-main-wrap_step"},i.a.createElement(r.a,{current:w},F.map((function(e){return i.a.createElement(Ca,{key:e.title,title:e.title})})))),i.a.createElement(q,{ref:2==w?function(e){M=e}:M,nextStep:V,productId:D})),i.a.createElement("div",{className:"product-main-footer"},w>0&&i.a.createElement(n.a,{style:{margin:"0 8px"},onClick:function(){j(w-1),sessionStorage.setItem("stepnum",w-1)},type:"primary",ghost:!0},"上一步"),w<F.length-1&&i.a.createElement(n.a,{type:"primary",onClick:function(){2===w?M.onFinish():M.current.onFinish()}},"下一步"),w===F.length-1&&i.a.createElement(n.a,{type:"primary",onClick:function(){M.current.showRelease()}},"发布产品"))),E&&i.a.createElement(wa.a,{titleVisible:E,onCloseTitle:function(){O(!1)},onOkClose:function(e){u(D),Object(y.a)({type:"success",description:"更新成功！"}),O(!1)},productItem:d}))}))},fAKH:function(e,t,a){},ggmS:function(e,t,a){},jXZW:function(e,t,a){},sTEO:function(e,t,a){},wkzE:function(e,t,a){}}]);