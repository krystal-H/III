(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},"40NI":function(e,t,a){},"8sIe":function(e,t,a){"use strict";a.d(t,"a",(function(){return Y}));a("vxpS"),a("ThRY"),a("6wma"),a("2Kt1"),a("gsuU"),a("tpKs"),a("rsdX"),a("L8Gl"),a("EO5n"),a("72Pr");var n=a("O4+N"),r=(a("+SM3"),a("SE39")),l=(a("Y5Ue"),a("xc0u")),c=(a("bqBU"),a("4OHk")),i=(a("7fbo"),a("LCR/")),o=a("CvKH"),s=a.n(o),u=(a("DwF0"),a("oCJ0"),a("SnyF"),a("wlSd"),a("WWzu"),a("eVIo"),a("8OWE"),a("h4PX"),a("SoGA"),a("L4wC"),a("KzFV"),a("mtIt"),a("q+fq")),d=a.n(u),m=a("Nlzp"),p=a("DgvE"),f=a("cu44"),v=a("TL2v"),g=a("2kug"),E=(a("U4At"),a("KiF4")),y=(a("/mds"),a("aLG4")),b=(a("HzvR"),a("2n5t")),h=(a("rJH4"),a("nKmx")),I=(a("n1yf"),a("M+R0"),a("eRDW"),a("N4lb"),a("pTgC"),a("YEMt"),a("P2RN"));function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){w(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function w(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function x(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||L(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){if(e){if("string"==typeof e)return j(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var C=h.a.TextArea,N=h.a.Search,D=b.a.Option,R=[{title:"填写任务说明"},{title:"添加配置数据"},{title:"选择配置更新的设备"}],T=["待执行","执行中","成功","失败"];function A(e){var t=e.visible,a=e.productId,r=e.onCancel,i=e.configProtoclList,o=e.isDeviceRomote,f=e.getRemoteList,v=e._deviceList,k=e.editData,w=e.protocolFormat,L=S(Object(u.useState)(0),2),j=L[0],T=L[1],A=S(Object(u.useState)(k?{taskExplain:k.taskExplain}:{taskExplain:""}),2),P=A[0],U=A[1],V=S(Object(u.useState)(k?k.protocolSendData||[]:i.map((function(e){return e.defaultPropertyValue||""}))),2),q=V[0],J=V[1],M=S(Object(u.useState)(k&&k.protocolSelection||[]),2),Q=M[0],B=M[1],z=S(Object(u.useState)([]),2),K=z[0],_=z[1],G=S(Object(u.useState)(1),2),W=G[0],H=G[1],Y=S(Object(u.useState)([]),2),X=Y[0],Z=Y[1],$=S(Object(u.useState)({curDeviceInfoList:[],allDeviceInfoList:[],allDeviceInfoPager:{pageIndex:1,currPageRows:7}}),2),ee=$[0],te=$[1],ae=S(Object(u.useState)([]),2),ne=ae[0],re=ae[1],le=S(Object(u.useState)(!1),2),ce=le[0],ie=le[1],oe=S(Object(u.useState)({allList:[],successList:[],errorList:[],errorVisible:!1}),2),se=oe[0],ue=oe[1],de=S(Object(u.useState)(""),2),me=de[0],pe=de[1],fe=S(Object(u.useState)(!1),2),ve=fe[0],ge=fe[1],Ee=S(Object(u.useState)({rightAllList:k?k.deviceList:[],rightTempList:k?k.deviceList:[]}),2),ye=Ee[0],be=Ee[1],he=S(Object(u.useState)([]),2),Ie=he[0],ke=he[1],Oe=Object(u.useRef)(null),we=P.taskExplain,xe=ee.curDeviceInfoList,Se=ee.allDeviceInfoList,Le=ee.allDeviceInfoPager,je=se.allList,Ce=se.successList,Ne=se.errorList,De=se.errorVisible,Re=ye.rightAllList,Te=ye.rightTempList,Ae=o?1:2,Pe=s()(R);o&&Pe.splice(2,1);var Ue=function(e){Object(m.c)(m.a.getAllDeviceInfo,{productId:a,pageRows:8,pageIndex:e||Le.pageIndex}).then((function(e){if(e.data){var t=e.data,a=t.list,n=void 0===a?[]:a,r=t.pager,l=void 0===r?{}:r,c=[].concat(x(Se),x(n));n.forEach((function(e){e.key=e.deviceUniqueId})),te({curDeviceInfoList:n,allDeviceInfoPager:l,allDeviceInfoList:c})}}))};Object(u.useEffect)((function(){o||Ue()}),[a,o]);var Ve=function(e){var t=m.a.saveRomoteConfig,n={taskExplain:we,productId:a,protocolJson:JSON.stringify(1!==w?Q.map((function(e){var t=i[e];return delete t._type,delete t._params,delete t._index,delete t.key,O(O({},t),{},{sendData:q[e]})})):q.map((function(e,t){var a=i[t];return delete a._type,delete a._params,delete a._index,delete a.key,O(O({},a),{},{sendData:e})})))};if(o)t=m.a.saveRomoteConfigForDevice,n.deviceList=v;else{if(Re.length<1)return void Object(I.a)({description:"请至少选择一个设备"});n.deviceList=Re.map((function(e){return{deviceId:e.deviceId,deviceUniqueId:e.deviceUniqueId,macAddress:e.macAddress}})),k&&(n.taskId=k.taskId)}Object(m.d)(t,n,{needJson:!0,loading:!0,noInstance:!0}).then((function(t){if(e){var n=t.data;Object(m.c)(m.a.submitRomoteConfig,{taskId:n,productId:a},{loading:!0}).then((function(e){f(1),r()}))}else f(1),r()}))},qe=function(e){U(O(O({},P),{},{taskExplain:e.target.value.trim()}))},Fe=function(e,t){var a=x(q),n=K.filter((function(e){return e!==t}));a[t]=e,J(a),_(n)},Je=function(e){H(+e),Z([]),re([])},Me=function(e){e?(ie(!0),Object(m.c)(m.a.getDeviceInfoByIdOrMacAddress,{productId:a,query:e}).then((function(e){var t=e.data;t.key=t.deviceUniqueId,e.data&&re([t])})).finally((function(){ie(!1)}))):Object(I.a)({description:"请输入查询条件"})},Qe=function(e){var t=x(Re);if(e&&e.trim()){var a=e.trim();t=Re.filter((function(e){var t=e.deviceUniqueId,n=e.macAddress;return t.indexOf(a)>-1||n.indexOf(a)>-1}))}be(O(O({},ye),{},{rightTempList:t}))},Be=function(){window.open(m.a.downloadRemoteDeviceTemplateExcel)},ze=function(e){console.log(1);var t=e.target;if(t.files&&t.files.length>0){var n=Object(p.e)(t.files,["xls","xlsx"],1e4),r=n.isOk;n.type,n.size;if(!r)return void Object(I.a)({description:"文件类型或者大小不符合要求"});var l=t.files[0];Object(m.d)(m.a.importRemoteDeviceExcel,{uploadExcel:l,productId:a},{needFormData:!0,loading:!0}).then((function(e){if(e.data){var t=e.data,a=[],n=[];t.forEach((function(e,t){var r=e.errorType,l=e.deviceUniqueId;e.key=l,r?n.push({deviceUniqueId:l,errorType:r,key:l}):a.push(O({},e))})),ue(O(O({},se),{},{allList:t,successList:a,errorList:n})),a.length>0&&(be({rightAllList:[].concat(a),rightTempList:[].concat(a)}),ke([])),pe(l.name),ge(!0)}}))}},Ke=function(){var e=(1==W?Se:ne).filter((function(e){return X.includes(e.deviceUniqueId)})),t=Object(p.s)([].concat(x(Re),x(e)),"deviceUniqueId");Oe&&(Oe.current.input.input.value=""),be({rightAllList:t,rightTempList:t})},_e=function(){if(0!==Ie.length){var e=Re.filter((function(e){var t=e.key;return!Ie.includes(t)})),t=Te.filter((function(e){var t=e.key;return!Ie.includes(t)}));be(O(O({},ye),{},{rightAllList:e,rightTempList:t})),ke([])}},Ge=[{title:"数据名称",dataIndex:"propertyName",key:"propertyName",width:160},{title:"数据标识",dataIndex:"property",width:240,key:"property"},{title:"数据类型",dataIndex:"_type",key:"_type",width:140},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"},{title:"下发数据",dataIndex:"execTime",key:"execTime",width:180,render:function(e,t){var a=t._type,n=t._params,r=t._index,l=t.key,c=null,i=1!==w&&!Q.includes(l);switch(a){case"数值型":c=d.a.createElement(y.a,{value:q[r],min:n.min,max:n.max,disabled:i,onChange:function(e){return Fe(e,r)},placeholder:"请输入参数"});break;case"字符型":c=d.a.createElement(h.a,{value:q[r],maxLength:30,disabled:i,onChange:function(e){return Fe(e.target.value.trim(),r)},placeholder:"请输入参数"});break;default:c=d.a.createElement(b.a,{disabled:i,onChange:function(e){return Fe(e,r)},value:q[r]||""},d.a.createElement(D,{key:-1,value:""},"请选择参数"),n&&n.map((function(e,t){return d.a.createElement(D,{key:t+a,value:e.value},e.name)})))}return d.a.createElement("span",{className:"config-send-data ".concat(K.includes(r)?"warn":"")},c)}}],We=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:140},{title:"物理地址",dataIndex:"macAddress",width:140,key:"macAddress"}],He={selectedRowKeys:Q,onChange:function(e){B(e)}},Ye={selectedRowKeys:X,onChange:function(e){Z(e)}},Xe={selectedRowKeys:Ie,onChange:function(e){ke(e)}},Ze=1===W?xe:2===W?ne:[];return d.a.createElement(E.a,{visible:t,width:1e3,className:"romote-modal",title:"远程配置任务",centered:!0,closable:!1,onOk:null,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",{className:"romote-add-content flex-column"},d.a.createElement(g.a,{type:2,flowLists:Pe,style:{padding:"12px 0"},activeItem:j}),d.a.createElement("div",{className:"content-wrapper flex1"},function(){switch(j){case 0:return d.a.createElement("div",{className:"step-0-wrapper flex-row"},d.a.createElement("div",{className:"step-0-lable"},d.a.createElement("span",{className:"pre-requst-start"},"任务说明")),d.a.createElement("div",{className:"textarea-wrapper flex1"},d.a.createElement(C,{value:we,maxLength:100,onChange:qe,autoSize:{minRows:4,maxRows:6}})),d.a.createElement("div",{className:"count-wrapper"},d.a.createElement("span",null,"".concat(we.length,"/100"))));case 1:return d.a.createElement("div",{className:"step-1-wrapper"},d.a.createElement("p",null,1!==w?"请选中需要下发的配置数据，并配置下发数据的值":"该产品使用了CLink标准数据格式（十六进制），需全量下发配置更新数据"),d.a.createElement("div",{className:"table-wrapper"},d.a.createElement(n.a,{columns:Ge,rowSelection:1!==w?He:null,dataSource:i,scroll:{y:300},pagination:!1})));case 2:return d.a.createElement("div",{className:"step-2-wrapper"},d.a.createElement("div",{className:"device-select-wrapper flex-row"},d.a.createElement("div",{className:"left flex1"},d.a.createElement("p",null,"选择配置更新的设备"),d.a.createElement(b.a,{value:W,onChange:Je},d.a.createElement(D,{value:1,key:1},"全部设备"),d.a.createElement(D,{value:2,key:2},"通过设备ID/物理地址查找"),d.a.createElement(D,{value:3,key:3},"导入设备列表（本地文件）")),2===W&&d.a.createElement(N,{enterButton:"查 找",loading:ce,onSearch:Me,maxLength:50,placeholder:"请输入设备ID/物理地址查找"}),3===W?d.a.createElement("section",{className:"file-upload-area"},d.a.createElement("p",null,"选择本地的设备数据文件上传 ",d.a.createElement("a",{onClick:Be},"设备数据模板")),d.a.createElement("p",null,"每次添加最多支持20,000个设备"),ve?d.a.createElement("div",null,d.a.createElement("div",{className:"result-area"},d.a.createElement("h3",null,me||"--"),d.a.createElement("p",null,"共".concat(je.length,"条数据")),d.a.createElement("p",null,"".concat(Ce.length,"台设备成功匹配")),d.a.createElement("p",null,"".concat(Ne.length,"条数据匹配失败"))),d.a.createElement("div",{className:"tools"},d.a.createElement("a",{onClick:function(){return ge(!1)}},"重新上传"),d.a.createElement("a",{onClick:function(){return ue(O(O({},se),{},{errorVisible:!0}))}},"错误日志"))):d.a.createElement("div",null,d.a.createElement("div",{className:"file-input-wrapper"},d.a.createElement(l.a,{type:"primary"},d.a.createElement(c.a,{type:"upload"})," 选择本地设备数据文件"),d.a.createElement("input",{type:"file",onInput:ze,accept:".xls,.xlsx"})),d.a.createElement("p",null,"支持xls，xlsx格式，文件大小不超过10MB"))):2===W?d.a.createElement(n.a,{columns:We,dataSource:Ze,rowSelection:Ye,pagination:!1}):d.a.createElement(n.a,{columns:We,dataSource:Ze,rowSelection:Ye,pagination:{total:Le.totalRows,defaultCurrent:1,defaultPageSize:Le.currPageRows,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",onChange:function(e){return Ue(e)},showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}})),d.a.createElement("div",{className:"center"},d.a.createElement(l.a,{type:"primary",disabled:0===X.length,onClick:Ke},"选择设备")),d.a.createElement("div",{className:"right flex1"},d.a.createElement("p",null,"已选中配置更新的设备"),d.a.createElement(N,{enterButton:"查 找",ref:Oe,onSearch:Qe,maxLength:50,placeholder:"请输入设备ID/物理地址查找"}),d.a.createElement("div",{className:"tools-wrapper"},d.a.createElement("a",{className:Ie.length>0?"":"disable",onClick:_e},"取消选中")),d.a.createElement(n.a,{columns:We,rowSelection:Xe,dataSource:Te,pagination:{total:Te.length,defaultCurrent:1,defaultPageSize:7,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}}))))}}()),d.a.createElement("div",{className:"r-footer"},d.a.createElement("span",null,j>0&&d.a.createElement(l.a,{onClick:function(){return T(j-1)},type:"primary"},"上一步"),d.a.createElement(l.a,{onClick:function(){if(0===j){if(!we)return void Object(I.a)({description:"请输入远程配置的备注信息"})}else if(1===j){var e=[];if(1!==w){if(Q.length<1)return void Object(I.a)({description:"请至少选择一条配置协议"});Q.forEach((function(t){[""," ",null,void 0].includes(q[t])&&e.push(t)}))}else q.forEach((function(t,a){[""," ",null,void 0].includes(t)&&e.push(a)}));if(e.length>0)return Object(I.a)({description:"请为配置协议添加参数"}),void _(e)}else if(2===j&&Re.length<1)return void Object(I.a)({description:"请至少选择一个设备"});j===Ae?Ve(!o):T(j+1)},type:"primary"},j===Ae?"提交执行":"下一步"),d.a.createElement(l.a,{onClick:function(){2===j?Ve():r()},type:2===j?"primary":"default"},2===j?"保存":"取消"))),De&&d.a.createElement(F,{visible:De,errorList:Ne,onCancel:function(){return ue(O(O({},se),{},{errorVisible:!1}))}})))}function P(e){var t=e.visible,a=e.record,r=e.statusText,c=e.onCancel,o=e.searchDeviceResult,s=e.isDeviceRomote,f=S(Object(u.useState)({selectType:1,keyWords:"",filterStatus:0}),2),v=f[0],g=f[1],y=S(Object(u.useState)({errorLogVisible:!1,errorLogRecord:{}}),2),I=y[0],k=y[1],x=a.taskId,L=a.taskExplain,j=a.status,C=a.execTime,N=a.protocolConfig,R=a.total,A=a.success,P=a.inExec,U=a.fail,q=a.list,F=void 0===q?[]:q,J=a.pager,M=void 0===J?{}:J,Q=v.selectType,B=v.keyWords,z=v.filterStatus,K=I.errorLogVisible,_=I.errorLogRecord,G=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"物理地址",dataIndex:"macAddress",width:200,key:"macAddress"},{title:"配置结果",dataIndex:"status",key:"status",width:160,render:function(e,t){var a=t.status;return d.a.createElement("span",{className:"verify-statu-".concat(a)},T[a-1])}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.status,n=t.remoteId;t.receiveMsg,t.errorType;return d.a.createElement("span",null,""+a=="4"?d.a.createElement(d.a.Fragment,null,d.a.createElement("a",{onClick:function(){return function(e){Object(m.c)(m.a.retryByTaskId,{remoteId:e}).then((function(e){H(M.pageIndex)}))}(n)}},"重试"),d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return function(e){var t=e.remoteId,a=e.errorType;2==a?Object(m.c)(m.a.getReceiveMsg,{remoteId:t},{loading:!0}).then((function(e){k({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:e.data&&e.data.receiveMsg}})})):k({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:null}})}(t)}},"日志")):null)}}],W=function(e,t){g(O(O({},v),{},w({},t,e)))},H=function(e){var t={};e&&(t.pageIndex=e),B&&(t[1===Q?"deviceUniqueId":"macAddress"]=B),z&&(t.status=z),t.taskId=x,o(t)};return d.a.createElement(E.a,{visible:t,width:1e3,className:"romote-modal",title:"远程配置任务",centered:!0,closable:!0,onOk:null,onCancel:c,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",{className:"romote-detail-content height-premit"},d.a.createElement("h3",null,"基础信息"),d.a.createElement("div",{className:"base-info"},d.a.createElement("p",null,d.a.createElement("span",null,"任务ID"),d.a.createElement("span",null,x||"--")),d.a.createElement("p",null,d.a.createElement("span",null,"任务说明"),d.a.createElement("span",null,L||"--")),d.a.createElement("p",null,d.a.createElement("span",null,"任务状态"),d.a.createElement("span",null,r[j]||"--")),d.a.createElement("p",null,d.a.createElement("span",null,"执行时间"),d.a.createElement("span",null,p.a.utcToDev(C)||"--"))),d.a.createElement("h3",null,"配置数据"),d.a.createElement(n.a,{columns:[{title:"数据名称",dataIndex:"propertyName",key:"propertyName",width:200},{title:"数据标识",dataIndex:"property",width:240,key:"property"},{title:"数据类型",dataIndex:"_type",key:"_type",width:120},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"},{title:"下发数据",dataIndex:"sendData",key:"sendData",width:140}],dataSource:N||[],pagination:!1}),!s&&d.a.createElement(d.a.Fragment,null,d.a.createElement("h3",null,"配置设备"),d.a.createElement("div",{className:"device-wrapper"},d.a.createElement("div",null,d.a.createElement("h4",null,"配置设备数"),d.a.createElement("p",null,Number.isInteger(R)?R:"--")),d.a.createElement("div",null,d.a.createElement("h4",null,"配置成功"),d.a.createElement("p",null,Number.isInteger(A)?A:"--")),d.a.createElement("div",null,d.a.createElement("h4",null,"执行中"),d.a.createElement("p",null,Number.isInteger(P)?P:"--")),d.a.createElement("div",null,d.a.createElement("h4",null,"配置失败"),d.a.createElement("p",null,Number.isInteger(U)?U:"--")),d.a.createElement("div",null,d.a.createElement("span",{className:0==+U?"disable":"",onClick:+U>0?function(){Object(m.c)(m.a.batchRetry,{taskId:x}).then((function(e){H()}))}:null},"批量重试"))),d.a.createElement("div",{className:"filter-wrapper"},d.a.createElement(b.a,{value:Q,onChange:function(e){return W(e,"selectType")}},d.a.createElement(D,{key:"1",value:1},"设备ID"),d.a.createElement(D,{key:"2",value:2},"物理地址")),d.a.createElement(h.a,{placeholder:"支持精确查询",value:B,maxLength:50,onChange:function(e){return W(e.target.value,"keyWords")}}),d.a.createElement("span",null,"配置结果"),d.a.createElement(b.a,{value:z,onChange:function(e){return W(e,"filterStatus")}},d.a.createElement(D,{key:"0",value:0},"全部"),d.a.createElement(D,{key:"1",value:1},"待执行"),d.a.createElement(D,{key:"2",value:2},"执行中"),d.a.createElement(D,{key:"3",value:3},"执行成功"),d.a.createElement(D,{key:"4",value:4},"执行失败")),d.a.createElement(l.a,{type:"primary",onClick:function(){return H()}},"查找"),d.a.createElement(l.a,{type:"primary",onClick:function(){Object(m.c)(m.a.exportTaskResult,{taskId:x}).then((function(e){window.open(m.a.exportTaskResult+"?taskId=".concat(x))}))}},"导出数据")),d.a.createElement(n.a,{columns:G,dataSource:F||[],pagination:{total:M.totalRows,current:M.pageIndex,defaultCurrent:1,defaultPageSize:M.defaultPageRows,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",onChange:function(e){return H(e)},showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}}),K&&d.a.createElement(V,{visible:K,onCancel:function(){return k({errorLogVisible:!1,errorLogRecord:{}})},record:_}))))}var U=["没问题","下发配置数据失败","上报的配置数据不一致","上报的配置数据在超时时间内未获取到","存在相同的设备在执行远程配置任务","后台数据异常"];function V(e){var t=e.visible,a=e.record,n=e.onCancel,r=a.errorType,l=a.receiveMsg;return d.a.createElement(E.a,{visible:t,width:600,className:"romote-modal",title:"日志",centered:!0,closable:!0,onOk:null,onCancel:n,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",{className:"remote-error-wrapper"},d.a.createElement("div",null,d.a.createElement("label",null,"失败原因：")," ",d.a.createElement("span",null,U[r])),d.a.createElement("div",null,d.a.createElement("label",null,"报文信息："),d.a.createElement("div",{className:"msg-wrap"},function(e){if(!e)return d.a.createElement("h4",null,"无报文信息");var t=JSON.parse(e),a=Object.keys(t);return d.a.createElement(d.a.Fragment,null,d.a.createElement("h4",null,"报文解析列表"),a.map((function(e){return d.a.createElement("div",{className:"log-row"},d.a.createElement("span",{className:"log-left-key"},e),d.a.createElement("span",{className:"log-right-content"},t[e]))})))}(l)))))}var q=["设备ID的长度超过限制","物理地址的长度超限制","设备ID发生重复","物理地址发生重复","设备ID不存在或未联网","物理地址不存在或未联网"];function F(e){var t=e.visible,a=e.errorList,r=e.onCancel,l=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"错误原因",dataIndex:"errorType",width:200,key:"errorType",render:function(e,t){var a=t.errorType;return d.a.createElement("span",null,q[a-1])}}];return d.a.createElement(E.a,{visible:t,width:600,className:"romote-modal",title:"设备导入错误日志",centered:!0,closable:!0,onOk:null,onCancel:r,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",null,d.a.createElement(n.a,{columns:l,dataSource:a||[],pagination:{total:a.length,defaultCurrent:1,defaultPageSize:10,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}})))}a("40NI");var J=a("FC04");function M(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?M(Object(a),!0).forEach((function(t){B(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return K(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return K(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var _=["平台支持远程更新设备的配置数据，您可以提交远程配置任务，实时对设备的系统参数等数据进行远程更新，并且获取设备配置的更新状态；详细说明可参考文档"],G=[{title:"创建远程配置任务"},{title:"添加配置数据"},{title:"选择设备"},{title:"执行任务"}],W=["草稿","待执行","执行中","已执行"],H=["","执行中","执行成功","执行失败"];function Y(e){var t=e.productId,a=e.protocolLists,o=void 0===a?[]:a,E=e.remoteType,y=void 0===E?"product":E,b=e.deviceId,h=e.deviceUniqueId,I=e.macAddress,k=z(Object(u.useState)(!1),2),O=k[0],w=k[1],x=z(Object(u.useState)({detailVisible:!1,selectRecord:{}}),2),S=x[0],L=x[1],j=z(Object(u.useState)([]),2),C=j[0],N=j[1],D=z(Object(u.useState)({pageIndex:1}),2),R=D[0],T=D[1],U=z(Object(u.useState)({deletevisible:!1,deleteItem:null,deleteLoading:!1}),2),q=U[0],F=U[1],M=z(Object(u.useState)([]),2),B=M[0],K=M[1],Y=z(Object(u.useState)(0),2),X=Y[0],Z=Y[1],$=z(Object(u.useState)(null),2),ee=$[0],te=$[1],ae=z(Object(u.useState)({errorLogVisible:!1,errorLogRecord:{}}),2),ne=ae[0],re=ae[1],le=ne.errorLogVisible,ce=ne.errorLogRecord,ie=R.totalRows,oe=R.pageIndex,se=R.pageRows,ue=q.deletevisible,de=q.deleteItem,me=q.deleteLoading,pe=S.detailVisible,fe=S.selectRecord,ve="device"===y,ge=s()(G);ve&&ge.splice(2,1);var Ee=ve?H:W,ye=[{title:"任务ID",dataIndex:"taskId",key:"taskId",width:200},{title:"任务说明",dataIndex:"taskExplain",key:"taskExplain"},{title:"更新设备数量",dataIndex:"deviceTotal",key:"deviceTotal",width:180},{title:"任务状态",dataIndex:"status",key:"status",width:180,render:function(e,t){var a=t.status;return d.a.createElement("span",{className:"h5-statu-".concat(a+1)},Ee[a])}},{title:"执行时间",dataIndex:"execTime",key:"execTime",width:180,render:function(e,t){var a=t.execTime;return d.a.createElement("span",null,a?p.a.utcToDev(a):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.status,n=t.taskId;return ve?d.a.createElement("span",null,d.a.createElement("a",{onClick:function(){return Ie(t)}},"查看"),""+a=="3"?d.a.createElement(d.a.Fragment,null,d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return xe(n)}},"重试"),d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return Se(t)}},"日志")):null):d.a.createElement("span",null,""+a=="1"?d.a.createElement(d.a.Fragment,null,d.a.createElement("a",{onClick:function(){return he(t)}},"编辑"),d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return F({deletevisible:!0,deleteItem:t})}},"删除")):d.a.createElement("a",{onClick:function(){return Ie(t)}},"查看"))}}];ve&&ye.splice(2,1);var be=function(e){var a=m.a.getRomoteConfigListByProduct,n={pageIndex:e||oe,pageRows:10};ve?(a=m.a.getRomoteConfigListForDevice,n.deviceId=b):n.productId=t,Object(m.c)(a,n).then((function(e){var t=e.data,a=t.pager,n=void 0===a?{}:a,r=t.list,l=void 0===r?[]:r;N(Object(p.c)(l)),T(n)}))};Object(u.useEffect)((function(){be()}),[t,oe,ve,b]),Object(u.useEffect)((function(){var e=o.filter((function(e){return 5==e.dataType})),t=e[0]&&e[0].list||[],a=e[0]&&e[0].protocolFormat||0;t=(t=t.filter((function(e){return"Base_Null_Reserved_Null"!==e.property}))).map((function(e,t){var a=e.propertyValueDesc,n=null;if(a&&a.indexOf("|")>-1&&(n=a.split("|").map((function(e){var t=e.split("-");return t.length>1?{name:t[1],value:t[0]}:{}}))),a&&a.indexOf("~")>-1){var r=z(a.split("~"),2);n={min:+r[0],max:+r[1]}}return Q(Q({},e),{},{_type:Object(p.q)(e),_params:n,_index:t,key:t})})),K(t),Z(a)}),[o]);var he=function(e){if(e){var t=e.taskId;ke(t,1).then((function(e){var t=e.data,a=t.taskExplain,n=t.taskId,r=t.protocolJson,l=t.deviceList,c=JSON.parse(r),i=c.map((function(e){return e.property})),o=B.map((function(e){return e.defaultPropertyValue||""})),s=[];B.forEach((function(e,t){var a=e.property,n=i.indexOf(a);n>-1&&(o[t]=c[n].sendData,s.push(t))})),l.forEach((function(e){return e.key=e.deviceUniqueId})),te({taskId:n,taskExplain:a,deviceList:l,protocolSendData:o,protocolSelection:s}),w(!O)}))}else B.length>0&&w(!O)},Ie=function(e){var t=e.taskId;ve?Object(m.c)(m.a.getRemoteDetailForDevice,{taskId:t},{loading:!0}).then((function(t){var a=t.data.protocolJson;L({detailVisible:!pe,selectRecord:Q(Q({},e),{},{protocolConfig:JSON.parse(a)})})})):Promise.all([ke(t,2),Oe(t),we({taskId:t})]).then((function(t){var a=z(t,3),n=a[0],r=a[1],l=a[2],c=n.data.protocolJson,i=void 0===c?"[]":c,o=r.data,s=l.data,u=s.list,d=s.pager;L({detailVisible:!pe,selectRecord:Q(Q(Q({},e),{},{protocolConfig:JSON.parse(i)},o),{},{list:u,pager:d})})}))},ke=function(e,t){return Object(m.c)(m.a.getRemoteDetail,{taskId:e,type:t},{loading:!0})},Oe=function(e){return Object(m.c)(m.a.getResultTotal,{taskId:e},{loading:!0})},we=function(e){return Object(m.c)(m.a.getDeviceResultList,Q({},e),{loading:!0})},xe=function(e){Object(m.c)(m.a.retryByTaskIdForDevice,{taskId:e},{loading:!0}).then((function(e){be(oe)}))},Se=function(e){var t=e.taskId,a=e.errorType;2==a?Object(m.c)(m.a.getReceiveMsgForDevice,{taskId:t},{loading:!0}).then((function(e){re({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:e.data&&e.data.receiveMsg}})})):re({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:null}})};return d.a.createElement("div",{className:"remote-config-wrapper"},d.a.createElement(f.a,{style:{margin:"0 0 24px",padding:"24px"}},d.a.createElement(v.a,{desc:_}),d.a.createElement("div",{style:{padding:"24px 0 0"},className:"use-service-flow-wrapper"},d.a.createElement(g.a,{type:3,flowLists:ge}),d.a.createElement("div",{className:"extra-descs"},d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"创建远程配置任务，填写任务的目的或备注信息")),d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"添加要更新的产品配置数据字段和更新的数值")),!ve&&d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"可通过设备ID/物理地址，设备标签，本地导入确定要配置的设备")),d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"提交执行远程配置任务，设备更新结果实时可见"))))),d.a.createElement("section",{className:"remote-config-manage-wrapper section-bg"},d.a.createElement("h3",null,"远程配置任务",B.length?d.a.createElement(l.a,{style:{float:"right"},type:"primary",onClick:function(){return he()}},d.a.createElement(c.a,{type:"plus"}),"创建任务"):d.a.createElement(r.a,{title:"无配置协议时不支持创建"},d.a.createElement(l.a,{style:{float:"right"},type:"primary",disabled:!0},d.a.createElement(c.a,{type:"plus"}),"创建任务"))),d.a.createElement("div",{className:"table-wrapper"},d.a.createElement(n.a,{columns:ye,className:"ant-table-fixed",dataSource:C,pagination:{total:ie,current:oe,defaultCurrent:1,defaultPageSize:10,onChange:function(e){return function(e){be(e)}(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}})),O&&d.a.createElement(A,{visible:O,productId:t,protocolFormat:X,onCancel:function(){w(!1),te(null)},editData:ee,configProtoclList:B,getRemoteList:be,isDeviceRomote:ve,_deviceList:[{deviceId:b,deviceUniqueId:h,macAddress:I}]}),pe&&d.a.createElement(P,{visible:pe,record:fe,statusText:Ee,isDeviceRomote:ve,searchDeviceResult:function(e){we(e).then((function(e){var t=e.data,a=t.list,n=t.pager;L({detailVisible:pe,selectRecord:Q(Q({},fe),{},{list:a,pager:n})})}))},onCancel:function(){return L({detailVisible:!1,selectRecord:{}})}})),ue&&d.a.createElement(J.a,{visible:ue,modalOKHandle:function(){var e=de.taskId;F(Q(Q({},q),{},{deleteLoading:!0})),Object(m.c)(m.a.deleteRomoteConfig,{taskId:e}).then((function(e){be(se>1?oe:oe-1>0?oe-1:1)})).finally((function(){F({deletevisible:!1,deleteItem:null,deleteLoading:!1})}))},modalCancelHandle:function(){return F({deletevisible:!1,deleteItem:null,deleteLoading:!1})},targetName:de.taskId,confirmLoading:me,title:"删除任务",needWarnIcon:!0,descText:"即将删除的任务",tipText:"任务的所有信息将完全被删除，无法找回，请谨慎操作"}),le&&d.a.createElement(V,{visible:le,onCancel:function(){return re({errorLogVisible:!1,errorLogRecord:{}})},record:ce}))}},YNSc:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("72Pr");var n=a("O4+N"),r=a("q+fq"),l=a.n(r),c=a("cu44"),i=[{title:"Topic",dataIndex:"topic",key:"topic"},{title:"描述",dataIndex:"desc",key:"desc"}];function o(e){var t=e.productIdHex,a=void 0===t?"":t,r=(e.type,[{fn:"属性",topic:"/sys/".concat(a,"/thing/event/property/post"),desc:"设备属性上报"},{fn:"事件info",topic:"/sys/".concat(a,"/device/thing/event/info/post"),desc:"设备信息通知"},{fn:"事件error",topic:"/sys/".concat(a,"/device/thing/event/error/post"),desc:"设备故障上报"},{fn:"事件alert",topic:"/sys/".concat(a,"/device/thing/event/alert/post"),desc:"设备告警"}]);return l.a.createElement(c.a,{title:"topic列表"},l.a.createElement("div",{style:{padding:"12px"}},l.a.createElement(n.a,{columns:i,dataSource:r,key:"topic",pagination:!1})))}}}]);