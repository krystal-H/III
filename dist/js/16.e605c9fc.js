(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"17x9":function(e,t,a){e.exports=a("WUjv")(13)},"2mql":function(e,t,a){e.exports=a("WUjv")(21)},FbVF:function(e,t,a){"use strict";a.r(t);a("rB9j"),a("Rm1S");var n=a("q1tI"),r=a.n(n),o=a("55Ip"),c=(a("NBAS"),a("SuFq"),a("tkto"),a("pNMO"),a("TeQF"),a("5DmW"),a("FZtP"),a("27RR"),a("4Brf"),a("07d7"),a("0oug"),a("4mDm"),a("PKPk"),a("3bBZ"),a("mbEz"),a("wCAj")),l=(a("L/Qf"),a("2/Rp")),u=(a("Y2jk"),a("zeV3")),s=(a("0lcf"),a("mr32")),d=(a("k3Gp"),a("kLXV")),f=(a("8QGh"),a("2fM7")),m=(a("1vPl"),a("5rEg")),p=(a("RKNx"),a("L41K")),b=(a("fbCW"),a("2B1R"),a("/MKj")),y=a("Nlzp"),v=(a("sMBO"),a("pjDv"),a("zKZe"),a("AUBz"),a("ZTPi")),h=(a("7W5+"),a("8z0m")),g=(a("K4yd"),a("9yH6")),E=(a("tULf"),a("Vl3Y")),w=(a("x0AG"),a("+2oP"),a("ma9I"),a("z7Xi")),O=a("P2RN"),I=a("rwTb"),j=[{nam:"待验证",color:"blue"},{nam:"验证中",color:"gold"},{nam:"已发布",color:"green"},{nam:"验证完成",color:"lime"}],V=[{nam:"待升级",color:"blue"},{nam:"升级中",color:"gold"},{nam:"升级成功",color:"green"},{nam:"升级失败",color:"magenta"},{nam:"取消",color:"geekblue"},{nam:"下载结束",color:"geekblue"},{nam:"重置升级",color:"geekblue"}],S={strextVer:/^[a-zA-Z0-9_\-\.]{1,30}$/,verNam:/^[a-zA-Z0-9\u4e00-\u9fa5][a-zA-Z0-9_\u4e00-\u9fa5]{0,39}$/,mainVer:/^[0-9]*$/,url:/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/},x=[{id:1,nam:"普通升级",desc:"用户可感知，升级触发时用户可以在app上查看到升级提醒，确认后才能升级"},{id:2,nam:"强制升级",desc:"用户可感知，在app上查看到升级提示，无需确认自动开始升级"},{id:3,nam:"静默升级",desc:"用户无感知，无需确认，设备主动请求升级"},{id:4,nam:"推送升级",desc:"用户无感知，无需确认，平台主动推送下发升级到设备（需配置升级策略）"}],P=[{id:0,nam:"全部设备"},{id:1,nam:"设备分组"},{id:2,nam:"指定设备"}],T=[{id:0,nam:"不重试"},{id:1,nam:"30分钟后"},{id:2,nam:"1小时后"}],D=[{id:1,nam:"1 次"},{id:2,nam:"2 次"},{id:3,nam:"3 次"}],C=["触发升级","定时升级"],F=[{id:2,nam:"MCU"},{id:3,nam:"SoC"},{id:5,nam:"系统方案"}],_={2:"模块",3:"插件",5:"升级包"},k=a("2C8d");function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function R(e){return function(e){if(Array.isArray(e))return Y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||U(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function L(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(Object(a),!0).forEach((function(t){B(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return o}(e,t)||U(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){if(e){if("string"==typeof e)return Y(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Y(e,t):void 0}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var q=f.a.Option,z=E.a.Item,H={labelCol:{span:6},wrapperCol:{span:16}},G=Object(b.connect)((function(e){var t=e.get("otaUpgrade");return{mcusocproLi:t.mcusocproLi,firmwareFrPro:t.firmwareFrPro}}),(function(e){return{getVersionLi:function(t){return e(Object(k.d)(t))},firmwareLastVersion:function(t){return e(Object(k.a)(t))}}}))((function(e){var t=e.changeState,a=e.editId,o=e.editProductFirParams,c=e.firmwareLastVersion,u=e.mcusocproLi,s=e.firmwareFrPro,p=e.getVersionLi,b=M(Object(n.useState)(1),2),j=b[0],V=b[1],x=M(Object(n.useState)(1),2),P=x[0],T=x[1],D=M(Object(n.useState)("tab0"),2),C=D[0],k=D[1],A=M(Object(n.useState)([]),2),U=A[0],Y=A[1],G=M(Object(n.useState)([]),2),Q=G[0],K=G[1],W=M(Object(n.useState)({}),2),J=W[0],Z=W[1],X=M(Object(n.useState)([]),2),$=X[0],ee=X[1],te=J.f_firmwareVersionTypeName,ae=J.f_curExtVersion,ne=s.schemeType,re=void 0===ne?o.schemeType:ne,oe=s.productFirmwareVersion,ie=void 0===oe?0:oe,ce=s.productId,le=s.productName,ue=s.summaryVersions,se=(void 0===ue?[]:ue).find((function(e){return 0==e.firmwareVersionType}))||{},de=se.firmwareVersionTypeName,fe=se.curExtVersion,me=M(Object(n.useState)(["tab0"]),2),pe=me[0],be=me[1],ye=M(E.a.useForm(),1)[0],ve=Object(n.useRef)(0);Object(n.useEffect)((function(){2==re&&Object(y.c)(y.a.getModuleDeviceVersionList,{productId:a||ce},{loading:!0}).then((function(e){var t=e.data,a=void 0===t?{}:t;Y(a),console.log(777,a)}))}),[re]),Object(n.useEffect)((function(){a&&(he(a),Object(y.c)(y.a.otaDevVersionList,L({},o)).then((function(e){var t=e.data;K(void 0===t?[]:t)})))}),[a]),Object(n.useEffect)((function(){if(Q.length){var e=JSON.parse(JSON.stringify(Q)),t=null;if(e.findIndex((function(e){return 0==e.firmwareVersionType}))>-1&&(t=e.slice(i,1),T(0),Z(t),ye.setFields({modUpgrade:0,f_extVersion:t.extVersion}),3==re&&ye.setFields({f_totalVersion:t.totalVersion,f_filePath:t.filePath})),e.length){V(0),ee(e),ye.setFieldsValue({mcuUpgrade:0});for(var a=[],n={},r=0;r<e.length;r++){var o="tab"+r,c=e[r];a.push(o);var l=c.firmwareVersionTypeName,u=c.firmwareTypeNo,s=c.totalVersion,d=c.extVersion,f=c.filePath;n["firmwareVersionTypeName_"+o]=l,n["firmwareTypeNo_"+o]=u,n["totalVersion_"+o]=s,n["extVersion_"+o]=d,n["filePath_"+o]=f}console.log("--form_val--",n),be(a)}}}),[Q]);var he=function(e){c(e)},ge=function(){var e="newTab".concat(ve.current++);be((function(t){return[].concat(R(t),[e])})),k(e)},Ee=function(e){var t=C,a=-1;pe.forEach((function(t,n){t===e&&(a=n-1)}));var n=pe.filter((function(t){return t!==e}));n.length&&t===e&&(t=a>=0?n[a]:n[0]),be(n),k(t)};return r.a.createElement(d.a,{title:a?"修改固件":"新增固件"+a,visible:!0,onOk:ye.submit,onCancel:function(){t("addFirmwareVisiable",!1),t("editId",0),t("editProductFirParams",{})},width:650,maskClosable:!1},r.a.createElement(E.a,N({form:ye},H,{className:"ota_add_firmware_dialog",onFinish:function(e){console.log("---formvalues---",e);var n=e.productId,r=e.productFirmwareName,o=e.f_firmwareVersionTypeName,i=e.f_curExtVersion,c=e.f_extVersion,l=e.f_totalVersion,u=e.f_filePath,s={productId:a||n,productFirmwareName:r,productFirmwareVersion:ie+1};if(5==re||0==j){var d=pe.map((function(t,a){var r=e["firmwareTypeNo_".concat(t)];return{deviceVersionName:e["firmwareVersionTypeName_".concat(t)],firmwareVersionType:r,mainVersion:"",extVersion:e["extVersion_".concat(t)],totalVersion:e["totalVersion_".concat(t)],filePath:e["filePath_".concat(t)],productId:n,deviceVersionType:re,deviceVersionId:$[a]&&$[a].deviceVersionId}}));s=L(L({},s),{},{deviceVersions:d})}if(5!=re&&0==P){var f={firmwareVersionType:0,deviceVersionName:o,mainVersion:"",extVersion:c,totalVersion:l,filePath:u,productId:n,deviceVersionType:re,curExtVersion:i,deviceVersionId:J.deviceVersionId};s.deviceVersions?s.deviceVersions.push(f):s.deviceVersions=[f]}Object(y.c)(y.a.otaAddVersion,s).then((function(e){Object(O.a)({type:"success",description:"操作成功！"}),p(),t("addFirmwareVisiable",!1),t("editId",0),t("editProductFirParams",{})}))},id:"area"}),a&&r.a.createElement(z,{label:"产品名称"}," ",le)||r.a.createElement(z,{label:"产品名称",name:"productId",rules:[{required:!0,message:"请选择产品"}]},r.a.createElement(f.a,{showSearch:!0,optionFilterProp:"children",placeholder:"请选择产品",onChange:he,getPopupContainer:function(){return document.getElementById("area")}},u.map((function(e){var t=e.productName,a=e.productId;return r.a.createElement(q,{key:a,value:a},t)})))),r.a.createElement(z,{label:"开发方案"}," ",re&&F.find((function(e){return e.id==re})).nam||"--"),r.a.createElement(z,{label:r.a.createElement(I.a,{label:"产品版本号",tip:"产品版本自动生成，自增长，产品的整体内部版本号"})},ie+1),r.a.createElement(z,{label:"产品版本名称",name:"productFirmwareName",rules:[{required:!0,message:"请输入产品版本名称"}]},r.a.createElement(m.a,{maxLength:30,placeholder:"最多30个字符"})),5==re?r.a.createElement(z,{label:"操作系统"},"Android/Linux"):2==re||3==re?r.a.createElement(z,{label:"通信模组升级",name:"modUpgrade",initialValue:1},r.a.createElement(g.a.Group,{onChange:function(e){T(e.target.value)}},r.a.createElement(g.a.Button,{value:1},"不升级"),r.a.createElement(g.a.Button,{value:0},"升级"))):null,2==re&&0==P&&r.a.createElement("div",{className:"modupbox"},r.a.createElement(z,{label:"通信模组",name:"f_firmwareVersionTypeName"},te||de),r.a.createElement(z,{label:"当前模组固件版本",name:"f_curExtVersion"}," ",ae||fe),r.a.createElement(z,{label:"最新模组固件版本",name:"f_extVersion",rules:[{required:!0,message:"请选择"}]},r.a.createElement(f.a,{placeholder:"请选择",getPopupContainer:function(){return document.getElementById("area")}},U.map((function(e){var t=e.deviceVersionId;return r.a.createElement(q,{key:t,value:t},t)})))),r.a.createElement("div",{className:"tips"},"备注：自动获取最新模组固件版本，点确定可进行验证和升级。")),3==re&&0==P&&r.a.createElement("div",{className:"modupbox"},r.a.createElement(z,{label:"通信模组",name:"f_firmwareVersionTypeName"},te||de),r.a.createElement(z,{label:"硬件版本号",name:"f_totalVersion"}," ",r.a.createElement(m.a,{maxLength:30,placeholder:"非必填"})," "),r.a.createElement(z,{label:"当前软件版本号",name:"f_curExtVersion"},ae||fe),r.a.createElement(z,{label:"待上传软件版本号",name:"f_extVersion",rules:[{required:!0,message:"待上传软件版本号"}]},r.a.createElement(m.a,{maxLength:30,placeholder:"最多30个字符"})),r.a.createElement(z,{label:"固件程序",name:"f_filePath",rules:[{required:!0,message:"请输入URL"},{pattern:S.url,message:"请输入正确的URL"}]},r.a.createElement(m.a,{maxLength:200,placeholder:"请输入URL或者上传一个附件自动填充"})),r.a.createElement(h.a,{className:"filepathinpt",onChange:function(e){var t=e.file;if(t.response){var a=t.response.data&&t.response.data.url||"";ye.setFieldsValue({f_filePath:a})}"removed"==t.status&&ye.setFieldsValue({f_filePath:""})},accept:".bin,.hex,.zip,.cyacd,.apk,.dpkg",maxCount:1,action:y.a.upFileUrl,data:{appId:31438,domainType:4}},r.a.createElement(l.a,{type:"primary"},r.a.createElement(w.a,null),"上传附件"),r.a.createElement("div",null,"支持.bin,.hex,.zip,.cyacd,.apk,.dpkg格式，不超过200MB。"))),(2==re||3==re)&&r.a.createElement(z,{label:["","","MCU升级","自定义插件升级"][re],name:"mcuUpgrade",initialValue:1},r.a.createElement(g.a.Group,{onChange:function(e){V(e.target.value)}},r.a.createElement(g.a.Button,{value:1},"不升级"),r.a.createElement(g.a.Button,{value:0},"升级"))),(5==re||0==j)&&r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{className:"tabs",type:"editable-card",onChange:function(e){k(e)},activeKey:C,onEdit:function(e,t){"add"===t?(pe.length,ge()):(console.log("---del--",e),Ee(e))},hideAdd:pe.length>=5},pe.map((function(e,t){return r.a.createElement(v.a.TabPane,{tab:"".concat(_[re]).concat(t),key:e},r.a.createElement(z,{label:_[re]+"名称",name:"firmwareVersionTypeName_".concat(e),rules:[{required:!0,message:"请填写模块名称"}]},r.a.createElement(m.a,{maxLength:30,placeholder:"不超过30字符"})),r.a.createElement(z,{label:_[re]+"编号",name:"firmwareTypeNo_".concat(e),rules:[{required:!0,message:"请填写模块编号"}]},r.a.createElement(m.a,{maxLength:3,placeholder:"请输入1-100的整数字，编号须唯一"})),r.a.createElement(z,{label:"硬件版本号",name:"totalVersion_".concat(e)}," ",r.a.createElement(m.a,{maxLength:30,placeholder:"非必填"})," "),r.a.createElement(z,{label:"待上传软件版本号",name:"extVersion_".concat(e),rules:[{required:!0,message:"待上传软件版本号"}]},r.a.createElement(m.a,{maxLength:30,placeholder:"最多30个字符"})),r.a.createElement(z,{label:"固件程序",name:"filePath_".concat(e),rules:[{required:!0,message:"请输入URL"},{pattern:S.url,message:"请输入正确的URL"}]},r.a.createElement(m.a,{maxLength:200,placeholder:"请输入URL或者上传一个附件自动填充"})))}))),pe.length>0&&r.a.createElement(h.a,{className:"filepathinpt",onChange:function(e){var t=e.file;if(t.response){var a=t.response.data&&t.response.data.url||"";ye.setFieldsValue(B({},"filePath_".concat(C),a))}"removed"==t.status&&ye.setFieldsValue(B({},"filePath_".concat(C),""))},accept:".bin,.hex,.zip,.cyacd,.apk,.dpkg",maxCount:1,action:y.a.upFileUrl,data:{appId:31438,domainType:4}},r.a.createElement(l.a,{type:"primary"},r.a.createElement(w.a,null),"上传附件"),r.a.createElement("div",null,"支持.bin,.hex,.zip,.cyacd,.apk,.dpkg格式，不超过200MB。")))))})),Q=(a("U8R4"),a("+eQT")),K=(a("oVuX"),a("wd/R")),W=a.n(K),J=a("WsrF");a("XlDN");function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var X,$=["upgradeDevice","beginDate","endDate"];function ee(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function te(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function ae(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ne(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ce(e);if(t){var r=ce(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return ie(this,a)}}function ie(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}f.a.Option;var le=m.a.TextArea,ue=(p.a.Step,[5,19]),se={labelCol:{span:ue[0]},wrapperCol:{span:ue[1]}},de=J.a.create({name:"ota_reaease_ver"})(Object(b.connect)(null,(function(e){return{getVersionLi:function(t){return e(Object(k.d)(t))}}}))(X=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(i,e);var t,a,n,o=oe(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).changeState=function(e,a){var n=a.target?a.target.value:a;t.setState(ae({},e,n))},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(O.a)({description:"文件上传大小超过500k限制"}),!1;var a=t.props,n=a.deviceVersionId,r=a.form.setFieldsValue;return Object(y.c)(y.a.otaImportMac,{multipartFile:e,deviceVersionId:n},{needFormData:!0}).then((function(e){var t=e.data,a=void 0===t?{}:t,n=a.successes,o=(a.fails,a.totalCount),i=a.successCount,c=a.failCount,l=n.join(",");r({upgradeDevice:l}),Object(O.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})})),!1},t.commit=function(){var e=t.props,a=e.form.validateFieldsAndScroll,n=e.deviceVersionId,r=e.close;a((function(e,a){if(!e){var o=a.upgradeDevice,i=a.beginDate,c=a.endDate,l=te(a,$);o&&(l.upgradeDevice=o.join&&o.join(",")||o),(i||c)&&(l.beginDate=W()(i).format("YYYY-MM-DD HH:mm:ss"),l.endDate=W()(c).format("YYYY-MM-DD HH:mm:ss")),Object(y.b)(y.a.otaRelease,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(a),!0).forEach((function(t){ae(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ee(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({deviceVersionId:n},l),{loading:!0}).then((function(){t.props.getVersionLi(),r()}))}}))},t.changeUpgradeType=function(e){var a=e.target.value;t.setState({upgradeType:a,upgradeRange:2}),t.props.form.setFieldsValue({upgradeRange:2})},t.state={upgradeType:1,upgradeRange:2,triggerTime:0},t}return t=i,(a=[{key:"render",value:function(){var e,t,a=this,n=this.props.form.getFieldDecorator,o=this.state,i=o.upgradeType,c=o.upgradeRange,u=o.triggerTime,s=x.find((function(e){return e.id==i})).desc;return r.a.createElement("div",{className:"ota_release_dialog"},r.a.createElement(J.a,se,r.a.createElement("div",null,r.a.createElement(J.a.Item,{label:"升级方式",required:!0,help:s,className:"helpitem"},n("upgradeType",{initialValue:1})(r.a.createElement(g.a.Group,{onChange:this.changeUpgradeType},x.map((function(e){var t=e.id,a=e.nam;return r.a.createElement(g.a.Button,{key:t,value:t},a)}))))),r.a.createElement(J.a.Item,{label:"升级提示信息"},n("upgradeRemark")(r.a.createElement(le,{placeholder:"仅普通升级和强制升级时，用户可在app（或设备屏幕）查看到升级提示，最多50个字符",rows:3,maxLength:50}))),r.a.createElement(J.a.Item,{label:"升级范围",required:!0,help:"若选择全部设备，则有且仅能发布一个批次，不能新增其他发布批次",className:"helpitem"},n("upgradeRange",{initialValue:2})(r.a.createElement(g.a.Group,{onChange:function(e){a.changeState("upgradeRange",e)}},4!=i&&r.a.createElement(g.a.Button,{value:0},"全部设备"),r.a.createElement(g.a.Button,{value:2},"指定设备")))),2==c&&r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a.Item,{label:"设备Mac"},n("upgradeDevice",{rules:[{required:!0,message:"请输入或导入要升级的设备Mac"}]})(r.a.createElement(le,{placeholder:"请输入或导入要升级的设备Mac，多个用逗号隔开",rows:5}))),r.a.createElement("div",{className:"ota_uploadbox"},r.a.createElement(h.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},r.a.createElement(l.a,{type:"primary",icon:r.a.createElement(w.a,null)},"批量导入")),r.a.createElement(l.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板"))),4==i&&r.a.createElement("div",null,r.a.createElement(J.a.Item,{label:"升级时间策略",required:!0},n("triggerTime",{initialValue:0})(r.a.createElement(g.a.Group,{onChange:function(e){a.changeState("triggerTime",e)}},r.a.createElement(g.a.Button,{value:0},"触发升级"),r.a.createElement(g.a.Button,{value:1},"定时升级")))),1==u&&r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a.Item,{label:"升级开始时间"},n("beginDate",{rules:[{required:!0,message:"请选择开始时间"}]})(r.a.createElement(Q.a,(ae(e={showTime:!0,placeholder:"请选择开始时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:W()("00:00:00","HH:mm:ss")}),ae(e,"disabledDate",fe),ae(e,"disabledTime",me),e)))),r.a.createElement(J.a.Item,{label:"升级结束时间"},n("endDate",{rules:[{required:!0,message:"请选择结束时间"}]})(r.a.createElement(Q.a,(ae(t={showTime:!0,placeholder:"请选择结束时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:W()("00:00:00","HH:mm:ss")}),ae(t,"disabledDate",fe),ae(t,"disabledTime",me),t))))),r.a.createElement(J.a.Item,{label:"失败重试时间",required:!0},n("retryTime",{initialValue:0})(r.a.createElement(g.a.Group,null,T.map((function(e){var t=e.id,a=e.nam;return r.a.createElement(g.a.Button,{key:t,value:t},a)}))))),r.a.createElement(J.a.Item,{label:"失败重试次数",required:!0},n("retryCount",{initialValue:1})(r.a.createElement(g.a.Group,null,D.map((function(e){var t=e.id,a=e.nam;return r.a.createElement(g.a.Button,{key:t,value:t},a)})))))))),r.a.createElement("div",{className:"btnbox"},r.a.createElement(l.a,{type:"primary",onClick:this.commit},"确定")))}}])&&ne(t.prototype,a),n&&ne(t,n),i}(n.Component))||X);function fe(e){return e&&e<W()().startOf("day")}function me(){return{disabledHours:function(){return pe("h")},disabledMinutes:function(){return pe("m")}}}function pe(e){var t=W()().format(e)-0;console.log(e,W()().format(e));for(var a=[],n=0;n<t;n++)a.push(n);return console.log(e,a),a}a("2DKY");var be=a("+KLJ");function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=we(e);if(t){var r=we(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return Ee(this,a)}}function Ee(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Oe=m.a.TextArea,Ie={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},je=["系统验证：要求输入的设备全部都升级成功到新版本后，状态才更新成验证完成。","手动验证：用户线下自行对设备验证，验证通过后，选择验证完成状态。"],Ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}(i,e);var t,a,n,o=ge(i);function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).changeValidateType=function(){},t.handleSubmit=function(){var e=t.props,a=e.deviceVersionId,n=e.pagerIndex,r=e.pageIndex,o=e.close,i=t.state,c=i.macSet,l=i.validateType,u=i.status;c?Object(y.c)(y.a.otaValidate,{deviceVersionId:a,macSet:c,validateType:l,status:u},{loading:!0}).then((function(e){n(r),o()})):t.setState({error:!0})},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(O.a)({description:"文件上传大小超过500k限制"}),!1;var a=t.props.deviceVersionId;return Object(y.c)(y.a.otaImportMac,{multipartFile:e,deviceVersionId:a},{needFormData:!0}).then((function(e){var a=e.data,n=void 0===a?{}:a,r=n.successes,o=n.totalCount,i=n.successCount,c=n.failCount,l=r.join(",");t.setState({macSet:l}),Object(O.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})})),!1},t.changeValue=function(e,a){var n=a.target.value;t.setState(function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},e,n))};var a=e.validationDetail,n=a.macSet,r=a.validateType;return t.state={status:0,error:!1,macSet:n,validateType:r},t}return t=i,(a=[{key:"render",value:function(){var e=this,t=this.props,a=t.title,n=t.close,o=this.state,i=o.error,c=o.macSet,u=o.validateType,s=o.status;return r.a.createElement(d.a,{title:a,visible:!0,onOk:this.handleSubmit,onCancel:n,width:650,maskClosable:!1},r.a.createElement("div",{className:"ota_validationdialog"},r.a.createElement(E.a,Ie,r.a.createElement(E.a.Item,{label:"验证模式"},r.a.createElement(g.a.Group,{value:+u,onChange:function(t){e.changeValue("validateType",t)}},r.a.createElement(g.a.Button,{value:0},"系统验证"),r.a.createElement(g.a.Button,{value:1},"手动验证"))),r.a.createElement(E.a.Item,{label:"设备Mac",required:!0,help:!c&&i?"请输入或导入要验证的设备Mac":"",validateStatus:!c&&i?"error":""},r.a.createElement(Oe,{value:c,placeholder:"请输入或导入要验证的设备Mac，多个用逗号隔开",rows:7,onChange:function(t){e.changeValue("macSet",t)}})),r.a.createElement("div",{className:"ota_uploadbox"},r.a.createElement(h.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},r.a.createElement(l.a,{type:"primary",icon:r.a.createElement(w.a,null)},"批量导入")),r.a.createElement(l.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板")),1==u&&r.a.createElement(E.a.Item,{label:"线下验证状态"},r.a.createElement(g.a.Group,{value:s,onChange:function(t){e.changeValue("status",t)}},r.a.createElement(g.a.Button,{value:0},"验证中"),r.a.createElement(g.a.Button,{value:1},"验证完成")))),r.a.createElement(be.a,{message:je[u],type:"info",showIcon:!0})))}}])&&ve(t.prototype,a),n&&ve(t,n),i}(n.Component);a("5s+n"),a("p532"),a("p7yf");function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xe(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Pe,Te=[{title:"产品名称",dataIndex:"productName"},{title:"模块/插件",dataIndex:"deviceVersionName"},{title:"模块/插件编号",dataIndex:"firmwareVersionType"},{title:"当前软件版本号",dataIndex:"extVersion"}],De=function(e){var t=e.productFirmwareId,a=e.schemeType,o=e.openClose,i=Se(Object(n.useState)([]),2),l=i[0],u=i[1],s=Se(Object(n.useState)(!0),2),f=s[0],m=s[1];return Object(n.useEffect)((function(){t&&(m(!0),Object(y.c)(y.a.otaDevVersionList,{productFirmwareId:t,schemeType:a}).then((function(e){var t=e.data;u(void 0===t?[]:t)})).finally((function(){return m(!1)})))}),[t]),r.a.createElement(d.a,{title:"查看固件",visible:!!t,width:700,onOk:function(){o()},onCancel:function(){o()},footer:null,afterClose:function(){return u([])}},r.a.createElement(c.a,{className:"viewFirmList-modal",rowKey:"deviceVersionId",columns:Te,dataSource:l,loading:f,pagination:!1,scroll:{y:500}}))},Ce=a("DgvE"),Fe=a("MeRu"),_e=a("QjPx"),ke=a.n(_e);function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ae(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(a),!0).forEach((function(t){Le(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Re(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Le(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Be(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=qe(e);if(t){var r=qe(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return Ye(this,a)}}function Ye(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ze=p.a.Step,He=(m.a.Search,m.a.Group,f.a.Option),Ge=Object(b.connect)((function(e){var t=e.get("otaUpgrade");return{versionList:t.versionList,mcusocproLi:t.mcusocproLi}}),(function(e){return{getVersionLi:function(t){return e(Object(k.d)(t))},getExtVerLi:function(t){return e(Object(k.b)(t))},getMcuSocProLi:function(t){return e(Object(k.c)())}}}))(Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(m,e);var t,a,n,i=Ue(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),console.log(e),(t=i.call(this,e)).editFirmware=function(e,a){t.setState({editId:e,addFirmwareVisiable:!0,editProductFirParams:a})},t.changeState=function(e,a){t.setState(Le({},e,a))},t.switchDialog=function(e){var a=t.state[e];t.setState(Le({},e,!a))},t.openRelease=function(e){t.setState({releaseFirmwareDialog:!0,deviceVersionId:e})},t.openValidation=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{macSet:"",validateType:0};t.setState({validationFirmwareDialog:!0,deviceVersionId:e,validationDetail:a,validationModTit:a.macSet?"修改验证":"验证"})},t.getValidateInfo=function(e){Object(y.b)(y.a.otaValiGetinfo,{deviceVersionId:e}).then((function(e){var a=e.data||[];t.setState({validateInfo:a}),a.length||Object(O.a)({description:"没有查到验证信息"})}))},t.closeValidateInfo=function(){t.setState({validateInfo:[]})},t.deleteConfirm=function(e){d.a.confirm({title:"删除固件",content:"即将删除 ID 为 ".concat(e," 的固件，此固件包下各批次的升级设备信息也将一并删除。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(y.b)(y.a.otaDeleteVer,{deviceVersionId:e}).then((function(e){var a=t.state.pager,n=a.totalRows,r=a.pageIndex;r=n%(10*(r-1))>1?r:r-1,t.pagerIndex(r)}))}})},t.pagerIndex=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=t.state,n=a.productId,r=a.schemeType,o={pageIndex:e};-1!=n&&(o.productId=n),-1!=r&&(o.schemeType=r),t.props.getVersionLi(o)},t.closeValiFirm=function(){t.switchDialog("validationFirmwareDialog")},t.setValidationDetail=function(e,a){var n=t.state.validationDetail;t.setState({validationDetail:Ae(Ae({},n),{},Le({},e,a))})},t.changeProduct=function(e){t.setState({productId:e},(function(){t.pagerIndex(1)}))},t.cngeSchemeType=function(e){t.setState({schemeType:e},(function(){t.pagerIndex(1)}))},t.openCloseViewFirmList=function(e,a){t.setState({viewFirmid:e,viewFirmtype:a})},t.refValidationFirmware=function(){},t.state={versionList:[],pager:{pageIndex:1,totalRows:10},productId:Object(Ce.h)("productId")||"-1",schemeType:void 0,addFirmwareVisiable:!1,validationFirmwareDialog:!1,deviceVersionId:"",validationDetail:{macSet:"",validateType:0},validationModTit:"验证",validateInfo:[],releaseFirmwareDialog:!1,viewFirmid:void 0,viewFirmtype:void 0,editId:0,editProductFirParams:{}},t.columns=[{title:"产品名称",dataIndex:"productName"},{title:"开发方案",dataIndex:"schemeType",render:function(e){return F.find((function(t){return t.id==e})).nam||"脏数据"}},{title:"产品版本号",dataIndex:"productFirmwareVersion"},{title:"固件名称",dataIndex:"productFirmwareName"},{title:"运行状态",dataIndex:"status",render:function(e){var t=j[e],a=t.nam,n=t.color;return r.a.createElement(s.a,{color:n},a)}},{title:"创建时间",dataIndex:"createTime",render:function(e){return r.a.createElement("span",null,e&&Ce.a.utcToDev(e)||"--")}},{title:"操作",dataIndex:"action",render:function(e,a){var n=a.status,i=void 0===n?0:n,c=a.productFirmwareId,l=a.macSet,s=void 0===l?"":l,d=a.validateType,f=void 0===d?0:d,m=a.productId,p=(a.totalVersion,a.productName,a.schemeType);a.firmwareVersionType;return r.a.createElement(u.b,null,r.a.createElement("a",{onClick:function(){t.openCloseViewFirmList(c,p)}},"查看固件"),0==i?r.a.createElement("a",{onClick:function(){t.openValidation(c)}},"验证"):1==i?r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{onClick:function(){t.openValidation(c,{macSet:s,validateType:f||0})}},"修改验证"),r.a.createElement("a",{onClick:function(){t.getValidateInfo(c)}},"查看验证")):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{onClick:function(){t.openRelease(c)}},"发布"),2==i&&r.a.createElement(o.Link,{to:"/open/product/otaUpdate/details/".concat(c)},"查看批次")),i<2&&r.a.createElement("a",{onClick:function(){t.editFirmware(m,{productFirmwareId:c,schemeType:p})}},"修改固件"))}}],t.valInfoColumns=[{title:"Mac地址",dataIndex:"macAddress"},{title:"验证时间",dataIndex:"upgradeTime",render:function(e){return r.a.createElement("span",null,e&&Ce.a.utcToDev(e)||"--")}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"验证状态",dataIndex:"upgradeStatus",render:function(e){var t=V[e],a=t.nam,n=t.color;return r.a.createElement(s.a,{color:n},a)}},{title:"备注",dataIndex:"remark",render:function(e,t){return 3==t.upgradeStatus&&e||""}}],t}return t=m,(a=[{key:"componentDidMount",value:function(){this.pagerIndex(),this.props.getMcuSocProLi()}},{key:"render",value:function(){var e=this,t=this.state,a=t.addFirmwareVisiable,n=t.releaseFirmwareDialog,o=t.validationFirmwareDialog,i=t.deviceVersionId,u=t.validationDetail,s=t.validateInfo,m=t.validationModTit,b=t.viewFirmid,y=t.viewFirmtype,v=t.editId,h=t.editProductFirParams,g=this.props,E=g.versionList,w=E.list,O=E.pager,I=g.mcusocproLi,j=O.pageIndex,V=O.totalRows;return r.a.createElement("div",{className:"ota-firmware-up"},r.a.createElement(Fe.a,{title:"固件升级",selectOnchange:function(t){e.changeProduct(t)},defaultValue:Object(Ce.h)("productId")||"-1",selectData:I}),r.a.createElement("div",{className:"comm-shadowbox comm-setp-ttip"},r.a.createElement("div",{className:"step-title"},r.a.createElement("img",{src:ke.a,alt:""}),r.a.createElement("span",null,"固件升级步骤")),r.a.createElement(p.a,{current:-1,initial:0},r.a.createElement(ze,{title:"添加升级包",description:"添加升级包，区分不同的MCU、模组、系统。"}),r.a.createElement(ze,{title:"配置升级策略",description:"配置升级对象，配置升级批次、升级范围、升级时间等升级具体策略。"}),r.a.createElement(ze,{title:"查看升级详情",description:"查看升级包各升级批次的具体设备列表，以及各设备的升级状态。"}))),r.a.createElement("div",{className:"otacontent comm-shadowbox"},r.a.createElement("div",{className:"otasearchbox"},r.a.createElement("div",{className:"searchgroupbox"},r.a.createElement("span",null,"方案类型："),r.a.createElement(f.a,{className:"typeselect",defaultValue:-1,onChange:this.cngeSchemeType},r.a.createElement(He,{value:-1},"全部类型"),F.map((function(e,t){var a=e.id,n=e.nam;return r.a.createElement(He,{key:t,value:a},n)})))),r.a.createElement(l.a,{className:"button",onClick:function(){e.switchDialog("addFirmwareVisiable")},type:"primary"},"添加固件")),r.a.createElement(c.a,{rowKey:function(e){var t=e.deviceVersionId,a=e.createTime;return t+"_"+e.productFirmwareId+a},columns:this.columns,dataSource:w,pagination:{defaultCurrent:j,total:V,hideOnSinglePage:!1,onChange:this.pagerIndex}}),a&&r.a.createElement(G,{changeState:this.changeState,editId:v,editProductFirParams:h}),n&&r.a.createElement(d.a,{title:"发布固件",visible:!0,width:660,onCancel:function(){e.switchDialog("releaseFirmwareDialog")},footer:null,maskClosable:!1},r.a.createElement(de,{deviceVersionId:i,close:function(){e.switchDialog("releaseFirmwareDialog")}})),o&&r.a.createElement(Ve,{deviceVersionId:i,validationDetail:Ae({},u),pagerIndex:this.pagerIndex,pageIndex:j,close:this.closeValiFirm,title:m}),r.a.createElement(De,{productFirmwareId:b,schemeType:y,openClose:this.openCloseViewFirmList}),r.a.createElement(d.a,{title:"验证信息",visible:!!s.length,onCancel:this.closeValidateInfo,width:800,footer:null,maskClosable:!1,afterClose:function(){e.pagerIndex(j)}},r.a.createElement(c.a,{rowKey:"macAddress",columns:this.valInfoColumns,dataSource:s,pagination:!1}))))}}])&&Be(t.prototype,a),n&&Be(t,n),m}(n.Component))||Pe,Qe=(a("OrB1"),a("gFTJ"));a("hByQ");function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Je(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?We(Object(a),!0).forEach((function(t){Ze(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):We(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ze(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Xe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $e(e,t){return($e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=at(e);if(t){var r=at(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return tt(this,a)}}function tt(e,t){return!t||"object"!==Ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function at(e){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var nt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}(l,e);var t,a,n,i=et(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).getBatch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=t.deviceVersionId,n=t.state.batchId;Object(y.b)(y.a.otaGetBatch,{deviceVersionId:a,batchId:n,pageIndex:e,pageRows:10}).then((function(e){var a=e.data,n=a.list,r=void 0===n?[]:n,o=a.pager,i=void 0===o?{}:o;t.setState({list:r,pager:i})}))},t.getDetail=function(){var e=t.deviceVersionId;Object(y.c)(y.a.otaGetVersionDetail,{deviceVersionId:e}).then((function(e){var a=e.data;t.setState({details:Je({},a)})}))},t.search=function(e){t.setState({batchId:e},(function(){t.getBatch()}))},t.deviceVersionId=e.match.params.id,t.state={batchId:void 0,list:[],pager:{},details:{}},t.columns=[{title:"批次ID",dataIndex:"batchId"},{title:"发布时间",dataIndex:"createTime",render:function(e){return r.a.createElement("span",null,e&&Ce.a.utcToDev(e)||"--")}},{title:"升级范围",dataIndex:"upgradeRange",render:function(e){return P[e].nam}},{title:"升级方式",dataIndex:"upgradeType",render:function(e){return x[e-1].nam}},{title:"升级策略",dataIndex:"triggerTime",render:function(e){return C[e]}},{title:"状态",dataIndex:"upgradeStatus",render:function(e){return["升级中","已完成"][e]}},{title:"操作",key:"id",render:function(e,a){var n=a.batchId;return r.a.createElement(o.Link,{to:"/open/product/otaUpdate/batch/".concat(t.deviceVersionId,"/").concat(n)},"查看")}}],t}return t=l,(a=[{key:"componentDidMount",value:function(){this.getBatch(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,a=t.pager,n=a.pageIndex,o=a.totalRows,i=a.totalPages,l=t.list,u=t.details,s=u.productName,d=u.productFirmwareVersion,f=u.deviceVersionName,p=u.uploadTime;return r.a.createElement("section",{className:"ota-firmwaredetail flex-column"},r.a.createElement(Fe.a,{title:s,titleBack:!0},r.a.createElement("header",{className:"page-content-header"},r.a.createElement(Qe.b,{title:"",className:"descriptions",column:4},r.a.createElement(Qe.b.Item,{label:"产品版本号"},d),r.a.createElement(Qe.b.Item,{label:"产品版本名称"},f),r.a.createElement(Qe.b.Item,{label:"上传时间"},p&&Ce.a.utcToDev(p))))),r.a.createElement("div",{className:"comm-shadowbox",style:{padding:"24px"}},r.a.createElement(m.a.Search,{placeholder:"输入发布批次ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),r.a.createElement(c.a,{rowKey:"batchId",columns:this.columns,dataSource:l,pagination:{defaultCurrent:n,total:o,hideOnSinglePage:!0,onChange:function(t){e.getBatch(t)},current:n,showSizeChanger:!1,showQuickJumper:i>5}})))}}])&&Xe(t.prototype,a),n&&Xe(t,n),l}(n.PureComponent);function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ot(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function it(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(a),!0).forEach((function(t){ct(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ot(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ct(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function lt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function st(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ft(e);if(t){var r=ft(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return dt(this,a)}}function dt(e,t){return!t||"object"!==rt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ft(e){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}(i,e);var t,a,n,o=st(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=t.verid,n=t.id;Object(y.b)(y.a.otaGetBatchDevice,{deviceVersionId:a,batchId:n,pageIndex:e,pageRows:10}).then((function(e){var a=e.data,n=a.list,r=void 0===n?[]:n,o=a.pager,i=void 0===o?{}:o;t.setState({list:r.map((function(e,t){return it(it({},e),{},{index:t})})),pager:i})}))},t.getDetail=function(){var e=t.verid,a=t.id;Object(y.b)(y.a.otaGetBatchInfo,{deviceVersionId:e,batchId:a}).then((function(e){var a=e.data;t.setState({details:it({},a)})}))},t.id=e.match.params.id,t.verid=e.match.params.verid,t.state={list:[],pager:{},details:{}},t.columns=[{title:"设备ID",dataIndex:"deviceUniqueId"},{title:"设备MAC",dataIndex:"macAddress"},{title:"状态",dataIndex:"upgradeStatus",render:function(e){return e&&V[e].nam}},{title:"日志",dataIndex:"remark"}],t}return t=i,(a=[{key:"componentDidMount",value:function(){this.getList(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,a=t.pager,n=a.pageIndex,o=a.totalRows,i=a.totalPages,l=t.list,u=t.details,s=u.productName,d=u.productVersion,f=u.deviceVersionName,m=u.uploadTime,p=u.createTime,b=u.upgradeRange,y=void 0===b?0:b,v=u.upgradeType;return r.a.createElement("section",{className:"ota-firmwaredetail flex-column"},r.a.createElement(Fe.a,{title:"批次id: ".concat(this.id),titleBack:!0},r.a.createElement("header",{className:"page-content-header"},r.a.createElement(Qe.b,{title:"",className:"descriptions",column:4},r.a.createElement(Qe.b.Item,{label:"产品名称"},s),r.a.createElement(Qe.b.Item,{label:"产品版本号"},d),r.a.createElement(Qe.b.Item,{label:"产品版本名称"},f),r.a.createElement(Qe.b.Item,{label:"上传时间"},m&&Ce.a.utcToDev(m)),r.a.createElement(Qe.b.Item,{label:"发布时间"},p&&Ce.a.utcToDev(p)),r.a.createElement(Qe.b.Item,{label:"升级范围"},P[y].nam),r.a.createElement(Qe.b.Item,{label:"升级方式"},v&&x[v-1].nam||"--")))),r.a.createElement("div",{className:"comm-shadowbox",style:{padding:"24px"}},r.a.createElement(c.a,{rowKey:"index",columns:this.columns,dataSource:l,pagination:{defaultCurrent:n,total:o,hideOnSinglePage:!1,onChange:function(t){e.getList(t)},current:n,showSizeChanger:!1,showQuickJumper:i>5}})))}}])&&lt(t.prototype,a),n&&lt(t,n),i}(n.PureComponent);t.default=function(e){var t=e.match.path;return r.a.createElement(o.Switch,null,r.a.createElement(o.Route,{path:"".concat(t,"/list"),component:Ge}),r.a.createElement(o.Route,{path:"".concat(t,"/details/:id"),component:nt}),r.a.createElement(o.Route,{path:"".concat(t,"/batch/:verid/:id"),component:mt}),r.a.createElement(o.Redirect,{to:"".concat(t,"/list")}))}},MgzW:function(e,t,a){e.exports=a("WUjv")(35)},QjPx:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACHElEQVQokW2SP0iVYRTGf+97v+/LNDO1wjSDhiAKMWioqIYQFDcjkAanGoSohiBaHWvJKQiClhyiqKChoYIiQh0KIQtbDOxWphJlwvV67/eep+G73kp84OW8HHie85w/jn/w8sN8r4V0GLFHkkdCABIyIUdBsqfENYM9nS3zANEq+c1X1S79+H4BYxZsVsqIZAI5YJ/MmhF9FIsAJwEcwOuPC61pKT0aQqjLGEaw7OdM5iI3VZpdeZfbFt9QsLNyrtB7aHcdQPTq/VxPqVi6K7gDnJLUWq0uMAnKwjdHt8NC+Zxvjvpk1rzq3KdpuC6U7zrQdtGCHsiEtO47E7bkOs1sSqbq3NzziS9BkndiUtJeSbEyC0hQNhida2BqcROFcpQ2bki1v2Epniw21d7vd8vu2du8QOPeRadZg8+LycaRT033UnMdiYfYQVyJSY6xckJXJBngil0HW2fWChy7paEIOhIHbfVw6TjcHIVfBYgdR2oDVzwCZGu5VHY8EDto2wxXe6GjBYa6YUd9xY1jwEv6u+81iD3tsYefBTj/MMtdfgyLhayVxNPuZYatb4DYk6/27Cu5yhySLOa9oGBSw3oCiWckySoR+6poVSRyjLgn49OPFNQHmpBYVPV8jVJw8YuFXYeXyjW5/zbgIfKMrQS6olzQYApI6pZUq8oFSiKHcWLrjE393j79rdjoYs/O2JOPHCMrgWvD/W75DzRNJjQqUF42AAAAAElFTkSuQmCC"},p7yf:function(e,t,a){}}]);