(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"+ch6":function(e,t,n){"use strict";n("ef1R"),n("Ra8s"),n("HsXu"),n("bs69"),n("Lm8M"),n("ryEf"),n("qgAm"),n("Ck9u"),n("MNU5");var a=n("YeX6"),r=(n("UdMA"),n("ViyK")),c=(n("xzjF"),n("PeP6")),o=(n("sSxo"),n("I9ul"),n("pckg"),n("sfoS"),n("gAA8"),n("0Us0"),n("JiFE"),n("62KB"),n("9b3Y"),n("T9Mk")),l=n.n(o),i=n("El68");function u(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var d=c.a.Option,p=["按产品","按分组"];t.a=function(e){var t=e.list,n=e.searchedData,m=e.multiple,f=void 0!==m&&m,v=e.onRef,y=e.inputkey,b=s(Object(o.useState)(0),2),g=b[0],h=b[1],E=s(Object(o.useState)([-1]),2),O=E[0],j=E[1],w=s(Object(o.useState)(""),2),I=w[0],S=w[1],C=s(Object(o.useState)(!1),2),P=C[0],k=C[1],N=s(Object(o.useState)(!1),2),T=N[0],x=N[1];Object(o.useEffect)((function(){v&&v(D)}));var L=function(e,t){var n=e.findIndex((function(e){return t==e})),a=u(e);return n>-1&&a.splice(n,1),a},D=function(){var e={type:g};return I&&(e[y]=I),O.length>0&&-1!==O[0]&&(e.productIds=O.join(",")),e};return l.a.createElement("div",{className:"comm-search-box"},l.a.createElement(r.a.Group,{compact:!0,className:"inputgroup"},l.a.createElement(c.a,{value:g,onChange:function(e){h(e),j([-1])}},p.map((function(e,t){return l.a.createElement(d,{key:t,value:t},e)}))),l.a.createElement(c.a,{showSearch:!0,optionFilterProp:"children",mode:f?"multiple":"",defaultValue:[-1],value:O,onChange:!f&&function(e){j([e])}||void 0,onSelect:f&&function(e){j(-1==e?[-1]:function(t){var n=L(t,-1);return[].concat(u(n),[e])})}||void 0,onDeselect:f&&function(e){j((function(t){return L(t,e)}))}||void 0,style:{width:250}},l.a.createElement(d,{value:-1},"全部".concat(0==g?"产品":"分组")),t[g].map((function(e,t){var n=e.productId,a=e.id,r=e.name,c=e.productName;return l.a.createElement(d,{key:t,value:[n,a][g]},[c,r][g])}))),y&&l.a.createElement(r.a,{value:I,maxLength:30,placeholder:"请输入设备ID查询",style:{width:200},onChange:function(e){S(e.target.value)}})),l.a.createElement(a.a,{type:"primary",className:"btn",onClick:function(){k(!0),n(D()).finally((function(e){console.log("---rrr--",e),k(!1)}))},loading:P,icon:l.a.createElement(i.a,null)},"查询"),l.a.createElement(a.a,{type:"default",className:"btn",loading:T,onClick:function(){h(0),j([-1]),S(""),x(!0),n({}).finally((function(){x(!1)}))}},"重置"))}},"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},O0UD:function(e,t,n){},PE3M:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Rn}));n("J2lP"),n("DJj6");var a=n("T9Mk"),r=n.n(a),c=n("q5+0"),o=(n("ef1R"),n("Ra8s"),n("sfoS"),n("HsXu"),n("bs69"),n("Lm8M"),n("ryEf"),n("qgAm"),n("Ck9u"),n("IHDg"),n("P37N"),n("vV4J"),n("av3G"),n("RfWx"),n("UTJx"),n("dVdO")),l=(n("UdMA"),n("ViyK")),i=(n("62KB"),n("9b3Y"),n("R2s5")),u=(n("hz08"),n("MeRu")),s=n("8QW8"),m=n("cu44"),f=n("FC04"),d=n("Nlzp"),p=n("DndG"),v=n("DgvE");function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var O=/^[\w\u4E00-\u9FA5]{1,30}$/,j="中英文、数字、下划线，长度不超过30";var w=i.a.create({name:"form_in_modal-project-add"})((function(e){var t=e.form,n=(e.history,h(Object(a.useState)([]),2)),c=n[0],y=n[1],g=h(Object(a.useState)(!1),2),E=g[0],w=g[1],I=h(Object(a.useState)(!1),2),S=I[0],C=I[1],P=h(Object(a.useState)(null),2),k=P[0],N=P[1],T=t.getFieldDecorator,x=l.a.TextArea,L=Object(a.useCallback)((function(){Object(d.c)(d.a.getProjectList,{loading:!0}).then((function(e){e&&e.data&&y(e.data)}))}),[]);Object(a.useEffect)((function(){L()}),[L]);var D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=e.serveCount,n=e.deviceCount,a=e.proCount,r="";return(t>0||n>0||a>0)&&(r="项目下仍有服务未删除，或有产品/设备未解除关联关系，请进入项目内删除对应内容"),r};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"项目管理",needBtn:!0,btnText:"新建项目",btnClickHandle:function(e){k&&N(e),w(!0)},btnIcon:"plus"}),r.a.createElement(m.a,{style:{minHeight:"calc(100% - 102px)"}},c.length>0?r.a.createElement("div",{className:"project-wrapper"},c.map((function(e,t){var n=e.name,a=e.deviceCount,c=e.serveCount,o=e.createTime,l=e.projectId;return r.a.createElement("div",{className:"project-item",key:t+t},r.a.createElement(p.b,{to:{pathname:"/open/developCenter/projectManage/detail/".concat(l),search:"?name=".concat(n)},className:"title"},n),r.a.createElement("span",{className:"time"},"创建于：".concat(v.a.utcToDev(+o))),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"item"},r.a.createElement("span",null,"关联设备"),r.a.createElement("h2",null,a)),r.a.createElement("div",{className:"item"},r.a.createElement("span",null,"服务"),r.a.createElement("h2",null,c))),r.a.createElement("div",{className:"btns"},r.a.createElement("span",{onClick:function(){N(b({},e)),w(!0)}},"编辑"),r.a.createElement("span",{onClick:function(){!function(e){var t=e.serveCount,n=e.deviceCount,a=e.projectId;if(t>0||n>0)return N(e),void C(!0);Object(d.c)(d.a.getProductInProject,{projectId:a},{loading:!0}).then((function(t){var n=t&&t.data&&t.data.list||[];e.proCount=n.length,N(e),C(!0)}))}(b({},e))}},"删除")))}))):r.a.createElement(s.a,{tipText:"没有项目，请添加"})),E&&r.a.createElement(o.a,{visible:E,width:600,title:"新增项目",centered:!0,closable:!1,onCancel:function(){N(null),w(!1)},onOk:function(){t.validateFields((function(e,t){if(!e){var n=d.a.addProject,a=b({},t);k&&(n=d.a.updateProject,a.projectId=k.projectId),Object(d.d)(n,a,{loading:!0}).then((function(e){w(!1),k&&N(null),L()}))}}))},destroyOnClose:!0,maskClosable:!1},r.a.createElement(i.a,{labelCol:{span:4},wrapperCol:{span:20},labelAlign:"left"},r.a.createElement(i.a.Item,{label:"项目名称"},T("name",{rules:[{required:!0,message:"请输入项目名称"},{pattern:O,message:j}],initialValue:k?k.name:""})(r.a.createElement(l.a,{placeholder:j}))),r.a.createElement(i.a.Item,{label:"项目描述"},T("desc",{rules:[{required:!0,message:"请输入项目描述"},{pattern:O,message:j}],initialValue:k?k.desc:""})(r.a.createElement(x,{placeholder:j,rows:3}))))),S&&r.a.createElement(f.a,{visible:S,title:"删除项目",needWarnIcon:!0,descText:"即将删除的项目",targetName:k.name,tipText:D(),modalCancelHandle:function(){C(!1),N(null)},modalOKHandle:function(){var e=k.projectId;if(D())return C(!1),void N(null);Object(d.c)(d.a.deleteProject,{id:e},{loading:!0}).then((function(e){C(!1),N(null),L()}))}}))})),I=(n("QcZr"),n("b+L2")),S=(n("MNU5"),n("YeX6")),C=(n("SmMv"),n("DTgQ")),P=(n("xzjF"),n("PeP6")),k=(n("59iL"),n("f6Fh")),N=(n("gAA8"),n("0Us0"),n("pckg"),n("JiFE"),n("8x1r")),T=n("El68"),x=n("P2RN"),L=(n("hEGT"),n("+ch6"));function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}P.a.Option;function M(e){var t=e.visible,n=e.okLoading,c=e.onOkHandle,i=e.onCancelHandle,u=e._selectedRowKeys,s=e.columns,m=e.type,f=void 0===m?1:m,d=e.dataInRela,p=e.getRelaList,v=R(Object(a.useState)(u||[]),2),y=v[0],b=v[1],g=R(Object(a.useState)(""),2),h=g[0],E=g[1],O=R(Object(a.useState)(!1),2),j=O[0],w=O[1],C=R(Object(a.useState)(!1),2),P=C[0],k=C[1],N=d.list,F=d.pager,M=d.relatedProductList,_=d.deviceGroupList,Q=function(){},V=function(e){var t={};1===f?h&&(t.name=h):Object.assign(t,Q()),"number"==typeof e?t._index=e:w(!0),p(t).finally((function(){w(!1)}))},q={selectedRowKeys:y,onChange:function(e){b(e)}};return r.a.createElement(o.a,{visible:t,width:1e3,title:"关联".concat(["产品","设备"][f-1]),okText:"确定",confirmLoading:n,onOk:function(){y.length?c(y):Object(x.a)({message:"请至少选中一个后再进行管理"})},cancelText:"取消",onCancel:i,centered:!0,closable:!1,destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{style:{marginBottom:"24px"}},1===f&&r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,{placeholder:"请输入产品查询名称",style:{width:"240px",marginRight:"12px"},value:h,onChange:function(e){return E(e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",style:{marginRight:"12px"},onClick:V,loading:j,icon:r.a.createElement(T.a,null)},"查询"),r.a.createElement(S.a,{type:"default",loading:P,onClick:function(){E(""),k(!0),p({}).finally((function(){k(!1)}))}},"重置")),2===f&&r.a.createElement(L.a,{multiple:!0,inputkey:"param",list:[M,_],searchedData:function(e){return p(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))},onRef:function(e){Q=e}})),r.a.createElement(I.a,{rowKey:1===f?"productId":"deviceId",rowSelection:q,columns:s,dataSource:N,pagination:{total:F.totalRows,current:F.pageIndex,defaultCurrent:1,defaultPageSize:10,onChange:function(e){V(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}}))}n("amE0");var _=n("54Vy");n("vQck");function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e,t,n,a,r,c,o){try{var l=e[c](o),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(a,r)}function K(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var c=e.apply(t,n);function o(e){U(c,a,r,o,l,"next",e)}function l(e){U(c,a,r,o,l,"throw",e)}o(void 0)}))}}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return J(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var G=["发布","发布","停止","启动","",""];function H(e){var t=e.projectId,n=B(Object(a.useState)(!1),2),c=n[0],i=n[1],u=B(Object(a.useState)({callExplainVisible:!1,paramList:[],url:[]}),2),s=u[0],m=u[1],y=B(Object(a.useState)(""),2),b=y[0],g=y[1],h=B(Object(a.useState)([]),2),E=h[0],O=h[1],j=B(Object(a.useState)({totalRows:0,pageIndex:1}),2),w=j[0],P=j[1],k=B(Object(a.useState)([]),2),L=k[0],D=k[1],A=B(Object(a.useState)({actionType:0,actionRecord:{},actionLoading:!1}),2),R=A[0],F=A[1],M=B(Object(a.useState)({dataAnlVisibel:!1,dataAnlRecord:null}),2),Q=M[0],q=M[1],U=B(Object(a.useState)(-1),2),J=U[0],H=U[1],W=B(Object(a.useState)({id:-1,neme:"",desc:""}),2),z=W[0],X=W[1],Y=w.totalRows,Z=w.pageIndex,$=s.callExplainVisible,ee=s.paramList,te=s.url,ne=R.actionType,ae=R.actionRecord,re=R.actionLoading,ce=Q.dataAnlVisibel,oe=Q.dataAnlRecord;Object(a.useEffect)((function(){le(1)}),[le,t]);var le=function(e){var n={pageRows:10};t&&(n.projectId=t),e&&(n.pageIndex=e),b&&(n.name=b),Object(d.c)(d.a.getServeList,n,{loading:!0}).then((function(e){var t=e&&e.data||{},n=t.list,a=t.pager;O(n),P(a)}))},ie=function(){var e=K(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return e.next=3,Object(d.c)(d.a.getProjectList,{},{loading:!0});case 3:n=e.sent,D(n.data||[]);case 5:i(!0);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(d.d)(d.a.servePublish,V({serviceId:e,envType:t,operate:n},a),{timeout:3e5}).then((function(e){le(Z)})).finally(de)},se=function(){var e=K(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:F((function(e){return V(V({},e),{},{actionType:t,actionRecord:V({},n)})}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),me=function(){F((function(e){return V(V({},e),{},{actionLoading:!0})}));var e=ae.id;3==ne?function(e){Object(d.d)(d.a.serveDelete,{id:e}).then((function(){le(),Object(x.a)({type:"success",description:"删除成功！"})})).finally(de)}(e):ue(e,1==ne?1:0,2)},fe=function(e){F((function(e){return V(V({},e),{},{actionLoading:!0})}));var t=ae.id,n=ae.proEnv,a=1,r=ae.testEnv;2==ne&&(a=0,r=n),ue(t,a,r,e)},de=function(){F({actionType:0,actionRecord:{},actionLoading:!1})},pe=function(e,t){var n=t||oe||{},a=n.id,r=n.projectId,c=n.desc,o=n.name;Object(v.n)("/dataAnalysis/".concat(r,"/").concat(a),"desc=".concat(c,"&name=").concat(o,"&analysisiType=").concat(e)),q((function(e){return V(V({},e),{},{dataAnlVisibel:!1})}))},ve=function(e){var t=e.id,n=e.type,a=void 0===n?0:n,c=e.projectId;return 0==+a?r.a.createElement("a",{onClick:function(){return Object(v.n)("/logicDevelop/".concat(c,"/").concat(t))}},"编辑"):r.a.createElement("a",{onClick:function(){return function(e){var t=e.id;Object(d.c)(d.a.getDataAnlzType,{serveId:t}).then((function(t){var n=(t&&t.data||{}).funcType;n?pe(n,e):q((function(t){return V(V({},t),{},{dataAnlVisibel:!0,dataAnlRecord:e})}))}))}(e)}},"编辑")},ye=[{title:"服务名称",dataIndex:"name",key:"name",width:160,render:function(e,t){var n=t.id,a=t.desc;return r.a.createElement("a",{onClick:function(){return X({id:n,name:e,desc:a})}},e)}},{title:"服务类型",dataIndex:"type",key:"type",width:160,render:function(e,t){var n=t.type,a=void 0===n?0:n;return r.a.createElement("span",null,["业务逻辑服务","数据分析服务"][a])}},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:160,render:function(e,t){var n=t.createTime;return r.a.createElement("span",null,n?v.a.utcToDev(n):"--")}},{title:"操作",key:"action",width:500,render:function(e,t){var n=t.id,a=t.type,c=void 0===a?0:a,o=t.testEnv,l=t.proEnv,i=t.projectId,u=t.name,s=5==o?"重新发布新版本到测试环境":"".concat(G[o],"测试环境"),f=5==l?"重新部署新版本到生产环境":"".concat(G[l],"生产环境");return r.a.createElement("span",null,2===l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(p.b,{to:{pathname:"/open/developCenter/serveDetail/".concat(n),search:"?serveName=".concat(u,"&projectId=").concat(i,"&type=").concat(c)},target:"_black"},"查看"),r.a.createElement(C.a,{type:"vertical"})),ve(t),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{disabled:0===o,onClick:function(){return se(1,t)}},s),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{disabled:!1,onClick:function(){return function(e){Object(d.c)(d.a.serveCallExplain,{serviceId:e},{loading:!0}).then((function(e){var t=[],n="";if(e.data){if(e.data.input){var a=JSON.parse(e.data.input);a.input&&(t=a.input)}e.data.flowVersion&&(n=e.data.flowVersion.invokeUrl||"")}m({paramList:t,url:n,callExplainVisible:!0})}))}(n)}},"调用说明"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{disabled:0===l,onClick:function(){return se(2,t)}},f),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return H(n)}},"复制"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return se(3,t)}},"删除"))}}];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tab-content-wrapper"},r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",onClick:ie,icon:r.a.createElement(N.a,null)},"新建服务")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(l.a,{placeholder:"请输入服务名称查询",style:{width:"240px"},value:b,onChange:function(e){return g(e.target.value)},maxLength:20})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",icon:r.a.createElement(T.a,null),onClick:function(){return le(1)}},"查询")))),r.a.createElement("div",{className:"table-wrapper"},r.a.createElement(I.a,{columns:ye,rowKey:"id",dataSource:E,pagination:{total:Y,current:Z,defaultCurrent:1,defaultPageSize:10,onChange:function(e){return le(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}})),c&&r.a.createElement(_.a,{visible:c,onOk:function(e){Object(d.d)(d.a.serveAdd,V({},e),{loading:!0}).then((function(){g(""),i(!1),le(1),Object(x.a)({type:"success",description:"新增成功！"})}))},projectId:t,projectList:L,onCancel:function(){return i(!1)}}),J&&r.a.createElement(_.c,{visible:-1!==J||-1!==z.id,editContent:z,onOk:function(e){-1!==J?Object(d.d)(d.a.serveCopy,V(V({},e),{},{id:J}),{loading:!0}).then((function(){g(""),H(-1),le(1)})):-1!==z.id&&Object(d.d)(d.a.updateServe,V(V({},e),{},{id:z.id}),{loading:!0}).then((function(){X({id:-1,name:"",desc:""}),le(Z)}))},onCancel:function(){-1!==J?H(-1):-1!==z.id&&X({id:-1,name:"",desc:""})}}),function(){var e=ae.id,t=ae.name,n=ae.proEnv,a=ae.testEnv,c=3==ne,o=1==ne,l=2==ne,i=2==a,u=2==n;return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{visible:c||o&&i||l&&u,modalOKHandle:me,modalCancelHandle:de,targetName:t,confirmLoading:re,title:c?"删除服务":"停止服务",needWarnIcon:!0,descText:"即将".concat(["在测试环境停止","在生产环境停止","删除服务"][ne-1])}),r.a.createElement(_.d,{visible:o&&!i||l&&!u,envdata:{id:e,actionType:ne,testEnv:a,proEnv:n,name:t},onOk:fe,confirmLoading:re,onCancel:de}))}(),$&&r.a.createElement(_.b,{paramList:ee,url:te,visible:$,onCancel:function(){return m({callExplainVisible:!1,paramList:[]})}}),ce&&r.a.createElement(o.a,{visible:ce,className:"sql-modal-self-class",width:500,title:"选择数据分析类型",closable:!0,centered:!0,footer:null,onCancel:function(){return q({dataAnlVisibel:!1,dataAnlRecord:null})},destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{className:"type-select"},r.a.createElement("span",{onClick:function(){return pe(1)}},"节点实时流任务"),r.a.createElement("span",{onClick:function(){return pe(3)}},"数据分析任务"),r.a.createElement("span",{onClick:function(){return pe(4)}},"SQL实时流任务"))))}function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){X(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var $=k.a.TabPane,ee=P.a.Option,te=[d.a.getProductInProject,d.a.getDeviceInProject];function ne(e){var t=e.match,n=e.history,c=Y(Object(a.useState)(1),2),o=c[0],i=c[1],s=Y(Object(a.useState)([]),2),y=s[0],b=s[1],g=Y(Object(a.useState)({totalRows:0,pageIndex:1}),2),h=g[0],E=g[1],O=Y(Object(a.useState)([]),2),j=O[0],w=O[1],L=Y(Object(a.useState)({totalRows:0,pageIndex:1}),2),D=L[0],A=L[1],R=Y(Object(a.useState)([]),2),F=R[0],_=R[1],Q=Y(Object(a.useState)({name:"",mac:"",productId:""}),2),V=Q[0],q=Q[1],U=Y(Object(a.useState)({relaVisible:!1,name:"",mac:"",productId:"",list:[],pager:{},relatedDeviceList:[],relatedProductList:[],deviceGroupList:[],_selectedRowKeys:[]}),2),K=U[0],B=U[1],J=Y(Object(a.useState)(!1),2),G=J[0],W=J[1],Z=Y(Object(a.useState)({actionVisibel:!1,actionType:"1",actionRecord:{},actionLoading:!1}),2),ne=Z[0],ae=Z[1],re=t.params&&t.params.id,ce=decodeURI(Object(v.j)("name")),oe=K.relaVisible,le=K._selectedRowKeys,ie=ne.actionVisibel,ue=ne.actionType,se=ne.actionRecord,me=ne.actionLoading,fe=Object(a.useCallback)((function(e,t,n){var a=V.name,r=V.mac,c=V.productId,o={projectId:re};t&&(o.pageIndex=t),1==e&&(o.name=a),2==e&&(o=z(z({},o),{},{mac:r,productId:n||c})),Object(d.c)(te[e-1],o,{loading:!0}).then((function(t){var n=t&&t.data||{},a=n.list,r=void 0===a?[]:a,c=n.pager,o=void 0===c?{}:c;1===e?b(r):w(r),1===e?E(o):A(o)}))}),[re,V]),de=Object(a.useCallback)((function(e){var t=1===o?"productId":"deviceId",n=1===o?d.a.unrelaProduct:d.a.unrelaDevice;ae((function(e){return z(z({},e),{},{actionLoading:!0})})),Object(d.c)(n,X({projectId:re},t,e)).then((function(){fe(o)})).finally((function(){ae({actionVisibel:!1,actionRecord:null,actionLoading:!1})}))}),[re,fe,o]),pe=Object(a.useCallback)((function(){return Object(d.c)(d.a.getAllRelatedProduct,{projectId:re,pageRows:9999}).then((function(e){return e&&e.data&&e.data.list||[]}))}),[re]),ve=Object(a.useCallback)((function(){return Object(d.c)(d.a.getGroupList,{pageRows:9999}).then((function(e){return e.data.list||[]}))})),ye=Object(a.useCallback)((function(e){i(2),q((function(t){return z(z({},t),{},{productId:e})})),pe().then((function(e){_(e)})),fe(2,void 0,e)}),[pe,fe]),be=Object(a.useMemo)((function(){switch(o){case 1:return[{title:"产品ID",dataIndex:"productId",key:"productId",width:200},{title:"产品名称",dataIndex:"productName",key:"productName",width:200},{title:"产品类型",dataIndex:"productClassId",key:"productClassId",width:180,render:function(e,t){var n=t.productClassId,a=void 0===n?0:n;return r.a.createElement("span",null,["普通设备","网关设备"][a])}},{title:"状态",dataIndex:"mode",key:"mode",width:180,render:function(e,t){var n=t.mode,a=void 0===n?0:n;return r.a.createElement("span",null,["开发中","已发布","审核中"][a])}},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180,render:function(e,t){var n=t.createTime;return r.a.createElement("span",null,n?v.a.utcToDev(n):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var n=t.productId,a=t.mode;return r.a.createElement("span",null,r.a.createElement(p.b,{to:{pathname:"/open/base/product/".concat(1==a?"details":"edit","/").concat(n)}},"查看"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return ye(n)}},"设备管理"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return Ie("1",t)}},"解除关联"))}}];case 2:return[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"物理地址",dataIndex:"deviceMac",key:"deviceMac",width:200},{title:"产品",dataIndex:"productName",key:"productName",width:180},{title:"分类",dataIndex:"productClass",key:"productClass",width:180,render:function(e,t){var n=t.productClass,a=void 0===n?0:n;return r.a.createElement("span",null,["普通设备","网关设备"][a])}},{title:"状态",dataIndex:"status",key:"status",width:180,render:function(e,t){var n=t.status;return r.a.createElement("span",null,["开发中","已发布","审核中"][n||0])}},{title:"最后上线",dataIndex:"lastOnlineTime",key:"lastOnlineTime",width:180,render:function(e,t){var n=t.lastOnlineTime;return r.a.createElement("span",null,n?v.a.utcToDev(n):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var n=t.deviceId;return r.a.createElement("span",null,r.a.createElement(p.b,{to:{pathname:"/open/base/device/onlineDevice/details/".concat(n)}},"查看"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return Ie("1",t)}},"解除绑定"))}}]}}),[o,ye]),ge=function(e,t){q((function(n){var a=z({},n);return a[e]=t,a}))};Object(a.useEffect)((function(){re?(fe(1),fe(2),pe().then((function(e){_(e)}))):Object(x.a)({description:"请传入项目ID"})}),[re]);var he=function(e){var t=V.name,a=V.mac,c=V.productId;return 1===e?r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",loading:G,icon:r.a.createElement(N.a,null),onClick:je},"关联产品")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"default",name:t,onClick:function(){return n.push({pathname:"/open/base/product/add",search:"projectId=".concat(re)})},icon:r.a.createElement(N.a,null)},"创建产品")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(l.a,{placeholder:"请输入产品查询名称",onChange:function(e){return ge("name",e.target.value)},style:{width:"240px"},maxLength:20})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",onClick:function(){return fe(1)},icon:r.a.createElement(T.a,null)},"查询"))):2===e?r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",loading:G,onClick:je,icon:r.a.createElement(N.a,null)},"关联设备")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(l.a,{placeholder:"请输入设备物理地址/设备ID",mac:a,onChange:function(e){return ge("mac",e.target.value)},style:{width:"240px"},maxLength:50})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(P.a,{style:{width:"240px"},value:c,onChange:function(e){return ge("productId",e)}},r.a.createElement(ee,{value:""},"全部产品"),F.map((function(e){var t=e.productId,n=e.productName;return r.a.createElement(ee,{key:t,value:t},n)})))),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",icon:r.a.createElement(T.a,null),onClick:function(){return fe(2)}},"查询"))):void 0},Ee=function(){var e=1===o?h:D,t=e.totalRows,n=e.pageIndex,a=1===o?y:j;return r.a.createElement(I.a,{columns:be,rowKey:1===o?"productId":"deviceId",dataSource:a,pagination:{total:t,current:n,defaultCurrent:1,defaultPageSize:20,onChange:function(e){return fe(o,e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}})},Oe=function(e){var t=e.name,n=e.param,a=e.productIds,r=e._index,c=e.type,l={projectId:re,pageRows:10,pageIndex:r||1},i=d.a.getRelaProduct;return 1===o?t&&(l.name=t):2===o&&(i=d.a.getRelaDevice,l.type=c||0,n&&(l.param=n),a&&(l.productIds=a)),Object(d.c)(i,l).then((function(e){return e&&e.data&&B((function(t){return z(z({},t),e.data)})),e}))},je=function(){var e=[Oe({})];2===o&&e.push(pe(),ve()),W(!0),Promise.all(e).then((function(e){var t=Y(e,3),n=(t[0],t[1]),a=void 0===n?[]:n,r=t[2],c=void 0===r?[]:r;B((function(e){return z(z({},e),{},{relaVisible:!0,relatedProductList:a,deviceGroupList:c})}))})).finally((function(){W(!1)}))},we=function(){B({relaVisible:!1,name:"",mac:"",productId:"",list:[],pager:{}})},Ie=function(e,t){ae((function(n){return z(z({},n),{},{actionType:e,actionRecord:z({},t),actionVisibel:!0})}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{title:ce||"--"}),r.a.createElement(m.a,{style:{minHeight:"calc(100% - 102px)"}},r.a.createElement(k.a,{activeKey:""+o,onChange:function(e){return i(+e)}},r.a.createElement($,{tab:"产品列表",key:1},r.a.createElement("div",{className:"tab-content-wrapper"},he(1)),r.a.createElement("div",{className:"table-wrapper"},Ee())),r.a.createElement($,{tab:"设备列表",key:2},r.a.createElement("div",{className:"tab-content-wrapper"},he(2)),r.a.createElement("div",{className:"table-wrapper"},Ee())),r.a.createElement($,{tab:"服务列表",key:3},r.a.createElement(H,{projectId:re})))),oe&&r.a.createElement(M,{visible:oe,getRelaList:Oe,onOkHandle:function(e){var t,n;(t=e.join(","),n=1===o?d.a.relaProduct:d.a.relaDevice,Object(d.d)(n,{projectId:re,ids:t})).then((function(e){we(),fe(o)}))},onCancelHandle:we,columns:be.slice(0,-1),type:o,dataInRela:K,setDataInRela:B,_selectedRowKeys:le}),ie&&r.a.createElement(f.a,{visible:ie,modalOKHandle:function(){var e=se.deviceId,t=se.productId;"1"===ue&&(1===o&&de(t),2===o&&de(e))},modalCancelHandle:function(){return ae({actionVisibel:!1,actionRecord:null,actionLoading:!1})},targetName:se[1===o?"productName":"deviceUniqueId"],confirmLoading:me,title:"解除关联",needWarnIcon:!0,descText:"即将解除关联"}))}n("O0UD");function ae(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(w,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/detail/:id"),render:function(e){return r.a.createElement(ne,e)}}),r.a.createElement(c.b,{to:"".concat(t,"/list")}))}var re=n("2kug"),ce=[{title:"步骤一"},{title:"步骤二"},{title:"步骤三"}];function oe(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"服务开发"}),r.a.createElement(m.a,null,r.a.createElement("div",{className:"use-service-flow-wrapper"},r.a.createElement(re.a,{type:3,flowLists:ce}),r.a.createElement("div",{className:"extra-descs"},r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"新建服务，填写服务名称和关联项目")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"编辑业务逻辑，进行部署调试")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"发布服务，生成正式地址，可以对服务进行启动/停止"))))),r.a.createElement(m.a,{style:{minHeight:"calc(100% - 300px)"}},r.a.createElement(H,null)))}n("W0kV");var le,ie,ue=n("caRq"),se=n("Cr9J"),me=(n("SlgS"),n("lf9m"),n("ivud")),fe=n("AcTD"),de=n("vzJ4"),pe=n("zrZB"),ve=n("gtRY");n("3tak");function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Oe(e);if(t){var r=Oe(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ee(this,n)}}function Ee(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(o,e);var t,n,a,c=he(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=c.call(this,e),e.init(le,ie,!0),t}return t=o,(n=[{key:"render",value:function(){return r.a.createElement("div",{className:"draw-wrap"},r.a.createElement(fe.a,null),r.a.createElement(de.a,null),r.a.createElement(pe.a,null))}}])&&be(t.prototype,n),a&&be(t,a),o}(a.Component),we=Object(me.b)(void 0,(function(e){return{init:function(t,n,a){return e(Object(ve.z)(t,n,a))}}}))(je),Ie=function(e){return le=e.projectId,ie=e.serviceId,r.a.createElement(we,null)};function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){Pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ne(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Te=k.a.TabPane,xe=P.a.Option;function Le(){var e=Object(c.h)().id,t=decodeURI(Object(v.j)("serveName")),n=decodeURI(Object(v.j)("projectId")),o=decodeURI(Object(v.j)("type")),i=ke(Object(a.useState)({searchKey:"",since:null,searchLoading:!1}),2),s=i[0],f=i[1],p=ke(Object(a.useState)({logList:[],logPager:{}}),2),y=p[0],b=p[1],g=s.searchKey,h=s.since,E=s.searchLoading,O=y.logList,j=(y.logPager,Object(a.useCallback)((function(t){var n={serviceId:e,tail:100,follow:!1};return t&&(n=t),Object(d.c)(d.a.getServiceLog,n).then((function(e){e&&e.data&&b(Ce(Ce({},y),{},{logList:e.data}))}))}),[e,y]));Object(a.useEffect)((function(){j()}),[e]);var w=function(e,t){f((function(n){return Ce(Ce({},n),Pe({},e,t))}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:t||"测试"}),r.a.createElement(m.a,{style:{minHeight:"calc(100% - 102px)"}},r.a.createElement(k.a,{defaultActiveKey:"1"},r.a.createElement(Te,{tab:"运行数据",key:1},r.a.createElement("div",null,r.a.createElement(m.a,null,r.a.createElement("div",{className:"all-data-wrapper"},r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"服务总数"),r.a.createElement("p",null,"100")),r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"测试环境"),r.a.createElement("p",null,"49")),r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"正式环境"),r.a.createElement("p",null,"51")))))),r.a.createElement(Te,{tab:"服务日志",key:2},r.a.createElement("div",{className:"serve-log-wrapper"},r.a.createElement("div",{style:{marginBottom:"24px"}},r.a.createElement(P.a,{value:"",style:{width:"240px",marginRight:"12px"}},r.a.createElement(xe,{value:""},"错误日志")),r.a.createElement(ue.a,{style:{width:"240px",marginRight:"12px"},showTime:!0,showToday:!0,value:h,onChange:function(e){return w("since",e)}}),r.a.createElement(l.a,{placeholder:"请输入关键字",style:{width:"240px",marginRight:"12px"},value:g,onChange:function(e){return w("searchKey",e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",style:{marginRight:"12px"},onClick:function(){if(h){var e=1e3*(h.unix()-28800);j(e)}else j()},loading:E,icon:r.a.createElement(T.a,null)},"查询")),r.a.createElement("div",null,r.a.createElement(I.a,{rowKey:"timestamp",columns:[{title:"调用时间",dataIndex:"timestamp",key:"timestamp"},{title:"节点执行日志",dataIndex:"text",key:"text"}],dataSource:O,pagination:!1})))),r.a.createElement(Te,{tab:"服务编排",key:3},r.a.createElement("div",{className:"static-flow-wrapper"},r.a.createElement("div",{className:"relative-wrapper"},1==o?r.a.createElement(se.a,{service:{serviceId:e,projectId:n},isStatic:!0}):r.a.createElement(Ie,{projectId:n,serviceId:e})))))))}n("q23V");var De=n("+VvO"),Ae=n("1Ngb"),Re=n.n(Ae),Fe=(n("gSWv"),n("M7r8")),Me=i.a.create({name:"add-dataflow-rule"})((function(e){var t=e.form,n=t.validateFieldsAndScroll,a=t.getFieldValue,c=t.getFieldDecorator,u=t.resetFields,s=e.closeMod,m=e.visable,f=e.transferId,p=void 0===f?void 0:f,v=e.transferName,y=void 0===v?"":v,b=e.transferDesc,g=void 0===b?"":b,h=p?"编辑规则":"新增规则";return r.a.createElement(o.a,{title:h,visible:m,width:600,onOk:function(){n((function(e,t){var n=t.transferName,a=t.transferDesc;e||Object(d.d)(d.a.saveTransfer,{transferName:n,transferDesc:a,transferId:p},{needJson:!0}).then((function(e){s(!0),u()}))}))},onCancel:function(){s(),u()},maskClosable:!1,className:"self-modal"},r.a.createElement(i.a,{labelCol:{span:4},wrapperCol:{span:20}},r.a.createElement(i.a.Item,{label:"规则名称"},c("transferName",{rules:[{required:!0,message:"请输入规则名称"},{max:50,message:"最大输入长度为50"}],initialValue:y})(r.a.createElement(l.a,{placeholder:"请输入规则名称"}))),r.a.createElement(Fe.a,{label:"规则描述",formId:"transferDesc",astrictNub:"50",rows:"4",placeholder:"规则描述",getFieldDecorator:c,getFieldValue:a,initialVal:g})))}));function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Ke(e);if(t){var r=Ke(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ue(this,n)}}function Ue(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ke(e){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Be=["创建规则","选择产品","编写SQL，处理数据","添加操作，转发数据","验证规则","启动规则"],Je=[["删除","即将要删除规则"],["启动","即将要启动规则"],["停用","即将要停用规则"]],Ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(o,e);var t,n,a,c=qe(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=c.call(this,e)).getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(d.c)(d.a.getDataTransferList,e).then((function(e){t.setState({ruleList:e.data.list,pager:e.data.pager,loading:!1})}))},t.openAdd=function(){t.setState({addRuleVisible:!0})},t.closeAdd=function(e){t.setState({addRuleVisible:!1}),e&&t.pagerIndex(1)},t.searchRule=function(e){t.setState({loading:!0,searchName:e},(function(){t.pagerIndex(1)}))},t.pagerIndex=function(e){t.setState({pageIndex:e,loading:!0},(function(){t.getList({pageIndex:e,pageRows:10,transferName:t.state.searchName||void 0})}))},t.getGuidStep=function(){for(var e=[],t=0;t<Be.length;t++)e.push(r.a.createElement("div",{className:"step",key:"step_"+t},r.a.createElement("span",{className:"number"},t+1),r.a.createElement("span",{className:"desc"},Be[t]))),t+1<Be.length&&e.push(r.a.createElement("img",{className:"arrow",key:"img_"+t,src:Re.a}));return e},t.openConfirmMod=function(e,n,a){t.setState({id:e,name:n,confirmType:a})},t.modOk=function(){var e=t.state,n=e.id,a=e.confirmType,r=e.pageIndex,c=void 0===r?1:r,o=e.ruleList;if(1==a)Object(d.c)(d.a.delOneTransfer,{transferId:n},{loading:!0}).then((function(e){1==o.length&&c>1&&--c,t.pagerIndex(c),t.setState({confirmType:0})}));else{var l=2==a?1:0;Object(d.d)(d.a.saveTransfer,{transferId:n,status:l},{needJson:!0,noInstance:!0,loading:!0}).then((function(e){t.pagerIndex(c),t.setState({confirmType:0})}))}},t.modCancel=function(){t.setState({confirmType:0})},t.state={loading:!0,ruleList:[],pager:{},searchName:"",name:"",id:"",confirmType:0,addRuleVisible:!1,pageIndex:1},t.columns=[{title:"规则名称",dataIndex:"transferName"},{title:"规则ID",dataIndex:"transferId",width:90},{title:"描述",dataIndex:"transferDesc"},{title:"创建时间",dataIndex:"createTime",width:162,render:function(e){return r.a.createElement("span",null,v.a.utcToDev(e))}},{title:"状态",dataIndex:"status",width:90,render:function(e){return r.a.createElement("span",null,{0:"未启用",1:"启用"}[e]||"--")}},{title:"操作",key:"action",width:160,render:function(e,n){var a=n.transferId,c=n.transferName,o=n.status;return r.a.createElement("span",null,r.a.createElement(p.b,{to:"/open/developCenter/dataFlow/ruledetail/".concat(a)},"查看"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){t.openConfirmMod(a,c,o+2)}},["启用","停用"][o]),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){t.openConfirmMod(a,c,1)}},"删除"))}}],t}return t=o,(n=[{key:"componentDidMount",value:function(){this.pagerIndex(1)}},{key:"render",value:function(){var e=this,t=this.state,n=t.loading,a=t.name,c=t.addRuleVisible,o=t.ruleList,i=t.pager,s=t.confirmType;return r.a.createElement("div",{className:"dataflow-page"},r.a.createElement(u.a,{noback:!0,title:"数据流转"}),r.a.createElement("header",{className:"page-content-header"},r.a.createElement("div",{className:"searchBox"},r.a.createElement(l.a.Search,{placeholder:"请输入规则名查找",enterButton:!0,maxLength:20,onSearch:function(t){return e.searchRule(t)}})),r.a.createElement("div",{className:"butFloatRight"},r.a.createElement(S.a,{className:"but-add",type:"primary",icon:r.a.createElement(N.a,null),onClick:this.openAdd},"创建规则"))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(De.a,{message:"数据流转规则可以对设备上报的数据进行简单处理，并将处理后的数据流转到其他Topic或其他存储实例，目前只支持Json数据的处理",type:"info",showIcon:!0}),r.a.createElement("div",{className:"guid-step"},this.getGuidStep()))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(I.a,{rowKey:"transferId",columns:this.columns,dataSource:o,pagination:{defaultCurrent:i.pageIndex,total:i.totalRows,hideOnSinglePage:!1,onChange:this.pagerIndex,current:i.pageIndex},loading:n}))),r.a.createElement(Me,{visable:c,closeMod:function(t){e.closeAdd(t)}}),r.a.createElement(f.a,{visible:s>0,modalOKHandle:this.modOk,modalCancelHandle:this.modCancel,title:s>0&&Je[s-1][0],descText:s>0&&Je[s-1][1],targetName:a}))}}])&&Qe(t.prototype,n),a&&Qe(t,a),o}(a.Component),He=(n("HTPJ"),n("rFuK")),We=(n("miF7"),n("QnTe")),ze=(n("ddWB"),n("bkGP")),Xe=(n("sSxo"),n("I9ul"),n("fPXa"));function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){$e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function et(e){return function(e){if(Array.isArray(e))return at(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||nt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||nt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(e,t){if(e){if("string"==typeof e)return at(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?at(e,t):void 0}}function at(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var rt=P.a.Option,ct=i.a.create({name:"add-dataflow-editsql"})(Object(a.memo)((function(e){var t=e.form,n=t.validateFieldsAndScroll,c=t.getFieldValue,u=t.getFieldDecorator,s=t.resetFields,m=(t.validateFields,t.setFieldsValue),f=e.visable,p=e.tableData,v=e.productList,y=e.closeMod,b=e.transferId,g=e.transferSQL,h=g.transferSQL,E=void 0===h?"SELECT \n\nFROM \n\nWHERE":h,O=g.productId,j=g.deviceIdList,w=g.isAllDevice,I=void 0===w?0:w,S=g.transferSQLId,C=tt(Object(a.useState)(E),2),k=C[0],N=C[1],T=tt(Object(a.useState)([]),2),x=T[0],L=T[1],D=tt(Object(a.useState)([]),2),A=D[0],R=D[1];Object(a.useEffect)((function(){var e=F();(L(e),S)&&m({transferSQL:E,productId:O,deviceIdList:0==I&&[-1]||j})}),[p]);var F=function(){var e=[];return Object.keys(p||{}).forEach((function(t){e.push(M(t,"数据表")),p[t].forEach((function(t){e.push(M(t,"表属性"))}))})),e.length>0&&e||null},M=function(e,t){return{name:"name",value:e,score:100,meta:t}},_=function(e,t){var n=e.findIndex((function(e){return t==e})),a=et(e);return n>-1&&a.splice(n,1),a};return r.a.createElement(o.a,{title:"编写SQL",visible:f,width:700,onOk:function(){n((function(e,t){if(console.log(999,t),!e){var n=t.deviceIdList,a=1;-1==n[0]&&(a=0,n=null);var r=S&&{transferSQLId:S}||{};Object(d.d)(d.a.saveTransfer,{transferId:b,transferSQL:Ze(Ze(Ze({},t),{},{isAllDevice:a},r),{},{deviceIdList:n})},{needJson:!0,noInstance:!0}).then((function(e){y(!0),s()}))}}))},onCancel:function(){y(),s()},maskClosable:!1},r.a.createElement(i.a,null,r.a.createElement(i.a.Item,{labelCol:{span:3},wrapperCol:{span:21}},r.a.createElement(Xe.a,{mode:"mysql",height:200,code:k,completers:x,onChange:function(e){!function(e){N(e),m({transferSQL:e})}(e)}}),u("transferSQL",{initialValue:k,rules:[{required:!0,message:"请编写SQL"}]})(r.a.createElement(l.a,{type:"hidden"}))),r.a.createElement(i.a.Item,{label:"选择产品",labelCol:{span:3},wrapperCol:{span:12}},u("productId",{rules:[{required:!0,message:"请选择产品"}]})(r.a.createElement(P.a,{showSearch:!0,placeholder:"选择产品",optionFilterProp:"children",onChange:function(e){Object(d.c)(d.a.getDeviceList,{classType:1,pageRows:9999,infoType:1,productId:e},{loading:!0}).then((function(e){var t=e.data;R(t&&t.list||[]),m({deviceIdList:[]})}))}},v.map((function(e){var t=e.productId,n=e.productName;return r.a.createElement(rt,{key:t,value:t},n)}))))),r.a.createElement(i.a.Item,{label:"选择设备",labelCol:{span:3},wrapperCol:{span:12}},u("deviceIdList",{rules:[{required:!0,message:"请选择设备"}]})(r.a.createElement(P.a,{showSearch:!0,mode:"multiple",placeholder:"选择设备",optionFilterProp:"children",onSelect:function(e){if(-1==e)m({deviceIdList:[-1]});else{var t=c("deviceIdList"),n=_(t,-1);console.log(888,t,n),m({deviceIdList:et(n)})}}},A.length>0&&r.a.createElement(rt,{value:-1},"全部设备"),A.map((function(e){var t=e.deviceId,n=e.deviceMac;return r.a.createElement(rt,{key:t,value:t},n)})))))))}))),ot=(n("KFG7"),n("IDv4")),lt=(n("m+vn"),n("DIPV")),it=n("5xfi"),ut=n("OIuG");function st(e){return function(e){if(Array.isArray(e))return dt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ft(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||ft(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ft(e,t){if(e){if("string"==typeof e)return dt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dt(e,t):void 0}}function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var pt=P.a.Option,vt=i.a.create({name:"add-dataflow-checksql"})(Object(a.memo)((function(e){var t=e.transferId,n=e.form,c=n.validateFieldsAndScroll,o=n.getFieldValue,u=n.getFieldDecorator,s=n.resetFields,m=n.setFieldsValue,f=e.visable,p=e.productList,v=e.closeMod,y=mt(Object(a.useState)("{\n\n}"),2),b=y[0],g=y[1],h=mt(Object(a.useState)([]),2),E=h[0],O=h[1],j=mt(Object(a.useState)(void 0),2),w=j[0],I=j[1];Object(a.useEffect)((function(){}),[]);var C=function(e,t){var n=e.findIndex((function(e){return t==e})),a=st(e);return n>-1&&a.splice(n,1),a};return r.a.createElement(ot.a,{title:"SQL调试",visible:f,width:480,onClose:function(){v(),s()}},r.a.createElement(i.a,null,r.a.createElement(i.a.Item,{label:"产品",labelCol:{span:24},wrapperCol:{span:12}},u("productId",{rules:[{required:!0,message:"请选择产品"}]})(r.a.createElement(P.a,{showSearch:!0,placeholder:"选择产品",optionFilterProp:"children",onChange:function(e){Object(d.c)(d.a.getDeviceList,{classType:1,pageRows:9999,infoType:1,productId:e},{loading:!0}).then((function(e){var t=e.data;O(t&&t.list||[]),m({deviceIdList:[]})}))}},p.map((function(e){var t=e.productId,n=e.productName;return r.a.createElement(pt,{key:t,value:t},n)}))))),r.a.createElement(i.a.Item,{label:"设备",labelCol:{span:24},wrapperCol:{span:12}},u("deviceIdList",{rules:[{required:!0,message:"请选择设备"}]})(r.a.createElement(P.a,{showSearch:!0,mode:"multiple",placeholder:"选择设备",optionFilterProp:"children",onSelect:function(e){if(-1==e)m({deviceIdList:[-1]});else{var t=o("deviceIdList"),n=C(t,-1);console.log(888,t,n),m({deviceIdList:st(n)})}}},E.length>0&&r.a.createElement(pt,{value:-1},"全部设备"),E.map((function(e){var t=e.deviceId,n=e.deviceMac;return r.a.createElement(pt,{key:t,value:t},n)}))))),r.a.createElement(i.a.Item,{label:r.a.createElement(lt.a,{content:"设备使用自定义 Topic 时 Payload 数据格式即为上报的数据",overlayClassName:"draw-popover"},"Payload数据 ",r.a.createElement(it.a,null)),labelCol:{span:24},wrapperCol:{span:24}},r.a.createElement(Xe.a,{mode:"json",height:200,code:b,onChange:function(e){!function(e){g(e),m({payload:e})}(e)}}),u("payload",{initialValue:b,rules:[{required:!0,message:"请编写Payload数据"}]})(r.a.createElement(l.a,{type:"hidden"})))),r.a.createElement(S.a,{className:"",type:"primary",onClick:function(){c((function(e,n){if(console.log(999,n),!e){var a=n.deviceIdList,r=n.productId,c=n.payload;try{c=JSON.parse(c)}catch(e){return console.log("eeeeee",e),void Object(x.a)({description:"Payload数据请输入正确的json格式"})}var o=-1==a[0]?0:1,l={transferSQL:{transferId:t,productId:r,isAllDevice:o,deviceIdList:a},payload:c};I(void 0),Object(d.d)(d.a.checkSqlTransfer,l,{needJson:!0,noInstance:!0}).then((function(e){I(e.data)}))}}))}},"调 试"),w&&r.a.createElement(ut.a,{keyName:"调试结果",data:w}))})));function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){gt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ht(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Et(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Ot=P.a.Option,jt=i.a.create({name:"add-dataflow-addsend"})(Object(a.memo)((function(e){var t,n,c,u,s,m=e.operateList,f=e.transferId,p=e.form,v=p.validateFieldsAndScroll,y=(p.getFieldValue,p.getFieldDecorator),b=p.resetFields,g=(p.validateFields,p.setFieldsValue),h=e.operateType,E=e.transferTargetIndex,O=e.closeMod,j=e.transferTargetList,w=e.transferRecover,I=e.topicList,S=(t=1,n=Object(a.useRef)(),c=ht(Object(a.useState)(t),2),u=c[0],s=c[1],Object(a.useEffect)((function(){n.current&&n.current(u)}),[u]),[u,function(e,t){n.current=t,s(e)}]),C=ht(S,2),k=C[0],N=C[1];Object(a.useEffect)((function(){if(2==h||4==h){var e,t;if(2==h){var n=j[E];e=n.targetType,t=n.targetConfig}else t=w.recoverConfig,e=w.recoverType;var a=JSON.parse(t),r=a.transferId,c=a.topic,o=a.tag,l={optype:e,destination:c||r};1==e&&(l.tag=o),N(e),g(l)}}),[h]);return r.a.createElement(o.a,{title:h%2==0?"编辑":"添加",visible:h>0,width:600,onOk:function(){v((function(e,t){if(!e){var n=t.optype,a=t.destination,r=t.tag,c=0==n?{transferId:a}:{topic:a,tag:r},o=JSON.stringify(c),l={transferId:f};if(h>2)l.transferRecover=bt(bt({},w),{},{recoverType:n,recoverConfig:o});else if(1==h)l.transferTargetList=[{targetType:n,targetConfig:o}];else{var i=bt(bt({},j[E]),{},{targetType:n,targetConfig:o});l.transferTargetList=[i]}Object(d.d)(d.a.saveTransfer,l,{needJson:!0,noInstance:!0,loading:!0}).then((function(e){O(!0),b()}))}}))},onCancel:function(){O(),b()},maskClosable:!1},r.a.createElement(i.a,{labelCol:{span:6},wrapperCol:{span:16}},r.a.createElement(i.a.Item,{label:"选择操作"},y("optype",{rules:[{required:!0,message:"请选择操作"}],initialValue:1})(r.a.createElement(P.a,{placeholder:"选择操作",onChange:function(e){N(e),g({destination:void 0})}},m.map((function(e,t){return r.a.createElement(Ot,{disabled:1!=t,key:t,value:t},e)}))))),0==k&&r.a.createElement(i.a.Item,{label:"数据目的地"},y("destination",{rules:[{required:!0,message:"请选择数据目的地"}]})(r.a.createElement(P.a,{placeholder:"请选择"},I[0].map((function(e){var t=e.transferId,n=e.transferName;return r.a.createElement(Ot,{key:t,value:t},n)})))))||r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a.Item,{label:"数据目的地"},y("destination",{rules:[{required:!0,message:"请填写数据目的地"}]})(r.a.createElement(l.a,{placeholder:"自定义或者从平台选择"}))),r.a.createElement("div",{className:"hidselectbox"},r.a.createElement("a",null,"从平台选择"),r.a.createElement(P.a,{className:"hidselect",placeholder:"请选择",onChange:function(e){g({destination:e})}},I[1].map((function(e){return r.a.createElement(Ot,{key:e,value:e},e)})))),r.a.createElement(i.a.Item,{label:"tag"},y("tag",{rules:[{required:!0,message:"请填写tag"}]})(r.a.createElement(l.a,{placeholder:"输入tag"}))))))})));function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function It(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||Ct(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function St(e){return function(e){if(Array.isArray(e))return Pt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ct(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ct(e,t){if(e){if("string"==typeof e)return Pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pt(e,t):void 0}}function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=At(e);if(t){var r=At(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Dt(this,n)}}function Dt(e,t){return!t||"object"!==wt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Rt=["发布到另一个流转规则","发布到RocketMQ","发布到MQTT","发布到MySQL","发布到Redis"],Ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(o,e);var t,n,a,c=Lt(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=c.call(this,e)).openEditServe=function(){t.setState({editvisable:!0})},t.closeEditServe=function(e){t.setState({editvisable:!1}),e&&t.getDetail()},t.getTableInfo=function(){Object(d.c)(d.a.getTransferDataTable).then((function(e){var n=e.data,a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){Nt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},void 0===n?{}:n);t.setState({tableData:a})}))},t.getDetail=function(){Object(d.c)(d.a.getDataTransfer,{transferId:t.id},{loading:!0}).then((function(e){var n=e.data||{},a=n.transferDesc,r=n.transferName,c=n.transferSQL,o=n.transferTargetList,l=n.transferRecover;t.setState({transferName:r,transferDesc:a,transferSQL:c||{},transferTargetList:o||[],transferRecover:l||{}})}))},t.openEditSQL=function(){t.setState({editSQLvisiable:!0})},t.openCheckSQL=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t.setState({checkSQLvisiable:e})},t.closeEditSQL=function(e){t.setState({editSQLvisiable:!1}),e&&t.getDetail()},t.openOperate=function(e,n){var a={operateType:e};2==e&&(a.transferTargetIndex=n),t.setState(a);var r=t.state,c=r.transferMenuList,o=r.rocketMQTopicList;0==c.length&&t.getTransferMenuList(),0==o.length&&t.getRocketMQTopicList()},t.closeOperate=function(e){t.setState({operateType:0}),e&&t.getDetail()},t.getProList=function(){Object(d.c)(d.a.getProductList,{pageRows:9999,instanceId:2},{needVersion:1.2}).then((function(e){var n=e.data&&e.data.list||[];t.setState({productList:n})}))},t.getTransferMenuList=function(){Object(d.c)(d.a.getTransferMenuList).then((function(e){var n=e.data,a=St(void 0===n?{}:n);t.setState({transferMenuList:a})}))},t.getRocketMQTopicList=function(){Object(d.c)(d.a.getRocketMQTopicList).then((function(e){var n=e.data,a=St(void 0===n?{}:n);t.setState({rocketMQTopicList:a})}))},t.getColumns=function(e){var n=It(4==e&&["recoverType","recoverConfig","transferRecoverId"]||["targetType","targetConfig","transferTargetId"],3);return[{title:"操作类型",dataIndex:n[0],render:function(e){return Rt[e]}},{title:"数据目的地",dataIndex:n[1]},{title:"操作",dataIndex:n[2],width:120,render:function(n,a,c){return r.a.createElement("span",null,r.a.createElement("a",{onClick:function(){t.openOperate(e,c)}},"编辑"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement(ze.a,{title:"确定要移除吗？",onConfirm:function(){t.deleteTarget(n,e)},okText:"是",cancelText:"否"},r.a.createElement("a",null,"移除")))}}]},t.deleteTarget=function(e,n){var a=4==n&&{transferRecoverId:e}||{transferTargetId:e};Object(d.c)(d.a.delOneTransfer,a,{loading:!0,noInstance:!0}).then((function(e){t.getDetail()}))},t.id=e.match.params.id,t.state={transferName:"--",transferDesc:"--",transferSQL:{},transferTargetList:[],transferRecover:{},operateType:0,transferTargetIndex:0,editvisable:!1,editSQLvisiable:!1,checkSQLvisiable:!1,tableData:null,productList:[],transferMenuList:[],rocketMQTopicList:[]},t}return t=o,(n=[{key:"componentDidMount",value:function(){this.getDetail(),this.getTableInfo(),this.getProList()}},{key:"render",value:function(){var e=this,t=this.state,n=t.transferDesc,a=t.transferName,c=t.editvisable,o=t.transferSQL,l=t.editSQLvisiable,i=t.checkSQLvisiable,s=t.tableData,f=t.productList,d=t.operateType,p=t.transferTargetIndex,v=t.transferTargetList,y=t.transferRecover,b=t.transferMenuList,g=t.rocketMQTopicList;return r.a.createElement("section",{className:"page-dataflowdetail"},r.a.createElement(u.a,{title:"规则详情"}),r.a.createElement("header",{className:"header"},r.a.createElement(We.b,{className:"descriptions",column:2},r.a.createElement(We.b.Item,{label:"规则名称"},a),r.a.createElement(We.b.Item,{label:"规则 ID"},this.id),r.a.createElement(We.b.Item,{label:"规则描述"},n)),r.a.createElement(S.a,{className:"deitbtn",type:"primary",onClick:this.openEditServe},"编辑")),r.a.createElement(m.a,{title:"处理数据"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(S.a,{className:"addbtn",type:"primary",onClick:this.openEditSQL},"编写 SQL"),r.a.createElement("div",{className:"sqltit"},"规则查询语句:"),o.transferSQL&&r.a.createElement("div",{className:"sqlstr"},o.transferSQL," ",r.a.createElement("a",{onClick:function(){return e.openCheckSQL(!0)}},"调试SQL"))||r.a.createElement(r.a.Fragment,null,r.a.createElement(He.a,{className:"emptyimg",description:!1,image:He.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"您还没有编写 SQL 语句处理数据，",r.a.createElement("a",{onClick:this.openEditSQL},"编写 SQL"))))),r.a.createElement(m.a,{title:"转发数据"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(S.a,{className:"addbtn",type:"primary",onClick:function(){e.openOperate(1)}},"添加操作"),v.length>0&&r.a.createElement(I.a,{rowKey:"transferTargetId",columns:this.getColumns(2),dataSource:v,pagination:!1})||r.a.createElement(r.a.Fragment,null,r.a.createElement(He.a,{className:"emptyimg",description:!1,image:He.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"暂无转发数据，",r.a.createElement("a",{onClick:function(){e.openOperate(1)}},"添加操作"))))),r.a.createElement(m.a,{title:"转发错误操作数据"},r.a.createElement("div",{className:"alone-section-content-default"},y.recoverConfig&&r.a.createElement(I.a,{rowKey:"transferRecoverId",columns:this.getColumns(4),dataSource:[y],pagination:!1})||r.a.createElement(r.a.Fragment,null,r.a.createElement(He.a,{className:"emptyimg",description:!1,image:He.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"暂无转发错误操作数据，",r.a.createElement("a",{onClick:function(){e.openOperate(3)}},"添加操作"))))),r.a.createElement(Me,{visable:c,transferId:this.id,transferName:a,transferDesc:n,closeMod:function(t){e.closeEditServe(t)}}),l&&r.a.createElement(ct,{visable:l,transferId:this.id,tableData:s,productList:f,transferSQL:o,closeMod:function(t){e.closeEditSQL(t)}}),i&&r.a.createElement(vt,{visable:i,transferId:this.id,productList:f,closeMod:function(){return e.openCheckSQL(!1)}}),d>0&&r.a.createElement(jt,{operateList:Rt,transferId:this.id,operateType:d,transferTargetIndex:p,topicList:[b,g],transferTargetList:v,transferRecover:y,closeMod:function(t){e.closeOperate(t)}}))}}])&&Tt(t.prototype,n),a&&Tt(t,a),o}(a.PureComponent);function Mt(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(Ge,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/ruledetail/:id"),render:function(e){return r.a.createElement(Ft,e)}}),r.a.createElement(c.b,{to:"".concat(t,"/list")}))}function _t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_t(Object(n),!0).forEach((function(t){Vt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ut(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Kt=[{title:"配置数据流转"},{title:"选择监控对象"},{title:"定义监控规则"},{title:"确定监控形式"}],Bt={pageRows:10,pageIndex:1},Jt=function(e){var t=qt(Object(a.useState)({pager:{},list:[]}),2),n=t[0],c=t[1],o=qt(Object(a.useState)([]),2),i=o[0],s=o[1],p=qt(Object(a.useState)([]),2),y=p[0],b=p[1];Object(a.useEffect)((function(){g(Bt)}),[]);var g=function(e){y&&(e.warningId=y),Object(d.c)(d.a.geMonitorList,e,{loading:!0}).then((function(e){c(e.data)}))},h=[{title:"规则名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description"},{title:"运行状态",dataIndex:"runType",key:"runType",render:function(e){return r.a.createElement("span",null,{0:"初始状态",1:"运行中",2:"已停止"}[e])}},{title:"最近编辑时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return e?v.a.utcToDev(e):"--"}},{title:"操作",dataIndex:"id",key:"id",render:function(e,t){var n=t.id,a=t.name,c=t.runType;return r.a.createElement("span",null,r.a.createElement("a",{href:"#/open/developCenter/deviceMonitor/edit/".concat(n)},"编辑"),r.a.createElement(C.a,{type:"vertical"}),1==c&&r.a.createElement("a",{onClick:function(){s([n,a,"stop"])},href:"javascript:"},"停止")||r.a.createElement("a",{onClick:function(){O(n)},href:"javascript:"},"启动"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){s([n,a,"del"])},href:"javascript:"},"删除"))}}],E=function(e){g(Qt(Qt({},Bt),{},{pageIndex:e}))},O=function(e){Object(d.c)(d.a.startMonitor,{id:e},{loading:!0}).then((function(e){E(n.pager.pageIndex||1)}))},j=n.list,w=n.pager;return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"设备监控"}),r.a.createElement(m.a,null,r.a.createElement("div",{className:"use-service-flow-wrapper"},r.a.createElement(re.a,{type:3,flowLists:Kt}),r.a.createElement("div",{className:"extra-descs"},r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"配置数据流转，选择需要进行设备监控的rocketMQ数据对象。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"选择需要进行设备监控配置的对象，包括设备、产品、设备组。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"定义监控对象的具体监控规则，包括参数对比值、时长定义、条件比较等规则。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"在配置好规则前，可自定义具体整体规则的监控形式。"))))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(S.a,{href:"#/open/developCenter/deviceMonitor/add",icon:r.a.createElement(N.a,null),type:"primary"},"新增配置"),r.a.createElement(l.a,{placeholder:"请输入预警唯一ID查询",style:{width:"240px",margin:"0 24px 24px"},value:y,onChange:function(e){return b(e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",icon:r.a.createElement(T.a,null),onClick:function(){return E(1)}},"查询"),r.a.createElement(I.a,{rowKey:"id",columns:h,dataSource:j,pagination:{defaultCurrent:w.pageIndex,total:w.totalRows,onChange:E,current:w.pageIndex,showTotal:function(e){return r.a.createElement("span",null,"共 ",e," 条")}}}))),r.a.createElement(f.a,{visible:i.length>0,modalOKHandle:function(){var e="del"==i[2]&&d.a.deleteMonitor||d.a.stopMonitor;Object(d.c)(e,{id:i[0]},{loading:!0}).then((function(e){E(n.pager.pageIndex||1),s([])}))},modalCancelHandle:function(){s([])},title:"del"==i[2]?"删除":"停止",descText:"即将".concat("del"==i[2]?"删除":"停止","监控规则"),needWarnIcon:!0,targetName:i[1]}))},Gt=(n("SeTJ"),n("9iNK"));function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}P.a.Option;var zt={labelCol:{span:4},wrapperCol:{span:14}},Xt=i.a.create({name:"monitor-baseinfo"})((function(e){var t=e.form,n=t.validateFieldsAndScroll,c=t.getFieldValue,o=t.getFieldDecorator,u=(t.resetFields,t.setFieldsValue),s=e.saveBaseInfo,m=e.baseFormData,f=e.transferList;Object(a.useEffect)((function(){var e=m.description,t=m.name,n=m.transferId,a=m.transferTopic,r=m.transferTag;u({description:e,name:t,transferId:n,transferTopic:a,transferTag:r})}),[m]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,zt,r.a.createElement(i.a.Item,{label:"规则名称"},o("name",{rules:[{required:!0,message:"请输入监控规则名称"},{max:50,message:"最大输入长度为50"}]})(r.a.createElement(l.a,{placeholder:"请输入监控规则名称"}))),r.a.createElement(Fe.a,{label:"描述",formId:"description",astrictNub:"100",rows:"3",placeholder:"监控规则描述",getFieldDecorator:o,getFieldValue:c}),r.a.createElement("div",{className:"formitembox"},r.a.createElement(i.a.Item,{label:"数据流转"},o("transferObj",{rules:[{required:!0,message:"请选择数据流转对象"}]})(r.a.createElement(Gt.a,{style:{width:"450px"},options:void f.map((function(e){for(var t=e.transferId,n=e.transferName,a=e.recoverConfigList,r=void 0===a?[]:a,c={},o=0;o<r.length;o++){var l=JSON.parse(r[o]),i=l.topic,u=l.tag;c[i]?c[i].push(u):c[i]=[u]}var s=[];for(var m in c){console.log(c[m]);var f=c[m].map((function(e){return{value:e,label:e}}));s.push({value:m,label:m,children:f})}return{value:t,label:n,children:s}})),placeholder:"流转对象 / topic / tag"}))),r.a.createElement("div",{className:"tips"},"没有数据？请先配置",r.a.createElement("a",{href:"#/open/developCenter/dataFlow/list"}," 数据流转")))),r.a.createElement("div",{className:"stepbtnbox"},r.a.createElement(S.a,{className:"btn",type:"primary",onClick:function(){n((function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){Wt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t);s(n)}))}},"下一步")))})),Yt=(n("oENA"),n("uTCA")),Zt=n("CvKH"),$t=n.n(Zt);n("hjnz"),n("xuDP");function en(e){return(en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var tn=["ruleType"];function nn(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function an(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?an(Object(n),!0).forEach((function(t){cn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):an(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function on(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,c=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw r}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ln(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ln(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ln(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function un(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function sn(e,t){return(sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=dn(e);if(t){var r=dn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return fn(this,n)}}function fn(e,t){return!t||"object"!==en(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dn(e){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pn={labelCol:{span:4},wrapperCol:{span:16}},vn=P.a.Option,yn=(ue.a.RangePicker,[{id:"==",nam:"等于"},{id:">",nam:"大于"},{id:">=",nam:"大于等于"},{id:"<",nam:"小于"},{id:"<=",nam:"小于等于"}]),bn=[{id:"noDeviceData",nam:"设备无数据告警"},{id:"peak",nam:"设备数据触发阈值告警"},{id:"statistical",nam:"设备时间段内数据汇聚输出"},{id:"threshold",nam:"设备数据持续触发阈值告警"}],gn={ruleType:"noDeviceData",ruleId:"",stickTime:"",resendIntervalTime:""},hn={info:{productId:"",productName:""},rules:[$t()(gn)]},En={name:"",uniqueId:"",products:[$t()(hn)]},On=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sn(e,t)}(o,e);var t,n,a,c=mn(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=c.call(this,e)).changeParam=function(e,n,a){var r=$t()(t.state.campusConf),c=on(a,3),o=c[0],l=c[1],i=c[2];e.target&&(e=e.target.value),"fields"==n&&(e=e.split(",")),r[o].products[l].rules[i][n]=e,t.setState({campusConf:r})},t.getOneWarForm=function(e,n,a){var c=n.startTime,o=n.endTime,i=n.stickTime,u=n.judgeField,s=n.judgeValue,m=n.judgeType;switch(e){case"noDeviceData":var f=n.resendIntervalTime;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置时长"),r.a.createElement(l.a,{className:"timeinput",value:i,onChange:function(e){t.changeParam(e,"stickTime",a)}}),"毫秒无数据，则触发告警"),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"规则重发时间间隔"),r.a.createElement(l.a,{className:"timeinput",value:f,onChange:function(e){t.changeParam(e,"resendIntervalTime",a)}}),"毫秒"));case"peak":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(l.a,{onChange:function(e){t.changeParam(e,"startTime",a)},placeholder:"例：08:30:00",className:"hourtime",value:c}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(l.a,{onChange:function(e){t.changeParam(e,"endTime",a)},placeholder:"例：09:30:00",className:"hourtime",value:o})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较的字段和值"),r.a.createElement(l.a,{onChange:function(e){t.changeParam(e,"judgeField",a)},placeholder:"输入比较的字段",className:"kvinput",value:u}),r.a.createElement("span",{className:"rangeline"},":"),r.a.createElement(l.a,{onChange:function(e){t.changeParam(e,"judgeValue",a)},placeholder:"输入字段的值",className:"kvinput",value:s})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较方式"),r.a.createElement(P.a,{placeholder:"比较方式",defaultValue:"==",value:m,className:"compareselect",onChange:function(e){t.changeParam(e,"judgeType",a)}},yn.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(vn,{key:t,value:t},n)}))),r.a.createElement("span",{className:"desc"},"备注：与数据流转rocketMQ中数据做对比。")));case"statistical":var d=n.fields;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(l.a,{value:c,onChange:function(e){t.changeParam(e,"startTime",a)},placeholder:"例：08:30:00",className:"hourtime"}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(l.a,{value:o,onChange:function(e){t.changeParam(e,"endTime",a)},placeholder:"例：09:30:00",className:"hourtime"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"需获取的字段"),r.a.createElement(l.a,{value:d&&d.join(",")||"",onChange:function(e){t.changeParam(e,"fields",a)},placeholder:"可输入多个，英文逗号隔开",className:"manykey"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"desc solo"},"备注：蒋获取的字段k-v值做推送。")));case"threshold":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(l.a,{value:c,onChange:function(e){t.changeParam(e,"startTime",a)},placeholder:"例：08:30:00",className:"hourtime"}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(l.a,{value:o,onChange:function(e){t.changeParam(e,"endTime",a)},placeholder:"例：09:30:00",className:"hourtime"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较的字段和值"),r.a.createElement(l.a,{onChange:function(e){t.changeParam(e,"judgeField",a)},placeholder:"输入比较的字段",className:"kvinput",value:u}),r.a.createElement("span",{className:"rangeline"},":"),r.a.createElement(l.a,{onChange:function(e){t.changeParam(e,"judgeValue",a)},placeholder:"输入字段的值",className:"kvinput",value:s})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较方式"),r.a.createElement(P.a,{onChange:function(e){t.changeParam(e,"judgeType",a)},placeholder:"比较方式",defaultValue:"==",value:m,className:"compareselect"},yn.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(vn,{key:t,value:t},n)}))),r.a.createElement("span",{className:"desc"},"备注：与数据流转rocketMQ中数据做对比。")),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"持续时长"),r.a.createElement(l.a,{onChange:function(e){t.changeParam(e,"stickTime",a)},className:"timeinput",value:i}),"毫秒"));default:return null}},t.getRuleFormData=function(){var e=t.state,n=e.connector_type,a=e.connector_topic,r=e.connector_tag,c=e.connector_url,o=e.campusConf,l={connector_type:n};return"rocketmq"==n?(l.connector_topic=a,l.connector_tag=r):l.connector_url=c,{sinkConf:l,campusConf:$t()(o)}},t.handleSubmit=function(e){var n=t.props,a=n.baseFormData,r=n.ruleId,c=rn(rn({},a),{},{ruleConf:JSON.stringify(t.getRuleFormData())}),o=d.a.addMonitor;r&&(c.id=r,o=d.a.updateMonitor),Object(d.c)(o,c).then((function(e){console.log(11111,e)}))},t.goPre=function(){t.props.setRuleFormData(t.getRuleFormData())},t.changeNoticeType=function(e){var n=e.target.value;t.setState({connector_type:n})},t.changeUrl=function(e){t.setState({connector_url:e})},t.addRule=function(e,n){var a=$t()(t.state.campusConf);a[e].products[n].rules.push($t()(gn)),t.setState({campusConf:a})},t.addPro=function(e){var n=$t()(t.state.campusConf);n[e].products.push($t()(hn)),t.setState({campusConf:n})},t.addGroup=function(){var e=$t()(t.state.campusConf);e.push($t()(En)),t.setState({campusConf:e})},t.changeWarType=function(e,n,a,r){var c=$t()(t.state.campusConf);c[n].products[a].rules[r].ruleType=e,t.setState({campusConf:c})},t.changeGroup=function(e,n){var a=$t()(t.state.campusConf),r=on(e.split("_|_"),2),c=r[0],o=r[1];a[n].uniqueId=c,a[n].name=o,t.setState({campusConf:a})},t.changePro=function(e,n,a){var r=$t()(t.state.campusConf),c=on(e.split("_|_"),2),o=c[0],l=c[1];r[n].products[a].info.productId=o,r[n].products[a].info.productName=l,t.setState({campusConf:r})},t.state={connector_type:"rocketmq",connector_topic:"IOT_DEVICE_MONITOR_TOPIC_2021",connector_tag:void 0,connector_url:void 0,campusConf:[$t()(En)]},t}return t=o,(n=[{key:"componentDidMount",value:function(){var e=this.props.ruleFormData,t=e.sinkConf,n=e.campusConf;this.setState(rn(rn({},t),{},{campusConf:$t()(n)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.campusConf,a=t.connector_type,c=t.connector_topic,o=t.connector_tag,u=t.connector_url,s=this.props,m=s.devicegrouplist,f=s.productList;return r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,pn,r.a.createElement(i.a.Item,{label:"通知方式"},r.a.createElement(Yt.a.Group,{value:a,onChange:this.changeNoticeType},r.a.createElement(Yt.a,{value:"rocketmq"},"rocketMQ"),r.a.createElement(Yt.a,{value:"dingtalk"},"钉钉推送"))),"rocketmq"==a&&r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a.Item,{label:"topic"},r.a.createElement(P.a,{value:c},r.a.createElement(vn,{value:c},c))),o&&r.a.createElement(i.a.Item,{label:"tag"},r.a.createElement(P.a,{value:o},r.a.createElement(vn,{value:o},o))))||r.a.createElement(i.a.Item,{label:"钉钉推送地址"},r.a.createElement(l.a,{value:u,placeholder:"请输入钉钉推送地址",onChange:function(t){e.changeUrl(t)}})),r.a.createElement("div",{className:"devicegroupbox"},n.map((function(t,a){var c=t.uniqueId,o=t.name,l=t.products;return r.a.createElement("div",{key:c+"_"+a,className:"devicegroup"},r.a.createElement(i.a.Item,{className:"groupselect",label:"设备分组".concat(n[1]&&a+1||"")},r.a.createElement(P.a,{placeholder:"请选择设备分组",value:c+"_|_"+o,onChange:function(t){e.changeGroup(t,a)}},m.map((function(e){var t=e.id,n=e.name;return r.a.createElement(vn,{key:t,value:t+"_|_"+n},n)})))),r.a.createElement("div",{className:"pro-gropubox"},l.map((function(t,n){var c=t.info,o=t.rules,l=c.productId,i=c.productName;return r.a.createElement("div",{className:"pro-group",key:l+"_"+n},r.a.createElement(P.a,{className:"proselect",placeholder:"选择产品",showSearch:!0,optionFilterProp:"children",value:l+"_|_"+i,onChange:function(t){e.changePro(t,a,n)}},f.map((function(e,t){var n=e.productId,a=e.productName;return r.a.createElement(vn,{key:t,value:n+"_|_"+a},a)}))),r.a.createElement("div",{className:"rulebox"},o.map((function(t,c){var o=t.ruleType,l=nn(t,tn);return r.a.createElement("div",{className:"rule",key:c},r.a.createElement(P.a,{placeholder:"选择告警方式",onChange:function(t){e.changeWarType(t,a,n,c)},value:o,className:"typeselect"},bn.map((function(e){var t=e.id,n=e.nam;return r.a.createElement(vn,{key:t,value:t},n)}))),r.a.createElement("div",{className:"onewarn"},e.getOneWarForm(o,l,[a,n,c])))})),r.a.createElement("a",{className:"addbtn",onClick:function(){e.addRule(a,n)}},"增加规则")))})),r.a.createElement("a",{className:"addbtn",onClick:function(){e.addPro(a)}},"增加产品")))})),n.length<2&&r.a.createElement("a",{className:"addbtn",onClick:this.addGroup},"增加分组"))),r.a.createElement("div",{className:"stepbtnbox"},r.a.createElement(S.a,{className:"btn",onClick:this.goPre},"上一步"),r.a.createElement(S.a,{className:"btn",type:"primary",onClick:this.handleSubmit},"提 交")))}}])&&un(t.prototype,n),a&&un(t,a),o}(a.Component),jn=i.a.create({name:"ruleForm"})(On);n("UgUF");function wn(e){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){Cn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function kn(e,t){return(kn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=xn(e);if(t){var r=xn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Tn(this,n)}}function Tn(e,t){return!t||"object"!==wn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xn(e){return(xn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ln={pageIndex:1,pageRows:9999},Dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kn(e,t)}(o,e);var t,n,a,c=Nn(o);function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=c.call(this,e)).goToStep=function(e){t.setState({current:e},(function(){console.log(t.state)}))},t.saveBaseInfo=function(e){t.setState({baseFormData:e,current:1})},t.setRuleFormData=function(e){t.setState({ruleFormData:e,current:0})},t.baseInfoForm={},t.ruleForm={},t.publicTypeForm={},t.state={current:0,ruleId:t.props.match.params.id,baseFormData:{},ruleFormData:[],devicegrouplist:[],productList:[],transferList:[]};var n=t.props.match.params.id;return n&&Object(d.c)(d.a.getMonitor,{id:n},{loading:!0}).then((function(e){var a=e.data,r=a.description,c=a.name,o=a.transferId,l=a.transferTopic,i=a.transferTag,u=a.ruleConf,s={description:r,name:c,transferId:o,transferTopic:l,transferTag:i},m=JSON.parse(u);t.setState({ruleId:n,baseFormData:s,ruleFormData:m},(function(){console.log(9999,t.state)}))})),t}return t=o,(n=[{key:"componentDidMount",value:function(){var e=this;Object(d.c)(d.a.getGroupList,Sn({},Ln)).then((function(t){e.setState({devicegrouplist:t.data.list})})),Object(d.c)(d.a.getDownProduct,Sn({},Ln)).then((function(t){var n=t.data.list;n&&n.length&&n.length>0&&e.setState({productList:n})})),Object(d.c)(d.a.getTransfer4Monitor).then((function(t){var n=t.data||[];console.log(44,n),e.setState({transferList:n})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.current,a=t.ruleId,c=t.baseFormData,o=t.ruleFormData,l=t.devicegrouplist,i=t.productList,s=t.transferList;return r.a.createElement("div",{className:"device-monitordetailpage flex-column"},r.a.createElement(u.a,{backHandle:function(){return e.props.history.push({pathname:"/open/developCenter/deviceMonitor/list",page:"2"})},title:a?"编辑设备监控":"新增设备监控"}),r.a.createElement("div",{className:"step-header-wrapper"},r.a.createElement("div",{className:"step-header flex-row"},r.a.createElement("div",{className:"step-item flex-row flex1".concat(0===n?" current-step":"")},r.a.createElement("i",{className:"step-product"}),r.a.createElement("span",null,"1. 监控信息")),r.a.createElement("div",{className:"step-item flex1 flex-row".concat(1===n?" current-step":"")},r.a.createElement("i",{className:"step-data"}),r.a.createElement("span",null,"2. 规则配置")))),r.a.createElement("div",{className:"add-content-wrapper"},r.a.createElement("div",{className:"add-content"},r.a.createElement("div",{className:"steps-content"},[r.a.createElement(Xt,{saveBaseInfo:this.saveBaseInfo,baseFormData:c,transferList:s}),r.a.createElement(jn,{baseFormData:c,ruleFormData:o,ruleId:a,setRuleFormData:this.setRuleFormData,devicegrouplist:l,productList:i})][n]))))}}])&&Pn(t.prototype,n),a&&Pn(t,a),o}(a.Component);function An(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(Jt,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/edit/:id"),render:function(e){return r.a.createElement(Dn,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/add"),render:function(e){return r.a.createElement(Dn,e)}}),r.a.createElement(c.b,{to:"".concat(t,"/list")}))}function Rn(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/projectManage"),component:ae}),r.a.createElement(c.c,{path:"".concat(t,"/serveDevelop"),component:oe}),r.a.createElement(c.c,{path:"".concat(t,"/serveDetail/:id"),component:Le}),r.a.createElement(c.c,{path:"".concat(t,"/dataFlow"),component:Mt}),r.a.createElement(c.c,{path:"".concat(t,"/deviceMonitor"),component:An}),r.a.createElement(c.b,{to:"".concat(t,"/projectManage")}))}},UgUF:function(e,t,n){},gSWv:function(e,t,n){},ivPg:function(e,t,n){e.exports=n.p+"static/images/no-source-tip.681eb7825cf81b5da33967ff8571f3c6.png"},vQck:function(e,t,n){}}]);