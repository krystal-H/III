(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{gbE0:function(e,t,a){"use strict";a.r(t);a("ef1R"),a("Ra8s"),a("sfoS"),a("HsXu"),a("bs69"),a("Lm8M"),a("ryEf"),a("qgAm"),a("9b3Y"),a("Ck9u"),a("59iL");var n=a("f6Fh"),r=a("T9Mk"),l=a.n(r),i=a("DgvE"),c=a("Nlzp"),o=a("MeRu"),u=(a("IHDg"),a("P37N"),a("vV4J"),a("av3G"),a("RfWx"),a("MNU5"),a("YeX6")),s=(a("SmMv"),a("DTgQ")),m=(a("QcZr"),a("b+L2")),d=(a("6IzV"),a("QFmM")),f=(a("UdMA"),a("ViyK")),p=(a("2ek4"),a("oWtQ")),g=(a("xzjF"),a("PeP6")),b=(a("62KB"),a("FC04")),y=(a("UTJx"),a("dVdO")),v=(a("a6t6"),a("N1Yw")),E=(a("odtX"),a("4Hua")),h=a("v7xx"),O=a("P2RN");function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var S=function(e){var t=e.warningInof,a=e.closeDetailMod,n=e.delwithWarn,o=t.alarmTime,u=t.warningTitle,s=t.state,m=t.warningWay,d=t.ruleName,p=t.warningDetail,g=t.deviceIds,b=t.dealDetail,w=t.id,S=t.productName,I=j(Object(r.useState)(""),2),x=I[0],P=I[1],C=j(Object(r.useState)(""),2),k=C[0],N=C[1],A=1==s&&l.a.createElement(h.a,{style:{padding:"0"},preText:"取消",nextText:"提交",preHandle:a,nextHandle:function(){x?n({id:w,dealDetail:x}):Object(O.a)({description:"请填写处理记录",type:"warn"})}})||l.a.createElement(h.a,{style:{padding:"0"},nextBtn:!1,preText:"关闭",preHandle:a});return l.a.createElement(y.a,{className:"page-warninginfo-modal",title:u,visible:!!u,width:700,onCancel:a,footer:A},l.a.createElement(v.a,{gutter:[12,16]},l.a.createElement(E.a,{span:5,className:"detail-label"},"告警时间："),l.a.createElement(E.a,{span:18},i.a.utcToDev(o)||"--"),l.a.createElement(E.a,{span:5,className:"detail-label"},"告警消息类型："),l.a.createElement(E.a,{span:18},{0:"站内",1:"站内+邮件"}[m]),l.a.createElement(E.a,{span:5,className:"detail-label"},"关联的告警规则："),l.a.createElement(E.a,{span:18},d||"--"),l.a.createElement(E.a,{span:5,className:"detail-label"},"告警内容："),l.a.createElement(E.a,{span:18},l.a.createElement("div",null,p||"--")),l.a.createElement(E.a,{span:5,className:"detail-label"},"产品名称："),l.a.createElement(E.a,{span:18},S||"--"),l.a.createElement(E.a,{span:5,className:"detail-label"},"告警设备ID："),l.a.createElement(E.a,{span:16},l.a.createElement("div",null,k||g||"")),l.a.createElement(E.a,{span:2},l.a.createElement("a",{onClick:function(){Object(c.c)(c.a.getWarningInfo,{id:w},{loading:!0}).then((function(e){N(e.data.deviceIds)}))}},"刷新")),l.a.createElement(E.a,{span:5,className:"detail-label"},"处理记录："),l.a.createElement(E.a,{span:18},1==s&&l.a.createElement(f.a.TextArea,{rows:3,value:x||b||"",placeholder:"处理记录",onChange:function(e){P(e.target.value)}})||l.a.createElement("div",null,x||b||""))))};a("hEGT");function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function x(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var N=f.a.TextArea,A=d.a.Item,T={labelCol:{span:6},wrapperCol:{span:12}};function D(e,t){var a=e.setStepCur,n=e.formdata,i=C(d.a.useForm(),1)[0];Object(r.useEffect)((function(){n.name?i.setFieldsValue(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?x(Object(a),!0).forEach((function(t){P(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},n)):i.resetFields()}),[n.name]);return l.a.createElement("div",null,l.a.createElement(d.a,I({ref:t,form:i},T,{onFinish:function(e){a(1)}}),l.a.createElement(A,{label:"告警规则名称",name:"name",rules:[{required:!0,message:"请输入告警规则名称"},{max:30,message:"最大输入长度为30字符"}]},l.a.createElement(f.a,{placeholder:"请输入告警规则名称"})),l.a.createElement(A,{label:"描述",name:"remark",rules:[{max:100,message:"最大输入长度为100字符"}]},l.a.createElement(N,{placeholder:"告警规则描述",showCount:!0,maxLength:100,rows:4}))),l.a.createElement(h.a,{preBtn:!1,nextHandle:i.submit}))}var F=Object(r.memo)(Object(r.forwardRef)(D)),W=(a("oENA"),a("uTCA"));a("pckg"),a("J2lP"),a("hjnz");function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function V(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?V(Object(a),!0).forEach((function(t){R(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):V(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function R(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var U=g.a.Option,J=d.a.Item,B={labelCol:{span:8},wrapperCol:{span:16}},z=[{id:0,nam:"属性触发"},{id:1,nam:"事件触发"},{id:3,nam:"上线触发"},{id:4,nam:"下线触发"},{id:2,nam:"上下线触发"}],K=[{id:"1",nam:"=="},{id:"2",nam:">"},{id:"3",nam:"<"},{id:"4",nam:">="},{id:"5",nam:"<="},{id:"6",nam:"!="},{id:"7",nam:"in"},{id:"8",nam:"between"}],$=[{id:"1",nam:"="},{id:"6",nam:"!="},{id:"7",nam:"in"}];function Q(e,t){var a=e.setStepCur,n=e.formdata,i=L(d.a.useForm(),1)[0],o=L(Object(r.useState)([]),2),u=o[0],s=o[1],m=L(Object(r.useState)([]),2),f=m[0],p=m[1],b=L(Object(r.useState)([]),2),y=b[0],O=b[1],j=L(Object(r.useState)([]),2),w=j[0],S=j[1],I=L(Object(r.useState)(n.triggerMode),2),x=I[0],P=I[1],C=L(Object(r.useState)(n.productId),2),k=C[0],N=C[1],A=L(Object(r.useState)(n.connType||"0"),2),T=A[0],D=A[1],F=L(Object(r.useState)(!1),2),V=F[0],R=F[1];Object(r.useEffect)((function(){0==u.length&&K()}),[]),Object(r.useEffect)((function(){k&&$(k)}),[k]),Object(r.useEffect)((function(){if(!V)if(n.productId){if(u.length>0&&f>0){var e=n.productId,t=n.deviceIds,a=n.triggerMode,r=n.props,l={productId:e,deviceIds:t,triggerMode:a};if(a>1)i.setFieldsValue(q({},l));else{l.ruletype=T;for(var c=0;c<r.length;c++){var o=r[c],s=o.propName,m=o.propIdentifier,d=o.propFieldType,p=o.judge,g=o.propVal,b=c>0?"_add":"";l["propName".concat(b)]="".concat(m,",").concat(d,",").concat(s),l["judge".concat(b)]=p,l["propVal".concat(b)]=g}if(1==a){Q(e);var v=n.eventName,E=n.eventIdentifier+","+v;l.identifier=E,G(E),w.length>0&&y.length>0&&i.setFieldsValue(q({},l))}else 0==a&&(G(),y.length>0&&i.setFieldsValue(q({},l)))}}}else i.resetFields()}),[n.productId,u,f,y,w,V]),Object(r.useImperativeHandle)(t,(function(){return{formDataToData:H}}),[H]);var H=function(){var e=i.getFieldsValue();console.log(111,e);var t=e.triggerName,a=e.productId,n=e.deviceIds,r=e.triggerMode,l={triggerName:t,productId:a,deviceIds:n,triggerMode:r};if(r<2){var c=e.identifier,o=e.ruletype,u=e.propName,s=e.judge,m=e.propVal;if(c){var d=c.split(",");l.eventName=d[1],l.eventIdentifier=d[0]}var f=u.split(","),p=[{propName:f[2],propIdentifier:f[0],propFieldType:f[1],judge:s,propVal:m}];if("0"!==o){l.connType=o;var g=e.propName_add,b=e.judge_add,y=e.propVal_add,v=g.split(",");p.push({propName:v[2],propIdentifier:v[0],propFieldType:v[1],judge:b,propVal:y})}l.props=p}return l},K=function(){Object(c.b)(c.a.getProductType,{},{loading:!0}).then((function(e){var t=e.data,a=Object.keys(t).map((function(e){return{id:e,name:t[e]}}));s(a)}))},$=function(e){Object(c.c)(c.a.getDeviceListByProId,{productId:e,pageIndex:1,pageRows:9999},{loading:!0}).then((function(e){p(e.data.list)}))},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k;Object(c.c)(c.a.getWarnEventLi,{productId:e},{loading:!0}).then((function(e){var t=e&&e.data||[];S(t)}))},G=function(e){var t={productId:k},a=c.a.getWarnProperty;e&&(a=c.a.getWarnEventProperty,t.eventIdentifier=e.split(",")[0]),Object(c.c)(a,t,{loading:!0}).then((function(e){var t=e&&e.data||[];O(t)}))};return l.a.createElement("div",null,l.a.createElement(d.a,{form:i,onFinish:function(e){a(2)}},l.a.createElement(v.a,{gutter:14},l.a.createElement(E.a,{span:10},l.a.createElement(J,M({},B,{label:"触发对象",name:"triggerName",initialValue:"deviceTrigger",required:!0}),l.a.createElement(g.a,null,l.a.createElement(U,{value:"deviceTrigger"},"设备触发")))),l.a.createElement(E.a,{span:7},l.a.createElement(J,{name:"productId",rules:[{required:!0,message:"请选择产品"}]},l.a.createElement(g.a,{showSearch:!0,optionFilterProp:"children",onChange:function(e){N(e),R(!0)},placeholder:"请选择产品"},u.map((function(e){var t=e.id,a=e.name;return l.a.createElement(U,{key:t,value:t},a)}))))),l.a.createElement(E.a,{span:7},l.a.createElement(J,{name:"deviceIds",rules:[{required:!0,message:"请选择设备"}]},l.a.createElement(g.a,{allowClear:!0,mode:"multiple",placeholder:"请选择设备"},f.map((function(e){var t=e.deviceId;e.deviceMac;return l.a.createElement(U,{key:t,value:t},t)})))))),l.a.createElement(v.a,{gutter:14},l.a.createElement(E.a,{span:10},l.a.createElement(J,M({label:"触发方式"},B,{name:"triggerMode",rules:[{required:!0,message:"请选择触发方式"}]}),l.a.createElement(g.a,{disabled:!k,placeholder:"请选择触发方式",onChange:function(e){1===e&&(Q(),O([]),R(!0)),0===e&&(G(),R(!0)),P(e)}},z.map((function(e){var t=e.id,a=e.nam;return l.a.createElement(U,{key:t,value:t},a)}))))),1===x&&l.a.createElement(E.a,{span:7},l.a.createElement(J,{name:"identifier",rules:[{required:!0,message:"请选择事件"}]},l.a.createElement(g.a,{placeholder:"请选择事件",onChange:function(e){G(e),R(!0)}},w.map((function(e){var t=e.identifier,a=e.name;return l.a.createElement(U,{key:t,value:t+","+a},a)})))))),(0==x||1==x)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(v.a,{gutter:14},l.a.createElement(E.a,{span:16},l.a.createElement(J,{label:"触发条件类型",name:"ruletype",labelCol:{span:5},required:!0,initialValue:"0"},l.a.createElement(W.a.Group,{onChange:function(e){D(e.target.value)}},l.a.createElement(W.a,{value:"0"},"单条"),l.a.createElement(W.a,{value:"and"},"and 组合"),l.a.createElement(W.a,{value:"or"},"or 组合"))))),l.a.createElement(_,{propEventList:y,add:""}),"0"!==T&&l.a.createElement(l.a.Fragment,null,l.a.createElement(v.a,{gutter:[14]},l.a.createElement(E.a,{span:4}),l.a.createElement(E.a,{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"14px"},span:6},T)),l.a.createElement(_,{propEventList:y,add:"_add"})))),l.a.createElement(h.a,{preHandle:function(){return a(0)},nextHandle:i.submit}))}var G=Object(r.memo)(Object(r.forwardRef)(Q)),_=function(e){var t=e.propEventList,a=void 0===t?[]:t,n=e.add,i=L(Object(r.useState)(""),2),c=i[0],o=i[1],u=L(Object(r.useState)("请输入比较值"),2),s=u[0],m=u[1];return l.a.createElement(v.a,{gutter:14},l.a.createElement(E.a,{span:10},l.a.createElement(J,M({label:"触发规则",name:"propName".concat(n)},B,{rules:[{required:!0,message:"请选择属性"}]}),l.a.createElement(g.a,{showSearch:!0,optionFilterProp:"children",onChange:function(e){var t=e.split(",")[1];o(t)},placeholder:"请选择属性"},a.map((function(e){var t=e.srcCode,a=e.srcName,n=e.srcType;return l.a.createElement(U,{key:t,value:t+","+n+","+a},"".concat(a,"( ").concat(t," )"))}))))),l.a.createElement(E.a,{span:4},l.a.createElement(J,{name:"judge".concat(n),rules:[{required:!0,message:"请选择比较方式"}]},l.a.createElement(g.a,{onChange:function(e){var t="请输入比较直";"in"==e?t="多个值请以逗号隔开":"between"==e&&(t="逗号隔开起始值，例如“1,5” "),m(t)},placeholder:"比较方式"},(("char"==c||"string"==c)&&$||K).map((function(e){var t=e.id,a=e.nam;return l.a.createElement(U,{key:t,value:a},a)}))))),l.a.createElement(E.a,{span:10},l.a.createElement(J,{name:"propVal".concat(n),rules:[{required:!0,message:"请输入比较值"}]},l.a.createElement(f.a,{placeholder:s}))))};function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Z(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return te(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var ae=f.a.TextArea,ne=d.a.Item,re={labelCol:{span:6},wrapperCol:{span:12}};function le(e,t){var a=e.setStepCur,n=e.commitAll,i=e.formdata,c=ee(d.a.useForm(),1)[0],o=ee(Object(r.useState)(i.warningWay),2),u=o[0],s=o[1];Object(r.useEffect)((function(){i.warningTitle?c.setFieldsValue(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(a),!0).forEach((function(t){Z(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},i)):c.resetFields()}),[i.warningTitle]);return l.a.createElement("div",null,l.a.createElement(d.a,X({ref:t,form:c},re,{onFinish:function(e){n()}}),l.a.createElement(ne,{label:"触发告警",name:"warningWay",rules:[{required:!0,message:"请选择告警方式"}],initialValue:"0"},l.a.createElement(W.a.Group,{onChange:function(e){s(e.target.value)}},l.a.createElement(W.a,{value:"0"},"站内消息"),l.a.createElement(W.a,{value:"1"},"站内消息+邮件"))),l.a.createElement(ne,{label:"消息标题",name:"warningTitle",rules:[{required:!0,message:"请输入消息标题"},{max:50,message:"最大输入长度为50"}]},l.a.createElement(f.a,{placeholder:"请输入消息标题"})),"1"==u&&l.a.createElement(ne,{label:"邮件地址",name:"emailAddress",rules:[{required:!0,message:"请输入邮件地址"},{max:100,message:"最大输入长度为100"}]},l.a.createElement(f.a,{placeholder:"请输入邮件地址"})),l.a.createElement(ne,{label:"告警内容",name:"warningDetails",rules:[{required:!0,message:"请输入告警内容"},{max:100,message:"最大输入长度为100"}]},l.a.createElement(ae,{rows:"3",maxLength:100,showCount:!0,placeholder:"请输入告警内容"})),l.a.createElement(ne,{label:"发送频率",name:"waringFreq",required:!0,initialValue:"0"},l.a.createElement(W.a.Group,null,l.a.createElement(W.a,{value:"0"},"首次发送后，相同故障间隔6小时发送一次，最高单日发送4次      "),l.a.createElement(W.a,{value:"1"},"首次发送后，相同故障间隔24小时发送一次")))),l.a.createElement(h.a,{nextText:"提交",preHandle:function(){return a(1)},nextHandle:c.submit}))}var ie=Object(r.memo)(Object(r.forwardRef)(le)),ce=["warningWay","warningTitle","warningDetails","waringFreq","emailAddress"];function oe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ue(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(a),!0).forEach((function(t){se(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function se(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function me(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function de(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fe(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var pe=p.a.Step,ge=n.a.TabPane,be=function(e){var t=e.visible,a=e.closeEditMod,i=e.editData,o=i.id,u=i.name,s=de(Object(r.useState)({}),2),m=s[0],d=s[1],f=de(Object(r.useState)({}),2),g=f[0],b=f[1],v=de(Object(r.useState)({}),2),E=v[0],h=v[1],O=de(Object(r.useState)(0),2),j=O[0],w=O[1];Object(r.useEffect)((function(){var e=i.remark,t=i.content;if(void 0!==o){var a=JSON.parse(t),n=a.warningWay,r=a.warningTitle,l=a.warningDetails,c=a.waringFreq,s=a.emailAddress,m=me(a,ce);d({name:u,remark:e}),b(m),h({warningWay:n,warningTitle:r,warningDetails:l,waringFreq:c,emailAddress:s})}}),[i]);var S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;w(e)},I=Object(r.useRef)(),x=Object(r.useRef)(),P=Object(r.useRef)();return l.a.createElement(y.a,{title:void 0!==o?"编辑规则":"新增规则",visible:t,width:1e3,footer:null,maskClosable:!1,onCancel:a,className:"page-devwarn-config-modal",afterClose:function(){w(0),d({}),b({}),h({})}},l.a.createElement(p.a,{current:j},l.a.createElement(pe,{title:"告警信息"}),l.a.createElement(pe,{title:"规则配置"}),l.a.createElement(pe,{title:"通知方式"})),l.a.createElement("div",{className:"formbox"},l.a.createElement(n.a,{activeKey:j+""},l.a.createElement(ge,{tab:"告警信息",key:"0"},l.a.createElement(F,{ref:I,setStepCur:S,formdata:m})),l.a.createElement(ge,{tab:"规则配置",key:"1"},l.a.createElement(G,{ref:x,setStepCur:S,formdata:g})),l.a.createElement(ge,{tab:"通知方式",key:"2"},l.a.createElement(ie,{ref:P,setStepCur:S,commitAll:function(){var e=I.current.getFieldsValue(),t=x.current.formDataToData(),n=P.current.getFieldsValue(),r=ue(ue({},t),n),l=JSON.stringify(r),i=ue(ue({},e),{},{id:o,content:l});Object(c.c)(c.a.saveWarningConfig,i,{loading:!0}).then((function(e){a()}))},formdata:E})))))};function ye(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(a),!0).forEach((function(t){Ee(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ye(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ee(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Oe(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Oe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var je=g.a.Option,we=(p.a.Step,f.a.Search,{pageRows:10,pageIndex:1}),Se={id:void 0,status:void 0,name:"",remark:"",content:""},Ie=["站内","站内+邮件"],xe=function(e){var t=he(Object(r.useState)({pager:{},list:[]}),2),a=t[0],n=t[1],o=a.list,u=a.pager,s=he(Object(r.useState)({}),2),p=s[0],b=s[1],y=he(Object(r.useState)(""),2),v=(y[0],y[1]),E=he(Object(r.useState)(""),2),h=E[0],O=E[1];Object(r.useEffect)((function(){j(we)}),[]);var j=function(e){var t=ve({ruleName:"",warningWay:h},e);Object(c.c)(c.a.getWarningList,t,{loading:!0}).then((function(e){n(e.data)}))},w=[{title:"告警时间",dataIndex:"alarmTime",key:"alarmTime",render:function(e){return e?i.a.utcToDev(e):"--"}},{title:"告警标题",dataIndex:"warningTitle",key:"warningTitle",ellipsis:!0},{title:"产品名称",dataIndex:"productName",key:"productName",ellipsis:!0},{title:"告警消息类型",dataIndex:"warningWay",key:"warningWay",render:function(e){return l.a.createElement("span",null,{0:"站内",1:"站内+邮件"}[e])}},{title:"告警状态",dataIndex:"state",key:"state",render:function(e){return l.a.createElement("span",null,{0:"草稿",1:"待处理",2:"已处理",3:"已发送"}[e])}},{title:"关联的告警规则",dataIndex:"ruleName",key:"ruleName",ellipsis:!0},{title:"操作",dataIndex:"id",key:"id",width:"70px",render:function(e,t){var a=t.state;return l.a.createElement("a",{onClick:function(){x(e)}},"1"==a?"处理":"查看")}}],I=function(e){j(ve(ve({},we),{},{pageIndex:e}))},x=function(e){Object(c.c)(c.a.getWarningInfo,{id:e},{loading:!0}).then((function(e){b(e.data)}))},P=function(){b({})};return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"searchrulebox"},l.a.createElement(d.a,{layout:"inline",labelCol:{span:8},wrapperCol:{span:15}},l.a.createElement(d.a.Item,{label:"告警消息类型"},l.a.createElement(g.a,{defaultValue:"",onChange:function(e){return O(e)},style:{width:150,marginRight:40}},l.a.createElement(g.a.Option,{value:""},"全部类型"),Ie.map((function(e,t){return l.a.createElement(je,{key:e,value:t},e)})))),l.a.createElement(d.a.Item,{label:"告警规则名称"},l.a.createElement(f.a.Search,{placeholder:"请输入规则名词查找",style:{width:380},enterButton:!0,allowClear:!0,maxLength:20,onSearch:function(e){v(e);var t=ve({},we);""!=e&&(t.ruleName=e),j(t)}})))),l.a.createElement(m.a,{rowKey:"id",columns:w,dataSource:o,pagination:{defaultCurrent:u.pageIndex,total:u.totalRows,onChange:I,current:u.pageIndex,showSizeChanger:!1,showQuickJumper:u.totalPages>5,hideOnSinglePage:!0}}),l.a.createElement("p",null,"注：仅限站内消息类型有“待处理”和“已处理状态”，站内消息+邮件均为“已发送”状态"),l.a.createElement(S,{warningInof:p,closeDetailMod:P,getIndexPage:I,delwithWarn:function(e){Object(c.c)(c.a.dealWithWarning,e,{loading:!0}).then((function(e){I(u.pageIndex||1),P()}))}}))},Pe=function(e){var t=he(Object(r.useState)({pager:{},list:[]}),2),a=t[0],n=t[1],o=he(Object(r.useState)([]),2),d=o[0],p=o[1],g=he(Object(r.useState)(""),2),y=g[0],v=g[1],E=he(Object(r.useState)(!1),2),h=E[0],O=E[1],j=he(Object(r.useState)(Se),2),w=j[0],S=j[1];Object(r.useEffect)((function(){I(we)}),[]);var I=function(e){Object(c.c)(c.a.getWarningConfigLi,e,{loading:!0}).then((function(e){n(e.data)}))},x=[{title:"规则名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"描述",dataIndex:"remark",key:"remark",ellipsis:!0},{title:"产品名称",dataIndex:"productName",key:"productName",ellipsis:!0},{title:"设备ID",dataIndex:"deviceIds",key:"deviceIds",ellipsis:!0},{title:"运行状态",dataIndex:"status",key:"status",width:"100px",render:function(e){return l.a.createElement("span",null,{0:"初始状态",1:"运行中",2:"已停止"}[e])}},{title:"最近编辑时间",dataIndex:"updateTime",key:"updateTime",width:"200px",render:function(e){return e?i.a.utcToDev(e):"--"}},{title:"操作",dataIndex:"id",key:"id",width:"180px",render:function(e,t){var a=t.id,n=t.name,r=t.status,i=t.remark,c=t.content;return l.a.createElement("span",null,l.a.createElement("a",{onClick:function(){k({id:a,name:n,remark:i,status:r,content:c})}},"编辑"),l.a.createElement(s.a,{type:"vertical"}),1==r&&l.a.createElement("a",{onClick:function(){p([a,n,"stop"])}},"停止")||l.a.createElement("a",{onClick:function(){C(a)}},"启动"),l.a.createElement(s.a,{type:"vertical"}),l.a.createElement("a",{onClick:function(){p([a,n,"del"])}},"删除"))}}],P=function(e){var t=ve(ve({},we),{},{pageIndex:e});""!=y&&(t.name=y),I(t)},C=function(e){Object(c.c)(c.a.startWarningConfigLi,{id:e},{loading:!0}).then((function(e){P(a.pager.pageIndex||1)}))},k=function(e){O(!0),S(e)},N=a.list,A=a.pager;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"searchrulebox"},l.a.createElement("div",{className:"comm-searchBox"},l.a.createElement(f.a.Search,{placeholder:"请输入规则名词查找",enterButton:!0,allowClear:!0,maxLength:20,onSearch:function(e){v(e);var t=ve({},we);""!=e&&(t.name=e),I(t)}})),l.a.createElement(u.a,{className:"btn",onClick:function(){k(Se)},type:"primary"},"新增")),l.a.createElement(m.a,{rowKey:"id",columns:x,dataSource:N,pagination:{defaultCurrent:A.pageIndex,total:A.totalRows,onChange:P,current:A.pageIndex,showSizeChanger:!1,showQuickJumper:A.totalPages>5,hideOnSinglePage:!0}}),l.a.createElement(b.a,{visible:d.length>0,modalOKHandle:function(){var e="del"==d[2]&&c.a.delWarningConfig||c.a.stopWarningConfig;Object(c.c)(e,{id:d[0]},{loading:!0}).then((function(e){P(a.pager.pageIndex||1),p([])}))},modalCancelHandle:function(){p([])},title:"del"==d[2]?"删除":"停止",descText:"即将".concat("del"==d[2]?"删除":"停止","告警配置"),needWarnIcon:!0,targetName:d[1]}),l.a.createElement(be,{visible:h,closeEditMod:function(){O(!1)},editData:ve({},w)}))};a("yfFx");function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ke(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ke(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Ne=n.a.TabPane;t.default=function(e){var t=Ce(Object(r.useState)({}),2),a=t[0],u=t[1],s=a.pendingCount,m=a.processedCount,d=a.sentCount,f=a.leastWaringDate;Object(r.useEffect)((function(){p()}),[p]);var p=function(){Object(c.b)(c.a.getDeviceWarningTotal,{loading:!0}).then((function(e){var t=e.data||{};u(t)}))};return l.a.createElement("section",{className:"page-devwarnlist"},l.a.createElement(o.a,{title:"设备消息"}),l.a.createElement("div",{className:"comm-shadowbox comm-countbox"},l.a.createElement("div",{className:"item"},"待处理告警",l.a.createElement("br",null),l.a.createElement("span",{className:"num"},s)),l.a.createElement("div",{className:"item"},"已处理告警",l.a.createElement("br",null),l.a.createElement("span",{className:"num"},m)),l.a.createElement("div",{className:"item"},"已发送告警",l.a.createElement("br",null),l.a.createElement("span",{className:"num"},d)),l.a.createElement("div",{className:"item"},"最近告警时间",l.a.createElement("br",null),l.a.createElement("span",{className:"num time"},f&&i.a.utcToDev(f)||"--"))),l.a.createElement("div",{className:"comm-shadowbox common-tab"},l.a.createElement(n.a,{defaultActiveKey:"1"},l.a.createElement(Ne,{tab:"消息列表",key:"1"},l.a.createElement(xe,null)),l.a.createElement(Ne,{tab:"规则列表",key:"2"},l.a.createElement(Pe,null)))))}},yfFx:function(e,t,a){}}]);