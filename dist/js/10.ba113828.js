(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"7EV8":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("2B1R"),n("07d7"),n("FZtP"),n("pDQq");var a=function(e,t,n,a,r){if(!Array.isArray(e))return 1;for(var i=e.map((function(e){return e[r]})),c=e.map((function(e){return e[t]})),o=i[0],l=[[o]],u=0,s=1;s<i.length;s++)i[s]===o?l[u].push(i[s]):(l[u+=1]=[],l[u].push(i[s]),o=i[s]);var d=[];l.forEach((function(e,t){d[t]=[],d[t]=c.splice(0,e.length)}));var f=[];d.forEach((function(e,t){var n=d[t][0],a=0;f[t]=[],f[t][a]=[],e.forEach((function(e,r){n===e?f[t][a].push(e):(a+=1,f[t][a]=[],f[t][a].push(e),n=e)}))}));var m=[];f.forEach((function(e){e.forEach((function(e){m.push(e)}))}));var p=[];m.forEach((function(e){for(var t=e.length,n=0;n<t;n++)p.push(0===n?t:0)}));var b={children:a,props:{}};return b.props.rowSpan=p[n],b}},"VS/T":function(e,t,n){},aoTg:function(e,t,n){},d0cm:function(e,t,n){},hplX:function(e,t,n){},iPVe:function(e,t,n){},qG2J:function(e,t,n){"use strict";n.r(t);n("pNMO"),n("4Brf"),n("0oug"),n("4mDm"),n("PKPk"),n("3bBZ"),n("+2oP"),n("sMBO"),n("pjDv"),n("rB9j"),n("tkto"),n("5DmW"),n("FZtP"),n("27RR"),n("mbEz");var a=n("wCAj"),r=(n("L/Qf"),n("2/Rp")),i=(n("tULf"),n("Vl3Y")),c=(n("qNb/"),n("PArb")),o=(n("1vPl"),n("5rEg")),l=(n("RKNx"),n("L41K")),u=(n("8QGh"),n("2fM7")),s=n("BkRI"),d=n.n(s),f=(n("zKZe"),n("07d7"),n("5s+n"),n("p532"),n("2B1R"),n("TeQF"),n("q1tI")),m=n.n(f),p=n("DgvE"),b=n("MeRu"),v=n("wmP4"),y=n.n(v),g=n("TL2v"),h=n("FC04"),O=(n("k3Gp"),n("kLXV")),I=(n("ma9I"),n("Nlzp")),E=n("wZVF");function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];return e.forEach((function(e){e.funcParamList&&e.funcParamList.length&&e.funcParamList.forEach((function(t){var a=JSON.parse(JSON.stringify(e));n.push(S(S({},a),t))}))})),n.forEach((function(e,n){(e.key=n,e.sendData="",e.isCheck=!1,Object.keys(t).length>0)&&JSON.parse(t.remoteProtocol.protocolJson).forEach((function(t){t.funcIdentifier===e.funcIdentifier&&(e.isCheck=!0,("properties"===e.funcType||e.identifier===t.identifier)&&(e.sendData=t.sendData))}))})),n}function x(e,t){var n=e.nextStep,a=e.productId,r=e.editData,i=void 0===r?{}:r,c=j(Object(f.useState)([]),2),o=c[0],l=c[1],u=j(Object(f.useState)(Object.keys(i).length>0?"edit":"add"),1)[0],s=Object(f.useRef)(null);Object(f.useEffect)((function(){d()}),[]);var d=function(){Object(I.c)(I.a.standardFnList,{productId:a},{loading:!0}).then((function(e){var t=e.data.standard.concat(e.data.custom);t=t.filter((function(e){return"服务"===e.funcTypeCN||"属性"===e.funcTypeCN&&"r"!==e.funcParamList[0].accessMode?e:void 0})),t="edit"===u?A(t,i):A(t),l(t)}))},p=function(){s.current.subOrder()};return Object(f.useImperativeHandle)(t,(function(){return{onFinish:p}}),[o]),m.a.createElement(E.a,{dataSource:o,ref:s,finishSub:function(e){sessionStorage.setItem("addConfigData",JSON.stringify(e)),n()},actionType:u})}var P=Object(f.forwardRef)(x),N=(n("7W5+"),n("8z0m")),D=(n("AUBz"),n("ZTPi")),L=n("7tbW"),T=n.n(L),R=(n("x0AG"),n("pDQq"),n("SYor"),n("yq1k"),n("JTJg"),n("z7Xi")),q=n("wlus"),U=n("P2RN"),M=["设备ID的长度超过限制","物理地址的长度超限制","设备ID发生重复","物理地址发生重复","设备ID不存在或未联网","物理地址不存在或未联网"];var J=function(e){var t=e.visible,n=e.errorList,r=e.onCancel,i=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId"},{title:"物理地址",dataIndex:"macAddress",key:"macAddress"},{title:"错误原因",dataIndex:"errorType",width:200,key:"errorType",render:function(e,t){var n=t.errorType;return m.a.createElement("span",null,M[n-1])}}];return m.a.createElement(O.a,{visible:t,width:600,className:"romote-modal",title:"设备导入错误日志",centered:!0,closable:!0,onOk:null,onCancel:r,destroyOnClose:!0,maskClosable:!1,footer:null},m.a.createElement("div",null,m.a.createElement(a.a,{columns:i,dataSource:n||[],pagination:{total:n.length,defaultCurrent:1,defaultPageSize:5,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",showTotal:function(e){return m.a.createElement("span",null,"共 ",m.a.createElement("a",null,e)," 条")}}})))};n("iPVe");function F(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Q(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||Q(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}u.a.Option;var W=o.a.Search,G=D.a.TabPane;function H(e,t){var n=e.productId,i=e.editData,c=e.onCancel,o=e.getRemoteConfigList,l=B(Object(f.useState)("1"),2),u=l[0],s=l[1],b=B(Object(f.useState)(!1),2),v=b[0],y=b[1],g=B(Object(f.useState)({curDeviceInfoList:[],allDeviceInfoList:[],allDeviceInfoPager:{pageIndex:1,currPageRows:10}}),2),h=g[0],O=g[1],E=B(Object(f.useState)([]),2),j=E[0],k=E[1],w=B(Object(f.useState)({rightAllList:[],rightTempList:[]}),2),S=w[0],C=w[1],A=Object(f.useRef)(null),x=B(Object(f.useState)({allList:[],successList:[],errorList:[],errorVisible:!1}),2),P=x[0],L=x[1],M=B(Object(f.useState)(""),2),K=M[0],z=M[1],Q=B(Object(f.useState)(!1),2),Z=Q[0],H=Q[1],X=h.curDeviceInfoList,Y=h.allDeviceInfoList,$=h.allDeviceInfoPager,_=S.rightAllList,ee=S.rightTempList,te=P.allList,ne=P.successList,ae=P.errorList,re=P.errorVisible,ie=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId"},{title:"物理地址",dataIndex:"macAddress",key:"macAddress"},{title:"操作",key:"action",width:50,render:function(e,t){return m.a.createElement("span",{onClick:function(){return le(t)},className:"remove-single"},"移除")}}],ce=function(){if(0===ee.length)return Object(U.a)({description:"请选择要更新的设备数据！"});var e=JSON.parse(sessionStorage.getItem("remoteConfigtaskDesc")),t=sessionStorage.getItem("addConfigData"),n=d()(ee);n.forEach((function(e){delete e.key}));var a={taskId:i.taskId||"",taskName:e.taskName||"",taskExplain:e.taskExplain||"",productId:e.productId||"",protocolJson:t,remoteProductDeviceList:n};console.log("最后提交的数据",a),Object(I.c)(I.a.saveRemoteConfig5x,a,{loading:!0}).then((function(e){Object(U.a)({description:"操作成功！",type:"success"}),c(),o()}))};Object(f.useImperativeHandle)(t,(function(){return{onFinish:ce}}),[ee]);var oe=function(e,t){var n=d()(e),a=n.findIndex((function(e){return e.deviceUniqueId===t.deviceUniqueId}));return n.splice(a,1),n},le=function(e){C(V(V({},S),{},{rightAllList:oe(_,e),rightTempList:oe(ee,e)}));var t=d()(j),n=t.findIndex((function(t){return t===e.deviceUniqueId}));t.splice(n,1),k(t)},ue={selectedRowKeys:j,onChange:function(e){console.log(e,"左侧list选中的数据"),k((function(t){var n=d()(t);return T()(n.concat(e))}))}},se=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(I.c)(I.a.getRemoteDeviceList5x,{productId:n,deviceUniqueId:t,pageIndex:e||$.pageIndex,pageRows:8},{loading:!0}).then((function(e){var t=e.data,n=t.list,a=void 0===n?[]:n,r=t.pager,i=void 0===r?{}:r,c=[].concat(F(Y),F(a));a.forEach((function(e){e.key=e.deviceUniqueId})),O({curDeviceInfoList:a,allDeviceInfoPager:i,allDeviceInfoList:c})})).finally((function(){y(!1)})),k(ee.map((function(e){return e.deviceUniqueId})))};Object(f.useEffect)((function(){if(se(),Object.keys(i).length>0){var e=i.remoteProductDevicePage.list.map((function(e){return{deviceId:e.deviceId,deviceUniqueId:e.deviceUniqueId,macAddress:e.macAddress,key:e.deviceUniqueId}}));C({rightAllList:d()(e),rightTempList:d()(e)}),k(i.remoteProductDevicePage.list.map((function(e){return e.deviceUniqueId})))}}),[]);var de=X;return m.a.createElement("div",{className:"choose-update-device"},m.a.createElement("div",{className:"device-block"},m.a.createElement("p",{className:"device-block-tip"},"选择配置更新的设备"),m.a.createElement("div",{className:"device-block-item padtop0"},m.a.createElement(D.a,{activeKey:u,defaultActiveKey:"1",onChange:function(e){console.log(e),s(e)}},m.a.createElement(G,{tab:"设备列表",key:"1"},m.a.createElement(W,{enterButton:"查 找",allowClear:!0,loading:v,onSearch:function(e){y(!0),se($.pageIndex,e)},maxLength:50,className:"search-box",placeholder:"请输入设备ID/物理地址查找"}),m.a.createElement(a.a,{columns:[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:140},{title:"物理地址",dataIndex:"macAddress",width:140,key:"macAddress"}],dataSource:de,rowSelection:ue,pagination:{total:$.totalRows,defaultCurrent:1,defaultPageSize:$.currPageRows,showQuickJumper:!1,hideOnSinglePage:!0,showSizeChanger:!1,size:"small",onChange:function(e){return se(e)},showTotal:function(e){return m.a.createElement("span",null,"共 ",m.a.createElement("a",null,e)," 条")}}})),m.a.createElement(G,{tab:"本地导入",key:"2"},Z?m.a.createElement("div",null,m.a.createElement("div",{className:"result-area"},m.a.createElement("h3",{className:"excel-style"},K||"--"),m.a.createElement("div",{style:{marginTop:14}},"共".concat(te.length,"条数据")),m.a.createElement("div",{className:"upload-data"},"成功：",ne.length,"条 / ",m.a.createElement("span",{className:"red"},"失败：",ae.length,"条，请修改完成后重上传")),ae.length>0&&m.a.createElement("div",null,m.a.createElement("a",{onClick:function(){return L(V(V({},P),{},{errorVisible:!0}))}},"错误日志"))),m.a.createElement(r.a,{type:"primary",className:"upload-btn martop22",onClick:function(){return H(!1)}},m.a.createElement(R.a,null)," 重新上传")):m.a.createElement("div",{className:"local-import"},m.a.createElement("div",{className:"file-input-wrapper"},m.a.createElement(N.a,{className:"upload-btn",beforeUpload:function(e){return console.log(e,"file"),e.size/1024<500?(Object(I.c)(I.a.importRemoteConfigExcel,{uploadExcel:e,productId:n},{needFormData:!0,loading:!0}).then((function(t){if(t.data){var n=t.data,a=[],r=[];if(n.forEach((function(e,t){var n=e.errorType,i=e.deviceUniqueId,c=e.macAddress;e.key=i,n?r.push({deviceUniqueId:i,macAddress:c,errorType:n,key:i}):a.push(V({},e))})),L(V(V({},P),{},{allList:n,successList:a,errorList:r})),a.length>0){var i=Object(p.l)([].concat(F(_),a),"deviceUniqueId");C({rightAllList:i,rightTempList:i})}z(e.name),H(!0)}})),!1):(Object(U.a)({description:"文件上传大小超过500k限制"}),!1)},fileList:[],accept:".xls,.xlsx"},m.a.createElement(r.a,{type:"primary",icon:m.a.createElement(R.a,null)},"选择本地设备数据文件")),m.a.createElement("a",{className:"get-template",onClick:function(){window.open("https://skintest.hetyj.com/b325662c4122f1b8948fe07c9d782ecb.xlsx")}},"设备数据模板")),m.a.createElement("p",{className:"local-import-tip"},"支持xls、xlsx格式，每次添加最多支持20,000个设备，总体文件大小不超过500kb")))))),m.a.createElement("div",{className:"transfer-icon",onClick:function(){var e=Y.filter((function(e){return j.includes(e.deviceUniqueId)})),t=Object(p.l)([].concat(F(_),F(e)),"deviceUniqueId");A&&(A.current.input.value=""),C({rightAllList:t,rightTempList:t})}}),m.a.createElement("div",{className:"device-block"},m.a.createElement("p",{className:"device-block-tip"},"已选中：",j.length||0,"条"),m.a.createElement("div",{className:"device-block-item"},m.a.createElement(W,{enterButton:"查 找",ref:A,allowClear:!0,onSearch:function(e){var t=F(_);if(e&&e.trim()){var n=e.trim();t=_.filter((function(e){var t=e.deviceUniqueId,a=e.macAddress;return t.indexOf(n)>-1||a.indexOf(n)>-1}))}C(V(V({},S),{},{rightTempList:t}))},maxLength:50,placeholder:"请输入设备ID/物理地址查找"}),m.a.createElement("div",{className:"remove-all"},m.a.createElement("a",{className:ee.length>0?"":"disable",onClick:function(){ee.length>0&&(C({rightAllList:[],rightTempList:[]}),k([]))}},m.a.createElement(q.a,null)," 一键移除")),m.a.createElement(a.a,{className:"config-data-table",columns:ie,dataSource:ee,pagination:!1,scroll:{y:344}}))),re&&m.a.createElement(J,{visible:re,errorList:ae,onCancel:function(){return L(V(V({},P),{},{errorVisible:!1}))}}))}var X=Object(f.forwardRef)(H);n("hplX");function Y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var _=o.a.TextArea,ee=u.a.Option,te=l.a.Step,ne=[{title:"填写任务说明"},{title:"添加配置数据"},{title:"选择配置更新的设备"}];var ae=function(e){var t=e.visible,n=e.onCancel,a=e.allProductList,c=e.editData,s=e.getRemoteConfigList,p=Object(f.useRef)(),b=Object(f.useRef)(),v=Y(i.a.useForm(),1)[0],y=Y(Object(f.useState)(0),2),g=y[0],h=y[1],I=Y(Object(f.useState)(""),2),E=I[0],j=I[1],k=function(){0===g?v.submit():1===g?p.current.onFinish():2===g&&b.current.onFinish()};return m.a.createElement(O.a,{title:"创建任务",centered:!0,destroyOnClose:!0,maskClosable:!1,visible:t,width:1100,onCancel:n,wrapClassName:"remote-config-modal",footer:[0!==g&&m.a.createElement(r.a,{key:"previous",onClick:function(){h(g-1)}},"上一步"),m.a.createElement(r.a,{type:"primary",key:"next",onClick:function(){return k()}},2===g?"提交":"下一步")]},m.a.createElement("div",{className:"remote-config"},m.a.createElement("div",{className:"step-box"},m.a.createElement(l.a,{current:g},ne.map((function(e,t){return m.a.createElement(te,{key:e.title,title:e.title})})))),0===g&&m.a.createElement(i.a,{form:v,name:"filTask",labelCol:{span:4},wrapperCol:{span:18},onFinish:function(e){console.log("Received values of form: ",e),sessionStorage.setItem("remoteConfigtaskDesc",JSON.stringify(e)),j(e.productId);var t=d()(g);h(++t)},onFinishFailed:function(e){console.log("Failed:",e)},initialValues:{productId:c.productId||"",taskName:c.taskName,taskExplain:c.taskExplain}},m.a.createElement(i.a.Item,{label:"归属产品",name:"productId",rules:[{required:!0,message:"请选择归属产品"}]},m.a.createElement(u.a,{style:{width:"100%"},placeholder:"请选择归属产品",showSearch:!0,optionFilterProp:"children"},a&&a.map((function(e){return m.a.createElement(ee,{key:e.productId,value:e.productId},e.productName)})))),m.a.createElement(i.a.Item,{label:"任务名称",name:"taskName",rules:[{required:!0,message:"请输入任务名称"},{max:20,message:"最大输入长度为20"}]},m.a.createElement(o.a,{style:{width:"100%"},placeholder:"请输入任务名称，不能超过20个字符"})),m.a.createElement(i.a.Item,{label:"任务说明",name:"taskExplain",rules:[{required:!0,message:"请输入任务说明"}]},m.a.createElement(_,{showCount:!0,maxLength:100,placeholder:"请输入任务说明",autoSize:{minRows:4}}))),1===g&&m.a.createElement(P,{ref:p,productId:E,editData:c,nextStep:function(){h(g+1)}}),2===g&&m.a.createElement(X,{ref:b,productId:E,editData:c,onCancel:n,getRemoteConfigList:s})))};n("d0cm");function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ie(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach((function(t){le(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue=function(e){var t,n=e.visible,r=e.detailData,i=e.onCancel,c=e.allProductList,o=e.actionType,l=re(Object(f.useState)([]),2),u=l[0],s=l[1],d=re(Object(f.useState)([]),2),p=d[0],b=d[1],v=function(){Object(I.c)(I.a.standardFnList,{productId:r.productId},{loading:!0}).then((function(e){var t=e.data.standard.concat(e.data.custom);t=function(e,t){var n=[];return e.forEach((function(e){e.funcParamList&&e.funcParamList.length&&e.funcParamList.forEach((function(t){var a=JSON.parse(JSON.stringify(e));n.push(oe(oe({},a),t))}))})),n.forEach((function(e,n){(e.key=n,e.sendData="",e.isCheck=!1,Object.keys(t).length>0)&&JSON.parse(t.remoteProtocol.protocolJson).forEach((function(t){t.funcIdentifier===e.funcIdentifier&&(e.isCheck=!0,("properties"===e.funcType||e.identifier===t.identifier)&&(e.sendData=t.sendData))}))})),n}(t=t.filter((function(e){return"服务"===e.funcTypeCN||"属性"===e.funcTypeCN&&"r"!==e.funcParamList[0].accessMode?e:void 0})),r),"detail"===o&&(t=t.filter((function(e){return e.isCheck}))),s(t)}))};return Object(f.useEffect)((function(){v()}),[]),Object(f.useEffect)((function(){if(Object.keys(r).length>0){var e=r.remoteProductDevicePage.list.map((function(e){return{deviceId:e.deviceId,deviceUniqueId:e.deviceUniqueId,macAddress:e.macAddress,key:e.deviceUniqueId}}));b(e)}}),[]),m.a.createElement(O.a,{title:"远程配置任务",width:1100,visible:n,onOk:i,onCancel:i,maskClosable:!1,destroyOnClose:!0,wrapClassName:"replace-module-modal"},m.a.createElement("div",{className:"remote-config-detail-modal"},m.a.createElement("div",{className:"title"},"任务说明"),m.a.createElement("div",{className:"task-desc"},m.a.createElement("div",null,m.a.createElement("span",{className:"title"},"归属产品："),(t="",c.forEach((function(e){e.productId===r.productId&&(t=e.productName)})),t)),m.a.createElement("div",null,m.a.createElement("span",{className:"title"},"任务名称："),r.taskName),m.a.createElement("div",null,m.a.createElement("span",{className:"title"},"任务说明："),r.taskExplain)),m.a.createElement("div",{className:"title marT22"},"配置数据"),m.a.createElement("div",null,m.a.createElement(E.a,{dataSource:u,actionType:"detail"})),m.a.createElement("div",{className:"title marT22"},"配置更新的设备"),m.a.createElement("div",null,m.a.createElement(a.a,{className:"config-data-table",columns:[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId"},{title:"物理地址",dataIndex:"macAddress",key:"macAddress"}],dataSource:p,pagination:!1,scroll:{y:155}}))))};n("VS/T");function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var be=u.a.Option,ve=l.a.Step,ye=o.a.Search,ge=["平台支持远程更新设备的配置数据，您可以提交远程配置任务，实时对设备的系统参数等数据进行远程更新，并且获取设备配置的更新状态；详细说明可参考文档"],he=["","待执行","","已执行"];t.default=function(){var e=Object(f.useState)([]),t=me(e,2),n=t[0],o=(t[1],Object(f.useState)(!1)),s=me(o,2),v=s[0],O=s[1],E=Object(f.useState)({}),j=me(E,2),k=j[0],w=j[1],S=Object(f.useState)({}),C=me(S,2),A=C[0],x=C[1],P=Object(f.useState)(!1),N=me(P,2),D=N[0],L=N[1],T=Object(f.useState)({pageIndex:1}),R=me(T,2),q=R[0],M=(R[1],Object(f.useState)({deletevisible:!1,deleteItem:null,deleteLoading:!1})),J=me(M,2),F=J[0],K=J[1],V=Object(f.useState)([]),z=me(V,2),B=z[0],Q=z[1],Z=Object(f.useState)(""),W=me(Z,2),G=W[0],H=W[1],X=Object(f.useState)(""),Y=me(X,2),$=Y[0],_=Y[1],ee=Object(f.useState)([]),te=me(ee,2),ne=te[0],re=te[1],ie=Object(f.useState)({pageIndex:1,totalRows:0,pageRows:6}),ce=me(ie,2),oe=ce[0],le=ce[1],se=(q.totalRows,q.pageIndex,q.pageRows,F.deletevisible),fe=F.deleteItem,pe=F.deleteLoading,Oe=[{title:"任务ID",dataIndex:"taskId",key:"taskId"},{title:"任务名称",dataIndex:"taskName",key:"taskName"},{title:"任务说明",dataIndex:"taskExplain",key:"taskExplain",width:300},{title:"归属产品名称",dataIndex:"productName",key:"productName"},{title:"更新设备数量",dataIndex:"deviceTotal",key:"deviceTotal"},{title:"任务状态",dataIndex:"status",key:"status",render:function(e,t){var n=t.status;return m.a.createElement("span",{className:"h5-statu-".concat(n+1)},he[n])}},{title:"执行时间",dataIndex:"execTime",key:"execTime",render:function(e,t){var n=t.execTime;return m.a.createElement("span",null,n?p.a.utcToDev(n):"--")}},{title:"操作",key:"action",render:function(e,t){var n=t.status;t.taskId;return m.a.createElement("span",null,""+n=="1"?m.a.createElement(m.a.Fragment,null,m.a.createElement("a",{onClick:function(){return Ie(t)}},"编辑"),m.a.createElement(c.a,{type:"vertical"}),m.a.createElement("a",{onClick:function(){return Ee(t)}},"执行"),m.a.createElement(c.a,{type:"vertical"}),m.a.createElement("a",{onClick:function(){return K({deletevisible:!0,deleteItem:t})}},"删除")):m.a.createElement("a",{onClick:function(){return je(t)}},"查看"))}}],Ie=function(e){e?Object(I.c)(I.a.getRemoteConfig5x,{taskId:e.taskId},{loading:!0}).then((function(e){w(e.data),O(!v)})):O(!v)},Ee=function(e){Object(I.c)(I.a.executeTask5x,{taskId:e.taskId},{loading:!0}).then((function(e){ke(),Object(U.a)({description:"执行成功！",type:"success"})}))},je=function(e){Object(I.c)(I.a.getRemoteConfig5x,{taskId:e.taskId},{loading:!0}).then((function(e){x(e.data),L(!0)}))},ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=de({productId:G,status:-1===$?"":$,taskName:e},oe);Object(I.c)(I.a.getRomoteConfigListByProduct5x,t,{loading:!0}).then((function(e){Q(Object(p.b)(e.data.list)),le((function(t){return Object.assign(d()(t),{totalRows:e.data.pager.totalRows})}))}))};Object(f.useEffect)((function(){ke()}),[oe.pageIndex,oe.pageRows,$,G]);var we=function(){Object(I.c)(I.a.allProductPubList,{loading:!0}).then((function(e){re(e.data)}),(function(){return re([])}))};Object(f.useEffect)((function(){we(),sessionStorage.removeItem("addConfigData"),sessionStorage.removeItem("remoteConfigtaskDesc")}),[]);var Se=function(e){ke(e)},Ce=function(e,t){le((function(n){return Object.assign(d()(n),{pageIndex:t===oe.pageRows?e:1,pageRows:t})}))},Ae=function(){var e=fe.taskId;K(de(de({},F),{},{deleteLoading:!0})),Object(I.c)(I.a.deleteRemoteConfig,{taskId:e},{loading:!0}).then((function(e){ke()})).finally((function(){K({deletevisible:!1,deleteItem:null,deleteLoading:!1})}))};return m.a.createElement("div",{id:"remote-config"},m.a.createElement(b.a,{title:"远程配置",selectOnchange:function(e){return H(e)},selectData:ne}),m.a.createElement("div",{className:"comm-shadowbox setp-tip comm-setp-ttip"},m.a.createElement("div",{className:"step-title"},m.a.createElement("img",{src:y.a,alt:""}),m.a.createElement("span",null,"远程配置步骤")),m.a.createElement(g.a,{desc:ge,style:{marginBottom:22}}),m.a.createElement(l.a,{current:-1,initial:0},m.a.createElement(ve,{title:"创建远程配置任务",description:"创建远程配置任务，填写任务的目的或备注信息。"}),m.a.createElement(ve,{title:"添加配置数据",description:"添加要更新的产品配置数据字段和更新的数值。"}),m.a.createElement(ve,{title:"选择设备",description:"可通过设备ID/物理地址，设备标签，本地导入确定要配置的设备。"}),m.a.createElement(ve,{title:"执行任务",description:"提交执行远程配置任务，设备更新结果实时可见。"}))),m.a.createElement("div",{className:"comm-shadowbox device-content"},m.a.createElement("div",{className:"content-top"},m.a.createElement("div",{className:"content-top-left"},m.a.createElement(i.a,{layout:"inline",labelCol:{span:7},wrapperCol:{span:17}},m.a.createElement(i.a.Item,{label:"任务状态"},m.a.createElement(u.a,{onChange:function(e){return _(e)},style:{width:150,marginRight:40},defaultValue:-1},m.a.createElement(u.a.Option,{value:-1},"全部状态"),he.filter((function(e){return e})).map((function(e,t){return m.a.createElement(be,{key:e,value:t+1},e)})))),m.a.createElement(i.a.Item,{label:"任务名称"},m.a.createElement(ye,{placeholder:"请输入任务名称",allowClear:!0,onSearch:Se,style:{width:465}})))),m.a.createElement(r.a,{type:"primary",onClick:function(){return Ie()}},"创建任务")),m.a.createElement(a.a,{columns:Oe,className:"ant-table-fixed",rowKey:"taskId",dataSource:B,pagination:{defaultCurrent:1,current:oe.pageIndex,pageSize:oe.pageRows,total:oe.totalRows,showSizeChanger:!1,showQuickJumper:oe.totalPages>5,onChange:Ce,showTotal:function(e){return m.a.createElement("span",null,"共 ",m.a.createElement("a",null,e)," 条")}}})),v&&m.a.createElement(ae,{visible:v,allProductList:ne,onCancel:function(){O(!1),w({})},editData:k,configProtoclList:n,getRemoteConfigList:ke}),se&&m.a.createElement(h.a,{visible:se,modalOKHandle:Ae,modalCancelHandle:function(){return K({deletevisible:!1,deleteItem:null,deleteLoading:!1})},targetName:fe.taskId,confirmLoading:pe,title:"删除任务",needWarnIcon:!0,descText:"即将删除的任务",tipText:"任务的所有信息将完全被删除，无法找回，请谨慎操作"}),D&&m.a.createElement(ue,{visible:D,detailData:A,allProductList:ne,onCancel:function(){return L(!1)}}))}},wZVF:function(e,t,n){"use strict";n("pNMO"),n("4Brf"),n("0oug"),n("4mDm"),n("PKPk"),n("3bBZ"),n("+2oP"),n("sMBO"),n("pjDv"),n("rB9j"),n("mbEz");var a=n("wCAj"),r=(n("1vPl"),n("5rEg")),i=(n("QCje"),n("fyUT")),c=(n("MKzF"),n("kaz8")),o=(n("8QGh"),n("2fM7")),l=n("BkRI"),u=n.n(l),s=(n("ma9I"),n("07d7"),n("FZtP"),n("TeQF"),n("tkto"),n("2B1R"),n("qePV"),n("q1tI")),d=n.n(s),f=n("7EV8"),m=n("P2RN");n("aoTg");function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,i=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var v=o.a.Option;function y(e,t){var n=e.dataSource,l=e.finishSub,b=e.actionType,y=p(Object(s.useState)([]),2),g=y[0],h=y[1],O=p(Object(s.useState)([]),2),I=O[0],E=O[1];Object(s.useEffect)((function(){E(u()(n));var e=[];n.forEach((function(t){if(t.isCheck)return-1===e.indexOf(t.funcIdentifier)&&e.push(t.funcIdentifier),t})),h(e)}),[n.length]);var j=function(e,t){var n=u()(I);n[t].sendData=e,E(n)},k=[{title:"勾选",width:"50px",dataIndex:"isCheck",fixed:"left",render:function(e,t,a){var r=Object(f.a)(n,"funcIdentifier",a,t.funcIdentifier,"funcIdentifier");return r.children=d.a.createElement(c.a,{checked:e,onChange:function(e){!function(e,t,n){var a=e.target.checked,r=u()(I);r[n].isCheck=a,E(r),h((function(e){var n=u()(e);return a?n.push(t.funcIdentifier):n=n.filter((function(e){if(e!==t.funcIdentifier)return e})),console.log(n,"勾选"),n}))}(e,t,a)},disabled:"detail"===b}),r}},{title:"功能类型",dataIndex:"funcTypeCN",width:"4%",render:function(e,t,a){return Object(f.a)(n,"funcIdentifier",a,e,"funcTypeCN")}},{title:"功能点名称",dataIndex:"funcName",width:"10%",render:function(e,t,a){return Object(f.a)(n,"funcIdentifier",a,e,"funcName")}},{title:"标识符",dataIndex:"funcIdentifier",width:"10%",render:function(e,t,a){return Object(f.a)(n,"funcIdentifier",a,e,"funcIdentifier")}},{title:"参数名称",dataIndex:"name",width:"12%"},{title:"参数标识",dataIndex:"identifier",width:"10%"},{title:"数据类型",width:"8%",dataIndex:"dataType",render:function(e,t){return d.a.createElement("span",null,t.dataTypCN)}},{title:"数据属性",dataIndex:"propertyMap",render:function(e,t){return d.a.createElement("span",null,function(e){var t=null;switch(e.dataTypeEN){case"float":case"int":t="数值范围：".concat(e.propertyMap.min,"-").concat(e.propertyMap.max,",间距：").concat(e.propertyMap.interval,",倍数：").concat(e.propertyMap.multiple,",单位：").concat(e.propertyMap.unit);break;case"bool":t="0：".concat(e.propertyMap[0],",1：").concat(e.propertyMap[1]);break;case"enum":var n="";for(var a in e.propertyMap)n+=a+"："+e.propertyMap[a]+", ";t="枚举值：".concat(n);break;default:return""}return t}(t))}},{title:"下发数据",dataIndex:"sendData",key:"sendData",fixed:"right",render:function(e,t,n){var a=t.dataTypeEN,c=t.propertyMap,l=null;if("detail"===b)return"bool"===a||"enum"===a?c[e]:e;switch(a){case"int":case"double":case"float":l=d.a.createElement(i.a,{value:t.sendData,min:c.min,max:c.max,onChange:function(e){return j(e,n)},placeholder:"请输入参数"});break;case"text":l=d.a.createElement(r.a,{value:t.sendData,allowClear:!0,maxLength:30,onChange:function(e){return j(e,n)},placeholder:"请输入参数"});break;case"enum":case"bool":l=d.a.createElement(o.a,{onChange:function(e){return j(e,n)},allowClear:!0,value:t.sendData},Object.keys(c)&&Object.keys(c).map((function(e,t){return d.a.createElement(v,{key:t+e,value:Number(e)},c[e])})))}return d.a.createElement("span",null,l)}}];return Object(s.useImperativeHandle)(t,(function(){return{subOrder:function(){var e,t;e=[],t=I.filter((function(t){var n=!0;if(t.sendData||0===t.sendData||(n=!1),0!==t&&g.indexOf(t.funcIdentifier)>-1&&n)return-1===e.indexOf(t.funcIdentifier)&&e.push(t.funcIdentifier),t})),e.length?e.length===g.length?(t=t.map((function(e){return{identifier:"properties"===e.funcType?e.funcIdentifier:e.identifier,sendData:e.sendData,funcIdentifier:e.funcIdentifier}})),l(t)):Object(m.a)({description:"部分勾选数据未配置"}):Object(m.a)({description:"请为配置协议添加参数"})}}}),[g,I]),d.a.createElement("div",null,d.a.createElement(a.a,{rowKey:"key",columns:k,className:"config-data-table",dataSource:I,locale:{emptyText:"暂无协议，请先去配置"},pagination:!1,scroll:{y:440,x:1e3}}))}t.a=Object(s.forwardRef)(y)},wmP4:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABsklEQVQokWWRvW4TQRSFv5nMLE4U8IJEEaFFUUJhCQpA4idNKFJQUiU0eYM8QOqUCCSQeAXShJISCQch4QYqQEHhV3LjmCoKyEnsvZdixrtr+xazO3N3vnPuWfP2c2dPoYEqqqBhQeMehucCwz78vH97fhHAqdIoLkHlcgRU9qGtqOoCsVzRjAAVjapaKI4ARIlSJaC0L1WVEUjhhGKMccCk7XJ+ZTKbIUCqI4zaRpVTgVY3Ze9wlt7AceFMn8a5I1Z3dPrlmumZ1x/bClrOVgH0BbZ/zNE5rpFY8AZ8fCZTtPoJK05VylmJTiS8v++mHBzXSAxs3IEshSe7YBS8YWkmZ9OGVKKqKCLKEPr18CzewMZd+NKBm5fg+lzpwhvWgwMpE64G1csd3sLlFB5cDaFldfh2ECCJJXMKzxQWwGCQmHr4eNbJ8kCm0se7QTmrw8MbkOfw4Td4S9swVs3mr9o/398W1bz15+Kt73/Pz1fDu7cIy1fg+Rtwlq0JwKt3+59U5JqiDMTQ7GYcDWZG/4AFZ2md5KxMAMZrdUen6zmb3rCeWDJvaTvDi5OcR0/XTO8/FFxXqP9J8G8AAAAASUVORK5CYII="}}]);