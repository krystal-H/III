(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"0eIn":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAACB0lEQVQ4T32ST2sTQRjGn9nZTTEKBeOtbv1T7zUHi8vmZMCw/QCBYsGT+DH88wEUeoseVTx4USyJFWpVYldaEJQEFROxCVqbi1Q0oWZnXpmZ3XRz0IXd2d2Z9/c+7/s+7HmzFzBChUi4RACZBwgYX6X6p/bQJViXS2fcmjrCXjS+d6QkdywoDdBAA44BitwtzZ2Y1oC1d9uUZDVJyagAYDGrcC4/9Up/AHi6ueVLIepqNzh7kmnAs7ffVISWTFI/RxDObb+Yn1pPA4QCEGHem0kAXzskyTWZk7pjFUlP0srUIYbuvHfKlLD6ZjsgiAqRdEe1GpIGDiWwvjOJ97uHMIhsHJ6IkJsYLu9QtvygzAZaxr8u7wYdsA5i1bbgZSzAYYATrxmOcJhB8b+Awm26agNXksCFWeBRA9Awc19jK5tfAoBVSKoS4mbGXrj1aRq/hw4cbrI/vAhcuLuvwrHQZisbWx1Vf9pAyfvSxxlwMCzmgYXT+4U+bgC1plbyhz15/Vm3jBMvnPeOjWZeDVv+nZZb74uMzq5k31sELt03CjKqHxxtVg3b2jWcc780d3w08+rLD/7Gj1y9uXtk1LzyLLDcMOUooK16UAvb2srGpuPzjyTDWu8ofkbZ8QmY4HBPoMiqYSsgQRWpfBAbJu0HQQytXzn09iYhyEaWiz5jfKkfWddvltngL3uXRG6qfr/OAAAAAElFTkSuQmCC"},"4ZAH":function(e,t,a){},RGxR:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return ie}));a("ef1R"),a("Ra8s"),a("sfoS"),a("HsXu"),a("bs69"),a("Lm8M"),a("ryEf"),a("qgAm"),a("9b3Y"),a("Ck9u"),a("QcZr");var n=a("b+L2"),r=(a("MNU5"),a("YeX6")),l=(a("SiC7"),a("AePH")),c=(a("6IzV"),a("QFmM")),i=(a("UdMA"),a("ViyK")),u=(a("2ek4"),a("oWtQ")),o=(a("xzjF"),a("PeP6")),s=(a("hEGT"),a("62KB"),a("T9Mk")),m=a.n(s),d=a("MeRu"),f=a("0eIn"),p=a.n(f),b=(a("IHDg"),a("P37N"),a("vV4J"),a("RfWx"),a("kkSL"),a("bREd")),v=(a("DBxd"),a("sQtw")),E=(a("oENA"),a("uTCA")),y=(a("UTJx"),a("dVdO")),h=(a("59iL"),a("f6Fh")),g=a("CvKH"),O=a.n(g),I=(a("xc6N"),a("av3G"),a("/Crn"),a("J2lP"),a("hjnz"),a("4dS9"),a("JiFE"),a("4ZAH"),a("rwTb")),j=a("Nlzp"),S=a("P2RN"),w=a("yq+b"),A=a.n(w);function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(Object(a),!0).forEach((function(t){k(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function k(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return V(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return V(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var F=u.a.Step,x=h.a.TabPane,L=i.a.TextArea;function R(e){var t=e.isModalVisible,a=e.colseMoadl,n=e.cancelModel,l=e.editData,c=e.actionType,i=P(Object(s.useState)("0"),2),o=i[0],d=i[1],f=P(Object(s.useState)({one:{},two:{},three:{}}),2),p=f[0],b=f[1],v=Object(s.useRef)(null),E=Object(s.useRef)(null),g=Object(s.useRef)(null),I=[m.a.createElement("div",{key:"a"},o-0>0&&m.a.createElement(r.a,{style:{margin:"0 8px"},onClick:function(){d((o-0-1).toString())}},"上一步"),o-0<2&&m.a.createElement(r.a,{type:"primary",onClick:function(){"0"===o?v.current.onFinish():"1"===o&&E.current.onFinish()}},"下一步"),o-0==2&&m.a.createElement(r.a,{type:"primary",onClick:function(){g.current.onFinish()}},"完成"))],S=function(e,t){"0"===o?b((function(e){var a=O()(e);return a.one=O()(t),a})):"1"===o&&b((function(e){var a=O()(e);return a.two=O()(t),a})),d(e)};return m.a.createElement(y.a,{title:"edit"===c?"编辑订阅":"新增订阅",visible:t,onCancel:n,width:"900px",wrapClassName:"add-subscribe-modal",footer:I,maskClosable:!1},m.a.createElement("div",{className:"add-subscribe"},m.a.createElement("div",{className:"add-subscribe-main"},m.a.createElement("div",{className:"edit-left-protocol-wrap"}," ",m.a.createElement(h.a,{activeKey:o,renderTabBar:function(e,t){return m.a.createElement(u.a,{current:o-0},m.a.createElement(F,{title:"选择订阅对象"}),m.a.createElement(F,{title:"配置订阅内容"}),m.a.createElement(F,{title:"确定订阅方式"}))}},m.a.createElement(x,{tab:"Tab 1",key:"0"},m.a.createElement(D,{ref:v,continueStep:S,editData:l,actionType:c})),m.a.createElement(x,{tab:"Tab 2",key:"1"},m.a.createElement(H,{ref:E,continueStep:S,editData:l,actionType:c})),m.a.createElement(x,{tab:"Tab 3",key:"2"},m.a.createElement(U,{ref:g,finishSub:function(e){var t=T(T(T({},p.one),p.two),e);console.log("====55======",t),"edit"===c&&(t.urlConfId=l.urlConfId),Object(j.c)(j.a.addsubscribe,t,{loading:!0}).then((function(e){a()}))},editData:l,actionType:c})))))))}function D(e,t){var a=e.continueStep,n=e.actionType,r=e.editData,l=P(c.a.useForm(),1)[0],u=P(Object(s.useState)([]),2),d=u[0],f=u[1],p=P(Object(s.useState)([]),2),b=p[0],y=p[1],h=P(Object(s.useState)(1),2),g=h[0],I=h[1],S=P(Object(s.useState)([]),2),w=S[0],A=S[1],N=P(Object(s.useState)([]),2),C=N[0],k=N[1];Object(s.useEffect)((function(){if(F(),"edit"===n)if(I(r.subscriptType),1===r.subscriptType){var e={subscriptName:r.subscriptName,productId:r.productId,isAllDevice:r.isAllDevice,projectId:r.projectId,subscriptType:r.subscriptType};D(r.projectId),l.setFieldsValue(e)}else{var t=[];r.labelVoList&&r.labelVoList.forEach((function(e){t.push(e.labelId)})),l.setFieldsValue({subscriptName:r.subscriptName,subscriptType:r.subscriptType,productId:r.productId,isAllLabel:r.isAllLabel,labelVoList:t})}}),[]);var V,F=function(){Object(j.c)(j.a.allProductPubList).then((function(e){k(e.data)})),Object(j.c)(j.a.projectList,{pageIndex:1,pageRows:100}).then((function(e){y(e.data.list)}))},x=function(){l.validateFields().then((function(e){var t=O()(e),n=(1===e.subscriptType?w:C).find((function(e){return e.productId===t.productId}));console.log(n);var r=n.productName;if(2===t.subscriptType){var l=[];d.forEach((function(e){(t.isAllLabel||t.labelVoList&&t.labelVoList.indexOf(e.value)>-1)&&l.push(e)})),t.labelVoList=l}t.productName=r,a("1",t)}))},R=function(e){l.setFieldsValue({labelVoList:[]}),Object(j.c)(j.a.getLabelByAddress,{productId:e}).then((function(e){var t=[];e.data.forEach((function(e){t.push(T(T({},e),{},{label:e.labelValue,value:e.labelId,id:e.labelId}))})),f(t)}))},D=function(e){var t={clientId:"open",projectId:e};Object(j.c)(j.a.getProductByProject,t).then((function(e){A(e.data)}))};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:x}}),[d,b,C,w]),m.a.createElement("div",{className:"step-one"},m.a.createElement(c.a,{form:l,labelAlign:"right",initialValues:{subscriptType:1}},m.a.createElement(c.a.Item,{name:"subscriptName",label:"订阅名称",rules:[{required:!0,whitespace:!0}]},m.a.createElement(i.a,null)),m.a.createElement(c.a.Item,{name:"subscriptType",label:"分类",rules:[{required:!0}]},m.a.createElement(E.a.Group,{onChange:function(e){return t=e.target.value,I(t),void l.setFieldsValue({productId:""});var t}},m.a.createElement(E.a,{value:1},"项目"),m.a.createElement(E.a,{value:2},"产品"))),1===g?m.a.createElement(c.a.Item,{name:"projectId",label:"选择项目",rules:[{required:!0,message:"请选择项目"}]},m.a.createElement(o.a,{onChange:function(e){var t={clientId:"open",projectId:e};A([]),l.setFieldsValue({productId:""}),Object(j.c)(j.a.getProductByProject,t).then((function(e){A(e.data)}))},showSearch:!0,optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},b.map((function(e){return m.a.createElement(o.a.Option,{value:e.projectId,key:e.projectId},e.projectName)})))):null,m.a.createElement(c.a.Item,{name:"productId",label:"选择产品",rules:[{required:!0,message:"请选择产品"}]},(V=1===l.getFieldValue("subscriptType")?w:C,m.a.createElement(o.a,{onChange:R,showSearch:!0,optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},V.map((function(e){return m.a.createElement(o.a.Option,{value:e.productId,key:e.productId},e.productName)}))))),1===g?m.a.createElement(m.a.Fragment,null,m.a.createElement(c.a.Item,{name:"isAllDevice",label:"选择设备",initialValue:1,rules:[{required:!0}]},m.a.createElement(E.a.Group,null,m.a.createElement(E.a,{value:1},"全部设备"),m.a.createElement(E.a,{value:2},"指定设备"))),m.a.createElement(c.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.isAllDevice!==t.isAllDevice}},(function(e){return 2===(0,e.getFieldValue)("isAllDevice")?m.a.createElement(c.a.Item,{name:"deviceIds",label:" ",colon:!1},m.a.createElement(L,{placeholder:"请输入此项目下产品的设备mac/imei/SN号或者设备ID"})):null}))):m.a.createElement(m.a.Fragment,null,m.a.createElement(c.a.Item,{name:"isAllLabel",label:"选择设备",initialValue:1,rules:[{required:!0}]},m.a.createElement(E.a.Group,null,m.a.createElement(E.a,{value:1},"全部设备"),m.a.createElement(E.a,{value:0},"根据标签筛选设备"))),m.a.createElement(c.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.isAllLabel!==t.isAllLabel}},(function(e){return 0===(0,e.getFieldValue)("isAllLabel")?m.a.createElement(c.a.Item,{name:"labelVoList",label:"选择标签"},m.a.createElement(v.a.Group,{options:d})):null})))))}function H(e,t){var a=e.continueStep,n=e.actionType,r=e.editData,l=P(c.a.useForm(),1)[0],i=P(Object(s.useState)([]),2),u=i[0],o=i[1];Object(s.useEffect)((function(){if(Object(j.c)(j.a.getDeviceEvent).then((function(e){var t=(e.data||[]).map((function(e){return{label:e.deviceEventName,value:e.deviceEventId}}));o(t),o(t)})),"edit"===n){var e=r.eventIds.split(",").map((function(e){return Number(e)})),t={timeRange:r.businessTime.split("-").map((function(e){return A()(e,"HH:mm")})),eventIds:e};l.setFieldsValue(t)}}),[]);var d=function(){l.validateFields().then((function(e){var t={businessTime:e.timeRange[0].format("HH:mm")+"-"+e.timeRange[1].format("HH:mm"),eventIds:e.eventIds.join(",")};a("2",t)}))};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:d}}),[]),m.a.createElement("div",{className:"step-two"},m.a.createElement(c.a,N({form:l,labelAlign:"right"},{labelCol:{span:6},wrapperCol:{span:18}}),m.a.createElement(c.a.Item,{name:"eventIds",label:"选择设备事件",rules:[{required:!0,message:"请选择设备事件"}]},m.a.createElement(v.a.Group,{options:u})),m.a.createElement(c.a.Item,{name:"timeRange",label:"选择业务发生时间",rules:[{required:!0,message:"请选择业务发生时间"}]},m.a.createElement(b.a.RangePicker,{format:"HH:mm"}))))}function U(e,t){var a=e.finishSub,n=e.actionType,r=e.editData,l=P(c.a.useForm(),1)[0],u=function(){l.validateFields().then((function(e){a(e)}))};Object(s.useImperativeHandle)(t,(function(){return{onFinish:u}}));var o=P(Object(s.useState)(1),2),d=o[0],f=o[1],p=function(){Object(S.a)({type:"info",description:"敬请期待"})};return Object(s.useEffect)((function(){if("edit"===n){f(r.pushWay);var e={pushWay:r.pushWay,pushFrequency:r.pushFrequency};1===r.pushWay&&(e.pushUrl=r.pushUrl,e.sign=r.sign),l.setFieldsValue(e)}}),[]),m.a.createElement("div",{className:"step-one"},m.a.createElement(c.a,{form:l,labelAlign:"right",initialValues:{pushWay:1}},m.a.createElement(c.a.Item,{name:"pushWay",label:"订阅方式",rules:[{required:!0,message:"请选择订阅方式"}]},m.a.createElement(E.a.Group,{onChange:function(e){f(e.target.value)}},m.a.createElement(E.a,{value:2},"MQTT主题订阅（推荐）"),m.a.createElement(E.a,{value:1},"API数据PUSH形式"))),1===d?m.a.createElement(m.a.Fragment,null,m.a.createElement(c.a.Item,{name:"isEncrypt",label:"是否加密",rules:[{required:!0,message:"请选择是否加密"}],initialValue:1},m.a.createElement(E.a.Group,{onChange:function(e){}},m.a.createElement(E.a,{value:1},"是"),m.a.createElement(E.a,{value:0},"否"))),m.a.createElement(c.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.isEncrypt!==t.isEncrypt}},(function(e){return 0===(0,e.getFieldValue)("isEncrypt")?m.a.createElement(c.a.Item,{label:" ",colon:!1,className:"sub-text-link"},m.a.createElement("a",{onClick:p},"下载帮助文档")):m.a.createElement(c.a.Item,{label:" ",colon:!1,className:"sub-text-link"},m.a.createElement("a",{onClick:p},"下载SDK&帮助文档"))})),m.a.createElement(c.a.Item,{name:"pushUrl",label:m.a.createElement(I.a,{label:"数据订阅URL",tip:"第三方云服务接口的唯一标识，供C-life云推送服务给第三方云推送数据使用，现仅支持http方式"}),rules:[{required:!0,whitespace:!0,message:"请输入数据订阅URL"}]},m.a.createElement(i.a,null)),m.a.createElement(c.a.Item,{name:"sign",label:m.a.createElement(I.a,{label:"Token",tip:"第三方云服务接口对接C-life云推送服务的凭证，用来验证厂商服务接口的合法性"}),rules:[{required:!0,whitespace:!0,message:"请输入Token"}]},m.a.createElement(i.a,null))):m.a.createElement(c.a.Item,{label:" ",colon:!1,className:"sub-text-link"},m.a.createElement("a",{onClick:p},"下载SDK&帮助文档")),m.a.createElement(c.a.Item,{label:"故障推送频率",name:"pushFrequency",rules:[{required:!0,message:"请选择故障推送频率"}]},m.a.createElement(E.a.Group,null,m.a.createElement(E.a,{value:1},"每次触发推送"),m.a.createElement(E.a,{value:2},"相同故障每小时推送1次")))))}D=Object(s.forwardRef)(D),H=Object(s.forwardRef)(H),U=Object(s.forwardRef)(U);a("W0kV");var q=a("caRq");a("pckg");function W(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?W(Object(a),!0).forEach((function(t){G(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function G(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return J(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return J(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}u.a.Step;var Y=h.a.TabPane,K=q.a.RangePicker;i.a.TextArea;function z(e,t){var a=e.continueStep,n=e.editData,r=Q(c.a.useForm(),1)[0],l=Q(Object(s.useState)([]),2),u=l[0],d=l[1],f=Q(Object(s.useState)([]),2),p=f[0],b=f[1];Object(s.useEffect)((function(){y();var e=[];n.labelVoList&&n.labelVoList.forEach((function(t){e.push(t.labelId)})),r.setFieldsValue({subscription:n.subscription,productId:n.productId,isAll:n.isAll,labelVoList:e}),h(n.productId)}),[]);var y=function(){Object(j.c)(j.a.allProductPubList).then((function(e){b(e.data)}))},h=function(e){r.setFieldsValue({labelVoList:[]}),Object(j.c)(j.a.getLabelByAddress,{productId:e}).then((function(e){var t=[];e.data.forEach((function(e){t.push(M(M({},e),{},{label:e.labelValue,value:e.labelId,id:e.labelId}))})),d(t)}))},g=function(){r.validateFields().then((function(e){var t=O()(e),n="";if(p.forEach((function(e){e.productId==t.productId&&(n=e.productName)})),t.productName=n,"number"==typeof t.isAll){var r=[];u.forEach((function(e){(t.isAll||t.labelVoList&&t.labelVoList.indexOf(e.value)>-1)&&r.push(e)})),t.labelVoList=r}a("1",t)}))};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:g}}),[p,u]),m.a.createElement("div",{className:"step-one"},m.a.createElement(c.a,{form:r,labelAlign:"right"},m.a.createElement(c.a.Item,{name:"subscription",label:"订阅名称",rules:[{required:!0}]},m.a.createElement(i.a,null)),m.a.createElement(c.a.Item,{name:"productId",label:"归属产品",rules:[{required:!0}]},m.a.createElement(o.a,{onChange:function(e){h(e)},showSearch:!0,optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},p.map((function(e){return m.a.createElement(o.a.Option,{value:e.productId,key:e.productId},e.productName)})))),m.a.createElement(c.a.Item,{name:"isAll",label:"选择设备"},m.a.createElement(E.a.Group,null,m.a.createElement(E.a,{value:1},"全部设备"),m.a.createElement(E.a,{value:0},"根据标签筛选设备"))),m.a.createElement(c.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.isAll!==t.isAll}},(function(e){return 0==(0,e.getFieldValue)("isAll")?m.a.createElement(c.a.Item,{name:"labelVoList",label:"选择标签"},m.a.createElement(v.a.Group,{options:u})):null}))))}function B(e,t){e.continueStep;var a=e.oneData,r=e.editData,l=Q(Object(s.useState)([]),2),i=l[0],u=l[1],o=Q(Object(s.useState)([]),2),d=o[0],f=o[1],p=Q(Object(s.useState)([]),2),b=p[0],E=p[1],y=Q(c.a.useForm(),1)[0],g=Q(Object(s.useState)([]),2),O=g[0],I=g[1],S=[{title:"数据名称",dataIndex:"funcName",key:"funcName"},{title:"数据标识",dataIndex:"funcIdentifier",key:"funcIdentifier"}],w=Q(Object(s.useState)({one:[],two:[],three:[]}),2),A=w[0],N=w[1],C=Q(Object(s.useState)("a"),2),T=C[0],k=C[1];Object(s.useEffect)((function(){V(),P(),Object(j.c)(j.a.getDeviceEvent).then((function(e){var t=e.data.data,a=Object.keys(t).map((function(e){return{label:t[e],value:e}}));I(a)}))}),[]);var P=function(){var e=[],t=[],a=[];r.devicePushDataConfList.forEach((function(n){n.funcIdentifier=n.protocolProperty,5===n.dataType&&e.push(n.protocolProperty),6===n.dataType&&t.push(n.protocolProperty),7===n.dataType&&a.push(n.protocolProperty)})),u(e),f(t),E(a)},V=function(){Object(j.c)(j.a.standardFnList,{productId:a.productId}).then((function(e){var t=e.data.standard.concat(e.data.custom),a={};a.one=t.filter((function(e){if("properties"===e.funcType)return e})),a.two=t.filter((function(e){if("events"===e.funcType)return e})),a.three=t.filter((function(e){if("services"===e.funcType)return e})),N(a)}))},F={onChange:function(e,t){u(e)},selectedRowKeys:i},x={onChange:function(e,t){f(e)},selectedRowKeys:d},L={onChange:function(e,t){E(e)},selectedRowKeys:b},R=function(){function e(e,t,a){var n=[];return e.forEach((function(r){if(t.indexOf(r.funcIdentifier)>-1){var l={dataType:a,dataTypeScope:e.length===t.length?2:1,protocolProperty:r.funcIdentifier};n.push(l)}})),n}var t=e(A.one,i,5),a=e(A.two,d,6),n=e(A.three,b,7);t.concat(a,n)};return Object(s.useImperativeHandle)(t,(function(){return{onFinish:R}}),[i,d,b]),m.a.createElement("div",{className:"step-two"},m.a.createElement(c.a,{form:y,labelAlign:"right"},m.a.createElement(c.a.Item,{name:"eventId",label:"选择设备事件",rules:[{required:!0,message:"请选择设备事件"}]},m.a.createElement(v.a.Group,{options:O})),m.a.createElement(h.a,{defaultActiveKey:"a",activeKey:T,onChange:function(e){k(e)}},m.a.createElement(Y,{tab:"属性",key:"a"},m.a.createElement(n.a,{rowSelection:M({},F),dataSource:A.one,columns:S,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}})),m.a.createElement(Y,{tab:"事件",key:"b"},m.a.createElement(n.a,{dataSource:A.two,rowSelection:M({},x),columns:S,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}})),m.a.createElement(Y,{tab:"服务",key:"c"},m.a.createElement(n.a,{dataSource:A.three,rowSelection:M({},L),columns:S,rowKey:"funcIdentifier",pagination:!1,scroll:{y:300}}))),m.a.createElement(c.a.Item,{name:"timeRange",label:"选择业务发生时间",rules:[{required:!0,message:"请选择业务发生时间"}]},m.a.createElement(K,{format:"YYYY-MM-DD"}))))}function Z(e,t){var a=e.finishSub,n=e.editData;console.log(n,"liek");var r=Q(Object(s.useState)("0"),2),l=r[0],u=r[1],o=Q(c.a.useForm(),1)[0],d=function(){o.validateFields().then((function(e){a(e)}))};Object(s.useEffect)((function(){u(n.pushWay.toString()),0==n.pushWay?o.setFieldsValue({pushWay:n.pushWay.toString(),url:n.url,pushToken:n.pushToken}):o.setFieldsValue({pushWay:n.pushWay.toString()})}),[]),Object(s.useImperativeHandle)(t,(function(){return{onFinish:d}}));return m.a.createElement("div",{className:"step-one"},m.a.createElement(c.a,{form:o,labelAlign:"right"},m.a.createElement(c.a.Item,{name:"pushWay",label:"订阅方式",rules:[{required:!0}]},m.a.createElement(E.a.Group,{onChange:function(e){u(e.target.value)}},m.a.createElement(E.a,{value:"0"},"API数据PUSH形式"),m.a.createElement(E.a,{value:"1"},"MQTT主题订阅"))),"0"===l&&m.a.createElement(c.a.Item,{name:"url",label:m.a.createElement(I.a,{label:"数据订阅URL",tip:"第三方云服务接口的唯一标识，供C-life云推送服务给第三方云推送数据使用，现仅支持http方式"}),rules:[{required:!0,message:"请输入"}]},m.a.createElement(i.a,null)),"0"===l&&m.a.createElement(c.a.Item,{name:"pushToken",label:m.a.createElement(I.a,{label:"Token",tip:"第三方云服务接口对接C-life云推送服务的凭证，用来验证厂商服务接口的合法性"}),rules:[{required:!0,message:"请输入"}]},m.a.createElement(i.a,null)),m.a.createElement(c.a.Item,{label:" ",colon:!1},m.a.createElement("a",{onClick:function(){window.open("http://skintest.hetyj.com/10086/a9b97e2ef3c7465bb79b63374cbd4dd8.docx")}},"订阅帮助文档"))))}z=Object(s.forwardRef)(z),B=Object(s.forwardRef)(B),Z=Object(s.forwardRef)(Z);var X=a("FC04");function _(e){var t=e.operate,a=e.visible,n=e.updateOkHandle,r=e.updateCancelHandle,l=e.actionObj,c=null;switch(t){case 1:c={title:"启动数据订阅",desc:"启动",needWarnIcon:!1};break;case 2:c={title:"停用数据订阅",desc:"停用",needWarnIcon:!0}}return m.a.createElement(X.a,{visible:a,modalOKHandle:function(){return n(t)},modalCancelHandle:r,targetName:l.subscription,title:c.title,descGray:!0,needWarnIcon:c.needWarnIcon,descText:c.desc,tipText:c.tip})}a("qSPm");function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ee(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ee(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function te(e){var t=e.rightVisible,a=e.onCloseRight,n=e.id,r=$(Object(s.useState)({devicePushDataConfList:[]}),2),l=r[0],c=r[1];Object(s.useEffect)((function(){i()}),[]);var i=function(){var e=j.a.subscribeDetail+"?urlConfId="+n;Object(j.c)(e).then((function(e){c(e.data)}))};return m.a.createElement(y.a,{maskClosable:!1,title:"订阅详情",footer:!1,visible:t,onOk:a,onCancel:a,width:"900px"},m.a.createElement("div",{className:"subscrbe-info"},m.a.createElement("div",{className:"subscrbe-c"},m.a.createElement("div",{className:"subscrbe-t"},"订阅对象"),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"订阅名称："),m.a.createElement("div",{className:"item-value"},l.subscriptName)),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"类型："),m.a.createElement("div",{className:"item-value"},1===l.subscriptType?"项目":"产品")),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"归属产品："),m.a.createElement("div",{className:"item-value"},l.productName)),m.a.createElement("div",{className:"subscrbe-t"},"配置数据"),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"设备事件："),m.a.createElement("div",{className:"item-value"},l.eventList&&l.eventList.join("，"))),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"业务时间："),m.a.createElement("div",{className:"item-value"},l.businessTime)),m.a.createElement("div",{className:"subscrbe-t",style:{marginTop:"22px"}},"订阅方式"),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"订阅方式："),m.a.createElement("div",{className:"item-value"},1===l.pushWay?"API数据PUSH形式":"MQTT主题订阅")),1===l.pushWay&&m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"数据订阅URL："),m.a.createElement("div",{className:"item-value"},l.pushUrl)),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"Token："),m.a.createElement("div",{className:"item-value"},l.sign))),m.a.createElement("div",{className:"subscrbe-item"},m.a.createElement("div",{className:"item-label"},"推送频次："),m.a.createElement("div",{className:"item-value"},0===l.pushFrequency?"每次触发推送":"相同故障每小时推送1次")))))}a("rvOk");function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ne(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var re=o.a.Option,le=u.a.Step,ce=i.a.Search;function ie(){var e=ae(c.a.useForm(),1)[0],t=ae(Object(s.useState)(0),2),a=t[0],i=t[1],f=ae(Object(s.useState)([]),2),b=f[0],v=f[1],E=ae(Object(s.useState)("add"),2),y=E[0],h=E[1],g=ae(Object(s.useState)([]),2),O=g[0],I=g[1],w=ae(Object(s.useState)(!1),2),N=w[0],C=w[1],T=ae(Object(s.useState)({}),2),k=T[0],P=T[1],V=ae(Object(s.useState)({pageIndex:1,totalRows:0,pageRows:10}),2),F=V[0],x=V[1],L=ae(Object(s.useState)(!1),2),D=L[0],H=L[1],U=ae(Object(s.useState)(null),2),q=U[0],W=U[1],M=ae(Object(s.useState)({}),2),G=M[0],Q=M[1],J=ae(Object(s.useState)(!1),2),Y=J[0],K=J[1],z=function(e,t){H(!0),Q(t),W(e)};Object(s.useEffect)((function(){Object(j.c)(j.a.allProductPubList,{}).then((function(e){e.data.unshift({productId:0,productName:"全部产品"}),I(e.data)}))}),[]),Object(s.useEffect)((function(){B()}),[F.pageRows,F.pageIndex,a]);var B=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n={};-1!=e.getFieldValue("push_way")&&(n.push_way=e.getFieldValue("push_way")),e.getFieldValue("subscriptName")&&(n.subscriptName=e.getFieldValue("subscriptName"));var r={devicePushUrlConf:n,pager:F};a&&(r.devicePushUrlConf.productId=a),Object(j.c)(j.a.subscribeList,r,{loading:t}).then((function(e){v(e.data.list),x((function(t){var a=JSON.parse(JSON.stringify(t));return Object.assign(a,{totalRows:e.data.pager.totalRows})}))}))},Z=[{title:"订阅ID",dataIndex:"urlConfId",key:"urlConfId"},{title:"订阅名称",dataIndex:"subscriptName",key:"subscriptName"},{title:"订阅方式",dataIndex:"pushWay",key:"pushWay",render:function(e){return m.a.createElement("span",null,2==e?"MQTT主题订阅":"API数据PUSH形")}},{title:"归属产品名称",dataIndex:"productName",key:"productName"},{title:"订阅更新时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return m.a.createElement("span",null,e&&A()(e).add(8,"h").format("YYYY-MM-DD HH:mm:ss")||"--")}},{title:"状态",dataIndex:"pushState",key:"pushState",render:function(e){return m.a.createElement("span",null,e?"正常":"停用")}},{title:"操作",render:function(e,t){return m.a.createElement(l.b,{size:"middle"},m.a.createElement("a",{onClick:function(){Q(t),K(!0)}},"查看"),m.a.createElement("a",{onClick:function(){!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=j.a.subscribeDetail+"?urlConfId="+e.urlConfId;Object(j.c)(a,{},{loading:t}).then((function(t){P(t.data),Q(e),h("edit"),C(!0)}))}(t)}},"编辑"),t.pushState?m.a.createElement("a",{onClick:function(){z(2,t)}},"停用"):m.a.createElement("a",{onClick:function(){z(1,t)}},"启动"))}}];return m.a.createElement("div",{id:"subscribe-data"},m.a.createElement(d.a,{title:"数据订阅"},m.a.createElement("div",{className:"top-select"},m.a.createElement(o.a,{style:{width:150},value:a,onChange:function(e){x((function(e){var t=JSON.parse(JSON.stringify(e));return Object.assign(t,{pageIndex:1})})),i(e)},showSearch:!0,optionFilterProp:"children"},O.map((function(e){return m.a.createElement(re,{value:e.productId,key:e.productId},e.productName)}))))),m.a.createElement("div",{className:"comm-shadowbox setp-ttip"},m.a.createElement("div",{className:"step-title"},m.a.createElement("img",{src:p.a,alt:""}),m.a.createElement("span",null,"数据订阅步骤")),m.a.createElement(u.a,{current:-1,initial:0},m.a.createElement(le,{title:"选择产品",description:"可根据产品订阅以及设备标签，选择需要的数据对象。"}),m.a.createElement(le,{title:"配置订阅内容",description:"可根据产品或设备的物模型，订阅详细的功能点数据信息。"}),m.a.createElement(le,{title:"确定订阅方式",description:"支持数据API推送服务或MQTT订阅，两种不同的方式。"}))),m.a.createElement("div",{className:"comm-shadowbox device-content"},m.a.createElement("div",{className:"content-top"},m.a.createElement("div",{className:"content-top-left"},m.a.createElement(c.a,{className:"device-filter-form",form:e,initialValues:{push_way:"-1"},layout:"inline"},m.a.createElement(c.a.Item,{name:"push_way",label:"订阅方式"},m.a.createElement(o.a,{style:{width:"200px"}},m.a.createElement(re,{value:"-1"},"全部方式"),m.a.createElement(re,{value:1},"API数据PUSH形式"),m.a.createElement(re,{value:2},"MQTT主题订阅"))),m.a.createElement(c.a.Item,{label:"订阅名称",name:"subscriptName"},m.a.createElement(ce,{onSearch:function(){1===F.pageIndex?B():x((function(e){var t=JSON.parse(JSON.stringify(e));return Object.assign(t,{pageIndex:1})}))},style:{width:"465px"}})))),m.a.createElement(r.a,{type:"primary",onClick:function(){h("add"),C(!0)}},"添加订阅")),m.a.createElement(n.a,{rowKey:"urlConfId",dataSource:b,columns:Z,pagination:{defaultCurrent:1,current:F.pageIndex,onChange:function(e,t){t==F.pageRows?x((function(a){var n=JSON.parse(JSON.stringify(a));return Object.assign(n,{pageIndex:e,pageRows:t})})):x((function(e){var a=JSON.parse(JSON.stringify(e));return Object.assign(a,{pageIndex:1,pageRows:t})}))},pageSize:F.pageRows,total:F.totalRows,showQuickJumper:!0,pageSizeOptions:[10],showTotal:function(){return m.a.createElement("span",null,"共 ",m.a.createElement("a",null,F.totalRows)," 条")}}})),N&&m.a.createElement(R,{isModalVisible:N,cancelModel:function(){C(!1)},colseMoadl:function(){Object(S.a)({type:"success",description:"edit"===y?"编辑成功":"新增成功！"}),B(),C(!1)},editData:k,actionType:y}),D&&m.a.createElement(_,{visible:D,operate:q,actionObj:G,updateOkHandle:function(){return function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(1===q){var t=j.a.subscribeStart+"?urlConfId="+G.urlConfId;Object(j.c)(t,{},{loading:e}).then((function(e){H(!1),Object(S.a)({type:"success",description:"操作成功！"}),B()}))}else{var a=j.a.subscribeClose+"?urlConfId="+G.urlConfId;Object(j.c)(a,{},{loading:e}).then((function(e){H(!1),Object(S.a)({type:"success",description:"操作成功！"}),B()}))}}()},updateCancelHandle:function(){H(!1)}}),Y&&m.a.createElement(te,{rightVisible:Y,onCloseRight:function(){K(!1)},id:G.urlConfId}))}},qSPm:function(e,t,a){},rvOk:function(e,t,a){}}]);