(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},"40NI":function(e,t,a){},"8sIe":function(e,t,a){"use strict";a.d(t,"a",(function(){return Z}));a("ef1R"),a("Ra8s"),a("HsXu"),a("qgAm"),a("9b3Y"),a("Ck9u"),a("IHDg"),a("vV4J"),a("RfWx"),a("QcZr");var n=a("b+L2"),r=(a("kt2P"),a("enwP")),l=(a("MNU5"),a("YeX6")),c=(a("SmMv"),a("DTgQ")),i=a("CvKH"),o=a.n(i),s=(a("I9ul"),a("P37N"),a("62KB"),a("J2lP"),a("hjnz"),a("av3G"),a("bs69"),a("sfoS"),a("gAA8"),a("Lm8M"),a("ryEf"),a("0Us0"),a("T9Mk")),u=a.n(s),d=a("8x1r"),m=a("Nlzp"),p=a("DgvE"),f=a("cu44"),v=a("TL2v"),g=a("2kug"),E=(a("UTJx"),a("dVdO")),y=(a("8OUX"),a("KCXd")),b=(a("xzjF"),a("PeP6")),h=(a("UdMA"),a("ViyK")),I=(a("pckg"),a("vERT"),a("V9IP"),a("OXkf"),a("kuaa"),a("4dS9"),a("FIdd")),k=a("P2RN");function O(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?O(Object(a),!0).forEach((function(t){x(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function S(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||L(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){if(e){if("string"==typeof e)return C(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var N=h.a.TextArea,D=h.a.Search,R=b.a.Option,T=[{title:"填写任务说明"},{title:"添加配置数据"},{title:"选择配置更新的设备"}],A=["待执行","执行中","成功","失败"];function P(e){var t=e.visible,a=e.productId,r=e.onCancel,c=e.configProtoclList,i=e.isDeviceRomote,d=e.getRemoteList,f=e._deviceList,v=e.editData,O=e.protocolFormat,x=j(Object(s.useState)(0),2),L=x[0],C=x[1],A=j(Object(s.useState)(v?{taskExplain:v.taskExplain}:{taskExplain:""}),2),P=A[0],U=A[1],V=j(Object(s.useState)(v?v.protocolSendData||[]:c.map((function(e){return e.defaultPropertyValue||""}))),2),q=V[0],J=V[1],Q=j(Object(s.useState)(v&&v.protocolSelection||[]),2),F=Q[0],B=Q[1],z=j(Object(s.useState)([]),2),K=z[0],_=z[1],G=j(Object(s.useState)(1),2),H=G[0],W=G[1],X=j(Object(s.useState)([]),2),Z=X[0],Y=X[1],$=j(Object(s.useState)({curDeviceInfoList:[],allDeviceInfoList:[],allDeviceInfoPager:{pageIndex:1,currPageRows:7}}),2),ee=$[0],te=$[1],ae=j(Object(s.useState)([]),2),ne=ae[0],re=ae[1],le=j(Object(s.useState)(!1),2),ce=le[0],ie=le[1],oe=j(Object(s.useState)({allList:[],successList:[],errorList:[],errorVisible:!1}),2),se=oe[0],ue=oe[1],de=j(Object(s.useState)(""),2),me=de[0],pe=de[1],fe=j(Object(s.useState)(!1),2),ve=fe[0],ge=fe[1],Ee=j(Object(s.useState)({rightAllList:v?v.deviceList:[],rightTempList:v?v.deviceList:[]}),2),ye=Ee[0],be=Ee[1],he=j(Object(s.useState)([]),2),Ie=he[0],ke=he[1],Oe=Object(s.useRef)(null),we=P.taskExplain,xe=ee.curDeviceInfoList,Se=ee.allDeviceInfoList,je=ee.allDeviceInfoPager,Le=se.allList,Ce=se.successList,Ne=se.errorList,De=se.errorVisible,Re=ye.rightAllList,Te=ye.rightTempList,Ae=i?1:2,Pe=o()(T);i&&Pe.splice(2,1);var Ue=function(e){Object(m.c)(m.a.getAllDeviceInfo,{productId:a,pageRows:8,pageIndex:e||je.pageIndex}).then((function(e){if(e.data){var t=e.data,a=t.list,n=void 0===a?[]:a,r=t.pager,l=void 0===r?{}:r,c=[].concat(S(Se),S(n));n.forEach((function(e){e.key=e.deviceUniqueId})),te({curDeviceInfoList:n,allDeviceInfoPager:l,allDeviceInfoList:c})}}))};Object(s.useEffect)((function(){i||Ue()}),[a,i]);var Ve=function(e){var t=m.a.saveRomoteConfig,n={taskExplain:we,productId:a,protocolJson:JSON.stringify(1!==O?F.map((function(e){var t=c[e];return delete t._type,delete t._params,delete t._index,delete t.key,w(w({},t),{},{sendData:q[e]})})):q.map((function(e,t){var a=c[t];return delete a._type,delete a._params,delete a._index,delete a.key,w(w({},a),{},{sendData:e})})))};if(i)t=m.a.saveRomoteConfigForDevice,n.deviceList=f;else{if(Re.length<1)return void Object(k.a)({description:"请至少选择一个设备"});n.deviceList=Re.map((function(e){return{deviceId:e.deviceId,deviceUniqueId:e.deviceUniqueId,macAddress:e.macAddress}})),v&&(n.taskId=v.taskId)}Object(m.d)(t,n,{needJson:!0,loading:!0,noInstance:!0}).then((function(t){if(e){var n=t.data;Object(m.c)(m.a.submitRomoteConfig,{taskId:n,productId:a},{loading:!0}).then((function(e){d(1),r()}))}else d(1),r()}))},qe=function(e){U(w(w({},P),{},{taskExplain:e.target.value.trim()}))},Je=function(e,t){var a=S(q),n=K.filter((function(e){return e!==t}));a[t]=e,J(a),_(n)},Me=function(e){W(+e),Y([]),re([])},Qe=function(e){e?(ie(!0),Object(m.c)(m.a.getDeviceInfoByIdOrMacAddress,{productId:a,query:e}).then((function(e){var t=e.data;t.key=t.deviceUniqueId,e.data&&re([t])})).finally((function(){ie(!1)}))):Object(k.a)({description:"请输入查询条件"})},Fe=function(e){var t=S(Re);if(e&&e.trim()){var a=e.trim();t=Re.filter((function(e){var t=e.deviceUniqueId,n=e.macAddress;return t.indexOf(a)>-1||n.indexOf(a)>-1}))}be(w(w({},ye),{},{rightTempList:t}))},Be=function(){window.open(m.a.downloadRemoteDeviceTemplateExcel)},ze=function(e){console.log(1);var t=e.target;if(t.files&&t.files.length>0){var n=Object(p.e)(t.files,["xls","xlsx"],1e4),r=n.isOk;n.type,n.size;if(!r)return void Object(k.a)({description:"文件类型或者大小不符合要求"});var l=t.files[0];Object(m.d)(m.a.importRemoteDeviceExcel,{uploadExcel:l,productId:a},{needFormData:!0,loading:!0}).then((function(e){if(e.data){var t=e.data,a=[],n=[];t.forEach((function(e,t){var r=e.errorType,l=e.deviceUniqueId;e.key=l,r?n.push({deviceUniqueId:l,errorType:r,key:l}):a.push(w({},e))})),ue(w(w({},se),{},{allList:t,successList:a,errorList:n})),a.length>0&&(be({rightAllList:[].concat(a),rightTempList:[].concat(a)}),ke([])),pe(l.name),ge(!0)}}))}},Ke=function(){var e=(1==H?Se:ne).filter((function(e){return Z.includes(e.deviceUniqueId)})),t=Object(p.s)([].concat(S(Re),S(e)),"deviceUniqueId");Oe&&(Oe.current.input.input.value=""),be({rightAllList:t,rightTempList:t})},_e=function(){if(0!==Ie.length){var e=Re.filter((function(e){var t=e.key;return!Ie.includes(t)})),t=Te.filter((function(e){var t=e.key;return!Ie.includes(t)}));be(w(w({},ye),{},{rightAllList:e,rightTempList:t})),ke([])}},Ge=[{title:"数据名称",dataIndex:"propertyName",key:"propertyName",width:160},{title:"数据标识",dataIndex:"property",width:240,key:"property"},{title:"数据类型",dataIndex:"_type",key:"_type",width:140},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"},{title:"下发数据",dataIndex:"execTime",key:"execTime",width:180,render:function(e,t){var a=t._type,n=t._params,r=t._index,l=t.key,c=null,i=1!==O&&!F.includes(l);switch(a){case"数值型":c=u.a.createElement(y.a,{value:q[r],min:n.min,max:n.max,disabled:i,onChange:function(e){return Je(e,r)},placeholder:"请输入参数"});break;case"字符型":c=u.a.createElement(h.a,{value:q[r],maxLength:30,disabled:i,onChange:function(e){return Je(e.target.value.trim(),r)},placeholder:"请输入参数"});break;default:c=u.a.createElement(b.a,{disabled:i,onChange:function(e){return Je(e,r)},value:q[r]||""},u.a.createElement(R,{key:-1,value:""},"请选择参数"),n&&n.map((function(e,t){return u.a.createElement(R,{key:t+a,value:e.value},e.name)})))}return u.a.createElement("span",{className:"config-send-data ".concat(K.includes(r)?"warn":"")},c)}}],He=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:140},{title:"物理地址",dataIndex:"macAddress",width:140,key:"macAddress"}],We={selectedRowKeys:F,onChange:function(e){B(e)}},Xe={selectedRowKeys:Z,onChange:function(e){Y(e)}},Ze={selectedRowKeys:Ie,onChange:function(e){ke(e)}},Ye=1===H?xe:2===H?ne:[];return u.a.createElement(E.a,{visible:t,width:1e3,className:"romote-modal",title:"远程配置任务",centered:!0,closable:!1,onOk:null,destroyOnClose:!0,maskClosable:!1,footer:null},u.a.createElement("div",{className:"romote-add-content flex-column"},u.a.createElement(g.a,{type:2,flowLists:Pe,style:{padding:"12px 0"},activeItem:L}),u.a.createElement("div",{className:"content-wrapper flex1"},function(){switch(L){case 0:return u.a.createElement("div",{className:"step-0-wrapper flex-row"},u.a.createElement("div",{className:"step-0-lable"},u.a.createElement("span",{className:"pre-requst-start"},"任务说明")),u.a.createElement("div",{className:"textarea-wrapper flex1"},u.a.createElement(N,{value:we,maxLength:100,onChange:qe,autoSize:{minRows:4,maxRows:6}})),u.a.createElement("div",{className:"count-wrapper"},u.a.createElement("span",null,"".concat(we.length,"/100"))));case 1:return u.a.createElement("div",{className:"step-1-wrapper"},u.a.createElement("p",null,1!==O?"请选中需要下发的配置数据，并配置下发数据的值":"该产品使用了CLink标准数据格式（十六进制），需全量下发配置更新数据"),u.a.createElement("div",{className:"table-wrapper"},u.a.createElement(n.a,{columns:Ge,rowSelection:1!==O?We:null,dataSource:c,scroll:{y:300},pagination:!1})));case 2:return u.a.createElement("div",{className:"step-2-wrapper"},u.a.createElement("div",{className:"device-select-wrapper flex-row"},u.a.createElement("div",{className:"left flex1"},u.a.createElement("p",null,"选择配置更新的设备"),u.a.createElement(b.a,{value:H,onChange:Me},u.a.createElement(R,{value:1,key:1},"全部设备"),u.a.createElement(R,{value:2,key:2},"通过设备ID/物理地址查找"),u.a.createElement(R,{value:3,key:3},"导入设备列表（本地文件）")),2===H&&u.a.createElement(D,{enterButton:"查 找",loading:ce,onSearch:Qe,maxLength:50,placeholder:"请输入设备ID/物理地址查找"}),3===H?u.a.createElement("section",{className:"file-upload-area"},u.a.createElement("p",null,"选择本地的设备数据文件上传 ",u.a.createElement("a",{onClick:Be},"设备数据模板")),u.a.createElement("p",null,"每次添加最多支持20,000个设备"),ve?u.a.createElement("div",null,u.a.createElement("div",{className:"result-area"},u.a.createElement("h3",null,me||"--"),u.a.createElement("p",null,"共".concat(Le.length,"条数据")),u.a.createElement("p",null,"".concat(Ce.length,"台设备成功匹配")),u.a.createElement("p",null,"".concat(Ne.length,"条数据匹配失败"))),u.a.createElement("div",{className:"tools"},u.a.createElement("a",{onClick:function(){return ge(!1)}},"重新上传"),u.a.createElement("a",{onClick:function(){return ue(w(w({},se),{},{errorVisible:!0}))}},"错误日志"))):u.a.createElement("div",null,u.a.createElement("div",{className:"file-input-wrapper"},u.a.createElement(l.a,{type:"primary"},u.a.createElement(I.a,null)," 选择本地设备数据文件"),u.a.createElement("input",{type:"file",onInput:ze,accept:".xls,.xlsx"})),u.a.createElement("p",null,"支持xls，xlsx格式，文件大小不超过10MB"))):2===H?u.a.createElement(n.a,{columns:He,dataSource:Ye,rowSelection:Xe,pagination:!1}):u.a.createElement(n.a,{columns:He,dataSource:Ye,rowSelection:Xe,pagination:{total:je.totalRows,defaultCurrent:1,defaultPageSize:je.currPageRows,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",onChange:function(e){return Ue(e)},showTotal:function(e){return u.a.createElement("span",null,"共 ",u.a.createElement("a",null,e)," 条")}}})),u.a.createElement("div",{className:"center"},u.a.createElement(l.a,{type:"primary",disabled:0===Z.length,onClick:Ke},"选择设备")),u.a.createElement("div",{className:"right flex1"},u.a.createElement("p",null,"已选中配置更新的设备"),u.a.createElement(D,{enterButton:"查 找",ref:Oe,onSearch:Fe,maxLength:50,placeholder:"请输入设备ID/物理地址查找"}),u.a.createElement("div",{className:"tools-wrapper"},u.a.createElement("a",{className:Ie.length>0?"":"disable",onClick:_e},"取消选中")),u.a.createElement(n.a,{columns:He,rowSelection:Ze,dataSource:Te,pagination:{total:Te.length,defaultCurrent:1,defaultPageSize:7,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",showTotal:function(e){return u.a.createElement("span",null,"共 ",u.a.createElement("a",null,e)," 条")}}}))))}}()),u.a.createElement("div",{className:"r-footer"},u.a.createElement("span",null,L>0&&u.a.createElement(l.a,{onClick:function(){return C(L-1)},type:"primary"},"上一步"),u.a.createElement(l.a,{onClick:function(){if(0===L){if(!we)return void Object(k.a)({description:"请输入远程配置的备注信息"})}else if(1===L){var e=[];if(1!==O){if(F.length<1)return void Object(k.a)({description:"请至少选择一条配置协议"});F.forEach((function(t){[""," ",null,void 0].includes(q[t])&&e.push(t)}))}else q.forEach((function(t,a){[""," ",null,void 0].includes(t)&&e.push(a)}));if(e.length>0)return Object(k.a)({description:"请为配置协议添加参数"}),void _(e)}else if(2===L&&Re.length<1)return void Object(k.a)({description:"请至少选择一个设备"});L===Ae?Ve(!i):C(L+1)},type:"primary"},L===Ae?"提交执行":"下一步"),u.a.createElement(l.a,{onClick:function(){2===L?Ve():r()},type:2===L?"primary":"default"},2===L?"保存":"取消"))),De&&u.a.createElement(M,{visible:De,errorList:Ne,onCancel:function(){return ue(w(w({},se),{},{errorVisible:!1}))}})))}function U(e){var t=e.visible,a=e.record,r=e.statusText,i=e.onCancel,o=e.searchDeviceResult,d=e.isDeviceRomote,f=j(Object(s.useState)({selectType:1,keyWords:"",filterStatus:0}),2),v=f[0],g=f[1],y=j(Object(s.useState)({errorLogVisible:!1,errorLogRecord:{}}),2),I=y[0],k=y[1],O=a.taskId,S=a.taskExplain,L=a.status,C=a.execTime,N=a.protocolConfig,D=a.total,T=a.success,P=a.inExec,U=a.fail,V=a.list,J=void 0===V?[]:V,M=a.pager,Q=void 0===M?{}:M,F=v.selectType,B=v.keyWords,z=v.filterStatus,K=I.errorLogVisible,_=I.errorLogRecord,G=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"物理地址",dataIndex:"macAddress",width:200,key:"macAddress"},{title:"配置结果",dataIndex:"status",key:"status",width:160,render:function(e,t){var a=t.status;return u.a.createElement("span",{className:"verify-statu-".concat(a)},A[a-1])}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.status,n=t.remoteId;t.receiveMsg,t.errorType;return u.a.createElement("span",null,""+a=="4"?u.a.createElement(u.a.Fragment,null,u.a.createElement("a",{onClick:function(){return function(e){Object(m.c)(m.a.retryByTaskId,{remoteId:e}).then((function(e){W(Q.pageIndex)}))}(n)}},"重试"),u.a.createElement(c.a,{type:"vertical"}),u.a.createElement("a",{onClick:function(){return function(e){var t=e.remoteId,a=e.errorType;2==a?Object(m.c)(m.a.getReceiveMsg,{remoteId:t},{loading:!0}).then((function(e){k({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:e.data&&e.data.receiveMsg}})})):k({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:null}})}(t)}},"日志")):null)}}],H=function(e,t){g(w(w({},v),{},x({},t,e)))},W=function(e){var t={};e&&(t.pageIndex=e),B&&(t[1===F?"deviceUniqueId":"macAddress"]=B),z&&(t.status=z),t.taskId=O,o(t)};return u.a.createElement(E.a,{visible:t,width:1e3,className:"romote-modal",title:"远程配置任务",centered:!0,closable:!0,onOk:null,onCancel:i,destroyOnClose:!0,maskClosable:!1,footer:null},u.a.createElement("div",{className:"romote-detail-content height-premit"},u.a.createElement("h3",null,"基础信息"),u.a.createElement("div",{className:"base-info"},u.a.createElement("p",null,u.a.createElement("span",null,"任务ID"),u.a.createElement("span",null,O||"--")),u.a.createElement("p",null,u.a.createElement("span",null,"任务说明"),u.a.createElement("span",null,S||"--")),u.a.createElement("p",null,u.a.createElement("span",null,"任务状态"),u.a.createElement("span",null,r[L]||"--")),u.a.createElement("p",null,u.a.createElement("span",null,"执行时间"),u.a.createElement("span",null,p.a.utcToDev(C)||"--"))),u.a.createElement("h3",null,"配置数据"),u.a.createElement(n.a,{columns:[{title:"数据名称",dataIndex:"propertyName",key:"propertyName",width:200},{title:"数据标识",dataIndex:"property",width:240,key:"property"},{title:"数据类型",dataIndex:"_type",key:"_type",width:120},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"},{title:"下发数据",dataIndex:"sendData",key:"sendData",width:140}],dataSource:N||[],pagination:!1}),!d&&u.a.createElement(u.a.Fragment,null,u.a.createElement("h3",null,"配置设备"),u.a.createElement("div",{className:"device-wrapper"},u.a.createElement("div",null,u.a.createElement("h4",null,"配置设备数"),u.a.createElement("p",null,Number.isInteger(D)?D:"--")),u.a.createElement("div",null,u.a.createElement("h4",null,"配置成功"),u.a.createElement("p",null,Number.isInteger(T)?T:"--")),u.a.createElement("div",null,u.a.createElement("h4",null,"执行中"),u.a.createElement("p",null,Number.isInteger(P)?P:"--")),u.a.createElement("div",null,u.a.createElement("h4",null,"配置失败"),u.a.createElement("p",null,Number.isInteger(U)?U:"--")),u.a.createElement("div",null,u.a.createElement("span",{className:0==+U?"disable":"",onClick:+U>0?function(){Object(m.c)(m.a.batchRetry,{taskId:O}).then((function(e){W()}))}:null},"批量重试"))),u.a.createElement("div",{className:"filter-wrapper"},u.a.createElement(b.a,{value:F,onChange:function(e){return H(e,"selectType")}},u.a.createElement(R,{key:"1",value:1},"设备ID"),u.a.createElement(R,{key:"2",value:2},"物理地址")),u.a.createElement(h.a,{placeholder:"支持精确查询",value:B,maxLength:50,onChange:function(e){return H(e.target.value,"keyWords")}}),u.a.createElement("span",null,"配置结果"),u.a.createElement(b.a,{value:z,onChange:function(e){return H(e,"filterStatus")}},u.a.createElement(R,{key:"0",value:0},"全部"),u.a.createElement(R,{key:"1",value:1},"待执行"),u.a.createElement(R,{key:"2",value:2},"执行中"),u.a.createElement(R,{key:"3",value:3},"执行成功"),u.a.createElement(R,{key:"4",value:4},"执行失败")),u.a.createElement(l.a,{type:"primary",onClick:function(){return W()}},"查找"),u.a.createElement(l.a,{type:"primary",onClick:function(){Object(m.c)(m.a.exportTaskResult,{taskId:O}).then((function(e){window.open(m.a.exportTaskResult+"?taskId=".concat(O))}))}},"导出数据")),u.a.createElement(n.a,{columns:G,dataSource:J||[],pagination:{total:Q.totalRows,current:Q.pageIndex,defaultCurrent:1,defaultPageSize:Q.defaultPageRows,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",onChange:function(e){return W(e)},showTotal:function(e){return u.a.createElement("span",null,"共 ",u.a.createElement("a",null,e)," 条")}}}),K&&u.a.createElement(q,{visible:K,onCancel:function(){return k({errorLogVisible:!1,errorLogRecord:{}})},record:_}))))}var V=["没问题","下发配置数据失败","上报的配置数据不一致","上报的配置数据在超时时间内未获取到","存在相同的设备在执行远程配置任务","后台数据异常"];function q(e){var t=e.visible,a=e.record,n=e.onCancel,r=a.errorType,l=a.receiveMsg;return u.a.createElement(E.a,{visible:t,width:600,className:"romote-modal",title:"日志",centered:!0,closable:!0,onOk:null,onCancel:n,destroyOnClose:!0,maskClosable:!1,footer:null},u.a.createElement("div",{className:"remote-error-wrapper"},u.a.createElement("div",null,u.a.createElement("label",null,"失败原因：")," ",u.a.createElement("span",null,V[r])),u.a.createElement("div",null,u.a.createElement("label",null,"报文信息："),u.a.createElement("div",{className:"msg-wrap"},function(e){if(!e)return u.a.createElement("h4",null,"无报文信息");var t=JSON.parse(e),a=Object.keys(t);return u.a.createElement(u.a.Fragment,null,u.a.createElement("h4",null,"报文解析列表"),a.map((function(e){return u.a.createElement("div",{className:"log-row"},u.a.createElement("span",{className:"log-left-key"},e),u.a.createElement("span",{className:"log-right-content"},t[e]))})))}(l)))))}var J=["设备ID的长度超过限制","物理地址的长度超限制","设备ID发生重复","物理地址发生重复","设备ID不存在或未联网","物理地址不存在或未联网"];function M(e){var t=e.visible,a=e.errorList,r=e.onCancel,l=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"错误原因",dataIndex:"errorType",width:200,key:"errorType",render:function(e,t){var a=t.errorType;return u.a.createElement("span",null,J[a-1])}}];return u.a.createElement(E.a,{visible:t,width:600,className:"romote-modal",title:"设备导入错误日志",centered:!0,closable:!0,onOk:null,onCancel:r,destroyOnClose:!0,maskClosable:!1,footer:null},u.a.createElement("div",null,u.a.createElement(n.a,{columns:l,dataSource:a||[],pagination:{total:a.length,defaultCurrent:1,defaultPageSize:10,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",showTotal:function(e){return u.a.createElement("span",null,"共 ",u.a.createElement("a",null,e)," 条")}}})))}a("40NI");var Q=a("FC04");function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function B(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){z(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function z(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,l=[],c=!0,i=!1;try{for(a=a.call(e);!(c=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==a.return||a.return()}finally{if(i)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var G=["平台支持远程更新设备的配置数据，您可以提交远程配置任务，实时对设备的系统参数等数据进行远程更新，并且获取设备配置的更新状态；详细说明可参考文档"],H=[{title:"创建远程配置任务"},{title:"添加配置数据"},{title:"选择设备"},{title:"执行任务"}],W=["草稿","待执行","执行中","已执行"],X=["","执行中","执行成功","执行失败"];function Z(e){var t=e.productId,a=e.protocolLists,i=void 0===a?[]:a,E=e.remoteType,y=void 0===E?"product":E,b=e.deviceId,h=e.deviceUniqueId,I=e.macAddress,k=K(Object(s.useState)(!1),2),O=k[0],w=k[1],x=K(Object(s.useState)({detailVisible:!1,selectRecord:{}}),2),S=x[0],j=x[1],L=K(Object(s.useState)([]),2),C=L[0],N=L[1],D=K(Object(s.useState)({pageIndex:1}),2),R=D[0],T=D[1],A=K(Object(s.useState)({deletevisible:!1,deleteItem:null,deleteLoading:!1}),2),V=A[0],J=A[1],M=K(Object(s.useState)([]),2),F=M[0],z=M[1],_=K(Object(s.useState)(0),2),Z=_[0],Y=_[1],$=K(Object(s.useState)(null),2),ee=$[0],te=$[1],ae=K(Object(s.useState)({errorLogVisible:!1,errorLogRecord:{}}),2),ne=ae[0],re=ae[1],le=ne.errorLogVisible,ce=ne.errorLogRecord,ie=R.totalRows,oe=R.pageIndex,se=R.pageRows,ue=V.deletevisible,de=V.deleteItem,me=V.deleteLoading,pe=S.detailVisible,fe=S.selectRecord,ve="device"===y,ge=o()(H);ve&&ge.splice(2,1);var Ee=ve?X:W,ye=[{title:"任务ID",dataIndex:"taskId",key:"taskId",width:200},{title:"任务说明",dataIndex:"taskExplain",key:"taskExplain"},{title:"更新设备数量",dataIndex:"deviceTotal",key:"deviceTotal",width:180},{title:"任务状态",dataIndex:"status",key:"status",width:180,render:function(e,t){var a=t.status;return u.a.createElement("span",{className:"h5-statu-".concat(a+1)},Ee[a])}},{title:"执行时间",dataIndex:"execTime",key:"execTime",width:180,render:function(e,t){var a=t.execTime;return u.a.createElement("span",null,a?p.a.utcToDev(a):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.status,n=t.taskId;return ve?u.a.createElement("span",null,u.a.createElement("a",{onClick:function(){return Ie(t)}},"查看"),""+a=="3"?u.a.createElement(u.a.Fragment,null,u.a.createElement(c.a,{type:"vertical"}),u.a.createElement("a",{onClick:function(){return xe(n)}},"重试"),u.a.createElement(c.a,{type:"vertical"}),u.a.createElement("a",{onClick:function(){return Se(t)}},"日志")):null):u.a.createElement("span",null,""+a=="1"?u.a.createElement(u.a.Fragment,null,u.a.createElement("a",{onClick:function(){return he(t)}},"编辑"),u.a.createElement(c.a,{type:"vertical"}),u.a.createElement("a",{onClick:function(){return J({deletevisible:!0,deleteItem:t})}},"删除")):u.a.createElement("a",{onClick:function(){return Ie(t)}},"查看"))}}];ve&&ye.splice(2,1);var be=function(e){var a=m.a.getRomoteConfigListByProduct,n={pageIndex:e||oe,pageRows:10};ve?(a=m.a.getRomoteConfigListForDevice,n.deviceId=b):n.productId=t,Object(m.c)(a,n).then((function(e){var t=e.data,a=t.pager,n=void 0===a?{}:a,r=t.list,l=void 0===r?[]:r;N(Object(p.c)(l)),T(n)}))};Object(s.useEffect)((function(){be()}),[t,oe,ve,b]),Object(s.useEffect)((function(){var e=i.filter((function(e){return 5==e.dataType})),t=e[0]&&e[0].list||[],a=e[0]&&e[0].protocolFormat||0;t=(t=t.filter((function(e){return"Base_Null_Reserved_Null"!==e.property}))).map((function(e,t){var a=e.propertyValueDesc,n=null;if(a&&a.indexOf("|")>-1&&(n=a.split("|").map((function(e){var t=e.split("-");return t.length>1?{name:t[1],value:t[0]}:{}}))),a&&a.indexOf("~")>-1){var r=K(a.split("~"),2);n={min:+r[0],max:+r[1]}}return B(B({},e),{},{_type:Object(p.q)(e),_params:n,_index:t,key:t})})),z(t),Y(a)}),[i]);var he=function(e){if(e){var t=e.taskId;ke(t,1).then((function(e){var t=e.data,a=t.taskExplain,n=t.taskId,r=t.protocolJson,l=t.deviceList,c=JSON.parse(r),i=c.map((function(e){return e.property})),o=F.map((function(e){return e.defaultPropertyValue||""})),s=[];F.forEach((function(e,t){var a=e.property,n=i.indexOf(a);n>-1&&(o[t]=c[n].sendData,s.push(t))})),l.forEach((function(e){return e.key=e.deviceUniqueId})),te({taskId:n,taskExplain:a,deviceList:l,protocolSendData:o,protocolSelection:s}),w(!O)}))}else F.length>0&&w(!O)},Ie=function(e){var t=e.taskId;ve?Object(m.c)(m.a.getRemoteDetailForDevice,{taskId:t},{loading:!0}).then((function(t){var a=t.data.protocolJson;j({detailVisible:!pe,selectRecord:B(B({},e),{},{protocolConfig:JSON.parse(a)})})})):Promise.all([ke(t,2),Oe(t),we({taskId:t})]).then((function(t){var a=K(t,3),n=a[0],r=a[1],l=a[2],c=n.data.protocolJson,i=void 0===c?"[]":c,o=r.data,s=l.data,u=s.list,d=s.pager;j({detailVisible:!pe,selectRecord:B(B(B({},e),{},{protocolConfig:JSON.parse(i)},o),{},{list:u,pager:d})})}))},ke=function(e,t){return Object(m.c)(m.a.getRemoteDetail,{taskId:e,type:t},{loading:!0})},Oe=function(e){return Object(m.c)(m.a.getResultTotal,{taskId:e},{loading:!0})},we=function(e){return Object(m.c)(m.a.getDeviceResultList,B({},e),{loading:!0})},xe=function(e){Object(m.c)(m.a.retryByTaskIdForDevice,{taskId:e},{loading:!0}).then((function(e){be(oe)}))},Se=function(e){var t=e.taskId,a=e.errorType;2==a?Object(m.c)(m.a.getReceiveMsgForDevice,{taskId:t},{loading:!0}).then((function(e){re({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:e.data&&e.data.receiveMsg}})})):re({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:null}})};return u.a.createElement("div",{className:"remote-config-wrapper"},u.a.createElement(f.a,{style:{margin:"0 0 24px",padding:"24px"}},u.a.createElement(v.a,{desc:G}),u.a.createElement("div",{style:{padding:"24px 0 0"},className:"use-service-flow-wrapper"},u.a.createElement(g.a,{type:3,flowLists:ge}),u.a.createElement("div",{className:"extra-descs"},u.a.createElement("div",{className:"descs-item"},u.a.createElement("p",null,"创建远程配置任务，填写任务的目的或备注信息")),u.a.createElement("div",{className:"descs-item"},u.a.createElement("p",null,"添加要更新的产品配置数据字段和更新的数值")),!ve&&u.a.createElement("div",{className:"descs-item"},u.a.createElement("p",null,"可通过设备ID/物理地址，设备标签，本地导入确定要配置的设备")),u.a.createElement("div",{className:"descs-item"},u.a.createElement("p",null,"提交执行远程配置任务，设备更新结果实时可见"))))),u.a.createElement("section",{className:"remote-config-manage-wrapper section-bg"},u.a.createElement("h3",null,"远程配置任务",F.length?u.a.createElement(l.a,{style:{float:"right"},type:"primary",onClick:function(){return he()}},u.a.createElement(d.a,null),"创建任务"):u.a.createElement(r.a,{title:"无配置协议时不支持创建"},u.a.createElement(l.a,{style:{float:"right"},type:"primary",disabled:!0},u.a.createElement(d.a,null),"创建任务"))),u.a.createElement("div",{className:"table-wrapper"},u.a.createElement(n.a,{columns:ye,className:"ant-table-fixed",dataSource:C,pagination:{total:ie,current:oe,defaultCurrent:1,defaultPageSize:10,onChange:function(e){return function(e){be(e)}(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return u.a.createElement("span",null,"共 ",u.a.createElement("a",null,e)," 条")}}})),O&&u.a.createElement(P,{visible:O,productId:t,protocolFormat:Z,onCancel:function(){w(!1),te(null)},editData:ee,configProtoclList:F,getRemoteList:be,isDeviceRomote:ve,_deviceList:[{deviceId:b,deviceUniqueId:h,macAddress:I}]}),pe&&u.a.createElement(U,{visible:pe,record:fe,statusText:Ee,isDeviceRomote:ve,searchDeviceResult:function(e){we(e).then((function(e){var t=e.data,a=t.list,n=t.pager;j({detailVisible:pe,selectRecord:B(B({},fe),{},{list:a,pager:n})})}))},onCancel:function(){return j({detailVisible:!1,selectRecord:{}})}})),ue&&u.a.createElement(Q.a,{visible:ue,modalOKHandle:function(){var e=de.taskId;J(B(B({},V),{},{deleteLoading:!0})),Object(m.c)(m.a.deleteRomoteConfig,{taskId:e}).then((function(e){be(se>1?oe:oe-1>0?oe-1:1)})).finally((function(){J({deletevisible:!1,deleteItem:null,deleteLoading:!1})}))},modalCancelHandle:function(){return J({deletevisible:!1,deleteItem:null,deleteLoading:!1})},targetName:de.taskId,confirmLoading:me,title:"删除任务",needWarnIcon:!0,descText:"即将删除的任务",tipText:"任务的所有信息将完全被删除，无法找回，请谨慎操作"}),le&&u.a.createElement(q,{visible:le,onCancel:function(){return re({errorLogVisible:!1,errorLogRecord:{}})},record:ce}))}},YNSc:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("QcZr");var n=a("b+L2"),r=a("T9Mk"),l=a.n(r),c=a("cu44"),i=[{title:"Topic",dataIndex:"topic",key:"topic"},{title:"描述",dataIndex:"desc",key:"desc"}];function o(e){var t=e.productIdHex,a=void 0===t?"":t,r=(e.type,[{fn:"属性",topic:"/sys/".concat(a,"/thing/event/property/post"),desc:"设备属性上报"},{fn:"事件info",topic:"/sys/".concat(a,"/device/thing/event/info/post"),desc:"设备信息通知"},{fn:"事件error",topic:"/sys/".concat(a,"/device/thing/event/error/post"),desc:"设备故障上报"},{fn:"事件alert",topic:"/sys/".concat(a,"/device/thing/event/alert/post"),desc:"设备告警"}]);return l.a.createElement(c.a,{title:"topic列表"},l.a.createElement("div",{style:{padding:"12px"}},l.a.createElement(n.a,{columns:i,dataSource:r,key:"topic",pagination:!1})))}}}]);