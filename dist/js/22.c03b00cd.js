(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"17x9":function(e,t,a){e.exports=a("WUjv")(13)},H2we:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return x}));a("pNMO"),a("4Brf"),a("07d7"),a("0oug"),a("4mDm"),a("PKPk"),a("3bBZ"),a("+2oP"),a("pjDv"),a("AUBz");var n=a("ZTPi"),r=(a("mbEz"),a("wCAj")),i=(a("K4yd"),a("9yH6")),l=(a("U8R4"),a("+eQT")),u=(a("8QGh"),a("2fM7")),c=(a("FZtP"),a("sMBO"),a("2B1R"),a("oVuX"),a("q1tI")),o=a.n(c),m=(a("55Ip"),a("MeRu")),d=a("Nlzp"),s=a("rwTb"),y=(a("a971"),a("Wgwc")),f=a.n(y),b=a("MT78");function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,i=[],l=!0,u=!1;try{for(a=a.call(e);!(l=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);l=!0);}catch(e){u=!0,r=e}finally{try{l||null==a.return||a.return()}finally{if(u)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var h=[{label:"近7天",value:"1"},{label:"近30天",value:"2"}],D=u.a.Option,w=l.a.RangePicker,N=[{label:"新增设备用户数",count:"--"},{label:"活跃设备用户数",count:"--"},{label:"新增设备用户次日留存数(昨日)",count:"--"},{label:"活跃设备用户次日留存数(昨日)",count:"--"},{label:"累计设备用户数",count:"--"}],Y=[{title:"日期",dataIndex:"summaryDate",key:"summaryDate"},{title:"新增设备用户数",dataIndex:"newNum",key:"newNum"},{title:"活跃设备用户数",dataIndex:"activeNum",key:"activeNum"},{title:"新增设备用户次日留存数(昨日)",dataIndex:"newRatio",key:"newRatio"},{title:"活跃设备用户次日留存数(昨日)",dataIndex:"activeRatio",key:"activeRatio"},{title:"累计设备用户数",dataIndex:"totalNum",key:"totalNum"}];function x(){var e=v(Object(c.useState)([]),2),t=(e[0],e[1]),a=v(Object(c.useState)(),2),n=a[0],l=a[1],y=v(Object(c.useState)(),2),p=y[0],x=y[1],g=v(Object(c.useState)([]),2),k=g[0],I=g[1],M=v(Object(c.useState)([]),2),S=M[0],j=M[1],O=v(Object(c.useState)("1"),2),A=O[0],C=O[1],T=v(Object(c.useState)(N),2),L=T[0],P=T[1],B=v(Object(c.useState)(0),2),F=B[0],U=B[1],K=v(Object(c.useState)([]),2),z=K[0],Z=K[1],G=v(Object(c.useState)([]),2),H=G[0],J=G[1],Q=v(Object(c.useState)(0),2),W=Q[0],q=Q[1];Object(c.useEffect)((function(){Object(d.c)(d.a.allProductPubList,{}).then((function(e){e.data.unshift({productId:0,productName:"全部产品"}),J(e.data)}))}),[]),Object(c.useEffect)((function(){_()}),[A,p,W]);var V=v(Object(c.useState)(!1),2),X=V[0],$=V[1];Object(c.useEffect)((function(){z.length&&(2==F||3==F?$(!0):($(!1),te(z)))}),[F]);var _=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t={};1==A?(t.endDate=f()().subtract(1,"day").format("YYYY-MM-DD"),t.startDate=f()().subtract(7,"day").format("YYYY-MM-DD")):2==A&&(t.endDate=f()().subtract(1,"day").format("YYYY-MM-DD"),t.startDate=f()().subtract(30,"day").format("YYYY-MM-DD")),p&&p.length&&(t.endDate=p[1].format("YYYY-MM-DD"),t.startDate=p[0].format("YYYY-MM-DD")),W&&(t.appId=W),Object(d.c)(d.a.deviceUserAn,t,{loading:e}).then((function(e){if(Array.isArray(e.data)){for(var a=[],n=[];f()(t.startDate).isBefore(t.endDate,"day");)a.push(t.startDate),t.startDate=f()(t.startDate).add(1,"day").format("YYYY-MM-DD");a.push(t.endDate),a.reverse().forEach((function(e){var t={activeNum:0,activeRatio:0,newRatio:0,totalNum:0,summaryDate:e,newNum:0};n.push(t)})),te(n),Z(n),ee({})}else{te(e.data.summaryList||[]),ee(e.data||{}),Z(e.data.summaryList||[]);var r=e.data.newList||[],i=e.data.activeList||[];I(r.reverse()),j(i.reverse())}}))},ee=function(e){var t=[{label:"新增设备用户数",count:e.newNum||0},{label:"活跃设备用户数",count:e.activeNum||0},{label:"新增设备用户次日留存数(昨日)",count:e.newRatio||0},{label:"活跃设备用户次日留存数(昨日)",count:e.activeRatio||0},{label:"累计设备用户数",count:e.totalNum||0}];P(t)},te=function(e){var t,a,n,r=(t=[],a=[],e.forEach((function(e){t.push(e.summaryDate),0==F?a.push(e.newNum):1==F?a.push(e.activeNum):2==F?a.push(e.newRatio):3==F&&a.push(e.activeRatio)})),t=t.reverse(),a=a.reverse(),{xTime:t,xData:a}),i=document.getElementById("echart-show"),l=b.init(i);(n={xAxis:{type:"category",data:r.xTime,axisTick:{show:!1},axisLine:{lineStyle:{color:"#E9E9E9"}},axisLabel:{textStyle:{color:"#000"}}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{textStyle:{color:"#000"}},splitLine:{show:!0,lineStyle:{color:"#E9E9E9"}}},grid:{left:"0%",right:"2%",bottom:"0%",top:"4%",containLabel:!0},tooltip:{trigger:"axis",formatter:function(e){for(var t=e[0].name+"<br>",a=0;a<e.length;a++)t+='<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+e[a].color+';"></span>',t+=L[F].label+":"+e[a].value+"<br>";return t}},series:[{data:r.xData,type:"line",lineStyle:{normal:{color:"#1890FF"}},itemStyle:{normal:{color:"#1890FF"}}}]})&&l.setOption(n)};return o.a.createElement("div",{id:"device-analysis"},o.a.createElement(m.a,{title:"设备用户分析"},o.a.createElement("div",{className:"top-select"},o.a.createElement(u.a,{style:{width:150},value:W,onChange:function(e){q(e)},showSearch:!0,optionFilterProp:"children"},H.map((function(e){return o.a.createElement(D,{value:e.productId,key:e.productId},e.productName)}))))),o.a.createElement("div",{className:"comm-shadowbox filter-wrap"},o.a.createElement(i.a.Group,{options:h,onChange:function(e){x(null),C(e.target.value)},value:A,optionType:"button"}),o.a.createElement(w,{value:n||p,disabledDate:function(e){return e&&e>f()().subtract(1,"day")||e<f()().subtract(30,"day")},onCalendarChange:function(e){return t(e)},onChange:function(e){return function(e){C(""),x(e)}(e)},onOpenChange:function(e){e?(l([]),t([])):l(void 0)},format:"YYYY-MM-DD",allowClear:!1,style:{borderColor:p&&p.length?"#1890ff":""}})),o.a.createElement("div",{className:"comm-shadowbox main-echart"},o.a.createElement("h3",null,"用户趋势分析",o.a.createElement(s.a,{tip:o.a.createElement("span",null,"【新增设备用户数】：新增绑定到设备的用户数（重复绑定，绑定过此账号下其他设备用户均不去重）。",o.a.createElement("br",null),"【活跃设备用户数】：绑定了设备的用户，当日有过设备控制页面打开行为，记一次活跃。",o.a.createElement("br",null),"【新增设备用户次日留存】：当日新增设备用户，次日有过设备控制页面打开行为，记一次留存。",o.a.createElement("br",null),"【活跃设备用户次日留存】：当日活跃设备用户，次日有过设备控制页面打开行为，记一次留存。",o.a.createElement("br",null),"【累计设备用户数】：累计绑定过此账号平台下产品设备的用户数量（重复绑定，绑定多个设备用户均不去重）。")})),o.a.createElement("div",{className:"echart-count-tab"},L.map((function(e,t){return o.a.createElement("div",{key:t,onClick:function(){!function(e){4!==e&&U(e)}(t)},className:["count-item",F===t?"current-tab":"",4===t?"last-wrap":""].join(" ")},o.a.createElement("div",{className:"item-label"},e.label),o.a.createElement("div",{className:"item-number"},e.count))}))),X&&2===F?o.a.createElement(E,{tableData:k}):null,X&&3===F?o.a.createElement(R,{tableData:S}):null,o.a.createElement("div",{style:{height:X?0:"303px",overflow:"hidden"},id:"echart-show"})),o.a.createElement("div",{className:"comm-shadowbox main-echart"},o.a.createElement("h3",null,"统计数据"),o.a.createElement("div",{className:"echart-download"},o.a.createElement("a",{onClick:function(){var e={};1==A?(e.endDate=f()().subtract(1,"day").format("YYYY-MM-DD"),e.startDate=f()().subtract(8,"day").format("YYYY-MM-DD")):2==A&&(e.endDate=f()().subtract(1,"day").format("YYYY-MM-DD"),e.startDate=f()().subtract(31,"day").format("YYYY-MM-DD")),p&&p.length&&(e.endDate=p[1].format("YYYY-MM-DD"),e.startDate=p[0].format("YYYY-MM-DD")),W&&(e.appId=W),Object(d.c)(d.a.deviceUserFile,e).then((function(e){window.open(e.data.path)}))}},"下载数据")),o.a.createElement(r.a,{dataSource:z,columns:Y,pagination:!1,rowKey:"summaryDate"})))}function E(e){var t=e.tableData;n.a.TabPane;return o.a.createElement("div",null,o.a.createElement(r.a,{dataSource:t,columns:[{title:"首次使用时间",dataIndex:"sumDate",key:"sumDate"},{title:"新用户",dataIndex:"newNum",key:"newNum"},{title:"1天后",dataIndex:"newRemainNum1",key:"newRemainNum1"},{title:"2天后",dataIndex:"newRemainNum2",key:"newRemainNum2"},{title:"3天后",dataIndex:"newRemainNum3",key:"newRemainNum3"},{title:"4天后",dataIndex:"newRemainNum4",key:"newRemainNum4"},{title:"5天后",dataIndex:"newRemainNum5",key:"newRemainNum5"},{title:"6天后",dataIndex:"newRemainNum6",key:"newRemainNum6"},{title:"7天后",dataIndex:"newRemainNum7",key:"newRemainNum7"}],pagination:!1,rowKey:"summaryDate"}))}function R(e){var t=e.tableData;n.a.TabPane;return o.a.createElement("div",null,o.a.createElement(r.a,{dataSource:t,columns:[{title:"首次使用时间",dataIndex:"sumDate",key:"sumDate"},{title:"新用户",dataIndex:"activeNum",key:"activeNum"},{title:"1天后",dataIndex:"activeRemainNum1",key:"activeRemainNum1"},{title:"2天后",dataIndex:"activeRemainNum2",key:"activeRemainNum2"},{title:"3天后",dataIndex:"activeRemainNum3",key:"activeRemainNum3"},{title:"4天后",dataIndex:"activeRemainNum4",key:"activeRemainNum4"},{title:"5天后",dataIndex:"activeRemainNum5",key:"activeRemainNum5"},{title:"6天后",dataIndex:"activeRemainNum6",key:"activeRemainNum6"},{title:"7天后",dataIndex:"activeRemainNum7",key:"activeRemainNum7"}],pagination:!1,rowKey:"summaryDate"}))}},a971:function(e,t,a){}}]);