(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"+J0j":function(e,t,n){},"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},"6LkR":function(e,t,n){},"94rQ":function(e,t,n){},GuBy:function(e,t,n){},IAq3:function(e,t,n){},KfNE:function(e,t,n){},RdJM:function(e,t,n){},sD8s:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Ma}));n("J2lP"),n("DJj6"),n("62KB");var a,r=n("T9Mk"),o=n.n(r),c=n("q5+0"),i=(n("SlgS"),n("lf9m"),n("ef1R"),n("Ra8s"),n("sfoS"),n("HsXu"),n("bs69"),n("Lm8M"),n("ryEf"),n("QcZr"),n("b+L2")),l=(n("59iL"),n("f6Fh")),u=(n("av3G"),n("hjnz"),n("ivud")),s=n("yrct"),p=n("MeRu");n("IAq3");function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h(e);if(t){var r=h(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return b(this,n)}}function b(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=l.a.TabPane,g=Object(c.i)(a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(c,e);var t,n,a,r=y(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e))._getDimensionList=function(){var e=1;"userDataApi"===t.dataApi&&(e=4),t.props.getDimensionList({dimensionType:e})},t._getApiList=function(e){var n=1;"userDataApi"===t.dataApi&&(n=2),t.props.getApiList({status:2,dataType:n,pageRows:10,pageIndex:e})},t.callback=function(e){t.props.getDimensionList({dimensionType:e})},t.onChange=function(e){t._getApiList(e)},t._getDataDimensionHTML=function(){var e=t.props.curDataDimension||{},n=e.dataDimension,a=e.dataIndex;return{dataDimensionHTML:n&&n.length>0?n.map((function(e,t){var a=e.dimensionName,r=e.dimensionDesc,c={};return n.length%2!=0&&t===n.length-2&&(c={borderBottom:"1px solid rgba(233, 233, 233, 1)"}),o.a.createElement("li",{key:t,style:c},o.a.createElement("span",{className:"key"},a,"："),o.a.createElement("span",{className:"value",title:r},r))})):o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"暂无数据")),dataIndexHTML:a&&a.length>0?a.map((function(e,t){var n=e.indexName,r=e.indexDesc,c={};return a.length%2!=0&&t===a.length-2&&(c={borderBottom:"1px solid rgba(233, 233, 233, 1)"}),o.a.createElement("li",{key:t,style:c},o.a.createElement("span",{className:"key"},n,"："),o.a.createElement("span",{className:"value",title:r},r))})):o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"暂无数据"))}},t._getAntDApiListData=function(){var e=t.props.apiList;return e.forEach((function(e){e.key=e.releaseId})),{apiList:e,columns:[{title:"方法",dataIndex:"requestType",key:"requestType"},{title:"URL",dataIndex:"apiUrl",key:"apiUrl"},{title:"描述",dataIndex:"apiDesc",key:"apiDesc"},{title:"版本",dataIndex:"releaseVersion",key:"releaseVersion"},{title:"状态",dataIndex:"status",key:"status",render:function(e){return 1===e?"未发布":"已发布"}},{title:"详情",key:"detail",render:function(e,t){return o.a.createElement("a",{href:"javascript:"},"查看说明")}}]}},t._getTabPaneHTML=function(){var e=t._getDataDimensionHTML(),n=e.dataDimensionHTML,a=e.dataIndexHTML;return["数据汇总","分析类","基础数据"].map((function(e,r){var c="deviceDataApi"===t.dataApi?r+1:r+4;return o.a.createElement(v,{tab:e,key:c},o.a.createElement("div",{className:"data-wrapper"},o.a.createElement("div",{className:"data-dimension"},o.a.createElement("header",null,"数据维度"),o.a.createElement("ul",{className:"clearfix"},n)),o.a.createElement("div",{className:"data-index"},o.a.createElement("header",null,"数据指标"),o.a.createElement("ul",{className:"clearfix"},a))))}))},t}return t=c,(n=[{key:"componentDidMount",value:function(){var e=this.props.match.path;this.dataApi=e.split("/")[3],this._getDimensionList(),this._getApiList(1)}},{key:"render",value:function(){var e=this.props.pager,t=this._getAntDApiListData(),n=t.apiList,a=t.columns,r=this._getTabPaneHTML(),c="deviceDataApi"===this.dataApi?"1":"4",u="deviceDataApi"===this.dataApi?"设备数据":"用户数据";return o.a.createElement("div",{className:"device-data-api-list-wrapper"},o.a.createElement(p.a,{noback:!0,title:u}),o.a.createElement("div",{className:"data-api-content-wrapper"},o.a.createElement("div",{className:"data-content"},o.a.createElement(l.a,{defaultActiveKey:c,tabBarStyle:{paddingLeft:"32px"},onChange:this.callback},r)),o.a.createElement("div",{className:"api-list-content"},o.a.createElement("header",null,"API"),o.a.createElement("div",{className:"api-table-wrapper"},o.a.createElement(i.a,{dataSource:n,columns:a,pagination:{onChange:this.onChange,defaultCurrent:1,pageSize:10,total:e.totalRows,showQuickJumper:!0}})))))}}])&&d(t.prototype,n),a&&d(t,a),c}(r.Component))||a,E=Object(u.b)((function(e){return{curDataDimension:e.getIn(["deviceDataApi","curDataDimension"]).toJS(),apiList:e.getIn(["deviceDataApi","apiList"]).toJS(),pager:e.getIn(["deviceDataApi","pager"]).toJS()}}),(function(e){return{getDimensionList:function(t){var n=s.a.getDimensionList(t);e(n)},getApiList:function(t){var n=s.a.getApiList(t);e(n)}}}))(g);var O=function(e){var t=e.match.path;return o.a.createElement(c.e,null,o.a.createElement(c.c,{path:"".concat(t,"/list"),component:E}),o.a.createElement(c.b,{to:"".concat(t,"/list")}))},w=(n("SmMv"),n("DTgQ")),S=n("DndG"),I=n("+kVv"),j=n("Nlzp"),P=n("DgvE"),D=n("FC04"),k=n("P2RN");n("+J0j");function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=_(e);if(t){var r=_(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return L(this,n)}}function L(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(c,e);var t,n,a,r=C(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).componentDidMount=function(){t.props.getMethodList({pageIndex:1,pageRows:10})},t.onChange=function(e){t.props.getMethodList({pageIndex:e,pageRows:10})},t.delMethod=function(e){Object(j.c)(j.a.delMethod,{apiId:e}).then((function(e){0===e.code&&(Object(k.a)({type:"success",description:"删除统计方法成功"}),t.setState((function(e){return{showDeleteDialog:!e.showDeleteDialog}}),(function(){t.props.getMethodList({pageIndex:1,pageRows:10})})))}))},t.showDeleteConfirm=function(e,n){t.setState((function(t){return{curApiId:e,showDeleteDialog:!t.showDeleteDialog,methodName:n}}))},t._getAntDMethodListData=function(){var e=t.props,n=e.methodList,a=e.pager;return n.forEach((function(e,t){e.key=e.apiId,e.id=10*(a.pageIndex-1)+t+1})),{methodList:n,columns:[{title:"ID",dataIndex:"id",key:"id"},{title:"统计方法名称",dataIndex:"apiName",key:"apiName"},{title:"申请时间",dataIndex:"createDate",key:"createDate",render:function(e){return P.a.utcToDev(e)}},{title:"状态",dataIndex:"status",key:"status",render:function(e){return 0===e?"审核中":1===e?"审核通过":"审核拒绝"}},{title:"操作",key:"opt",render:function(e,n){return o.a.createElement("span",null,o.a.createElement(S.b,{key:"detail",to:"/open/bigData/customMethod/detail/"+n.key},"查看"),o.a.createElement(w.a,{type:"vertical"}),o.a.createElement("a",{href:"javascript:",onClick:function(){return t.showDeleteConfirm(n.apiId,n.apiName)}},"删除"))}}]}},t.updateOkHandle=function(){var e=t.state.curApiId;t.delMethod(e)},t.updateCancelHandle=function(){t.setState((function(e){return{showDeleteDialog:!e.showDeleteDialog}}))},t.addMethod=function(){var e=t.props,n=e.history,a=e.methodNums,r=void 0===a?{}:a,o=r.MethodNum,c=void 0===o?0:o,i=r.MaxMethodNum;c>=(void 0===i?0:i)?Object(k.a)({description:"已达到上限值，无法新增！"}):n.push("/open/bigData/customMethod/add")},t.state={showDeleteDialog:!1,curApiId:void 0,methodName:""},t}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.props.pager,n=this.state,a=n.showDeleteDialog,r=n.methodName,c=this._getAntDMethodListData(),l=c.methodList,u=c.columns;return o.a.createElement("div",{className:"method-list-wrapper"},o.a.createElement(p.a,{btnClickHandle:this.addMethod,btnIcon:"plus",noback:!0,needBtn:!0,btnText:"新增统计方法",title:"自定义统计方法"}),o.a.createElement("div",{className:"method-list-content-wrapper"},o.a.createElement("div",{className:"method-list-content"},o.a.createElement("div",{className:"content-title"},"统计方法列表："),o.a.createElement("div",{className:"content"},o.a.createElement(i.a,{dataSource:l,columns:u,pagination:{onChange:this.onChange,defaultCurrent:1,current:t.pageIndex,pageSize:10,total:t.totalRows,showQuickJumper:!0}})))),a&&o.a.createElement(D.a,{visible:a,modalOKHandle:function(){return e.updateOkHandle()},modalCancelHandle:function(){return e.updateCancelHandle()},targetName:r,title:"删除统计方法",descText:"删除该统计方法可能会导致APP图表无数据",needWarnIcon:!0,tipText:"请确认是否继续删除?"}),"}")}}])&&x(t.prototype,n),a&&x(t,a),c}(r.PureComponent),A=Object(u.b)((function(e){return{methodList:e.getIn(["customMethod","methodList"]).toJS(),methodNums:e.getIn(["customMethod","MethodNums"]).toJS(),pager:e.getIn(["customMethod","pager"]).toJS()}}),(function(e){return{getMethodList:function(t){var n=I.a.getMethodList(t);e(n),e(I.a.getMethodNums())}}}))(R),V=(n("pckg"),n("IHDg"),n("mPWi"),n("B1aJ"),n("hEGT"),n("MNU5"),n("YeX6")),F=(n("oENA"),n("uTCA")),M=(n("a6t6"),n("N1Yw")),B=(n("odtX"),n("4Hua")),H=(n("UdMA"),n("ViyK")),q=(n("xzjF"),n("PeP6")),U=(n("/Crn"),n("P37N"),n("R2s5"));n("hz08");function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function K(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function W(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=z(e);if(t){var r=z(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Y(this,n)}}function Y(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Z=q.a.Option,X=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(c,e);var t,n,a,r=W(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).handleSubmit=function(e){e.preventDefault();var n=t.props.form.validateFieldsAndScroll,a=t.props,r=a.addMethod,o=a.protocolList,c=a.curApi;n((function(e,t){if(!e){console.log("Received values of form: ",t);var n=t.property,a=o&&o.find((function(e,t){return e.dataType===c.dataType})).list;t.propertyName=a.find((function(e){return e.property===n})).propertyName,r(t)}}))},t._getProductListHTML=function(){var e=t.props.productList;return e&&e.map((function(e,t){var n=e.productId,a=e.productName;return o.a.createElement(Z,{key:t,value:n},a)}))},t._getProtocolListHTML=function(){var e=t.props,n=e.protocolList;return(2===e.bindType?n&&n.filter((function(e,t){var n=e.dataType;return 3===n||8===n||20===n||27===n})):n&&n.filter((function(e,t){return 3===e.dataType}))).map((function(e,t){var n=e.dataType,a=e.dataTypeName;return o.a.createElement(Z,{key:t,value:n},a)}))},t._getCurProtocolListHTML=function(){var e=t.props,n=e.protocolList,a=e.curApi;if(0!==n.length&&a.dataType){var r=n&&n.find((function(e,t){return e.dataType===a.dataType})).list;return r&&r.map((function(e,t){var n=e.property,a=e.propertyName;return o.a.createElement(Z,{key:t,value:n},a)}))}},t}return t=c,(n=[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return o.a.createElement("div",{className:"add-method-form-wrapper"},o.a.createElement("div",{className:"title"},"添加方法"),o.a.createElement(U.a,J({},{labelCol:{span:3}},{className:"add-method-form"}),o.a.createElement("div",{className:"api-name"},o.a.createElement(U.a.Item,{label:"添加方法名称",wrapperCol:{span:10}},e("apiName",{rules:[{max:50,message:"最多可输入50个字符"},{required:!0,message:"请输入方法名称"}]})(o.a.createElement(H.a,{placeholder:"最多可输入50个字符"})))),o.a.createElement("div",{className:"select-wrapper"},o.a.createElement(M.a,{gutter:24},o.a.createElement(B.a,{span:8},o.a.createElement(U.a.Item,{label:"产品名称",labelCol:{span:9},wrapperCol:{span:15}},e("productId",{rules:[{required:!0,message:"请选择产品"}]})(o.a.createElement(q.a,{showSearch:!0,placeholder:"请选择产品",optionFilterProp:"children"},this._getProductListHTML())))),o.a.createElement(B.a,{span:8},o.a.createElement(U.a.Item,{label:"数据类型",labelCol:{span:9},wrapperCol:{span:15}},e("dataType",{rules:[{required:!0,message:"请选择数据类型"}]})(o.a.createElement(q.a,{showSearch:!0,placeholder:"请选择数据类型",optionFilterProp:"children"},this._getProtocolListHTML())))),o.a.createElement(B.a,{span:8})),o.a.createElement(M.a,{gutter:24},o.a.createElement(B.a,{span:8},o.a.createElement(U.a.Item,{label:"统计协议",labelCol:{span:9},wrapperCol:{span:15}},e("property",{rules:[{required:!0,message:"请选择统计协议"}]})(o.a.createElement(q.a,{showSearch:!0,placeholder:"请选择统计协议",optionFilterProp:"children"},this._getCurProtocolListHTML())))),o.a.createElement(B.a,{span:8},o.a.createElement(U.a.Item,{label:"统计精度",labelCol:{span:9},wrapperCol:{span:15}},e("reportFormsType",{rules:[{required:!0,message:"请选择统计精度"}]})(o.a.createElement(q.a,null,o.a.createElement(Z,{value:4},"1小时"),o.a.createElement(Z,{value:3},"1天"),o.a.createElement(Z,{value:2},"1月"),o.a.createElement(Z,{value:1},"1年"))))))),o.a.createElement("div",{className:"time-zone"},o.a.createElement(U.a.Item,{label:"时区",labelCol:{span:3},wrapperCol:{span:4}},e("cityTimeZone",{rules:[{required:!0,message:"请选择统计精度"}]})(o.a.createElement(q.a,null,o.a.createElement(Z,{value:8},"北京"))))),o.a.createElement("div",{className:"compute-rule"},o.a.createElement(U.a.Item,{label:"返回值计算规则："},e("ruleType",{rules:[{required:!0,message:"请选择计算规则"}]})(o.a.createElement(F.a.Group,null,o.a.createElement(F.a,{className:"radio-item",value:1},"平均值：y=（a1+a2+...+an）/n"),o.a.createElement(F.a,{className:"radio-item",value:2},"和：y= an+a（n-1）"),o.a.createElement("br",null),o.a.createElement(F.a,{className:"radio-item",value:3},"最大值：y=amax"),o.a.createElement(F.a,{className:"radio-item",value:4},"最小值：y=amin"))))),o.a.createElement("div",{className:"submit"},o.a.createElement(V.a,{type:"primary",htmlType:"submit",onClick:this.handleSubmit},"提交审核"))))}}])&&K(t.prototype,n),a&&K(t,a),c}(r.Component),$=U.a.create({name:"addMethod",onFieldsChange:function(e,t){console.log("changedFields",t),"{}"!==JSON.stringify(t)&&e.changeCurApi(t)},mapPropsToFields:function(e){for(var t=e.curApi,n={},a=0,r=Object.keys(t);a<r.length;a++){var o=r[a];n[o]=U.a.createFormField({value:t[o]})}return n}})(X);n("uu5+");function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=ce(e);if(t){var r=ce(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return oe(this,n)}}function oe(e,t){return!t||"object"!==ee(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ie,le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(c,e);var t,n,a,r=re(c);function c(){var e;te(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))).componentDidMount=function(){e.props.getCurApi(),e.props.getProductList()},e.changeCurApi=function(t){var n=Object.keys(t)[0],a=Object.values(t)[0];"productId"===n&&e.props.getProtocolListByProductId({productId:a.value}),e.props.changeCurApi(n,a.value)},e.addMethod=function(t){Object(j.c)(j.a.addMethod,t).then((function(t){if(0===t.code){var n=e.props.history;Object(k.a)({type:"success",description:"新增统计方法成功"}),n.replace({pathname:"open/bigData/customMethod"})}}))},e}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.curApi,a=t.productList,r=t.bindType,c=t.protocolList;return o.a.createElement("div",{className:"add-method-wrapper"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:"自定义统计方法"}),o.a.createElement("div",{className:"add-content-wrapper"},o.a.createElement($,{curApi:n,productList:a,protocolList:c,bindType:r,changeCurApi:this.changeCurApi,addMethod:this.addMethod})))}}])&&ne(t.prototype,n),a&&ne(t,a),c}(r.PureComponent),ue=Object(u.b)((function(e){return{curApi:e.getIn(["customMethod","curApi"]).toJS(),productList:e.getIn(["customMethod","productList"]).toJS(),protocolList:e.getIn(["customMethod","protocolList"]).toJS(),bindType:e.getIn(["customMethod","bindType"])}}),(function(e){return{getCurApi:function(){var t=I.a.getCurApi();e(t)},getProductList:function(){var t=I.a.getProductList();e(t)},getProtocolListByProductId:function(t){var n=I.a.getProtocolListByProductId(t);e(n)},changeCurApi:function(t,n){var a=I.a.changeCurApi(t,n);e(a)}}}))(le);n("GuBy");function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=be(e);if(t){var r=be(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ye(this,n)}}function ye(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function be(e){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var he=Object(c.i)(ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(c,e);var t,n,a,r=me(c);function c(){var e;pe(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))).componentDidMount=function(){console.log("this.props.match.params",e.props.match.params);var t=e.props.match.params.apiId;e.props.getCurApi(t)},e.ruleType=function(e){return 1===e?o.a.createElement("span",null,"取平均值：y=（a",o.a.createElement("sub",null,"1"),"+a",o.a.createElement("sub",null,"2"),"+...+a",o.a.createElement("sub",null,"n"),"）/n"):2===e?o.a.createElement("span",null,"取和：y= a",o.a.createElement("sub",null,"n"),"+a",o.a.createElement("sub",null,"（n-1）")):3===e?o.a.createElement("span",null,"取最大值：y=a",o.a.createElement("sub",null,"max")):4===e?o.a.createElement("span",null,"取最小值：y=a",o.a.createElement("sub",null,"min")):o.a.createElement("span",null,"加载中...")},e}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.props.curApi,n="",a="";switch(t.get("dataType")){case 3:n="运行数据";break;case 8:n="历史运行";break;case 20:n="历史控制";break;case 27:n="状态数据"}switch(t.get("reportFormsType")){case 1:a="1年";break;case 2:a="1月";break;case 3:a="1天";break;case 4:a="1小时"}return o.a.createElement("div",{className:"detail-method-wrapper"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:"自定义统计方法/查看"}),o.a.createElement("div",{className:"detail-content-wrapper"},o.a.createElement("div",{className:"detail-content"},o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"统计名称："),o.a.createElement("span",{className:"value"},t.get("apiName"))),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"产品名称："),o.a.createElement("span",{className:"value"},t.get("productName"))),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},n,"："),o.a.createElement("span",{className:"value"},"".concat(t.get("propertyName")||"","-").concat(t.get("property")))),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"统计精度："),o.a.createElement("span",{className:"value"},a)),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"时区："),o.a.createElement("span",{className:"value"},t.get("cityTimeZone")?t.get("cityTimeZone"):"北京")),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"计算规则："),o.a.createElement("span",{className:"value"},this.ruleType(t.get("ruleType"))))))))}}])&&fe(t.prototype,n),a&&fe(t,a),c}(r.PureComponent))||ie,ve=Object(u.b)((function(e){return{curApi:e.getIn(["customMethod","curApi"])}}),(function(e){return{getCurApi:function(t){var n=I.a.getCurApi(t);e(n)}}}))(he);var ge=function(e){var t=e.match.path;return o.a.createElement(c.e,null,o.a.createElement(c.c,{path:"".concat(t,"/list"),component:A}),o.a.createElement(c.c,{path:"".concat(t,"/add"),component:ue}),o.a.createElement(c.c,{path:"".concat(t,"/detail/:apiId"),component:ve}),o.a.createElement(c.b,{to:"".concat(t,"/list")}))},Ee=(n("4dS9"),n("vV4J"),n("RfWx"),n("yqJg"));n("RdJM");function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){Ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function je(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Pe(e,t){return(Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Te(e);if(t){var r=Te(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ke(this,n)}}function ke(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xe={pageRows:10,pageIndex:1},Ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}(c,e);var t,n,a,r=De(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).componentDidMount=function(){t._getDataSubscriptionList(xe)},t.onChange=function(e){t._getDataSubscriptionList(Se(Se({},xe),{},{pageIndex:e}))},t.showActionConfirm=function(e,n){t.setState((function(t){return{showActionDialog:!t.showActionDialog,curSubscriptionId:e,dialogType:n}}))},t.updateOkHandle=function(){var e=t.state,n=e.curSubscriptionId,a=e.dialogType;t._SubscriptionAction(n,a)},t.updateCancelHandle=function(){t.setState((function(e){return{showActionDialog:!e.showActionDialog,dialogType:""}}))},t._getDataSubscriptionList=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(j.c)(j.a.getDataSubscriptionList,Se(Se({},e),{},{version:"1.1"}),{loading:n}).then((function(e){var n=e.code,a=e.data;n===Ee.a&&t.setState((function(){return{dataSubscription:a}}))}))},t._SubscriptionAction=function(e,n){Object(j.c)("stop"===n?j.a.stopCurSubscription:j.a.enabledCurSubscription,{urlConfId:Number(e)},{loading:!0}).then((function(e){e.code===Ee.a&&t.setState((function(e){return{showActionDialog:!e.showActionDialog,dialogType:""}}),(function(){Object(k.a)({type:"success",description:"stop"===n?"停用数据订阅成功":"启用数据订阅成功"}),t._getDataSubscriptionList(xe,!1)}))}))},t._getAntDDataSubscriptionListData=function(){var e=t.state.dataSubscription.list;return e.forEach((function(e,t){e.key=e.urlConfId})),{dataSubscriptionList:e,columns:[{title:"订阅ID",dataIndex:"urlConfId",key:"urlConfId"},{title:"订阅形式",dataIndex:"pushWay",key:"pushWay",render:function(e){return{0:"API数据PUSH形式",1:"MQTT主题订阅"}[e]||"--"}},{title:"订阅创建时间",dataIndex:"createTime",key:"createTime",render:function(e){return P.a.utcToDev(e)}},{title:"订阅更新时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return P.a.utcToDev(e)}},{title:"状态",dataIndex:"pushState",key:"pushState",render:function(e){var t={color:"#FF2E00",marginRight:"10px"},n="停用";return 0===e?(t.color="#FF2E00",n="停用"):1===e?(t.color="#00B72E",n="正常"):(t.color="#FF2E00",n="锁定"),o.a.createElement("div",null,o.a.createElement("span",{style:t},"●"),o.a.createElement("span",null,n))}},{title:"操作",key:"opt",render:function(e,n){return o.a.createElement("span",null,o.a.createElement(S.b,{key:"detail",to:"/open/bigData/dataSubscription/detail/"+n.key},"查看"),o.a.createElement(w.a,{type:"vertical"}),o.a.createElement("a",{href:"javascript:",onClick:function(){return t.editSubscription(n.key)}},"编辑"),o.a.createElement(w.a,{type:"vertical"}),o.a.createElement("a",{href:"javascript:",onClick:function(){return t.showActionConfirm(n.key,0!==n.pushState?"stop":"start")}},0!==n.pushState?"停用":"启用"))}}]}},t.editSubscription=function(e){var n=t.props.history;Object(j.c)(j.a.getCurSubscription,{urlConfId:Number(e),version:"1.1"},{loading:!0}).then((function(e){var t=e.code,a=e.data;if(t===Ee.a){var r=a.urlConfId,o=a.productId,c=a.productName,i=a.deviceLabelIds;n.push({pathname:"/open/bigData/dataSubscription/edit/"+r,state:{urlConfId:r,productId:{dirty:!1,errors:void 0,name:"productId",touched:!0,validating:!1,value:{key:o,label:c}},labelOrDevice:{dirty:!1,errors:void 0,name:"labelOrDevice",touched:!0,validating:!1,value:i?0:1},deviceLabelIds:i}})}}))},t.addSubscription=function(){var e=t.props.history,n=t.state.dataSubscription,a=n.devicePushConfMaxNum;n.currentNum>=a?Object(k.a)({description:"最多只能创建".concat(a,"个订阅")}):e.push({pathname:"/open/bigData/dataSubscription/add"})},t.state={dataSubscription:{list:[],pager:{}},showActionDialog:!1,curSubscriptionId:"",dialogType:""},t}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.state,n=t.dataSubscription,a=t.showActionDialog,r=t.curSubscriptionId,c=t.dialogType,l=n.pager,u=this._getAntDDataSubscriptionListData(),s=u.dataSubscriptionList,f=u.columns;return o.a.createElement("div",{className:"subscription-list-wrapper flex-column"},o.a.createElement(p.a,{btnClickHandle:this.addSubscription,noback:!0,needBtn:!0,btnText:"新增订阅",title:"数据订阅"}),o.a.createElement("div",{className:"subscription-list-content-wrapper flex1"},o.a.createElement("div",{className:"subscription-list-content"},o.a.createElement(i.a,{className:"content",dataSource:s,columns:f,pagination:{onChange:this.onChange,defaultCurrent:1,current:l.pageIndex,pageSize:l.pageRows,total:l.totalRows,showQuickJumper:!0}}))),a&&o.a.createElement(D.a,{visible:a,modalOKHandle:function(){return e.updateOkHandle()},modalCancelHandle:function(){return e.updateCancelHandle()},targetName:r,title:"stop"===c?"停用":"启用",descText:"即将".concat("stop"===c?"停用":"启用","订阅ID"),descGray:!0,needWarnIcon:"stop"===c,tipText:"stop"===c?"停用之后不可使用，确认要停用吗？":"建议进入编辑确认是否是最新订阅内容和形式。"}))}}])&&je(t.prototype,n),a&&je(t,a),c}(r.PureComponent),Ce=n("CvKH"),Le=n.n(Ce),_e=(n("sSxo"),n("JiFE"),n("DBxd"),n("sQtw"));function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){Fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(){return(Me=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function He(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Je(e);if(t){var r=Je(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ge(this,n)}}function Ge(e,t){return!t||"object"!==Re(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Je(e){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ke=q.a.Option,Qe=(_e.a.Group,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(c,e);var t,n,a,r=Ue(c);function c(){var e;Be(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))).handleSubmit=function(t){t.preventDefault();var n=e.props.form.validateFieldsAndScroll,a=e.props,r=a.changeCurrent,o=a.getProtocolListByProductId,c=a.subscriptionObjectForm,i=a.labelList,l=(c.checkedList,c.labelOrDevice);n((function(e,t){if(!e){if(console.log("Received values of form: ",t),0===l.value){var n=0;if(i.forEach((function(e){e.checked&&n++})),i.length>0&&n<=0)return void Object(k.a)({description:"请选择设备标签"});if(0===i.length)return void Object(k.a)({description:"暂无标签，请选择全量设备进行订阅"})}r("next"),o(c.productId.value.key,"1.2")}}))},e.getLabelByProductId=function(t){(0,e.props.getLabelByProductId)(t)},e._getProductListHTML=function(){var t=e.props.productList;return t&&t.map((function(e,t){var n=e.productId,a=e.productName;return o.a.createElement(Ke,{key:n,value:n},a)}))},e.choiceLabel=function(t){(0,e.props.choiceLabel)(t)},e._getLabelListHTML=function(t){return t.map((function(t,n){var a=t.checked,r=t.labelKey,c=t.labelValue;return o.a.createElement("div",{key:n,className:"label-item ".concat(a&&"active-label"),onClick:function(){return e.choiceLabel(n)}},r,"-",c)}))},e}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props,t=e.form,n=e.subscriptionObjectForm,a=(e.labelListPlains,e.labelList),r=n.indeterminate,c=n.checkAll,i=n.labelOrDevice,l=t.getFieldDecorator;return o.a.createElement("div",{className:"first-content"},o.a.createElement(U.a,Me({},{labelCol:{span:3},wrapperCol:{span:21}},{className:"subscription-object-form"}),o.a.createElement(U.a.Item,{label:"选择产品",wrapperCol:{span:6},className:"product-select"},l("productId",{rules:[{required:!0,message:"请选择产品"}]})(o.a.createElement(q.a,{showSearch:!0,labelInValue:!0,placeholder:"请选择产品",optionFilterProp:"children",onChange:this.getLabelByProductId},this._getProductListHTML()))),o.a.createElement(U.a.Item,{label:"选择设备"},l("labelOrDevice",{rules:[{required:!0,message:"请选择设备"}]})(o.a.createElement(F.a.Group,null,o.a.createElement(F.a,{value:1},"全部设备"),o.a.createElement(F.a,{value:0},"根据标签筛选设备")))),o.a.createElement(M.a,{gutter:8,align:"middle"},o.a.createElement(B.a,{span:3,className:"product-label"}),0===i.value?a.length>0?o.a.createElement(B.a,{style:{padding:"24px"},span:20,className:"remarks"},o.a.createElement(U.a.Item,{label:"",colon:!1,labelCol:{span:0}},l("checkAll")(o.a.createElement(_e.a,{indeterminate:r.value,checked:c.value},"全部标签"))),o.a.createElement(U.a.Item,{label:"",colon:!1,labelCol:{span:0}},o.a.createElement("div",{className:"label-wrapper"},this._getLabelListHTML(a)))):o.a.createElement("div",{className:"label-desc"},"暂无标签，请选择全量设备进行订阅"):o.a.createElement(B.a,{span:20},o.a.createElement("div",{className:"label-desc"},"备注：选择全量设备，则订阅产品下截止目前的所有激活的设备。")))))}}])&&He(t.prototype,n),a&&He(t,a),c}(r.Component)),We=U.a.create({name:"subscriptionObject",onFieldsChange:function(e,t){console.log("changedFields",t),"{}"!==JSON.stringify(t)&&e.changeFormData("subscriptionObjectForm",t)},mapPropsToFields:function(e){for(var t=e.subscriptionObjectForm,n={},a=0,r=Object.keys(t);a<r.length;a++){var o=r[a];n[o]=U.a.createFormField(Ve(Ve({},t[o]),{},{value:t[o].value}))}return n}})(Qe);function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ze(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=tt(e);if(t){var r=tt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return et(this,n)}}function et(e,t){return!t||"object"!==Ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var nt=l.a.TabPane,at=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(c,e);var t,n,a,r=$e(c);function c(){var e;ze(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))).handleSubmit=function(t){t.preventDefault();var n=e.props.form.validateFieldsAndScroll,a=e.props,r=a.changeCurrent,o=a.devicePushDataConfList;n((function(e,t){if(!e){console.log("Received values of form: ",t);var n=!1;if(o&&o.forEach((function(e){e.selectedProtocolRowKeys.length>0&&(n=!0)})),!n)return void Object(k.a)({description:"请至少选择一条协议"});r("next")}}))},e._getAntDProtocolListData=function(t,n){var a=e.props,r=a.devicePushDataConfList,o=a.onSelectChange,c=r.find((function(e){return e.dataType===n})),i=[];c&&(i=c.selectedProtocolRowKeys);var l=[];t.forEach((function(e){var t=e.property,n=e.bitDefList;t?l.push(e):n&&n.length>0&&n.forEach((function(e){e.property&&l.push(e)}))})),l.forEach((function(e){e.key=e.property}));return{rowSelection:{selectedRowKeys:i,onChange:function(e){return o(e,n)},hideDefaultSelections:!0,selections:!0},antDProtocolList:l,columns:[{title:"数据名称",dataIndex:"propertyName",key:"propertyName"},{title:"数据标志",dataIndex:"property",key:"property"},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"}]}},e._getAntDTabs=function(){var t=e.props.protocolList;return t&&t.map((function(t){var n=t.dataType,a=t.dataTypeName,r=t.list,c=e._getAntDProtocolListData(r,n),l=c.rowSelection,u=c.antDProtocolList,s=c.columns;return o.a.createElement(nt,{className:"",tab:a,key:n},o.a.createElement(i.a,{rowSelection:l,dataSource:u,columns:s,pagination:!1}))}))},e}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props.productName;return o.a.createElement("div",{className:"second-content"},o.a.createElement("div",{className:"product-name"},o.a.createElement("span",null,"已选择产品："),o.a.createElement("span",null,e)),o.a.createElement("div",{className:"protocol-type clearfix"},o.a.createElement("span",{className:"protocol-type-label"},"请选择协议类型："),o.a.createElement(l.a,{type:"card",className:"protocol-type-content",defaultActiveKey:"1"},this._getAntDTabs())))}}])&&Ze(t.prototype,n),a&&Ze(t,a),c}(r.Component),rt=U.a.create({name:"subscriptionContent"})(at);function ot(e){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(n),!0).forEach((function(t){lt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ut(){return(ut=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function st(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=yt(e);if(t){var r=yt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return mt(this,n)}}function mt(e,t){return!t||"object"!==ot(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yt(e){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(c,e);var t,n,a,r=dt(c);function c(){var e;st(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))).handleSubmit=function(t){t.preventDefault();var n=e.props.form.validateFieldsAndScroll,a=e.props.createSubscription;n((function(e,t){e||a()}))},e}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props,t=e.form,n=e.subscriptionWayForm,a=t.getFieldDecorator,r=n.pushWay;return o.a.createElement("div",{className:"third-content"},o.a.createElement(U.a,ut({},{labelCol:{span:2},wrapperCol:{span:22}},{className:"subscription-way-form"}),o.a.createElement(U.a.Item,{label:"订阅方式"},a("pushWay",{rules:[{required:!0,message:"请选择订阅方式"}]})(o.a.createElement(F.a.Group,null,o.a.createElement(F.a,{value:0},"API数据PUSH形式"),o.a.createElement(F.a,{value:1},"MQTT主题订阅")))),0===r.value&&o.a.createElement(U.a.Item,{label:"数据订阅URL"},a("url",{rules:[{required:!0,message:"请输入数据订阅服务器的URL"}]})(o.a.createElement(H.a,{placeholder:"请输入数据订阅服务器的URL",style:{width:"calc(70%)"}})),o.a.createElement("div",{className:"url-desc"},"第三方云服务接口的惟一标识，供C-Life云推送服务给第三方云推送数据用的，现仅支持http方式。")),0===r.value&&o.a.createElement(U.a.Item,{label:"Token"},a("pushToken",{rules:[{required:!0,message:"填写验证token"}]})(o.a.createElement(H.a,{placeholder:"填写验证token",style:{width:"calc(70%)"}})),o.a.createElement("div",{className:"token-desc"},"第三方云服务接口对接C-Life云推送服务的凭证，用来验证厂商服务接口的合法性。"))))}}])&&pt(t.prototype,n),a&&pt(t,a),c}(r.Component),ht=U.a.create({name:"subscriptionWay",onFieldsChange:function(e,t){"{}"!==JSON.stringify(t)&&e.changeFormData("subscriptionWayForm",t)},mapPropsToFields:function(e){for(var t=e.subscriptionWayForm,n={},a=0,r=Object.keys(t);a<r.length;a++){var o=r[a];n[o]=U.a.createFormField(it(it({},t[o]),{},{value:t[o].value}))}return n}})(bt),vt=n("v7xx");n("KfNE");function gt(e){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(){return(Et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){St(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function It(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=kt(e);if(t){var r=kt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Dt(this,n)}}function Dt(e,t){return!t||"object"!==gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function kt(e){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Tt,xt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(c,e);var t,n,a,r=Pt(c);function c(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).onSelectChange=function(e,n){t.setState((function(t){var a=t.devicePushDataConfList,r=a.findIndex((function(e){return e.dataType===n}));return-1===r?a.push({dataType:n,selectedProtocolRowKeys:e}):a[r]={dataType:n,selectedProtocolRowKeys:e},{devicePushDataConfList:a}}))},t._getProductByDeveloperId=function(){Object(j.c)(j.a.getProductByDeveloperId,{version:"1.1"},{loading:!0}).then((function(e){var n=e.code,a=e.data;n===Ee.a&&t.setState((function(){return{productList:a}}))}))},t.choiceLabel=function(e){t.setState((function(t){var n=t.subscriptionObjectForm,a=t.labelList;a[e].checked=!a[e].checked;var r=!0,o=0;return a.forEach((function(e){e.checked?o++:r=!1})),{labelList:a,subscriptionObjectForm:wt(wt({},n),{},{indeterminate:{value:o&&o<a.length},checkAll:{value:r}})}}))},t.changeFormData=function(e,n){t.setState((function(){var a,r=t.state[e],o=Object.keys(n),c=Object.values(n),i=o[0],l=c[0],u=t.state,s=u.labelListPlains,p=u.labelList,f=St({},e,wt(wt({},r),n));"checkAll"===i&&1===o.length?(p.forEach((function(e){e.checked=l.value})),St(a={},e,wt(wt({},f[e]),{},{indeterminate:{value:!1},checkedList:{value:l.value?s:[]}})),St(a,"labelList",p),f=a):"checkedList"===i&&1===o.length?f=St({},e,wt(wt({},f[e]),{},{indeterminate:{value:!!l.value.length&&l.value.length<s.length},checkAll:{value:l.value.length===s.length}})):"pushWay"===i&&1===o.length&&(f=St({},e,wt(wt({},f[e]),{},{url:{value:void 0},pushToken:{value:void 0}})));return f}))},t.getProtocolListByProductId=function(e,n){Object(j.c)(j.a.getProtocolListByProductId,{productId:e,version:n},{loading:!0}).then((function(e){var n=e.code,a=e.data;n===Ee.a&&t.setState((function(){return{protocolList:a.list}}))}))},t.getLabelByProductId=function(e){t.setState((function(t){var n=t.subscriptionObjectForm;return n.checkedList={value:[]},n.indeterminate={value:!1},n.checkAll={value:!1},t.devicePushDataConfList=[],{productName:e.label}}),(function(){Object(j.c)(j.a.getLabelByProductId,{productId:Number(e.key),version:"1.1"},{loading:!0}).then((function(e){var n=e.code,a=e.data;if(n===Ee.a){var r=a&&a.map((function(e){return"".concat(e.labelId,"-").concat(e.labelKey,"-").concat(e.labelValue)}));t.setState((function(){return{labelList:a||[],labelListPlains:r||[]}}))}}))}))},t.changeCurrent=function(e){t.setState((function(t){return{current:"next"===e?t.current+1:t.current-1}}))},t.goToNextStep=function(e,n){t[e].handleSubmit(n)},t.goToPreStep=function(){t.changeCurrent("pre")},t._getDataTypeScope=function(e,n){var a=t.state.protocolList,r=a&&a.find((function(t){return t.dataType===e})),o=r?r.list:[],c=0;return 0===o.length||0===n.length||(n.length===o.length?c=1:n.length<o.length&&(c=2)),c},t._getDeviceLabelId=function(){var e=t.state.labelList,n="";return e.forEach((function(e){e.checked&&(n+=e.labelId+",")})),n.substr(0,n.length-1)},t.createSubscription=function(){var e=t.state,n=e.subscriptionObjectForm,a=e.subscriptionWayForm,r=e.devicePushDataConfList,o=e.isEdit,c=Le()(r),i=n.labelOrDevice;c.forEach((function(e){var n=e.selectedProtocolRowKeys,a=e.dataType;e.dataTypeScope=t._getDataTypeScope(a,n),n&&(e.protocolProperty=n.join(",")),e.dataFormat=1,delete e.selectedProtocolRowKeys}));var l={deviceLabelIds:t._getDeviceLabelId(),devicePushDataConfList:c,pushWay:Number(a.pushWay.value)};1===i.value&&delete l.deviceLabelIds,n.productId.value.key&&(l.productId=Number(n.productId.value.key)),a.url.value&&(l.url=a.url.value),a.pushToken.value&&(l.pushToken=a.pushToken.value),o&&(l.urlConfId=o),Object(j.d)(o?j.a.saveSubscription:j.a.createSubscription,wt({},l),{loading:!0,needJson:!0,noInstance:!0}).then((function(e){var n=t.props.history;e.code===Ee.a&&(Object(k.a)({type:"success",description:o?"订阅编辑成功！":"订阅生成成功！"}),n.replace({pathname:"/open/bigData/dataSubscription"}))}))};var n=t.props.location.state,a=void 0===n?{}:n,o=a.urlConfId,i=a.productId,l=a.labelOrDevice,u=a.deviceLabelIds;return console.log("DataSubscriptionAdd -> constructor -> state",a),t.state={subscriptionObjectForm:{productId:i||{value:void 0},checkedList:{value:[]},indeterminate:{value:!1},checkAll:{value:!1},labelOrDevice:l||{value:1}},subscriptionWayForm:{pushWay:{value:0},url:{value:void 0},pushToken:{value:void 0}},productName:"",productList:[],labelList:[],labelListPlains:[],protocolList:[],devicePushDataConfList:[],current:0,isEdit:o},u&&Object(j.c)(j.a.getLabelByProductId,{productId:Number(i.value.key),version:"1.1"},{loading:!0}).then((function(e){var n=e.code,a=e.data;if(n===Ee.a){var r=a&&a.map((function(e){return"".concat(e.labelId,"-").concat(e.labelKey,"-").concat(e.labelValue)})),o=u.split(",");a&&a.map((function(e){var t=e.labelId;o.indexOf(""+t)&&(e.checked=!0)})),t.setState((function(){return{labelList:a||[],labelListPlains:r||[]}}))}})),t}return t=c,(n=[{key:"componentDidMount",value:function(){this._getProductByDeveloperId()}},{key:"_getCurStepContent",value:function(){var e=this;return[{title:"配置订阅对象",content:o.a.createElement(We,Et({onRef:function(t){return e.subscriptionObjectForm=t},changeFormData:this.changeFormData,getLabelByProductId:this.getLabelByProductId,changeCurrent:this.changeCurrent,getProtocolListByProductId:this.getProtocolListByProductId,choiceLabel:this.choiceLabel},this.state))},{title:"配置订阅内容",content:o.a.createElement(rt,Et({onRef:function(t){return e.subscriptionContentForm=t},changeFormData:this.changeFormData,changeCurrent:this.changeCurrent,onSelectChange:this.onSelectChange},this.state))},{title:"配置订阅方式",content:o.a.createElement(ht,Et({changeFormData:this.changeFormData,createSubscription:this.createSubscription,onRef:function(t){return e.subscriptionWayForm=t}},this.state))}]}},{key:"render",value:function(){var e=this,t=this.state,n=t.current,a=t.isEdit,r=this._getCurStepContent();return o.a.createElement("div",{className:"subscription-add-page-wrapper flex-column"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:a?"订阅编辑":"新增订阅"}),o.a.createElement("div",{className:"step-header-wrapper"},o.a.createElement("div",{className:"step-header flex-row"},o.a.createElement("div",{className:"step-item flex-row flex1 ".concat(0===n&&"current-step")},o.a.createElement("i",{className:"step-product"}),o.a.createElement("span",null,"1. 选择订阅产品")),o.a.createElement("div",{className:"step-item flex1 flex-row ".concat(1===n&&"current-step")},o.a.createElement("i",{className:"step-data"}),o.a.createElement("span",null,"2. 选择订阅数据")),o.a.createElement("div",{className:"step-item flex1 flex-row ".concat(2===n&&"current-step")},o.a.createElement("i",{className:"step-way"}),o.a.createElement("span",null,"3. 选择订阅方式")))),o.a.createElement("div",{className:"add-content-wrapper flex1"},o.a.createElement("div",{className:"add-content"},o.a.createElement("div",{className:"steps-content"},r[n].content),o.a.createElement("div",{className:"steps-action"},0===n&&o.a.createElement(vt.a,{preBtn:!1,nextHandle:function(t){return e.goToNextStep("subscriptionObjectForm",t)}}),0!==n&&n<r.length-1&&o.a.createElement(vt.a,{preHandle:this.goToPreStep,nextHandle:function(t){return e.goToNextStep("subscriptionContentForm",t)}}),n===r.length-1&&o.a.createElement(vt.a,{nextText:"提交",preHandle:this.goToPreStep,nextHandle:function(t){return e.goToNextStep("subscriptionWayForm",t)}})))))}}])&&It(t.prototype,n),a&&It(t,a),c}(r.Component);n("94rQ");function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=At(e);if(t){var r=At(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Rt(this,n)}}function Rt(e,t){return!t||"object"!==Nt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Vt=Object(c.i)(Tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(c,e);var t,n,a,r=_t(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).componentDidMount=function(){var e=t.props.match.params.urlConfId;t._getCurSubscription(e)},t._getCurSubscription=function(e){Object(j.c)(j.a.getCurSubscription,{urlConfId:Number(e),version:"1.1"},{loading:!0}).then((function(e){var n=e.code,a=e.data;n===Ee.a&&t.setState((function(){return{curSubscription:a}}))}))},t._getProtocol=function(e){var t=e&&e.map((function(e,t){var n=e.dataType,a=e.protocolProperty,r="";switch(n){case 2:r="控制数据";break;case 3:r="运行数据";break;case 4:r="故障数据"}return o.a.createElement("div",{className:"protocol-type",key:t},o.a.createElement("div",{className:"protocol-type-name"},r),o.a.createElement("div",{className:"protocol-type-list clearfix"},a&&a.split(",").map((function(e,t){return o.a.createElement("div",{key:t,className:"protocol-type-list-item fl"},e)}))))}));return o.a.createElement("div",{className:"protocol-wrapper"},t)},t._editProtocol=function(){var e=t.state.curSubscription,n=t.props.history,a=e.urlConfId,r=e.productId,o=e.productName,c=e.deviceLabelIds;a&&n.push({pathname:"/open/bigData/dataSubscription/edit/"+a,state:{urlConfId:a,productId:{dirty:!1,errors:void 0,name:"productId",touched:!0,validating:!1,value:{key:r,label:o}},labelOrDevice:{dirty:!1,errors:void 0,name:"labelOrDevice",touched:!0,validating:!1,value:c?0:1},deviceLabelIds:c}})},t.state={curSubscription:{}},t}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.state.curSubscription,n=t.pushWay,a=t.pushState,r=t.createTime,c=t.updateTime,i=t.productName,l=t.labelVoList,u=t.devicePushDataConfList,s=t.pushToken,f=t.url,d=l&&l.map((function(e,t){return o.a.createElement("div",{key:t,className:"label-item fl"},e.labelValue)})),m={color:"#00B72E"},y="正常";return 0===a?(m={color:"#FF2E00"},y="停用"):1===a||(m={color:"#FF2E00"},y="锁定"),o.a.createElement("div",{className:"detail-subscription-wrapper flex-column"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:"订阅详情"}),o.a.createElement("div",{className:"detail-content-wrapper flex1"},o.a.createElement("div",{className:"detail-content"},o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"订阅方式："),o.a.createElement(B.a,{span:10,className:"detail-right"},0==n?"API数据PUSH形式":"MQTT主题订阅")),o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"订阅状态："),o.a.createElement(B.a,{span:10,style:m,className:"detail-right"},y)),o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"创建时间："),o.a.createElement(B.a,{span:10,className:"detail-right"},P.a.pekingToStr(r))),o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"更新时间："),o.a.createElement(B.a,{span:10,className:"detail-right"},P.a.pekingToStr(c))),o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"订阅产品："),o.a.createElement(B.a,{span:10,className:"detail-right"},i)),0===n&&o.a.createElement(o.a.Fragment,null,o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"数据订阅Url："),o.a.createElement(B.a,{span:10,className:"detail-right"},f)),o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"token："),o.a.createElement(B.a,{span:10,className:"detail-right"},s))),o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left product-label"},"产品标签："),o.a.createElement(B.a,{span:22,className:"detail-right"},d)),o.a.createElement(M.a,{gutter:8,className:"detail-line"},o.a.createElement(B.a,{span:3,className:"detail-left"},"订阅数据："),o.a.createElement(B.a,{span:22,className:"detail-right"},this._getProtocol(u))),o.a.createElement("div",{className:"edit-wrapper"},o.a.createElement(V.a,{onClick:this._editProtocol,type:"primary"},"编辑")))))}}])&&Ct(t.prototype,n),a&&Ct(t,a),c}(r.PureComponent))||Tt;var Ft=function(e){var t=e.match.path;return console.log("DataSubscription -> path",t),o.a.createElement(c.e,null,o.a.createElement(c.c,{path:"".concat(t,"/list"),component:Ne}),o.a.createElement(c.c,{path:"".concat(t,"/add"),component:xt}),o.a.createElement(c.c,{path:"".concat(t,"/edit/:urlConfId"),component:xt}),o.a.createElement(c.c,{path:"".concat(t,"/detail/:urlConfId"),component:Vt}),o.a.createElement(c.b,{to:"".concat(t,"/list")}))},Mt=(n("twYR"),n("FtIr")),Bt=(n("UTJx"),n("dVdO")),Ht=(n("qgAm"),n("9b3Y"),n("Ck9u"),n("Mh49"),n("g2Te")),qt=(n("SeTJ"),n("9iNK")),Ut=n("rVDo"),Gt=n("rwTb"),Jt=[{id:1,nam:"模组固件"},{id:2,nam:"MCU固件"},{id:4,nam:"系统固件"}],Kt=[{nam:"待验证",color:"blue"},{nam:"验证中",color:"gold"},{nam:"已发布",color:"green"},{nam:"验证完成",color:"lime"}],Qt=[{nam:"待升级",color:"blue"},{nam:"升级中",color:"gold"},{nam:"升级成功",color:"green"},{nam:"升级失败",color:"magenta"},{nam:"取消",color:"geekblue"},{nam:"下载结束",color:"geekblue"},{nam:"重置升级",color:"geekblue"}],Wt=[{value:1,label:"模组固件",children:[{value:1,label:"bootLoader"},{value:2,label:"servicePack"},{value:3,label:"hetProtocol"}]},{value:2,label:"MCU固件",children:[{value:1,label:"controlboard"},{value:2,label:"displayboard"},{value:3,label:"driveboard"}]},{value:4,label:"系统固件",children:[{value:1,label:"Android系统"},{value:2,label:"Linux系统"}]}],Yt={strextVer:/^[a-zA-Z0-9_\-\.]{1,30}$/,verNam:/^[a-zA-Z0-9\u4e00-\u9fa5][a-zA-Z0-9_\u4e00-\u9fa5]{0,39}$/,mainVer:/^[0-9]*$/,url:/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/},zt=[{id:1,nam:"普通升级",desc:"用户可感知，升级触发时用户可以在app上查看到升级提醒，确认后才能升级"},{id:2,nam:"强制升级",desc:"用户可感知，在app上查看到升级提示，无需确认自动开始升级"},{id:3,nam:"静默升级",desc:"用户无感知，无需确认，设备主动请求升级"},{id:4,nam:"推送升级",desc:"用户无感知，无需确认，平台主动推送下发升级到设备（需配置升级策略）"}],Zt=[{id:0,nam:"全部设备"},{id:1,nam:"设备分组"},{id:2,nam:"指定设备"}],Xt=[{id:0,nam:"不重试"},{id:1,nam:"30分钟后"},{id:2,nam:"1小时后"}],$t=[{id:1,nam:"1 次"},{id:2,nam:"2 次"},{id:3,nam:"3 次"}],en=["触发升级","定时升级"],tn=["整包","差分包"],nn=["升级中","已完成"],an=n("+vmU");function rn(e){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function on(){return(on=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cn(Object(n),!0).forEach((function(t){un(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,o=[],c=!0,i=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);c=!0);}catch(e){i=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(i)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function fn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=bn(e);if(t){var r=bn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return yn(this,n)}}function yn(e,t){return!t||"object"!==rn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bn(e){return(bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var hn=q.a.Option,vn={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:15}}},gn=U.a.create({name:"addFirmwareDialog"})(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(c,e);var t,n,a,r=mn(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).handleSubmit=function(){var e=t.props,n=e.form.validateFieldsAndScroll,a=e.changeState;n((function(e,n){var r=sn(n.verType,2),o=r[0],c=r[1];if(delete n.verType,!e){var i=ln(ln({},n),{},{deviceVersionType:o,firmwareVersionType:c});if(0==t.state.uploadType){var l=t.addFirmwareInput.getFileListUrl().length>0?t.addFirmwareInput.getFileListUrl().join(","):"";if(!l)return Object(k.a)({description:"请上传固件程序"}),!1;i.filePath=l}Object(j.d)(j.a.otaAddVersion,i,{needFormData:!0,needVersion:1.1,loading:!0}).then((function(e){t.resetForm(),t.props.getVersionLi(),a("addFirmwareDialog",!1)}))}}))},t.resetForm=function(){t.props.form.resetFields(),t.addFirmwareInput.setState({fileList:[]})},t.changePackType=function(e){var n=e.target.value;t.setState({packType:n},(function(){t.getExtVersion()}))},t.uploadType=function(e){var n=e.target.value;t.setState({uploadType:n})},t.getExtVersion=function(){if(0!=t.state.packType){var e=t.props.form.getFieldValue,n=e("productId"),a=e("totalVersion"),r=e("verType")||[],o=sn(r,2),c=o[0],i=o[1];n&&a&&2==r.length?t.props.getExtVerLi({productId:n,totalVersion:a,deviceVersionType:c,firmwareVersionType:i}):t.props.getExtVerLi()}},t.checkMainVersion=function(e,t,n){+t>2147483647?n("最大不能超过数值2147483647"):n()},t.state={packType:0,uploadType:0},t}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this,t=this.props,n=t.form.getFieldDecorator,a=t.productList,r=t.extVerisonLi,c=this.state,i=c.packType,l=c.uploadType;return o.a.createElement(U.a,on({},vn,{className:"ota_add_firmware_dialog"}),o.a.createElement(U.a.Item,{label:o.a.createElement(Gt.a,{label:"包类型",tip:"可选择整体升级包，或者差分包进行升级。"})},n("packageType",{rules:[{required:!0,message:"请选择包类型"}],initialValue:0})(o.a.createElement(F.a.Group,{onChange:this.changePackType},o.a.createElement(F.a.Button,{value:0},"整 包"),o.a.createElement(F.a.Button,{value:1},"差 分")))),o.a.createElement(U.a.Item,{label:"固件包名称",hasFeedback:!0},n("deviceVersionName",{rules:[{required:!0,message:"请输入固件包名称"},{pattern:Yt.verNam,message:"仅支持中英文、数字、下划线，须以中英文或数字开头，不超过40个字符"}]})(o.a.createElement(H.a,{maxLength:40,placeholder:"中英文、数字、下划线，且须以中英文或数字开头"}))),o.a.createElement(U.a.Item,{label:"所属产品"},n("productId",{rules:[{required:!0,message:"请选择所属产品"}]})(o.a.createElement(q.a,{placeholder:"选择产品",onBlur:this.getExtVersion,showSearch:!0,optionFilterProp:"children"},a.map((function(e,t){var n=e.productId,a=e.productName;return o.a.createElement(hn,{key:t,value:n},a)}))))),o.a.createElement(U.a.Item,{label:"固件类型"},n("verType",{rules:[{required:!0,message:"请选择固件类型"}]})(o.a.createElement(qt.a,{options:Wt,onChange:this.getExtVersion,expandTrigger:"hover",placeholder:"请选择固件类型"}))),o.a.createElement(U.a.Item,{label:o.a.createElement(Gt.a,{label:"固件系列标识",tip:"区分不同的固件系列，同系列同版本号的固件才能触发升级"}),hasFeedback:!0},n("totalVersion",{rules:[{required:!0,message:"请输入固件系列标识"},{pattern:Yt.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(H.a,{maxLength:30,onBlur:this.getExtVersion,placeholder:"支持字母、数字、下划线、短横线、点号"}))),o.a.createElement(U.a.Item,{label:o.a.createElement(Gt.a,{label:"内部版本号",tip:"同一系列标识的固件通过对比内部版本号决定是否升级"}),hasFeedback:!0},n("mainVersion",{rules:[{required:!0,message:"请输入内部版本号"},{pattern:Yt.mainVer,message:"须为不小于0的整数"},{validator:this.checkMainVersion}]})(o.a.createElement(H.a,{maxLength:10,placeholder:"内部版本须为不小于0的整数"}))),0==i?o.a.createElement(U.a.Item,{label:o.a.createElement(Gt.a,{label:"外部版本号",tip:"升级时对外部用户可见的公开版本号"}),hasFeedback:!0},n("extVersion",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:Yt.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(H.a,{maxLength:30,placeholder:"支持字母、数字、下划线、短横线、点号"}))):o.a.createElement(o.a.Fragment,null,o.a.createElement(U.a.Item,{label:o.a.createElement(Gt.a,{label:"升级对象的外部版本号",tip:"需要升级的对象设备的外部版本号"}),hasFeedback:!0},n("upgradeExtVerison",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:Yt.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(Ht.a,{dataSource:r,placeholder:r.length>0?"选择或输入":"没有查到可选项请手动输入",maxLength:"30",filterOption:!0}))),o.a.createElement(U.a.Item,{label:o.a.createElement(Gt.a,{label:"升级后的外部版本号",tip:"升级时对外部用户可见的公开版本号"}),hasFeedback:!0},n("extVersion",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:Yt.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(H.a,{maxLength:30,placeholder:"支持字母、数字、下划线、短横线、点号"})))),o.a.createElement(U.a.Item,{label:"固件程序：",required:!0},o.a.createElement(F.a.Group,{defaultValue:0,onChange:this.uploadType},o.a.createElement(F.a.Button,{value:0},"本地上传"),o.a.createElement(F.a.Button,{value:1},"填写URL"))),o.a.createElement(U.a.Item,{className:"filepathinpt",hasFeedback:!0},1==l?n("filePath",{rules:[{required:!0,message:"请输入URL"},{pattern:Yt.url,message:"请输入正确的URL"}]})(o.a.createElement(H.a,{maxLength:100,placeholder:"请输入URL"})):o.a.createElement(Ut.a,{onRef:function(t){return e.addFirmwareInput=t},isNotImg:!0,format:".bin,.hex,.zip,.cyacd,.apk,.dpkg",maxSize:200})))}}])&&fn(t.prototype,n),a&&fn(t,a),c}(o.a.Component)),En=(n("W0kV"),n("caRq")),On=(n("cFqh"),n("9RSv")),wn=(n("2ek4"),n("oWtQ")),Sn=n("yq+b"),In=n.n(Sn),jn=n("FIdd");function Pn(e){return(Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Dn=["extVersion","upgradeDevice","beginDate","endDate"];function kn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Tn(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Cn(e,t){return(Cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Rn(e);if(t){var r=Rn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return _n(this,n)}}function _n(e,t){return!t||"object"!==Pn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rn(e){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var An=q.a.Option,Vn=H.a.TextArea,Fn=wn.a.Step,Mn=[5,19],Bn={labelCol:{span:Mn[0]},wrapperCol:{span:Mn[1]}},Hn=U.a.create({name:"ota_reaease_ver"})(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cn(e,t)}(c,e);var t,n,a,r=Ln(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).changeState=function(e,n){var a=n.target?n.target.value:n;t.setState(xn({},e,a))},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(k.a)({description:"文件上传大小超过500k限制"}),!1;var n=t.props,a=n.deviceVersionId,r=n.form.setFieldsValue;return Object(j.d)(j.a.otaImportMac,{multipartFile:e,deviceVersionId:a},{needFormData:!0}).then((function(e){var t=e.data,n=void 0===t?{}:t,a=n.successes,o=(n.fails,n.totalCount),c=n.successCount,i=n.failCount,l=a.join(",");r({upgradeDevice:l}),Object(k.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(c,"条，失败了").concat(i,"条").concat("")})})),!1},t.goPreStep=function(){t.setState({stepcurrent:0})},t.goNextStep=function(){(0,t.props.form.validateFieldsAndScroll)((function(e,n){e||t.setState({stepcurrent:1})}))},t.commit=function(){var e=t.props,n=e.form.validateFieldsAndScroll,a=e.deviceVersionId,r=e.close;n((function(e,n){if(!e){var o=n.extVersion,c=n.upgradeDevice,i=n.beginDate,l=n.endDate,u=Tn(n,Dn);o&&(u.extVersion=o.join(",")),c&&(u.upgradeDevice=c.join&&c.join(",")||c),(i||l)&&(u.beginDate=In()(i).format("YYYY-MM-DD HH:mm:ss"),u.endDate=In()(l).format("YYYY-MM-DD HH:mm:ss")),Object(j.c)(j.a.otaRelease,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kn(Object(n),!0).forEach((function(t){xn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({deviceVersionId:a},u),{loading:!0}).then((function(){t.props.getVersionLi(),r()}))}}))},t.state={upgradeType:1,upgradeRange:1,stepcurrent:0,triggerTime:0},t}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.getGroupLi()}},{key:"render",value:function(){var e=this,t=this.props,n=t.form.getFieldDecorator,a=t.extVerisonLi,r=t.deviceGorupLi,c=t.packageType,i=this.state,l=i.upgradeType,u=i.upgradeRange,s=i.stepcurrent,p=i.triggerTime,f=zt.find((function(e){return e.id==l})).desc;return o.a.createElement("div",{className:"ota_release_dialog"},o.a.createElement("div",{className:"stepbox"},o.a.createElement(wn.a,{current:s,size:"small"},o.a.createElement(Fn,{title:"选择升级范围"}),o.a.createElement(Fn,{title:"配置升级策略"})),4!=l&&o.a.createElement("div",{className:"disabled"})),o.a.createElement(U.a,Bn,o.a.createElement("div",{style:{display:s?"none":"block"}},o.a.createElement(U.a.Item,{label:"升级方式",required:!0,help:f,className:"helpitem"},n("upgradeType",{initialValue:1})(o.a.createElement(F.a.Group,{onChange:function(t){e.changeState("upgradeType",t)}},zt.map((function(e){var t=e.id,n=e.nam;return o.a.createElement(F.a.Button,{key:t,value:t},n)}))))),o.a.createElement(U.a.Item,{label:"升级提示信息"},n("upgradeRemark")(o.a.createElement(Vn,{placeholder:"仅普通升级和强制升级时，用户可在app（或设备屏幕）查看到升级提示，最多50个字符",rows:3,maxLength:50}))),o.a.createElement(U.a.Item,{label:"升级范围",required:!0,help:"若选择全部设备，则有且仅能发布一个批次，不能新增其他发布批次",className:"helpitem"},n("upgradeRange",{initialValue:1})(o.a.createElement(F.a.Group,{onChange:function(t){e.changeState("upgradeRange",t)}},Zt.map((function(e){var t=e.id,n=e.nam;return 4==l&&0==t?null:o.a.createElement(F.a.Button,{key:t,value:t},n)}))))),2==u?o.a.createElement(o.a.Fragment,null,o.a.createElement(U.a.Item,{label:"设备Mac"},n("upgradeDevice",{rules:[{required:!0,message:"请输入或导入要升级的设备Mac"}]})(o.a.createElement(Vn,{placeholder:"请输入或导入要升级的设备Mac，多个用逗号隔开",rows:5}))),o.a.createElement("div",{className:"ota_uploadbox"},o.a.createElement(On.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},o.a.createElement(V.a,{type:"primary",icon:o.a.createElement(jn.a,null)},"批量导入")),o.a.createElement(V.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板"))):o.a.createElement(o.a.Fragment,null,1==u&&o.a.createElement(U.a.Item,{label:"升级设备组"},n("upgradeDevice",{rules:[{required:!0,message:"请选择设备组"}]})(o.a.createElement(q.a,{placeholder:"选择待升级设备组",mode:"multiple"},r.map((function(e){var t=e.id,n=e.name;return o.a.createElement(An,{key:t,value:t},n)}))))),1==c&&o.a.createElement(U.a.Item,{label:"外部版本号"},n("extVersion",{rules:[{required:!0,message:"请选择版本号"}]})(o.a.createElement(q.a,{placeholder:"请选择待升级外部版本号",mode:"multiple"},a.map((function(e,t){return o.a.createElement(An,{key:t,value:e},e)}))))))),4==l&&1==s&&o.a.createElement("div",null,o.a.createElement(U.a.Item,{label:"升级时间策略",required:!0},n("triggerTime",{initialValue:0})(o.a.createElement(F.a.Group,{onChange:function(t){e.changeState("triggerTime",t)}},o.a.createElement(F.a.Button,{value:0},"触发升级"),o.a.createElement(F.a.Button,{value:1},"定时升级")))),1==p&&o.a.createElement(o.a.Fragment,null,o.a.createElement(U.a.Item,{label:"升级开始时间"},n("beginDate",{rules:[{required:!0,message:"请选择开始时间"}]})(o.a.createElement(En.a,xn({showTime:!0,placeholder:"请选择开始时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:In()("00:00:00","HH:mm:ss")})))),o.a.createElement(U.a.Item,{label:"升级结束时间"},n("endDate",{rules:[{required:!0,message:"请选择结束时间"}]})(o.a.createElement(En.a,xn({showTime:!0,placeholder:"请选择结束时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:In()("00:00:00","HH:mm:ss")}))))),o.a.createElement(U.a.Item,{label:"失败重试时间",required:!0},n("retryTime",{initialValue:0})(o.a.createElement(F.a.Group,null,Xt.map((function(e){var t=e.id,n=e.nam;return o.a.createElement(F.a.Button,{key:t,value:t},n)}))))),o.a.createElement(U.a.Item,{label:"失败重试次数",required:!0},n("retryCount",{initialValue:1})(o.a.createElement(F.a.Group,null,$t.map((function(e){var t=e.id,n=e.nam;return o.a.createElement(F.a.Button,{key:t,value:t},n)}))))))),o.a.createElement("div",{className:"btnbox"},4==l?o.a.createElement(o.a.Fragment,null,0==s?o.a.createElement(V.a,{onClick:this.goNextStep,type:"primary"},"下一步"):o.a.createElement(o.a.Fragment,null,o.a.createElement(V.a,{onClick:this.goPreStep},"上一步"),o.a.createElement(V.a,{type:"primary",onClick:this.commit},"确定"))):o.a.createElement(V.a,{type:"primary",onClick:this.commit},"确定")))}}])&&Nn(t.prototype,n),a&&Nn(t,a),c}(r.Component)),qn=(n("q23V"),n("+VvO"));function Un(e){return(Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Jn(e,t){return(Jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Wn(e);if(t){var r=Wn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Qn(this,n)}}function Qn(e,t){return!t||"object"!==Un(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wn(e){return(Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yn,zn=H.a.TextArea,Zn={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},Xn=["系统验证：要求输入的设备全部都升级成功到新版本后，状态才更新成验证完成。","手动验证：用户线下自行对设备验证，验证通过后，选择验证完成状态。"],$n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jn(e,t)}(c,e);var t,n,a,r=Kn(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).changeValidateType=function(){},t.handleSubmit=function(){var e=t.props,n=e.deviceVersionId,a=e.validationDetail,r=a.macSet,o=a.validateType,c=e.pagerIndex,i=e.pageIndex,l=e.close;if(r){var u=t.state.status;Object(j.d)(j.a.otaValidate,{deviceVersionId:n,macSet:r,validateType:o,status:u},{loading:!0}).then((function(e){c(i),l()}))}else t.setState({error:!0})},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(k.a)({description:"文件上传大小超过500k限制"}),!1;var n=t.props.deviceVersionId;return Object(j.d)(j.a.otaImportMac,{multipartFile:e,deviceVersionId:n},{needFormData:!0}).then((function(e){var n=e.data,a=void 0===n?{}:n,r=a.successes,o=(a.fails,a.totalCount),c=a.successCount,i=a.failCount,l=r.join(",");t.props.setValidationDetail("macSet",l),Object(k.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(c,"条，失败了").concat(i,"条").concat("")})})),!1},t.changeStatus=function(e){console.log(1111,e),t.setState({status:e})},t.changeValue=function(e,n){var a=n.target.value;(0,t.props.setValidationDetail)(e,a)},t.state={status:0,error:!1},t}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this.handleSubmit)}},{key:"render",value:function(){var e=this,t=this.props.validationDetail,n=t.macSet,a=t.validateType,r=this.state.error;return o.a.createElement("div",{className:"ota_validationdialog"},o.a.createElement(U.a,Zn,o.a.createElement(U.a.Item,{label:"验证模式",name:"validateType"},o.a.createElement(F.a.Group,{value:a,onChange:function(t){e.changeValue("validateType",t)}},o.a.createElement(F.a.Button,{value:0},"系统验证"),o.a.createElement(F.a.Button,{value:1},"手动验证"))),o.a.createElement(U.a.Item,{label:"设备Mac",required:!0,help:!n&&r?"请输入或导入要验证的设备Mac":"",hasFeedback:!0,validateStatus:!n&&r?"error":""},o.a.createElement(zn,{value:n,placeholder:"请输入或导入要验证的设备Mac，多个用逗号隔开",rows:7,onChange:function(t){e.changeValue("macSet",t)}})),o.a.createElement("div",{className:"ota_uploadbox"},o.a.createElement(On.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},o.a.createElement(V.a,{type:"primary",icon:o.a.createElement(jn.a,null)},"批量导入")),o.a.createElement(V.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板")),1==a&&o.a.createElement(U.a.Item,{label:"线下验证状态",name:"status"},o.a.createElement(F.a.Group,{defaultValue:0,onChange:function(t){e.changeStatus(t.target.value)}},o.a.createElement(F.a.Button,{value:0},"验证中"),o.a.createElement(F.a.Button,{value:1},"验证完成")))),o.a.createElement(qn.a,{message:Xn[a],type:"info",showIcon:!0}))}}])&&Gn(t.prototype,n),a&&Gn(t,a),c}(r.Component),ea=n("cu44"),ta=n("2kug");n("6LkR");function na(e){return(na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function aa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ra(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aa(Object(n),!0).forEach((function(t){oa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ca(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ia(e,t){return(ia=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function la(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=sa(e);if(t){var r=sa(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return ua(this,n)}}function ua(e,t){return!t||"object"!==na(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sa(e){return(sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pa,fa=H.a.Search,da=H.a.Group,ma=q.a.Option,ya=Object(u.b)((function(e){var t=e.get("otaUpgrade");return{productList:t.productList,versionList:t.versionList,extVerisonLi:t.extVerisonLi}}),(function(e){return{getProLi:function(t){return e(Object(an.c)(t))},getVersionLi:function(t){return e(Object(an.d)(t))},getExtVerLi:function(t){return e(Object(an.b)(t))},sendFirmwareDetails:function(t){return e(Object(an.e)(t))}}}))(Yn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ia(e,t)}(c,e);var t,n,a,r=la(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).toFirmwareDetails=function(e){window.location.hash="#/open/bigData/OTA/firmwareDetails/".concat(e)},t.changeState=function(e,n){t.setState(oa({},e,n))},t.switchDialog=function(e){var n=t.state[e];t.setState(oa({},e,!n))},t.openRelease=function(e,n){var a=e.deviceVersionId,r=e.packageType;t.props.getExtVerLi(n),t.setState({releaseFirmwareDialog:!0,deviceVersionId:a,releasePackageType:r})},t.openValidation=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{macSet:"",validateType:0};t.setState({validationFirmwareDialog:!0,deviceVersionId:e,validationDetail:n,validationModTit:n.macSet?"修改验证":"验证"})},t.getValidateInfo=function(e){Object(j.c)(j.a.otaValiGetinfo,{deviceVersionId:e}).then((function(e){var n=e.data||[];t.setState({validateInfo:n}),n.length||Object(k.a)({description:"没有查到验证信息"})}))},t.closeValidateInfo=function(){t.setState({validateInfo:[]})},t.deleteConfirm=function(e){Bt.a.confirm({title:"删除固件",content:"即将删除 ID 为 ".concat(e," 的固件，此固件包下各批次的升级设备信息也将一并删除。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(j.c)(j.a.otaDeleteVer,{deviceVersionId:e}).then((function(e){var n=t.state.pager,a=n.totalRows,r=n.pageIndex;r=a%(10*(r-1))>1?r:r-1,t.pagerIndex(r)}))}})},t.pagerIndex=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=t.state,a=n.productId,r=n.deviceVersionType,o=n.deviceVersionName,c={pageIndex:e};-1!=a&&(c.productId=a),-1!=r&&(c.deviceVersionType=r),o&&(c.deviceVersionName=o),t.props.getVersionLi(c)},t.closeValiFirm=function(){t.switchDialog("validationFirmwareDialog")},t.setValidationDetail=function(e,n){var a=t.state.validationDetail;t.setState({validationDetail:ra(ra({},a),{},oa({},e,n))})},t.refAddFirmware={},t.refValidationFirmware=function(){},t.state={versionList:[],pager:{pageIndex:1,totalRows:10},productId:void 0,deviceVersionType:void 0,deviceVersionName:void 0,addFirmwareDialog:!1,validationFirmwareDialog:!1,deviceVersionId:"",validationDetail:{macSet:"",validateType:0},validationModTit:"验证",validateInfo:[],releaseFirmwareDialog:!1,releasePackageType:0},t.columns=[{title:"固件ID",dataIndex:"deviceVersionId"},{title:"固件包名称",dataIndex:"deviceVersionName"},{title:"固件类型",dataIndex:"deviceVersionType",render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Jt.find((function(t){return t.id==e})).nam}},{title:"包类型",dataIndex:"packageType",render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return tn[e=e||0]}},{title:"固件包上传创建时间",dataIndex:"uploadTime",render:function(e){return o.a.createElement("span",null,P.a.utcToDev(e))}},{title:"内部版本号",dataIndex:"mainVersion"},{title:"外部版本号",dataIndex:"extVersion"},{title:"运行状态",dataIndex:"updateStatus",render:function(e){var t=Kt[e],n=t.nam,a=t.color;return o.a.createElement(Mt.a,{color:a},n)}},{title:"操作",dataIndex:"action",render:function(e,n){var a=n.runStatus,r=n.deviceVersionId,c=n.macSet,i=void 0===c?"":c,l=n.validateType,u=void 0===l?0:l,s=n.productId,p=n.totalVersion,f=n.deviceVersionType,d=n.firmwareVersionType,m=n.packageType;return o.a.createElement("span",null,0==a?o.a.createElement("a",{onClick:function(){t.openValidation(r)}},"验证"):1==a?o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{onClick:function(){t.openValidation(r,{macSet:i,validateType:u||0})}},"修改验证"),o.a.createElement(w.a,{type:"vertical"}),o.a.createElement("a",{onClick:function(){t.getValidateInfo(r)}},"查看验证")):o.a.createElement(o.a.Fragment,null,4!=a&&o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{onClick:function(){t.openRelease({deviceVersionId:r,packageType:m},{productId:s,totalVersion:p,deviceVersionType:f,firmwareVersionType:d})}},"发布"),o.a.createElement(w.a,{type:"vertical"})),3!=a&&o.a.createElement("a",{onClick:function(){t.toFirmwareDetails(r)}},"查看批次")),o.a.createElement(w.a,{type:"vertical"}),o.a.createElement("a",{onClick:function(){t.deleteConfirm(r)}},"删除"))}}],t.valInfoColumns=[{title:"Mac地址",dataIndex:"macAddress"},{title:"验证时间",dataIndex:"upgradeTime",render:function(e){return o.a.createElement("span",null,P.a.utcToDev(e))}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"验证状态",dataIndex:"upgradeStatus",render:function(e){var t=Qt[e],n=t.nam,a=t.color;return o.a.createElement(Mt.a,{color:a},n)}},{title:"失败原因",dataIndex:"remark",render:function(e,t){return 3==t.upgradeStatus&&e||"--"}}],t}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.getProLi({pageRows:999}),this.pagerIndex()}},{key:"render",value:function(){var e=this,t=this.state,n=t.addFirmwareDialog,a=t.releaseFirmwareDialog,r=t.validationFirmwareDialog,c=t.deviceVersionId,l=t.validationDetail,u=t.validateInfo,s=t.releasePackageType,f=t.validationModTit,d=this.props,m=d.productList,y=d.versionList,b=y.list,h=y.pager,v=h.pageIndex,g=h.totalRows;return o.a.createElement("div",{className:"ota-firmware-up"},o.a.createElement(p.a,{noback:!0,title:"OTA升级"}),o.a.createElement(ea.a,null,o.a.createElement("div",{className:"use-service-flow-wrapper"},o.a.createElement(ta.a,{type:3,flowLists:[{title:"步骤一"},{title:"步骤二"},{title:"步骤三"}]}),o.a.createElement("div",{className:"extra-descs"},o.a.createElement("div",{className:"descs-item"},o.a.createElement("p",null,"添加升级包，区分不同的MCU、模组、系统，区分整体包、差分包等。")),o.a.createElement("div",{className:"descs-item"},o.a.createElement("p",null,"配置升级对象，配置升级批次、升级范围、升级时间等升级具体策略。")),o.a.createElement("div",{className:"descs-item"},o.a.createElement("p",null,"查看升级包各升级批次的具体设备列表，以及各设备的升级状态。"))))),o.a.createElement("div",{className:"commonContentBox"},o.a.createElement("div",{className:"centent"},o.a.createElement(da,{compact:!0,className:"searchgroupbox"},o.a.createElement(q.a,{onChange:function(t){e.changeState("productId",t)},className:"proselect",showSearch:!0,optionFilterProp:"children",defaultValue:-1},o.a.createElement(ma,{value:-1},"全部产品"),m.map((function(e,t){var n=e.productId,a=e.productName;return o.a.createElement(ma,{key:t,value:n},a)}))),o.a.createElement(q.a,{className:"typeselect",defaultValue:-1,onChange:function(t){e.changeState("deviceVersionType",t)}},o.a.createElement(ma,{value:-1},"全部类型"),Jt.map((function(e,t){var n=e.id,a=e.nam;return o.a.createElement(ma,{key:t,value:n},a)}))),o.a.createElement(fa,{placeholder:"输入升级包名称查找",className:"serachinpt",enterButton:!0,maxLength:20,onChange:function(t){e.changeState("deviceVersionName",t.target.value)},onSearch:function(){e.pagerIndex(1)}})),o.a.createElement(V.a,{className:"button",onClick:function(){e.switchDialog("addFirmwareDialog")},type:"primary"},"添加固件")),o.a.createElement("div",{className:"listBox"},o.a.createElement(i.a,{rowKey:"deviceVersionId",columns:this.columns,dataSource:b,pagination:{defaultCurrent:v,total:g,hideOnSinglePage:!1,onChange:this.pagerIndex}})),o.a.createElement(Bt.a,{title:"新增固件",visible:n,onOk:function(){e.refAddFirmware.handleSubmit()},onCancel:function(){e.switchDialog("addFirmwareDialog"),e.refAddFirmware.resetForm()},width:650,maskClosable:!1},o.a.createElement(gn,{onRef:function(t){e.refAddFirmware=t},changeState:this.changeState})),a&&o.a.createElement(Bt.a,{title:"发布固件",visible:!0,width:660,onCancel:function(){e.switchDialog("releaseFirmwareDialog")},footer:null,maskClosable:!1},o.a.createElement(Hn,{packageType:s,deviceVersionId:c,close:function(){e.switchDialog("releaseFirmwareDialog")}})),o.a.createElement(Bt.a,{title:f,visible:r,onOk:function(){e.refValidationFirmware()},onCancel:this.closeValiFirm,width:650,maskClosable:!1},o.a.createElement($n,{deviceVersionId:c,validationDetail:ra({},l),setValidationDetail:this.setValidationDetail,pagerIndex:this.pagerIndex,pageIndex:v,onRef:function(t){e.refValidationFirmware=t},close:this.closeValiFirm})),o.a.createElement(Bt.a,{title:"验证信息",visible:!!u.length,onCancel:this.closeValidateInfo,width:800,footer:null,maskClosable:!1},o.a.createElement(i.a,{rowKey:"macAddress",columns:this.valInfoColumns,dataSource:u,pagination:!1}))))}}])&&ca(t.prototype,n),a&&ca(t,a),c}(r.Component))||Yn,ba=(n("miF7"),n("QnTe"));n("7PGj");function ha(e){return(ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?va(Object(n),!0).forEach((function(t){Ea(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ea(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oa(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function wa(e,t){return(wa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Sa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=ja(e);if(t){var r=ja(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ia(this,n)}}function Ia(e,t){return!t||"object"!==ha(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ja(e){return(ja=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pa,Da=Object(u.b)((function(e){e.get("otaUpgrade").firmwareDetails;return{}}),(function(e){return{}}))(pa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wa(e,t)}(c,e);var t,n,a,r=Sa(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).toBatchDetail=function(e){window.location.hash="#/open/bigData/OTA/firmwareBatch/".concat(t.props.match.params.id,"/").concat(e)},t.getBatch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=t.props.match.params.id,a=t.state.batchId;Object(j.c)(j.a.otaGetBatch,{deviceVersionId:n,batchId:a,pageIndex:e,pageRows:10}).then((function(e){var n=e.data,a=n.list,r=void 0===a?[]:a,o=n.pager,c=void 0===o?{}:o;t.setState({list:r,pager:c})}))},t.getDetail=function(){var e=t.props.match.params.id;Object(j.c)(j.a.otaGetVersionDetail,{deviceVersionId:e}).then((function(e){var n=e.data;t.setState({details:ga({},n)})}))},t.search=function(e){t.setState({batchId:e},(function(){t.getBatch()}))},t.state={batchId:void 0,list:[],pager:{},details:{}},t.columns=[{title:"批次ID",dataIndex:"batchId"},{title:"发布时间",dataIndex:"createTime",render:function(e){return o.a.createElement("span",null,e&&P.a.utcToDev(e)||"--")}},{title:"升级范围",dataIndex:"upgradeRange",render:function(e){return Zt[e].nam}},{title:"升级方式",dataIndex:"upgradeType",render:function(e){return zt[e-1].nam}},{title:"升级策略",dataIndex:"triggerTime",render:function(e){return en[e]}},{title:"升级状态",dataIndex:"upgradeStatus",render:function(e){return["升级中","已完成"][e]}},{title:"操作",key:"id",render:function(e,n){var a=n.batchId;return o.a.createElement("span",null,o.a.createElement("a",{onClick:function(){t.toBatchDetail(a)}},"查看"))}}],t}return t=c,(n=[{key:"componentDidMount",value:function(){this.getBatch(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,n=t.pager,a=n.pageIndex,r=n.totalRows,c=t.list,l=t.details,u=l.deviceVersionName,s=l.packageType,f=l.productName,d=l.deviceVersionType,m=void 0===d?1:d,y=l.firmwareVersionType,b=void 0===y?1:y,h=l.uploadTime,v=l.mainVersion,g=l.extVersion,E=l.totalVersion,O=Wt.find((function(e){return e.value==m})),w=O.children[b-1].label;return o.a.createElement("section",{className:"ota-firmwaredetail flex-column"},o.a.createElement(p.a,{title:"OTA升级 / "+u}),o.a.createElement("header",{className:"page-content-header"},o.a.createElement(ba.b,{title:"",className:"descriptions",column:4},o.a.createElement(ba.b.Item,{label:"包类型"},tn[s]),o.a.createElement(ba.b.Item,{label:"所属产品"},f),o.a.createElement(ba.b.Item,{label:"固件类型"},"".concat(O.label,"/").concat(w)),o.a.createElement(ba.b.Item,{label:"上传时间"},h&&P.a.utcToDev(h)),o.a.createElement(ba.b.Item,{label:"内部版本号"},v),o.a.createElement(ba.b.Item,{label:"外部版本号"},g),o.a.createElement(ba.b.Item,{label:"固件系列标识"},E))),o.a.createElement(ea.a,{title:"批次列表"},o.a.createElement("div",{className:"alone-section-content-default"},o.a.createElement(H.a.Search,{placeholder:"输入发布批次ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),o.a.createElement(i.a,{rowKey:"batchId",columns:this.columns,dataSource:c,pagination:{defaultCurrent:a,total:r,hideOnSinglePage:!1,onChange:function(t){e.getBatch(t)},current:a}}))))}}])&&Oa(t.prototype,n),a&&Oa(t,a),c}(r.PureComponent))||pa;function ka(e){return(ka="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ta(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ta(Object(n),!0).forEach((function(t){Na(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ta(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Na(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ca(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function La(e,t){return(La=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Aa(e);if(t){var r=Aa(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ra(this,n)}}function Ra(e,t){return!t||"object"!==ka(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Aa(e){return(Aa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Va=Object(u.b)((function(e){e.get("otaUpgrade").firmwareDetails;return{}}),(function(e){return{}}))(Pa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&La(e,t)}(c,e);var t,n,a,r=_a(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=r.call(this,e)).cancel=function(e){var n=t.verid,a=t.id;Modal.confirm({title:"取消升级",content:"即将取消升级 deviceId 为 ".concat(e," 的设备。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(j.c)(j.a.otaCancelDevicePub,{deviceVersionId:n,batchId:a,deviceId:e}).then((function(){var e=t.state.pager,n=e.totalRows,a=e.pageIndex;a=n%(10*(a-1))>1?a:a-1,t.getList(a)}))}})},t.getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=t.verid,a=t.id,r=t.state.deviceId;Object(j.c)(j.a.otaGetBatchDevice,{deviceVersionId:n,batchId:a,deviceId:r,pageIndex:e,pageRows:10}).then((function(e){var n=e.data,a=n.list,r=void 0===a?[]:a,o=n.pager,c=void 0===o?{}:o;t.setState({list:r.map((function(e,t){return xa(xa({},e),{},{index:t})})),pager:c})}))},t.getDetail=function(){var e=t.verid,n=t.id;Object(j.c)(j.a.otaGetBatchInfo,{deviceVersionId:e,batchId:n}).then((function(e){var n=e.data;t.setState({details:xa({},n)})}))},t.search=function(e){t.setState({deviceId:e},(function(){t.getList()}))},t.id=e.match.params.id,t.verid=e.match.params.verid,t.state={deviceId:void 0,list:[],pager:{},details:{}},t.columns=[{title:"设备ID",dataIndex:"deviceId"},{title:"MAC地址",dataIndex:"mac"},{title:"产品",dataIndex:"productName"},{title:"设备分组名",dataIndex:"groupName"},{title:"最新升级时间",dataIndex:"updateTime",render:function(e){return o.a.createElement("span",null,e&&P.a.utcToDev(e)||"--")}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"升级状态",dataIndex:"upgradeStatus",render:function(e){return e&&Qt[e].nam}},{title:"操作",key:"act",render:function(e,n){var a=n.deviceId,r=n.upgradeStatus;return o.a.createElement("span",null,0==r&&o.a.createElement("a",{onClick:function(){t.cancel(a)}},"取消"))}}],t}return t=c,(n=[{key:"componentDidMount",value:function(){this.getList(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,n=t.pager,a=n.pageIndex,r=n.totalRows,c=t.list,l=t.details,u=l.deviceVersionName,s=l.upgradeStatus,f=void 0===s?0:s,d=l.upgradeRange,m=void 0===d?0:d,y=l.createTime,b=l.triggerTime,h=l.beginTime,v=l.endTime,g=l.retryCount,E=l.retryTime,O=l.deviceVersionType,w=void 0===O?1:O,S=l.firmwareVersionType,I=void 0===S?1:S,j=Wt.find((function(e){return e.value==w})),D=j.children[I-1].label;return o.a.createElement("section",{className:"ota-firmwaredetail flex-column"},o.a.createElement(p.a,{title:"OTA升级 / ".concat(u||"固件包"," / ").concat(this.id)}),o.a.createElement("header",{className:"page-content-header"},o.a.createElement(ba.b,{title:"",className:"descriptions",column:4},o.a.createElement(ba.b.Item,{label:"升级状态"},nn[f]),o.a.createElement(ba.b.Item,{label:"升级范围"},Zt[m].nam),o.a.createElement(ba.b.Item,{label:"发布时间"},y&&P.a.utcToDev(y)),o.a.createElement(ba.b.Item,{label:"升级方式"},"".concat(j.label,"/").concat(D)),o.a.createElement(ba.b.Item,{label:"升级触发策略"},en[b]),o.a.createElement(ba.b.Item,{label:"升级开始时间"},h&&P.a.utcToDev(h)),o.a.createElement(ba.b.Item,{label:"升级结束时间"},v&&P.a.utcToDev(v)),o.a.createElement(ba.b.Item,{label:"升级失败重试"},E,"次"),o.a.createElement(ba.b.Item,{label:"失败重试次数"},g))),o.a.createElement(ea.a,{title:"设备列表"},o.a.createElement("div",{className:"alone-section-content-default"},o.a.createElement(H.a.Search,{placeholder:"输入设备ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),o.a.createElement(i.a,{rowKey:"index",columns:this.columns,dataSource:c,pagination:{defaultCurrent:a,total:r,hideOnSinglePage:!1,onChange:function(t){e.getList(t)},current:a}}))))}}])&&Ca(t.prototype,n),a&&Ca(t,a),c}(r.PureComponent))||Pa;var Fa=function(e){var t=e.match.path;return o.a.createElement(c.e,null,o.a.createElement(c.c,{path:"".concat(t,"/firmwareList"),component:ya}),o.a.createElement(c.c,{path:"".concat(t,"/firmwareDetails/:id"),component:Da}),o.a.createElement(c.c,{path:"".concat(t,"/firmwareBatch/:verid/:id"),component:Va}),o.a.createElement(c.b,{to:"".concat(t,"/firmwareList")}))};function Ma(e){var t=e.match,n=e.muenList,a=t.path;return o.a.createElement(c.e,null,n.map((function(e,t){return"设备数据API"==e.menuname?o.a.createElement(c.c,{key:"设备数据API",path:"".concat(a,"/deviceDataApi"),component:O}):"用户数据API"==e.menuname?o.a.createElement(c.c,{key:"用户数据API",path:"".concat(a,"/userDataApi"),component:O}):"自定义统计方法"==e.menuname?o.a.createElement(c.c,{key:"自定义统计方法",path:"".concat(a,"/customMethod"),component:ge}):"数据订阅"==e.menuname?o.a.createElement(c.c,{key:"数据订阅",path:"".concat(a,"/dataSubscription"),component:Ft}):void 0})),o.a.createElement(c.c,{key:"OTA",path:"".concat(a,"/OTA"),component:Fa}),o.a.createElement(c.b,{to:"".concat(a,"/customMethod")}))}},"uu5+":function(e,t,n){},yqJg:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a=0}}]);