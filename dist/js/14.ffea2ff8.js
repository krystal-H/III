(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"17x9":function(e,t,a){e.exports=a("WUjv")(13)},"2mql":function(e,t,a){e.exports=a("WUjv")(21)},FbVF:function(e,t,a){"use strict";a.r(t);a("rB9j"),a("Rm1S");var n=a("q1tI"),r=a.n(n),o=a("55Ip"),i=(a("NBAS"),a("SuFq"),a("tkto"),a("pNMO"),a("TeQF"),a("5DmW"),a("FZtP"),a("27RR"),a("4Brf"),a("07d7"),a("0oug"),a("4mDm"),a("PKPk"),a("3bBZ"),a("mbEz"),a("wCAj")),c=(a("L/Qf"),a("2/Rp")),l=(a("0lcf"),a("mr32")),u=(a("qNb/"),a("PArb")),s=(a("k3Gp"),a("kLXV")),p=(a("8QGh"),a("2fM7")),f=(a("1vPl"),a("5rEg")),d=(a("RKNx"),a("L41K")),m=(a("fbCW"),a("2B1R"),a("/MKj")),b=a("Nlzp"),v=(a("+2oP"),a("sMBO"),a("pjDv"),a("zKZe"),a("bipt"),a("lrIw")),y=(a("gySj"),a("DFOY")),g=(a("K4yd"),a("9yH6")),h=(a("oVuX"),a("WsrF")),E=(a("XlDN"),a("P2RN")),O=a("rVDo"),w=a("rwTb"),I=[{id:1,nam:"模组固件"},{id:2,nam:"MCU固件"},{id:4,nam:"系统固件"}],j=[{nam:"待升级",color:"blue"},{nam:"升级中",color:"gold"},{nam:"升级成功",color:"green"},{nam:"升级失败",color:"magenta"},{nam:"取消",color:"geekblue"},{nam:"下载结束",color:"geekblue"},{nam:"重置升级",color:"geekblue"}],x=[{value:1,label:"模组固件",children:[{value:1,label:"bootLoader"},{value:2,label:"servicePack"},{value:3,label:"hetProtocol"}]},{value:2,label:"MCU固件",children:[{value:1,label:"controlboard"},{value:2,label:"displayboard"},{value:3,label:"driveboard"}]},{value:4,label:"系统固件",children:[{value:1,label:"Android系统"},{value:2,label:"Linux系统"}]}],V={strextVer:/^[a-zA-Z0-9_\-\.]{1,30}$/,verNam:/^[a-zA-Z0-9\u4e00-\u9fa5][a-zA-Z0-9_\u4e00-\u9fa5]{0,39}$/,mainVer:/^[0-9]*$/,url:/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/},S=[{id:1,nam:"普通升级",desc:"用户可感知，升级触发时用户可以在app上查看到升级提醒，确认后才能升级"},{id:2,nam:"强制升级",desc:"用户可感知，在app上查看到升级提示，无需确认自动开始升级"},{id:3,nam:"静默升级",desc:"用户无感知，无需确认，设备主动请求升级"},{id:4,nam:"推送升级",desc:"用户无感知，无需确认，平台主动推送下发升级到设备（需配置升级策略）"}],D=[{id:0,nam:"全部设备"},{id:1,nam:"设备分组"},{id:2,nam:"指定设备"}],k=[{id:0,nam:"不重试"},{id:1,nam:"30分钟后"},{id:2,nam:"1小时后"}],P=[{id:1,nam:"1 次"},{id:2,nam:"2 次"},{id:3,nam:"3 次"}],T=["触发升级","定时升级"],R=["整包","差分包"],C=["升级中","已完成"],A=a("2C8d");function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(){return(B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(Object(a),!0).forEach((function(t){L(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function L(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,r,o=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return q(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return q(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function z(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=K(e);if(t){var r=K(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return U(this,a)}}function U(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Q=p.a.Option,H={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:15}}},J=h.a.create({name:"addFirmwareDialog"})(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(i,e);var t,a,n,o=Y(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).handleSubmit=function(){var e=t.props,a=e.form.validateFieldsAndScroll,n=e.changeState;a((function(e,a){var r=_(a.verType,2),o=r[0],i=r[1];if(delete a.verType,!e){var c=M(M({},a),{},{deviceVersionType:o,firmwareVersionType:i});if(0==t.state.uploadType){var l=t.addFirmwareInput.getFileListUrl().length>0?t.addFirmwareInput.getFileListUrl().join(","):"";if(!l)return Object(E.a)({description:"请上传固件程序"}),!1;c.filePath=l}Object(b.c)(b.a.otaAddVersion,c,{needFormData:!0,needVersion:1.1,loading:!0}).then((function(e){t.resetForm(),t.props.getVersionLi(),n("addFirmwareDialog",!1)}))}}))},t.resetForm=function(){t.props.form.resetFields(),t.addFirmwareInput.setState({fileList:[]})},t.changePackType=function(e){var a=e.target.value;t.setState({packType:a},(function(){t.getExtVersion()}))},t.uploadType=function(e){var a=e.target.value;t.setState({uploadType:a})},t.getExtVersion=function(){if(0!=t.state.packType){var e=t.props.form.getFieldValue,a=e("productId"),n=e("totalVersion"),r=e("verType")||[],o=_(r,2),i=o[0],c=o[1];a&&n&&2==r.length?t.props.getExtVerLi({productId:a,totalVersion:n,deviceVersionType:i,firmwareVersionType:c}):t.props.getExtVerLi()}},t.checkMainVersion=function(e,t,a){+t>2147483647?a("最大不能超过数值2147483647"):a()},t.state={packType:0,uploadType:0},t}return t=i,(a=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,n=t.productList,o=t.extVerisonLi,i=this.state,c=i.packType,l=i.uploadType;return r.a.createElement(h.a,B({},H,{className:"ota_add_firmware_dialog"}),r.a.createElement(h.a.Item,{label:r.a.createElement(w.a,{label:"包类型",tip:"可选择整体升级包，或者差分包进行升级。"})},a("packageType",{rules:[{required:!0,message:"请选择包类型"}],initialValue:0})(r.a.createElement(g.a.Group,{onChange:this.changePackType},r.a.createElement(g.a.Button,{value:0},"整 包"),r.a.createElement(g.a.Button,{value:1},"差 分")))),r.a.createElement(h.a.Item,{label:"固件包名称",hasFeedback:!0},a("deviceVersionName",{rules:[{required:!0,message:"请输入固件包名称"},{pattern:V.verNam,message:"仅支持中英文、数字、下划线，须以中英文或数字开头，不超过40个字符"}]})(r.a.createElement(f.a,{maxLength:40,placeholder:"中英文、数字、下划线，且须以中英文或数字开头"}))),r.a.createElement(h.a.Item,{label:"所属产品"},a("productId",{rules:[{required:!0,message:"请选择所属产品"}]})(r.a.createElement(p.a,{placeholder:"选择产品",onBlur:this.getExtVersion,showSearch:!0,optionFilterProp:"children"},n.map((function(e,t){var a=e.productId,n=e.productName;return r.a.createElement(Q,{key:t,value:a},n)}))))),r.a.createElement(h.a.Item,{label:"固件类型"},a("verType",{rules:[{required:!0,message:"请选择固件类型"}]})(r.a.createElement(y.a,{options:x,onChange:this.getExtVersion,expandTrigger:"hover",placeholder:"请选择固件类型"}))),r.a.createElement(h.a.Item,{label:r.a.createElement(w.a,{label:"固件系列标识",tip:"区分不同的固件系列，同系列同版本号的固件才能触发升级"}),hasFeedback:!0},a("totalVersion",{rules:[{required:!0,message:"请输入固件系列标识"},{pattern:V.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(r.a.createElement(f.a,{maxLength:30,onBlur:this.getExtVersion,placeholder:"支持字母、数字、下划线、短横线、点号"}))),r.a.createElement(h.a.Item,{label:r.a.createElement(w.a,{label:"内部版本号",tip:"同一系列标识的固件通过对比内部版本号决定是否升级"}),hasFeedback:!0},a("mainVersion",{rules:[{required:!0,message:"请输入内部版本号"},{pattern:V.mainVer,message:"须为不小于0的整数"},{validator:this.checkMainVersion}]})(r.a.createElement(f.a,{maxLength:10,placeholder:"内部版本须为不小于0的整数"}))),0==c?r.a.createElement(h.a.Item,{label:r.a.createElement(w.a,{label:"外部版本号",tip:"升级时对外部用户可见的公开版本号"}),hasFeedback:!0},a("extVersion",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:V.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(r.a.createElement(f.a,{maxLength:30,placeholder:"支持字母、数字、下划线、短横线、点号"}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a.Item,{label:r.a.createElement(w.a,{label:"升级对象的外部版本号",tip:"需要升级的对象设备的外部版本号"}),hasFeedback:!0},a("upgradeExtVerison",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:V.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(r.a.createElement(v.a,{dataSource:o,placeholder:o.length>0?"选择或输入":"没有查到可选项请手动输入",maxLength:"30",filterOption:!0}))),r.a.createElement(h.a.Item,{label:r.a.createElement(w.a,{label:"升级后的外部版本号",tip:"升级时对外部用户可见的公开版本号"}),hasFeedback:!0},a("extVersion",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:V.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(r.a.createElement(f.a,{maxLength:30,placeholder:"支持字母、数字、下划线、短横线、点号"})))),r.a.createElement(h.a.Item,{label:"固件程序：",required:!0},r.a.createElement(g.a.Group,{defaultValue:0,onChange:this.uploadType},r.a.createElement(g.a.Button,{value:0},"本地上传"),r.a.createElement(g.a.Button,{value:1},"填写URL"))),r.a.createElement(h.a.Item,{className:"filepathinpt",hasFeedback:!0},1==l?a("filePath",{rules:[{required:!0,message:"请输入URL"},{pattern:V.url,message:"请输入正确的URL"}]})(r.a.createElement(f.a,{maxLength:100,placeholder:"请输入URL"})):r.a.createElement(O.a,{onRef:function(t){return e.addFirmwareInput=t},isNotImg:!0,format:".bin,.hex,.zip,.cyacd,.apk,.dpkg",maxSize:200})))}}])&&z(t.prototype,a),n&&z(t,n),i}(r.a.Component)),W=(a("U8R4"),a("+eQT")),Z=(a("7W5+"),a("8z0m")),X=(a("ma9I"),a("wd/R")),$=a.n(X),ee=a("z7Xi");function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ae=["extVersion","upgradeDevice","beginDate","endDate"];function ne(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function re(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function oe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ie(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=se(e);if(t){var r=se(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return ue(this,a)}}function ue(e,t){return!t||"object"!==te(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pe=p.a.Option,fe=f.a.TextArea,de=d.a.Step,me=[5,19],be={labelCol:{span:me[0]},wrapperCol:{span:me[1]}},ve=h.a.create({name:"ota_reaease_ver"})(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(i,e);var t,a,n,o=le(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).changeState=function(e,a){var n=a.target?a.target.value:a;t.setState(oe({},e,n))},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(E.a)({description:"文件上传大小超过500k限制"}),!1;var a=t.props,n=a.deviceVersionId,r=a.form.setFieldsValue;return Object(b.c)(b.a.otaImportMac,{multipartFile:e,deviceVersionId:n},{needFormData:!0}).then((function(e){var t=e.data,a=void 0===t?{}:t,n=a.successes,o=(a.fails,a.totalCount),i=a.successCount,c=a.failCount,l=n.join(",");r({upgradeDevice:l}),Object(E.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})})),!1},t.goPreStep=function(){t.setState({stepcurrent:0})},t.goNextStep=function(){(0,t.props.form.validateFieldsAndScroll)((function(e,a){e||t.setState({stepcurrent:1})}))},t.commit=function(){var e=t.props,a=e.form.validateFieldsAndScroll,n=e.deviceVersionId,r=e.close;a((function(e,a){if(!e){var o=a.extVersion,i=a.upgradeDevice,c=a.beginDate,l=a.endDate,u=re(a,ae);o&&(u.extVersion=o.join(",")),i&&(u.upgradeDevice=i.join&&i.join(",")||i),(c||l)&&(u.beginDate=$()(c).format("YYYY-MM-DD HH:mm:ss"),u.endDate=$()(l).format("YYYY-MM-DD HH:mm:ss")),Object(b.b)(b.a.otaRelease,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(a),!0).forEach((function(t){oe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ne(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({deviceVersionId:n},u),{loading:!0}).then((function(){t.props.getVersionLi(),r()}))}}))},t.state={upgradeType:1,upgradeRange:1,stepcurrent:0,triggerTime:0},t}return t=i,(a=[{key:"componentDidMount",value:function(){this.props.getGroupLi()}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,n=t.extVerisonLi,o=t.deviceGorupLi,i=t.packageType,l=this.state,u=l.upgradeType,s=l.upgradeRange,f=l.stepcurrent,m=l.triggerTime,b=S.find((function(e){return e.id==u})).desc;return r.a.createElement("div",{className:"ota_release_dialog"},r.a.createElement("div",{className:"stepbox"},r.a.createElement(d.a,{current:f,size:"small"},r.a.createElement(de,{title:"选择升级范围"}),r.a.createElement(de,{title:"配置升级策略"})),4!=u&&r.a.createElement("div",{className:"disabled"})),r.a.createElement(h.a,be,r.a.createElement("div",{style:{display:f?"none":"block"}},r.a.createElement(h.a.Item,{label:"升级方式",required:!0,help:b,className:"helpitem"},a("upgradeType",{initialValue:1})(r.a.createElement(g.a.Group,{onChange:function(t){e.changeState("upgradeType",t)}},S.map((function(e){var t=e.id,a=e.nam;return r.a.createElement(g.a.Button,{key:t,value:t},a)}))))),r.a.createElement(h.a.Item,{label:"升级提示信息"},a("upgradeRemark")(r.a.createElement(fe,{placeholder:"仅普通升级和强制升级时，用户可在app（或设备屏幕）查看到升级提示，最多50个字符",rows:3,maxLength:50}))),r.a.createElement(h.a.Item,{label:"升级范围",required:!0,help:"若选择全部设备，则有且仅能发布一个批次，不能新增其他发布批次",className:"helpitem"},a("upgradeRange",{initialValue:1})(r.a.createElement(g.a.Group,{onChange:function(t){e.changeState("upgradeRange",t)}},D.map((function(e){var t=e.id,a=e.nam;return 4==u&&0==t?null:r.a.createElement(g.a.Button,{key:t,value:t},a)}))))),2==s?r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a.Item,{label:"设备Mac"},a("upgradeDevice",{rules:[{required:!0,message:"请输入或导入要升级的设备Mac"}]})(r.a.createElement(fe,{placeholder:"请输入或导入要升级的设备Mac，多个用逗号隔开",rows:5}))),r.a.createElement("div",{className:"ota_uploadbox"},r.a.createElement(Z.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},r.a.createElement(c.a,{type:"primary",icon:r.a.createElement(ee.a,null)},"批量导入")),r.a.createElement(c.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板"))):r.a.createElement(r.a.Fragment,null,1==s&&r.a.createElement(h.a.Item,{label:"升级设备组"},a("upgradeDevice",{rules:[{required:!0,message:"请选择设备组"}]})(r.a.createElement(p.a,{placeholder:"选择待升级设备组",mode:"multiple"},o.map((function(e){var t=e.id,a=e.name;return r.a.createElement(pe,{key:t,value:t},a)}))))),1==i&&r.a.createElement(h.a.Item,{label:"外部版本号"},a("extVersion",{rules:[{required:!0,message:"请选择版本号"}]})(r.a.createElement(p.a,{placeholder:"请选择待升级外部版本号",mode:"multiple"},n.map((function(e,t){return r.a.createElement(pe,{key:t,value:e},e)}))))))),4==u&&1==f&&r.a.createElement("div",null,r.a.createElement(h.a.Item,{label:"升级时间策略",required:!0},a("triggerTime",{initialValue:0})(r.a.createElement(g.a.Group,{onChange:function(t){e.changeState("triggerTime",t)}},r.a.createElement(g.a.Button,{value:0},"触发升级"),r.a.createElement(g.a.Button,{value:1},"定时升级")))),1==m&&r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a.Item,{label:"升级开始时间"},a("beginDate",{rules:[{required:!0,message:"请选择开始时间"}]})(r.a.createElement(W.a,oe({showTime:!0,placeholder:"请选择开始时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:$()("00:00:00","HH:mm:ss")})))),r.a.createElement(h.a.Item,{label:"升级结束时间"},a("endDate",{rules:[{required:!0,message:"请选择结束时间"}]})(r.a.createElement(W.a,oe({showTime:!0,placeholder:"请选择结束时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:$()("00:00:00","HH:mm:ss")}))))),r.a.createElement(h.a.Item,{label:"失败重试时间",required:!0},a("retryTime",{initialValue:0})(r.a.createElement(g.a.Group,null,k.map((function(e){var t=e.id,a=e.nam;return r.a.createElement(g.a.Button,{key:t,value:t},a)}))))),r.a.createElement(h.a.Item,{label:"失败重试次数",required:!0},a("retryCount",{initialValue:1})(r.a.createElement(g.a.Group,null,P.map((function(e){var t=e.id,a=e.nam;return r.a.createElement(g.a.Button,{key:t,value:t},a)}))))))),r.a.createElement("div",{className:"btnbox"},4==u?r.a.createElement(r.a.Fragment,null,0==f?r.a.createElement(c.a,{onClick:this.goNextStep,type:"primary"},"下一步"):r.a.createElement(r.a.Fragment,null,r.a.createElement(c.a,{onClick:this.goPreStep},"上一步"),r.a.createElement(c.a,{type:"primary",onClick:this.commit},"确定"))):r.a.createElement(c.a,{type:"primary",onClick:this.commit},"确定")))}}])&&ie(t.prototype,a),n&&ie(t,n),i}(n.Component)),ye=(a("2DKY"),a("+KLJ"));function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ie(e);if(t){var r=Ie(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return we(this,a)}}function we(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ie(e){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var je,xe=f.a.TextArea,Ve={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},Se=["系统验证：要求输入的设备全部都升级成功到新版本后，状态才更新成验证完成。","手动验证：用户线下自行对设备验证，验证通过后，选择验证完成状态。"],De=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(i,e);var t,a,n,o=Oe(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,e)).changeValidateType=function(){},t.handleSubmit=function(){var e=t.props,a=e.deviceVersionId,n=e.validationDetail,r=n.macSet,o=n.validateType,i=e.pagerIndex,c=e.pageIndex,l=e.close;if(r){var u=t.state.status;Object(b.c)(b.a.otaValidate,{deviceVersionId:a,macSet:r,validateType:o,status:u},{loading:!0}).then((function(e){i(c),l()}))}else t.setState({error:!0})},t.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},t.beforeUpload=function(e){if(!(e.size/1024<500))return Object(E.a)({description:"文件上传大小超过500k限制"}),!1;var a=t.props.deviceVersionId;return Object(b.c)(b.a.otaImportMac,{multipartFile:e,deviceVersionId:a},{needFormData:!0}).then((function(e){var a=e.data,n=void 0===a?{}:a,r=n.successes,o=(n.fails,n.totalCount),i=n.successCount,c=n.failCount,l=r.join(",");t.props.setValidationDetail("macSet",l),Object(E.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})})),!1},t.changeStatus=function(e){console.log(1111,e),t.setState({status:e})},t.changeValue=function(e,a){var n=a.target.value;(0,t.props.setValidationDetail)(e,n)},t.state={status:0,error:!1},t}return t=i,(a=[{key:"componentDidMount",value:function(){this.props.onRef(this.handleSubmit)}},{key:"render",value:function(){var e=this,t=this.props.validationDetail,a=t.macSet,n=t.validateType,o=this.state.error;return r.a.createElement("div",{className:"ota_validationdialog"},r.a.createElement(h.a,Ve,r.a.createElement(h.a.Item,{label:"验证模式",name:"validateType"},r.a.createElement(g.a.Group,{value:n,onChange:function(t){e.changeValue("validateType",t)}},r.a.createElement(g.a.Button,{value:0},"系统验证"),r.a.createElement(g.a.Button,{value:1},"手动验证"))),r.a.createElement(h.a.Item,{label:"设备Mac",required:!0,help:!a&&o?"请输入或导入要验证的设备Mac":"",hasFeedback:!0,validateStatus:!a&&o?"error":""},r.a.createElement(xe,{value:a,placeholder:"请输入或导入要验证的设备Mac，多个用逗号隔开",rows:7,onChange:function(t){e.changeValue("macSet",t)}})),r.a.createElement("div",{className:"ota_uploadbox"},r.a.createElement(Z.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},r.a.createElement(c.a,{type:"primary",icon:r.a.createElement(ee.a,null)},"批量导入")),r.a.createElement(c.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板")),1==n&&r.a.createElement(h.a.Item,{label:"线下验证状态",name:"status"},r.a.createElement(g.a.Group,{defaultValue:0,onChange:function(t){e.changeStatus(t.target.value)}},r.a.createElement(g.a.Button,{value:0},"验证中"),r.a.createElement(g.a.Button,{value:1},"验证完成")))),r.a.createElement(ye.a,{message:Se[n],type:"info",showIcon:!0}))}}])&&he(t.prototype,a),n&&he(t,n),i}(n.Component),ke=a("DgvE"),Pe=a("MeRu"),Te=a("QjPx"),Re=a.n(Te);a("p7yf");function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Fe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(a),!0).forEach((function(t){Be(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ae(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Be(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ne(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=qe(e);if(t){var r=qe(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return _e(this,a)}}function _e(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ze,Ge=d.a.Step,Ye=f.a.Search,Ue=f.a.Group,Ke=p.a.Option,Qe=Object(m.connect)((function(e){var t=e.get("otaUpgrade");return{versionList:t.versionList,extVerisonLi:t.extVerisonLi}}),(function(e){return{getVersionLi:function(t){return e(Object(A.c)(t))},getExtVerLi:function(t){return e(Object(A.b)(t))}}}))(je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(f,e);var t,a,n,o=Le(f);function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=o.call(this,e)).toFirmwareDetails=function(e){window.location.hash="#/open/bigData/OTA/firmwareDetails/".concat(e)},t.changeState=function(e,a){t.setState(Be({},e,a))},t.switchDialog=function(e){var a=t.state[e];t.setState(Be({},e,!a))},t.openRelease=function(e,a){var n=e.deviceVersionId,r=e.packageType;t.props.getExtVerLi(a),t.setState({releaseFirmwareDialog:!0,deviceVersionId:n,releasePackageType:r})},t.openValidation=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{macSet:"",validateType:0};t.setState({validationFirmwareDialog:!0,deviceVersionId:e,validationDetail:a,validationModTit:a.macSet?"修改验证":"验证"})},t.getValidateInfo=function(e){Object(b.b)(b.a.otaValiGetinfo,{deviceVersionId:e}).then((function(e){var a=e.data||[];t.setState({validateInfo:a}),a.length||Object(E.a)({description:"没有查到验证信息"})}))},t.closeValidateInfo=function(){t.setState({validateInfo:[]})},t.deleteConfirm=function(e){s.a.confirm({title:"删除固件",content:"即将删除 ID 为 ".concat(e," 的固件，此固件包下各批次的升级设备信息也将一并删除。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(b.b)(b.a.otaDeleteVer,{deviceVersionId:e}).then((function(e){var a=t.state.pager,n=a.totalRows,r=a.pageIndex;r=n%(10*(r-1))>1?r:r-1,t.pagerIndex(r)}))}})},t.pagerIndex=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=t.state,n=a.productId,r=a.deviceVersionType,o=a.deviceVersionName,i={pageIndex:e,productId:n};-1!=r&&(i.deviceVersionType=r),o&&(i.deviceVersionName=o),t.props.getVersionLi(i)},t.closeValiFirm=function(){t.switchDialog("validationFirmwareDialog")},t.setValidationDetail=function(e,a){var n=t.state.validationDetail;t.setState({validationDetail:Fe(Fe({},n),{},Be({},e,a))})},t.refAddFirmware={},t.refValidationFirmware=function(){},t.state={versionList:[],pager:{pageIndex:1,totalRows:10},productId:void 0,deviceVersionType:void 0,deviceVersionName:void 0,addFirmwareDialog:!1,validationFirmwareDialog:!1,deviceVersionId:"",validationDetail:{macSet:"",validateType:0},validationModTit:"验证",validateInfo:[],releaseFirmwareDialog:!1,releasePackageType:0},t.columns=[{title:"固件ID",dataIndex:"deviceVersionId"},{title:"固件包名称",dataIndex:"deviceVersionName"},{title:"固件类型",dataIndex:"deviceVersionType",render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return I.find((function(t){return t.id==e})).nam}},{title:"包类型",dataIndex:"packageType",render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return R[e=e||0]}},{title:"固件包上传创建时间",dataIndex:"uploadTime",render:function(e){return r.a.createElement("span",null,ke.a.utcToDev(e))}},{title:"内部版本号",dataIndex:"mainVersion"},{title:"外部版本号",dataIndex:"extVersion"},{title:"操作",dataIndex:"action",render:function(e,a){var n=a.runStatus,o=a.deviceVersionId,i=a.macSet,c=void 0===i?"":i,l=a.validateType,s=void 0===l?0:l,p=a.productId,f=a.totalVersion,d=a.deviceVersionType,m=a.firmwareVersionType,b=a.packageType;return r.a.createElement("span",null,0==n?r.a.createElement("a",{onClick:function(){t.openValidation(o)}},"验证"):1==n?r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{onClick:function(){t.openValidation(o,{macSet:c,validateType:s||0})}},"修改验证"),r.a.createElement(u.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){t.getValidateInfo(o)}},"查看验证")):r.a.createElement(r.a.Fragment,null,4!=n&&r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{onClick:function(){t.openRelease({deviceVersionId:o,packageType:b},{productId:p,totalVersion:f,deviceVersionType:d,firmwareVersionType:m})}},"发布"),r.a.createElement(u.a,{type:"vertical"})),3!=n&&r.a.createElement("a",{onClick:function(){t.toFirmwareDetails(o)}},"查看批次")),r.a.createElement(u.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){t.deleteConfirm(o)}},"删除"))}}],t.valInfoColumns=[{title:"Mac地址",dataIndex:"macAddress"},{title:"验证时间",dataIndex:"upgradeTime",render:function(e){return r.a.createElement("span",null,ke.a.utcToDev(e))}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"验证状态",dataIndex:"upgradeStatus",render:function(e){var t=j[e],a=t.nam,n=t.color;return r.a.createElement(l.a,{color:n},a)}},{title:"失败原因",dataIndex:"remark",render:function(e,t){return 3==t.upgradeStatus&&e||"--"}}],t}return t=f,(a=[{key:"componentDidMount",value:function(){this.pagerIndex()}},{key:"render",value:function(){var e=this,t=this.state,a=t.addFirmwareDialog,n=t.releaseFirmwareDialog,o=t.validationFirmwareDialog,l=t.deviceVersionId,u=t.validationDetail,f=t.validateInfo,m=t.releasePackageType,b=t.validationModTit,v=this.props.versionList,y=v.list,g=v.pager,h=g.pageIndex,E=g.totalRows;return r.a.createElement("div",{className:"ota-firmware-up"},r.a.createElement(Pe.a,{title:"固件升级",selectOnchange:function(t){e.changeState("productId",t)}}),r.a.createElement("div",{className:"comm-shadowbox comm-setp-ttip"},r.a.createElement("div",{className:"step-title"},r.a.createElement("img",{src:Re.a}),r.a.createElement("span",null,"固件升级步骤")),r.a.createElement(d.a,{current:-1,initial:0},r.a.createElement(Ge,{title:"添加升级包",description:"添加升级包，区分不同的MCU、模组、系统，区分整体包、差分包等。"}),r.a.createElement(Ge,{title:"配置升级策略",description:"配置升级对象，配置升级批次、升级范围、升级时间等升级具体策略。"}),r.a.createElement(Ge,{title:"查看升级详情",description:"查看升级包各升级批次的具体设备列表，以及各设备的升级状态。"}))),r.a.createElement("div",{className:"otacontent comm-shadowbox"},r.a.createElement("div",{className:"otasearchbox"},r.a.createElement(Ue,{compact:!0,className:"searchgroupbox"},r.a.createElement(p.a,{className:"typeselect",defaultValue:-1,onChange:function(t){e.changeState("deviceVersionType",t)}},r.a.createElement(Ke,{value:-1},"全部类型"),I.map((function(e,t){var a=e.id,n=e.nam;return r.a.createElement(Ke,{key:t,value:a},n)}))),r.a.createElement(Ye,{placeholder:"输入升级包名称查找",className:"serachinpt",enterButton:!0,maxLength:20,onChange:function(t){e.changeState("deviceVersionName",t.target.value)},onSearch:function(){e.pagerIndex(1)}})),r.a.createElement(c.a,{className:"button",onClick:function(){e.switchDialog("addFirmwareDialog")},type:"primary"},"添加固件")),r.a.createElement(i.a,{rowKey:"deviceVersionId",columns:this.columns,dataSource:y,pagination:{defaultCurrent:h,total:E,hideOnSinglePage:!1,onChange:this.pagerIndex}}),r.a.createElement(s.a,{title:"新增固件",visible:a,onOk:function(){e.refAddFirmware.handleSubmit()},onCancel:function(){e.switchDialog("addFirmwareDialog"),e.refAddFirmware.resetForm()},width:650,maskClosable:!1},r.a.createElement(J,{onRef:function(t){e.refAddFirmware=t},changeState:this.changeState})),n&&r.a.createElement(s.a,{title:"发布固件",visible:!0,width:660,onCancel:function(){e.switchDialog("releaseFirmwareDialog")},footer:null,maskClosable:!1},r.a.createElement(ve,{packageType:m,deviceVersionId:l,close:function(){e.switchDialog("releaseFirmwareDialog")}})),r.a.createElement(s.a,{title:b,visible:o,onOk:function(){e.refValidationFirmware()},onCancel:this.closeValiFirm,width:650,maskClosable:!1},r.a.createElement(De,{deviceVersionId:l,validationDetail:Fe({},u),setValidationDetail:this.setValidationDetail,pagerIndex:this.pagerIndex,pageIndex:h,onRef:function(t){e.refValidationFirmware=t},close:this.closeValiFirm})),r.a.createElement(s.a,{title:"验证信息",visible:!!f.length,onCancel:this.closeValidateInfo,width:800,footer:null,maskClosable:!1},r.a.createElement(i.a,{rowKey:"macAddress",columns:this.valInfoColumns,dataSource:f,pagination:!1}))))}}])&&Ne(t.prototype,a),n&&Ne(t,n),f}(n.Component))||je,He=(a("OrB1"),a("gFTJ")),Je=(a("hByQ"),a("cu44"));function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Xe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(a),!0).forEach((function(t){$e(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ze(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function $e(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function et(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=rt(e);if(t){var r=rt(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return nt(this,a)}}function nt(e,t){return!t||"object"!==We(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ot,it=Object(m.connect)((function(e){e.get("otaUpgrade").firmwareDetails;return{}}),(function(e){return{}}))(ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(c,e);var t,a,n,o=at(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=o.call(this,e)).toBatchDetail=function(e){window.location.hash="#/open/bigData/OTA/firmwareBatch/".concat(t.props.match.params.id,"/").concat(e)},t.getBatch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=t.props.match.params.id,n=t.state.batchId;Object(b.b)(b.a.otaGetBatch,{deviceVersionId:a,batchId:n,pageIndex:e,pageRows:10}).then((function(e){var a=e.data,n=a.list,r=void 0===n?[]:n,o=a.pager,i=void 0===o?{}:o;t.setState({list:r,pager:i})}))},t.getDetail=function(){var e=t.props.match.params.id;Object(b.b)(b.a.otaGetVersionDetail,{deviceVersionId:e}).then((function(e){var a=e.data;t.setState({details:Xe({},a)})}))},t.search=function(e){t.setState({batchId:e},(function(){t.getBatch()}))},t.state={batchId:void 0,list:[],pager:{},details:{}},t.columns=[{title:"批次ID",dataIndex:"batchId"},{title:"发布时间",dataIndex:"createTime",render:function(e){return r.a.createElement("span",null,e&&ke.a.utcToDev(e)||"--")}},{title:"升级范围",dataIndex:"upgradeRange",render:function(e){return D[e].nam}},{title:"升级方式",dataIndex:"upgradeType",render:function(e){return S[e-1].nam}},{title:"升级策略",dataIndex:"triggerTime",render:function(e){return T[e]}},{title:"升级状态",dataIndex:"upgradeStatus",render:function(e){return["升级中","已完成"][e]}},{title:"操作",key:"id",render:function(e,a){var n=a.batchId;return r.a.createElement("span",null,r.a.createElement("a",{onClick:function(){t.toBatchDetail(n)}},"查看"))}}],t}return t=c,(a=[{key:"componentDidMount",value:function(){this.getBatch(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,a=t.pager,n=a.pageIndex,o=a.totalRows,c=t.list,l=t.details,u=l.deviceVersionName,s=l.packageType,p=l.productName,d=l.deviceVersionType,m=void 0===d?1:d,b=l.firmwareVersionType,v=void 0===b?1:b,y=l.uploadTime,g=l.mainVersion,h=l.extVersion,E=l.totalVersion,O=x.find((function(e){return e.value==m})),w=O.children[v-1].label;return r.a.createElement("section",{className:"ota-firmwaredetail flex-column"},r.a.createElement(Pe.a,{title:"OTA升级 / "+u}),r.a.createElement("header",{className:"page-content-header"},r.a.createElement(He.b,{title:"",className:"descriptions",column:4},r.a.createElement(He.b.Item,{label:"包类型"},R[s]),r.a.createElement(He.b.Item,{label:"所属产品"},p),r.a.createElement(He.b.Item,{label:"固件类型"},"".concat(O.label,"/").concat(w)),r.a.createElement(He.b.Item,{label:"上传时间"},y&&ke.a.utcToDev(y)),r.a.createElement(He.b.Item,{label:"内部版本号"},g),r.a.createElement(He.b.Item,{label:"外部版本号"},h),r.a.createElement(He.b.Item,{label:"固件系列标识"},E))),r.a.createElement(Je.a,{title:"批次列表"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(f.a.Search,{placeholder:"输入发布批次ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),r.a.createElement(i.a,{rowKey:"batchId",columns:this.columns,dataSource:c,pagination:{defaultCurrent:n,total:o,hideOnSinglePage:!1,onChange:function(t){e.getBatch(t)},current:n}}))))}}])&&et(t.prototype,a),n&&et(t,n),c}(n.PureComponent))||ze;function ct(e){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ut(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(a),!0).forEach((function(t){st(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):lt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function st(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=bt(e);if(t){var r=bt(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return mt(this,a)}}function mt(e,t){return!t||"object"!==ct(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var vt=Object(m.connect)((function(e){e.get("otaUpgrade").firmwareDetails;return{}}),(function(e){return{}}))(ot=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(c,e);var t,a,n,o=dt(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=o.call(this,e)).cancel=function(e){var a=t.verid,n=t.id;Modal.confirm({title:"取消升级",content:"即将取消升级 deviceId 为 ".concat(e," 的设备。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(b.b)(b.a.otaCancelDevicePub,{deviceVersionId:a,batchId:n,deviceId:e}).then((function(){var e=t.state.pager,a=e.totalRows,n=e.pageIndex;n=a%(10*(n-1))>1?n:n-1,t.getList(n)}))}})},t.getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=t.verid,n=t.id,r=t.state.deviceId;Object(b.b)(b.a.otaGetBatchDevice,{deviceVersionId:a,batchId:n,deviceId:r,pageIndex:e,pageRows:10}).then((function(e){var a=e.data,n=a.list,r=void 0===n?[]:n,o=a.pager,i=void 0===o?{}:o;t.setState({list:r.map((function(e,t){return ut(ut({},e),{},{index:t})})),pager:i})}))},t.getDetail=function(){var e=t.verid,a=t.id;Object(b.b)(b.a.otaGetBatchInfo,{deviceVersionId:e,batchId:a}).then((function(e){var a=e.data;t.setState({details:ut({},a)})}))},t.search=function(e){t.setState({deviceId:e},(function(){t.getList()}))},t.id=e.match.params.id,t.verid=e.match.params.verid,t.state={deviceId:void 0,list:[],pager:{},details:{}},t.columns=[{title:"设备ID",dataIndex:"deviceId"},{title:"MAC地址",dataIndex:"mac"},{title:"产品",dataIndex:"productName"},{title:"设备分组名",dataIndex:"groupName"},{title:"最新升级时间",dataIndex:"updateTime",render:function(e){return r.a.createElement("span",null,e&&ke.a.utcToDev(e)||"--")}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"升级状态",dataIndex:"upgradeStatus",render:function(e){return e&&j[e].nam}},{title:"操作",key:"act",render:function(e,a){var n=a.deviceId,o=a.upgradeStatus;return r.a.createElement("span",null,0==o&&r.a.createElement("a",{onClick:function(){t.cancel(n)}},"取消"))}}],t}return t=c,(a=[{key:"componentDidMount",value:function(){this.getList(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,a=t.pager,n=a.pageIndex,o=a.totalRows,c=t.list,l=t.details,u=l.deviceVersionName,s=l.upgradeStatus,p=void 0===s?0:s,d=l.upgradeRange,m=void 0===d?0:d,b=l.createTime,v=l.triggerTime,y=l.beginTime,g=l.endTime,h=l.retryCount,E=l.retryTime,O=l.deviceVersionType,w=void 0===O?1:O,I=l.firmwareVersionType,j=void 0===I?1:I,V=x.find((function(e){return e.value==w})),S=V.children[j-1].label;return r.a.createElement("section",{className:"ota-firmwaredetail flex-column"},r.a.createElement(Pe.a,{title:"OTA升级 / ".concat(u||"固件包"," / ").concat(this.id)}),r.a.createElement("header",{className:"page-content-header"},r.a.createElement(He.b,{title:"",className:"descriptions",column:4},r.a.createElement(He.b.Item,{label:"升级状态"},C[p]),r.a.createElement(He.b.Item,{label:"升级范围"},D[m].nam),r.a.createElement(He.b.Item,{label:"发布时间"},b&&ke.a.utcToDev(b)),r.a.createElement(He.b.Item,{label:"升级方式"},"".concat(V.label,"/").concat(S)),r.a.createElement(He.b.Item,{label:"升级触发策略"},T[v]),r.a.createElement(He.b.Item,{label:"升级开始时间"},y&&ke.a.utcToDev(y)),r.a.createElement(He.b.Item,{label:"升级结束时间"},g&&ke.a.utcToDev(g)),r.a.createElement(He.b.Item,{label:"升级失败重试"},E,"次"),r.a.createElement(He.b.Item,{label:"失败重试次数"},h))),r.a.createElement(Je.a,{title:"设备列表"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(f.a.Search,{placeholder:"输入设备ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),r.a.createElement(i.a,{rowKey:"index",columns:this.columns,dataSource:c,pagination:{defaultCurrent:n,total:o,hideOnSinglePage:!1,onChange:function(t){e.getList(t)},current:n}}))))}}])&&pt(t.prototype,a),n&&pt(t,n),c}(n.PureComponent))||ot;t.default=function(e){var t=e.match.path;return r.a.createElement(o.Switch,null,r.a.createElement(o.Route,{path:"".concat(t,"/list"),component:Qe}),r.a.createElement(o.Route,{path:"".concat(t,"/details/:id"),component:it}),r.a.createElement(o.Route,{path:"".concat(t,"/batch/:verid/:id"),component:vt}),r.a.createElement(o.Redirect,{to:"".concat(t,"/list")}))}},MgzW:function(e,t,a){e.exports=a("WUjv")(35)},QjPx:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAcCAYAAAAAwr0iAAAFnklEQVRIS51XXWxURRT+zr27pYVSlWBCbAlCbRtJDNUKy08UYluoRQR5kwIxao2JLxpNfDJQJTwYNfEVClYQBKJG0VJqW0shpF1FobDhb1OqWNAKTRtp6ZZl55iZO3N3dllx4002d+6duXO+853vnDlLuMt1NHrj/kRs9G0CVrJAMcBBBsDMIP2dfAazeqcufQOpUZRZhMl1t1SVF13MZMrsc8fc0cjQXMHxDiHEDDkpF0ojclczNh/5xjUAb52HxANL447j1FdVzNyTbigjgEiEc66LwXMMnpPind4QRKlem/csCVAGPUYUUgtEjluezkRGAF1n/yoRicQ6hVbYmL0HkfLOWiT4HgE8xoz5zGKyHRKPJdpdE3pwo73jv4bgbtr4r7nO3oGieFzsYCGWp4QHfLEmNKcsI4BolCddjQ2uZxYLWKAEBIelq46jXDYxVf4y4BhypGeMCQLOMJzO6seLmo2B1nB/KwPLVRil/0RcE5otP/UvxcCxyOC8hBB7hRBz04WlqVPBTIZVGU2CMgkgBUd00Ml3X6x6uGhIMhGLxS+AWYVD7lW7qDiFdeqJDhWMj09EWPBMZgwhEHjWyc85K/6++T4nuN7klaHS3I3QbIr9MeFgzYLZq6XRlnD/ETAvNXN3AOjsvfoBM7+pEBJ9XDnvgdfluPPk8L0JHhtmthRnea3TK5n/JhP03SF31YrQrO9auvs/Yog3dE6idvFDqQz80Hv1BDNXKH5BbZWPFi6XiztOXlkshDhueFce6CLgjy2jyZz3giiAD2sXznmrpbtvMzM2eQwwVi4pSQXQcWpgAkw5SiYydQltEDjLxBtY8DS1sZ7ztva0YAzamukfzcW5kSm4Mp6L0VvB2wyK5QcSseKCsemlU2+gMC+GlUvSGOg4OcBGaJJuv4how/JZWO+9QqPqkH8NxVw0D0zH72N5cAnqJ6XuOsmxQ0Dh5HGMxPNK99ZR1HxM7b8MeJH16nuTQ9RkJm/bgwAA/4WckA8BtPxR8MiJwalbAZqqDGsAPggDSN8DDoZdxurPNtAxuQu1/XyZlddegBuqK2ZutvP0buMnP+ESEUeYgPsyGnc0EzYrcixBAKGmOooqAL6ACA3VFbOyBrB4Gx9xgaWSakW55e36cu8o+OJ0khW5xmKoa+c6WkZtJy7rOqXi2rBifnYAnmjkSmK024alwYADrCv3fvI60At8ddrTg1wb0GGS40lBVPkAtBCzBrC0kbcRoz6d+rpy4Hlt3ITvy9PAN5EkS0agQcJ2+v6n33QWqGKdNYBljXzeAcpsxUva040bEF+fAb6NpGZFwMEFav3x12QrI0MQmp2VBp5q5BsuId9OOzsDDmzwTG/cm0GISc2M/m8A1Ts8ALYGJBipAxnvfes9AC9oAFIbZq0FdJQOh/v90kYyBFkyULOTz7uEsgybKkN7NICXPte06+IkRWhABgkX6HDPJXmG6haKGp7OEsAzn/I2Eqi3U9BmY1edx8Ar+zzP7fD4wgW2U2u4XwhmdUAQ+N2ahcWbsilEa5q4koF2owFbjNJgk9fQ4dX9Vmk2LJhwuKiiQz2XZMNQqo221S4qVqdhNtfaXboQ6Y2NlxLATg3gtf2phUidD55OuraupWXU0nNpNzN7EVNHLrWBRLepTqor02iE3aEK4M/Y5Gmd1wpfBlPeHaXYHEjpZ4P0njDsBhHasoqi1B7uK70lcIoF5yX/VXjtkynRSja61089LYFrE7k4fr0IzK6Ksy1KIzg/A7TxgIPV763Rh5E0cqi7r46Zt4M5L2OLldbvq5OTCEL352OJHJwamYGR+BRfbD4Q61h2CV1OEPXScxNivztpDveVIi7eAbCAwSUshZnWeJi/YeZji6VbBOfMwHhB37mxGTcdOIvk8S/DEiRcIeCo62L/1ueoI11b/wAuoupp6qoBZgAAAABJRU5ErkJggg=="},p7yf:function(e,t,a){}}]);